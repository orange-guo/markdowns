<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">通过延长olcIdleTimeout以减少nslcd中的Can&#x27;t contact LDAP server日志报错 | Xiangcheng Kuo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.geek66.cyou/blog/2023/03/28/ldap-idle-timeout"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="通过延长olcIdleTimeout以减少nslcd中的Can&#x27;t contact LDAP server日志报错 | Xiangcheng Kuo"><meta data-rh="true" name="description" content="客户用例执行失败, 其猜测可能是nslcd服务中的Can&#x27;t contact LDAP server相关报错导致其生产用例执行失败."><meta data-rh="true" property="og:description" content="客户用例执行失败, 其猜测可能是nslcd服务中的Can&#x27;t contact LDAP server相关报错导致其生产用例执行失败."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-03-28T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/orange-guo"><meta data-rh="true" property="article:tag" content="problem-solving,ldap,nslcd"><link data-rh="true" rel="icon" href="https://github.com/orange-guo.png"><link data-rh="true" rel="canonical" href="https://www.geek66.cyou/blog/2023/03/28/ldap-idle-timeout"><link data-rh="true" rel="alternate" href="https://www.geek66.cyou/blog/2023/03/28/ldap-idle-timeout" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.geek66.cyou/zh-CN/blog/2023/03/28/ldap-idle-timeout" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://www.geek66.cyou/blog/2023/03/28/ldap-idle-timeout" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xiangcheng Kuo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xiangcheng Kuo Atom Feed"><link rel="stylesheet" href="/assets/css/styles.faeb872e.css">
<script src="/assets/js/runtime~main.564c6659.js" defer="defer"></script>
<script src="/assets/js/main.749f5802.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://github.com/orange-guo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://github.com/orange-guo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Xiangcheng Kuo</b></a><a class="navbar__item navbar__link" href="/docs/software-engineering/introduction">Software Engineering</a><a class="navbar__item navbar__link" href="/docs/booknote/introduction">Book Notes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/orange-guo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/12/22/openfeign-zoned-datetime-formatting-problem">升级框架后发现Feign调用失败时间格式化问题的排查和解决</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/06/01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions">升级到spring-boot-3.1.0后native-image启动报错以及问题解决</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/05/26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios">基于hibernate的spring-data-jpa的并发性能优化配置</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/05/15/solve-unable-to-input-chinese-character-into-vscode">解决无法输入中文字符到vscode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/05/15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview">通过关闭OpenEntityManagerInViewInterceptor确保当下游服务响应缓慢时不会导致数据库连接被占用完</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/05/05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server">通过创建rsa格式的私钥以及服务端启用rsa认证解决jsch连接ssh失败的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/04/23/use-kind-create-a-k8s-cluster">使用kind创建一个k8s集群</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/04/16/hosting-a-static-website-using-s3">使用S3托管静态网站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/04/15/use-gradle-plugin-java-packager-to-build-binary-java-app">使用Gradle的JavaPackager插件将Java应用打包成二进制文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/04/05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine">解决在Kotlin Coroutines中的命令行调用中出现Stream Closed异常</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/04/04/enable-comment-in-docusaurus">为Docusaurus中的Blog启用评论功能</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/31/common-tags-in-gitlab">Gitlab中常见的标签</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/30/fix-elm-package-download-failed">解决elm依赖下载失败的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/30/fix-node-v17-upwards-openssl-hash-error">node.js v17及以上版本使用openssl v3.0引发的哈希算法错误及其解决方法</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2023/03/28/ldap-idle-timeout">通过延长olcIdleTimeout以减少nslcd中的Can&#x27;t contact LDAP server日志报错</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/27/grpc-tls-handshake-failed">grpc服务tls连接握手失败问题排查</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/25/evans">通过使用evans来更加便捷地调试grpc服务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/23/transport-endpoint-is-not-connected">transport endpoint is not connected问题解决</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/16/testcontainers-fixed-port">TestContainers固定容器端口</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/15/ldap-client-failover">通过增加timeout-control以解决当tcp连接一直处于SYN_SENT状态导致java中的ldap-client的failover不工作的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/14/intellij-idea-language-injection">IntelliJ IDEA中实现自定义注解中的语法高亮</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/13/intellij-idea-java-decompiler">使用IntelliJ IDEA中的java-decompiler插件将jar包反编译为java源码</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/09/ssh-execution-timeout">SSH命令无法创建远程连接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/06/problem-build-native-springboot-application">使用spring构建native遇到的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/05/problem-springboot3-upgrade">升级springboot3遇到的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/03/passwd-in-script">脚本中实现修改用户密码</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/02/clojure-validation">基于clojure表达式实现更加灵活的数据验证</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/26/apt-mirror">ubuntu中常用的apt源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/25/nvm">使用nvm实现nodejs多版本管理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/24/enable-sshd-password-authentication">启用SSH密码验证</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/23/naming-pattern-prefix">常见的命名前缀</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/22/springdoc-v2-parameter-object">springdoc-v2中在不配置@ParameterObject的情况下实现Pageable以及Sort对象到API参数的转换</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/21/inject-environment-as-array-into-spring-application">通过环境变量注入数组到应用程序配置</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/20/cleanup-old-version-of-snap-package">清理旧版本的snap应用以释放空间</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/19/enable-nlb-for-eks-service">通过为aws-eks托管的k8s中的service启用nlb以实现对外暴露服务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/18/use-aliyundrive-webdav-with-rclone-to-mount-files">使用aliyundrive-webdav和rclone实现阿里云盘文件挂载到本地</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/17/snap-install-specify-version">使 用snap安装指定版本的应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/16/linux-swapfile">在linux中通过启用swapfile来增加虚拟内存并提高性能</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/15/testcontainers-hostname">在TestContainers中实现配置的容器hostname以解决容器之间访问问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/14/ssh-prompt">跳过SSH连接时的确认提示</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/13/postgres-max-connections">修改postgresql中的最大连接数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/12/postgres-pgdump">将postgresql中指定的database导出为sql文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/11/rclone-fuse">在Docker中使用Rclone并将对应的fuse挂载到宿主机</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/10/pyenv">使用pyenv实现python多版本管理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/09/openjdk-project">JDK改进项目的介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/08/testcontainers-docker-registry">在TestContainers中实现Docker registry认证</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/07/use-chage-command-to-set-password-never-expire">通过调用shell模块来解决旧版本ansible无法设置密码过期时间的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/30/fix-cannot-execute-update-in-a-readonly-transaction">当调度服务接口时报错提示cannot execute UPDATE in a read-only transaction问题解决</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/29/testcontainers-connection-reset">TestContainers启动完fastone-auditing容器后客户端连接报错</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/24/avoiding-the-concurrent-modification-exception">通过引入防御性复制以避免ConcurrentModificationException</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="客户用例执行失败, 其猜测可能是nslcd服务中的Can&#x27;t contact LDAP server相关报错导致其生产用例执行失败."><header><h1 class="title_f1Hy" itemprop="headline">通过延长olcIdleTimeout以减少nslcd中的Can&#x27;t contact LDAP server日志报错</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-03-28T00:00:00.000Z" itemprop="datePublished">March 28, 2023</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/orange-guo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/orange-guo.png" alt="Xiangcheng Kuo" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/orange-guo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Xiangcheng Kuo</span></a></div><small class="avatar__subtitle" itemprop="description">programmer on jvm platform</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>客户用例执行失败, 其猜测可能是<code>nslcd</code>服务中的<code>Can&#x27;t contact LDAP server</code>相关报错导致其生产用例执行失败.<br></p>
<p><code>nslcd</code>日志如下:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[fastone@layout01 ~]$ sudo journalctl -t nslcd| tail --line 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 11:58:24 layout01 nslcd[25607]: [debc9e] &lt;group=&quot;fsadmin&quot;&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 11:59:17 layout01 nslcd[25607]: [fe8aa7] &lt;passwd=2032&gt; ldap_search_ext() failed: Can&#x27;t contact LDAP server: Broken pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 11:59:17 layout01 nslcd[25607]: [fe8aa7] &lt;passwd=2032&gt; no available LDAP server found, sleeping 1 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 11:59:18 layout01 nslcd[25607]: [fe8aa7] &lt;passwd=2032&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:01 layout01 nslcd[25607]: [272b88] &lt;group/member=&quot;root&quot;&gt; ldap_result() failed: Can&#x27;t contact LDAP server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:36 layout01 nslcd[25607]: [66b17f] &lt;group=2001&gt; ldap_search_ext() failed: Can&#x27;t contact LDAP server: Broken pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:36 layout01 nslcd[25607]: [66b17f] &lt;group=2001&gt; no available LDAP server found, sleeping 1 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:37 layout01 nslcd[25607]: [66b17f] &lt;group=2001&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:38 layout01 nslcd[25607]: [a15030] &lt;passwd=2004&gt; ldap_search_ext() failed: Can&#x27;t contact LDAP server: Broken pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:38 layout01 nslcd[25607]: [a15030] &lt;passwd=2004&gt; no available LDAP server found, sleeping 1 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:39 layout01 nslcd[25607]: [a15030] &lt;passwd=2004&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:39 layout01 nslcd[25607]: [9b7b93] &lt;passwd=2001&gt; ldap_result() failed: Can&#x27;t contact LDAP server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:00:54 layout01 nslcd[25607]: [97bb68] &lt;passwd=2011&gt; ldap_result() failed: Can&#x27;t contact LDAP server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:01:36 layout01 nslcd[25607]: [005d16] &lt;group=2011&gt; ldap_result() failed: Can&#x27;t contact LDAP server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:39 layout01 nslcd[25607]: [b9081a] &lt;group=&quot;fsadmin&quot;&gt; ldap_search_ext() failed: Can&#x27;t contact LDAP server: Broken pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:39 layout01 nslcd[25607]: [b9081a] &lt;group=&quot;fsadmin&quot;&gt; no available LDAP server found, sleeping 1 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:40 layout01 nslcd[25607]: [b9081a] &lt;group=&quot;fsadmin&quot;&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:47 layout01 nslcd[25607]: [0f614b] &lt;group/member=&quot;root&quot;&gt; ldap_search_ext() failed: Can&#x27;t contact LDAP server: Broken pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:47 layout01 nslcd[25607]: [0f614b] &lt;group/member=&quot;root&quot;&gt; no available LDAP server found, sleeping 1 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mar 28 12:03:48 layout01 nslcd[25607]: [0f614b] &lt;group/member=&quot;root&quot;&gt; connected to LDAP server ldap://172.20.3.126:389</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从日志中可以发现<code>nslcd</code>服务经常出现<code>Can&#x27;t contact LDAP server</code>.<br></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="问题原因">问题原因<a href="#问题原因" class="hash-link" aria-label="Direct link to 问题原因" title="Direct link to 问题原因">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="触发了ldap-server的连接超时">触发了<code>ldap-server</code>的连接超时<a href="#触发了ldap-server的连接超时" class="hash-link" aria-label="Direct link to 触发了ldap-server的连接超时" title="Direct link to 触发了ldap-server的连接超时">​</a></h3>
<p>这个问题的原因是因  为触发了<code>ldap-server</code>的超时时间, 从而导致<code>nslcd</code>服务中的<code>Can&#x27;t contact LDAP server</code>相关报错.<br>
<code>ldap-server</code>的连接超时时间我们设置的默认为<code>30s</code>为了确保连接不会被一直占用从而导致服务端负载过高.<br>
但是频繁出现这个错误会让客户认为是我们的<code>ldap-server</code>出现问题导致其用例失败, 我们需要延长超时时间来避免客户的误解.<br></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案">解决方案<a href="#解决方案" class="hash-link" aria-label="Direct link to 解决方案" title="Direct link to 解决方案">​</a></h2>
<p>为了解决这个问题, 我们需要修改<code>ldap-server</code>的超时时间.<br>
<code>ldap-server</code>中的超时时间是通过<code>olcIdleTimeout</code>来设置的.<br>
通过修改此值可以延长<code>ldap-server</code>的连接超时时间.<br>
需要注意的是, <code>olcIdleTimeout</code>的单位是秒.<br>
另外的一个注意事项是修改此值需要通过<code>ldap</code>中的<code>config</code>数据库的<code>admin</code>用户来修改.<br>
修改完成之后, 我们需要重启<code>ldap-server</code>服务.<br></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建change-timeoutldif文件">创建<code>change-timeout.ldif</code>文件<a href="#创建change-timeoutldif文件" class="hash-link" aria-label="Direct link to 创建change-timeoutldif文件" title="Direct link to 创建change-timeoutldif文件">​</a></h3>
<p>先创建如下文件, 为了方便, 我们将超时时间设置为<code>12h</code>.</p>
<div class="language-ldif codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">change-timeout.ldif</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ldif codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dn: cn=config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changetype: modify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replace: olcIdleTimeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcIdleTimeout: 43200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="通过ldapmodify命令修改超时时间">通过<code>ldapmodify</code>命令修改超时时间<a href="#通过ldapmodify命令修改超时时间" class="hash-link" aria-label="Direct link to 通过ldapmodify命令修改超时时间" title="Direct link to 通过ldapmodify命令修改超时时间">​</a></h3>
<p>我们需要连接<code>ldap-server</code>并执行<code>ldapmodify</code>命令来修改<code>ldap</code>连接超时时间.<br>
然后执行如下命令</p>
<p>需要注意的是, 执行<code>ldapmodify</code>命令<code>bind</code>的用户为<code>cn=admin,cn=config</code>用户, 该用户是<code>config</code>数据库的<code>admin</code>用户.<br></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldapmodify -x -D cn=admin,cn=config -w &lt;password-of-config-admin&gt; -f change-timeout.ldif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该命令将会输出如下内容</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">modifying entry &quot;cn=config&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当看到上面的输出时, 说明超时时间已经修改成功.<br></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确认超时时间是否修改成功">确认超时时间是否修改成功<a href="#确认超时时间是否修改成功" class="hash-link" aria-label="Direct link to 确认超时时间是否修改成功" title="Direct link to 确认超时时间是否修改成功">​</a></h3>
<p>执行如下命令</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldapsearch -x -D cn=admin,cn=config -w &lt;password-of-config-admin&gt; -b cn=config|grep olcIdleTimeout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该命令将会输出如下内容</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">olcIdleTimeout: 43200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcAttributeTypes: ( OLcfgGlAt:18 NAME &#x27;olcIdleTimeout&#x27; SYNTAX OMsInteger SING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> PendingAuth $ olcDisallows $ olcGentleHUP $ olcIdleTimeout $ olcIndexSubstrIf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过输出的内容可以看到<code>olcIdleTimeout</code>的值已经被修改为<code>43200</code>.<br></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重启ldap-server">重启<code>ldap-server</code><a href="#重启ldap-server" class="hash-link" aria-label="Direct link to 重启ldap-server" title="Direct link to 重启ldap-server">​</a></h3>
<p>为了确保配置生效, 我们需要重启<code>ldap</code>服务.<br>
不同的<code>ldap</code>服务的重启方式不同, 这里以<code>ldap</code>容器为例.<br></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker restart &lt;ldap-container&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证配置是否生效">验证配置是否生效<a href="#验证配置是否生效" class="hash-link" aria-label="Direct link to 验证配置是否生效" title="Direct link to 验证配置是否生效">​</a></h3>
<p>在安装有<code>nslcd</code>服务的机器上执行如下命令.<br>
两个命令中间间隔<code>35s</code>. 如果配置没生效那么30s后会再次出现<code>Can&#x27;t contact LDAP server</code>的报错.<br>
因为我们一开始默认的超时时间是<code>30s</code>, 所以我们需要间隔<code>35s</code>来验证配置是否生效.<br></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">getent passwd -s ldap &amp;&amp; sleep 35s &amp;&amp; getent passwd -s ldap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行期间我们需要观察<code>nslcd</code>服务的日志.<br>
最好开两个终端, 一个执行命令, 一个查看日志. 这样可以更加直观的看到日志.<br></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -u nslcd -f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果配置生效那么我们将不会看到<code>Can&#x27;t contact LDAP server</code>的报错.<br></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="备注">备注<a href="#备注" class="hash-link" aria-label="Direct link to 备注" title="Direct link to 备注">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认超时时间的配置文件">默认超时时间的配置文件<a href="#默认超时时间的配置文件" class="hash-link" aria-label="Direct link to 默认超时时间的配置文件" title="Direct link to 默认超时时间的配置文件">​</a></h3>
<div class="language-ldif codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">change-timeout.ldif</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ldif codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dn: cn=config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changetype: modify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replace: olcIdleTimeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcIdleTimeout: 30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看系统中的nslcd服务的配置文件">查看系统中的<code>nslcd</code>服务的配置文件<a href="#查看系统中的nslcd服务的配置文件" class="hash-link" aria-label="Direct link to 查看系统中的nslcd服务的配置文件" title="Direct link to 查看系统中的nslcd服务的配置文件">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/nslcd.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看ldap-server的olcroot用户的信息">查看<code>ldap-server</code>的<code>olcRoot</code>用户的信息<a href="#查看ldap-server的olcroot用户的信息" class="hash-link" aria-label="Direct link to 查看ldap-server的olcroot用户的信息" title="Direct link to 查看ldap-server的olcroot用户的信息">​</a></h3>
<p><code>olcRoot</code>是<code>ldap-server</code>的超级管理员, 通过该用户可以对<code>ldap-server</code>进行管理.<br></p>
<p>执行如下命令查看<code>ldap-server</code>的<code>olcRoot</code>用户的信息.<br></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /etc/ldap/slapd.d/cn=config &amp;&amp; grep -r &#x27;olcRoot&#x27; *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该命令将会输出如下参考内容</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">olcDatabase={0}config.ldif:olcRootDN: cn=admin,cn=config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcDatabase={0}config.ldif:olcRootPW:: xxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcDatabase={1}mdb.ldif:olcRootDN: cn=admin,dc=demo,dc=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">olcDatabase={1}mdb.ldif:olcRootPW:: xxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过上述输出可以看到有两个<code>olcRoot</code>用户, 一个是<code>cn=admin,cn=config</code>, 另一个是<code>cn=admin,dc=demo,dc=com</code>.<br>
有这两个用  户的原因是因为其是不同<code>olcDatabase</code>的<code>olcRoot</code>用户.<br>
<code>olcDatabase={0}config.ldif</code>是<code>ldap-server</code>的配置数据库. 其主要存放了<code>ldap-server</code>的配置信息.<br>
<code>olcDatabase={1}mdb.ldif</code>是<code>ldap-server</code>的数据数据库. 其主要存放了<code>ldap-server</code>的数据信息, 该数据是给我们使用的.<br></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="确保fd数量可用">确保<code>fd</code>数量可用<a href="#确保fd数量可用" class="hash-link" aria-label="Direct link to 确保fd数量可用" title="Direct link to 确保fd数量可用">​</a></h3>
<p>因为上面修改了<code>ldap-server</code>的超时时间, 所以我们需要确保<code>ldap-server</code>的<code>fd</code>数量足够.<br></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li><a href="https://www.openldap.org/devel/admin/slapdconf2.html" target="_blank" rel="noopener noreferrer">Configuring slapd</a></li>
<li><a href="https://linux.die.net/man/1/ldapmodify" target="_blank" rel="noopener noreferrer">ldapmodify(1) - Linux man page</a></li>
</ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/problem-solving">problem-solving</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ldap">ldap</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nslcd">nslcd</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2023/03/30/fix-node-v17-upwards-openssl-hash-error"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">node.js v17及以上版本使用openssl v3.0引发的哈希算法错误及其解决方法</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2023/03/27/grpc-tls-handshake-failed"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">grpc服务tls连接握手失败问题排查</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#问题原因" class="table-of-contents__link toc-highlight">问题原因</a><ul><li><a href="#触发了ldap-server的连接超时" class="table-of-contents__link toc-highlight">触发了<code>ldap-server</code>的连接超时</a></li></ul></li><li><a href="#解决方案" class="table-of-contents__link toc-highlight">解决方案</a><ul><li><a href="#创建change-timeoutldif文件" class="table-of-contents__link toc-highlight">创建<code>change-timeout.ldif</code>文件</a></li><li><a href="#通过ldapmodify命令修改超时时间" class="table-of-contents__link toc-highlight">通过<code>ldapmodify</code>命令修改超时时间</a></li><li><a href="#确认超时时间是否修改成功" class="table-of-contents__link toc-highlight">确认超时时间是否修改成功</a></li><li><a href="#重启ldap-server" class="table-of-contents__link toc-highlight">重启<code>ldap-server</code></a></li><li><a href="#验证配置是否生效" class="table-of-contents__link toc-highlight">验证配置是否生效</a></li></ul></li><li><a href="#备注" class="table-of-contents__link toc-highlight">备注</a><ul><li><a href="#默认超时时间的配置文件" class="table-of-contents__link toc-highlight">默认超时时间的配置文件</a></li><li><a href="#查看系统中的nslcd服务的配置文件" class="table-of-contents__link toc-highlight">查看系统中的<code>nslcd</code>服务的配置文件</a></li><li><a href="#查看ldap-server的olcroot用户的信息" class="table-of-contents__link toc-highlight">查看<code>ldap-server</code>的<code>olcRoot</code>用户的信息</a></li><li><a href="#确保fd数量可用" class="table-of-contents__link toc-highlight">确保<code>fd</code>数量可用</a></li></ul></li><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>