"use strict";(self.webpackChunkmarkdowns=self.webpackChunkmarkdowns||[]).push([[1663],{95525:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>c});var n=r(82708),a=r(74848),i=r(28453);const o={authors:["orange"],tags:["troubleshooting","java","spring-boot","spring-data","spring-data-ldap","ldap"]},s="\u89e3\u51b3Spring Data LDAP\u4e2dProjection\u67e5\u8be2@Attribute\u5b57\u6bb5\u8fd4\u56de\u7a7a\u503c\u7684\u95ee\u9898",p={authorsImageUrls:[void 0]},c=[{value:"\u95ee\u9898\u63cf\u8ff0",id:"\u95ee\u9898\u63cf\u8ff0",level:2},{value:"\u539f\u56e0\u5206\u6790",id:"\u539f\u56e0\u5206\u6790",level:2},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function l(t){const e={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.p,{children:["Spring Data LDAP\u662fSpring Data\u9879\u76ee\u7684\u5b50\u9879\u76ee\uff0c\u63d0\u4f9b\u4e86\u9762\u5411LDAP\u5b58\u50a8\u5e93\u7684Spring Data\u89c4\u8303\u5b9e\u73b0\u3002",(0,a.jsx)("br",{}),"\n\u5b83\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u50cf\u4f7f\u7528Spring Data JPA\u4e00\u6837\u64cd\u4f5cLDAP\uff0c\u652f\u6301Entity\u3001Repository\u548cProjection\u7b49\u529f\u80fd\u3002",(0,a.jsx)("br",{})]}),"\n",(0,a.jsx)(e.p,{children:"\u95ee\u9898\u51fa\u73b0\u5728\u4f7f\u7528Projection\u6295\u5f71\u67e5\u8be2\u5b9e\u4f53\u7684\u7279\u5b9a\u5b57\u6bb5\u65f6\uff1a\u5f53\u5b9e\u4f53\u5b57\u6bb5\u4f7f\u7528@Attribute\u6ce8\u89e3\u8fdb\u884c\u5b57\u6bb5\u6620\u5c04\u65f6\uff0c\u67e5\u8be2\u7ed3\u679c\u4e2d\u76f8\u5173\u5b57\u6bb5\u503c\u4e3a\u7a7a\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u95ee\u9898\u63cf\u8ff0",children:"\u95ee\u9898\u63cf\u8ff0"}),"\n",(0,a.jsx)(e.p,{children:"\u4ee5\u4e0b\u573a\u666f\u6f14\u793a\u4e86\u8be5\u95ee\u9898\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Ldap\u6570\u636e\u5e93\u5185\u5bb9"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ldif",children:"# base dn\ndn: dc=fastonetech,dc=com\nobjectClass: dcObject\nobjectClass:  organization\nobjectClass: top\ndc: fastonetech\no: fastonetech\n\n# ou => groups\ndn: ou=groups,dc=fastonetech,dc=com\nobjectClass: organizationalUnit\nobjectClass: top\nou: groups\n\n# group {tom}\ndn: cn=tom,ou=groups,dc=fastonetech,dc=com\nobjectClass: top\nobjectClass: posixGroup\ncn: tom\ngidNumber: 1001\nmemberUid: tom\n\n# group {tim}\ndn: cn=tim,ou=groups,dc=fastonetech,dc=com\nobjectClass: top\nobjectClass: posixGroup\ncn: tim\ngidNumber: 1002\nmemberUid: tim\n\n# group {joy}\ndn: cn=joy,ou=groups,dc=fastonetech,dc=com\nobjectClass: top\nobjectClass: posixGroup\ncn: joy\ngidNumber: 1003\nmemberUid: joy\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5b9e\u4f53\u7c7b\u5b9a\u4e49"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@Data\n@Entry(base = "ou=groups", objectClasses = {"posixGroup", "top"})\npublic final class LdapGroup {\n\n\t@Id\n\tprivate Name dn;\n\n\t@Attribute(name = "cn")\n\t@DnAttribute(value = "cn", index = 1)\n\tprivate String name;\n\n\t@Attribute(name = "gidNumber")\n\tprivate Integer groupId;\n\n\t@Attribute(name = "memberUid")\n\tprivate Set<String> members = new HashSet<>();\n\n\tpublic void addMember(String member) {\n\t\tmembers.add(member);\n\t}\n\n\tpublic boolean isOwnerGroup() {\n\t\treturn members.contains(this.name) && this.members.size() == 1;\n\t}\n\n\tpublic boolean isEmpty() {\n\t\treturn members.isEmpty();\n\t}\n\n\tpublic void removeMember(String member) {\n\t\tmembers.remove(member);\n\t}\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Projection\u63a5\u53e3\u5b9a\u4e49"})}),"\n",(0,a.jsx)(e.p,{children:"\u5b9a\u4e49\u4e24\u4e2aProjection\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5\uff0c\u90fd\u53ea\u67e5\u8be2groupId\u5b57\u6bb5\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"interface LdapGroupRepositoryClassBasedProjection extends LdapRepository<LdapGroup> {\n\n record LdapGroupOnlyGroupId(Integer groupId) {\n\n }\n\n List<LdapGroupRepositoryClassBasedProjection.LdapGroupOnlyGroupId> findByGroupIdIsNotNull();\n\n}\n\ninterface LdapGroupRepositoryInterfaceBasedProjection extends LdapRepository<LdapGroup> {\n\n interface LdapGroupOnlyGroupId {\n\n  Integer getGroupId();\n\n }\n\n List<LdapGroupRepositoryInterfaceBasedProjection.LdapGroupOnlyGroupId> findByGroupIdIsNotNull();\n\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6d4b\u8bd5\u7c7b"})}),"\n",(0,a.jsxs)(e.p,{children:["\u6d4b\u8bd5\u4ee3\u7801\u671f\u671b\u901a\u8fc7Projection\u67e5\u8be2\u5230\u4e09\u4e2agroupId\u503c",(0,a.jsx)(e.code,{children:"\uff081001\u30011002\u30011003\uff09"}),"\uff0c\u4f46\u5b9e\u9645\u8fd4\u56de0\u4e2a\u7ed3\u679c\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"class Test {\n\n\t@Test\n\tvoid testLdapProjectionInterfaces() {\n\t\tassertThat(ldapGroupRepositoryClassBasedProjection.count()).isEqualTo(3);\n\t\tvar classBasedProjection = ldapGroupRepositoryClassBasedProjection.findByGroupIdIsNotNull();\n\t\tvar classBasedProjectionGroupIds = classBasedProjection.stream().map(LdapGroupRepositoryClassBasedProjection.LdapGroupOnlyGroupId::groupId).filter(Objects::nonNull).collect(Collectors.toSet());\n\t\tassertThat(classBasedProjectionGroupIds).hasSize(3); // \u9884\u671f 3\uff0c\u5b9e\u96450\n\n\n\t\tassertThat(ldapGroupRepositoryInterfaceBasedProjection.count()).isEqualTo(3);\n\t\tvar interfaceProjection = ldapGroupRepositoryInterfaceBasedProjection.findByGroupIdIsNotNull();\n\t\tvar interfaceProjectionGroupIds = interfaceProjection.stream().map(LdapGroupRepositoryInterfaceBasedProjection.LdapGroupOnlyGroupId::getGroupId).filter(Objects::nonNull).collect(Collectors.toSet());\n\t\tassertThat(interfaceProjectionGroupIds).hasSize(3); // \u9884\u671f 3\uff0c\u5b9e\u96450\n\t}\n\n}\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u539f\u56e0\u5206\u6790",children:"\u539f\u56e0\u5206\u6790"}),"\n",(0,a.jsxs)(e.p,{children:["\u901a\u8fc7\u65ad\u70b9\u8c03\u8bd5Spring Data LDAP\u7684\u67e5\u8be2\u8fc7\u7a0b\u6765\u5206\u6790\u95ee\u9898\u539f\u56e0\u3002\u5728Spring Data LDAP\u4e2d\uff0c\u6240\u6709\u4e0eLDAP\u670d\u52a1\u5668\u7684\u4ea4\u4e92\u90fd\u901a\u8fc7LdapTemplate\u5b8c\u6210\uff0c\u56e0\u6b64\u5728",(0,a.jsx)(e.code,{children:"org.springframework.ldap.core.LdapTemplate"}),"\u7c7b\u7684search\u65b9\u6cd5\u4e0a\u8bbe\u7f6e\u65ad\u70b9\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public <T> List<T> search(Name base, String filter, SearchControls controls, \n    ContextMapper<T> mapper, DirContextProcessor processor)\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"a667049d7ea12a3153a1572ed5f6043c580f30cdf1104352b4303f3ebbdda3ba.png",src:r(22098).A+"",width:"2558",height:"1438"})}),"\n",(0,a.jsxs)(e.p,{children:["\u4ece\u8c03\u8bd5\u4fe1\u606f\u53ef\u4ee5\u770b\u5230",(0,a.jsx)(e.code,{children:"controls.attributes"}),"\u503c\u4e3a",(0,a.jsx)(e.code,{children:'["groupId"]'}),"\uff0c\u8fd9\u662f\u95ee\u9898\u6240\u5728\uff1a",(0,a.jsx)(e.code,{children:"groupId"}),"\u5728LDAP\u4e2d\u5bf9\u5e94\u7684\u5b57\u6bb5\u540d\u5e94\u8be5\u662f",(0,a.jsx)(e.code,{children:"gidNumber"}),"\u3002"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"    /**\n     *  Contains the list of attributes to be returned in\n     * {@code SearchResult} for each matching entry of search. {@code null}\n     * indicates that all attributes are to be returned.\n     * @serial\n     */\n    private String[] attributesToReturn;\n"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"attributesToReturn"}),"\u5b57\u6bb5\u7528\u4e8e\u63a7\u5236LDAP\u8fd4\u56de\u54ea\u4e9b\u5b57\u6bb5\uff0c\u95ee\u9898\u5728\u4e8e\u4e0a\u5c42\u4f20\u9012\u8be5\u503c\u65f6\u6ca1\u6709\u8fdb\u884c\u5b57\u6bb5\u6620\u5c04\u8f6c\u6362\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:["\u8ddf\u8e2a\u8be5\u503c\u7684\u4f20\u9012\u6d41\u7a0b\uff0c\u5b9a\u4f4d\u5230",(0,a.jsx)(e.code,{children:"LdapTemplate.searchControlsForQuery"}),"\u65b9\u6cd5\u4e2d\u7684",(0,a.jsx)(e.code,{children:"query.attributes()"}),"\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class LdapTemplate implements LdapOperations, InitializingBean {\n\n    private SearchControls searchControlsForQuery(LdapQuery query, boolean returnObjFlag) {\n\t\tSearchControls searchControls = getDefaultSearchControls(this.defaultSearchScope, returnObjFlag,\n\t\t\t\tquery.attributes());\n\n\t\tif (query.searchScope() != null) {\n\t\t\tsearchControls.setSearchScope(query.searchScope().getId());\n\t\t}\n\n\t\tif (query.countLimit() != null) {\n\t\t\tsearchControls.setCountLimit(query.countLimit());\n\t\t}\n\n\t\tif (query.timeLimit() != null) {\n\t\t\tsearchControls.setTimeLimit(query.timeLimit());\n\t\t}\n\t\treturn searchControls;\n\t}\n\n}\t\n"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"query.attributes()"}),"\u4e2d\u7684\u6570\u636e\u5728",(0,a.jsx)(e.code,{children:"LdapQueryCreator.create"}),"\u65b9\u6cd5\u4e2d\u521b\u5efa\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"class LdapQueryCreator extends AbstractQueryCreator<LdapQuery, ContainerCriteria> {\n\n\t@Override\n\tprotected ContainerCriteria create(Part part, Iterator<Object> iterator) {\n\n\t\tEntry entry = AnnotatedElementUtils.findMergedAnnotation(entityType, Entry.class);\n\n\t\tLdapQueryBuilder query = query();\n\n\t\tif (entry != null) {\n\t\t\tquery = query.base(entry.base());\n\t\t}\n\n\t\tif (!inputProperties.isEmpty()) {\n\t\t\tquery.attributes(inputProperties.toArray(new String[0]));\n\t\t}\n\n\t\tConditionCriteria criteria = query.where(getAttribute(part));\n\n\t\treturn appendCondition(part, iterator, criteria);\n\t}\n\n}\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u503c\u6765\u81ea",(0,a.jsx)(e.code,{children:"inputProperties"}),"\uff0c\u7ee7\u7eed\u8ffd\u8e2a\u53d1\u73b0\u5b83\u5728",(0,a.jsx)(e.code,{children:"PartTreeLdapRepositoryQuery.createQuery"}),"\u4e2d\u8bbe\u7f6e\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class PartTreeLdapRepositoryQuery extends AbstractLdapRepositoryQuery {\n\n\tprivate final PartTree partTree;\n\tprivate final ObjectDirectoryMapper objectDirectoryMapper;\n\n\tpublic PartTreeLdapRepositoryQuery(LdapQueryMethod queryMethod, Class<?> entityType, LdapOperations ldapOperations,\n\t\t\tMappingContext<? extends PersistentEntity<?, ?>, ? extends PersistentProperty<?>> mappingContext,\n\t\t\tEntityInstantiators instantiators) {\n\n\t\tsuper(queryMethod, entityType, ldapOperations, mappingContext, instantiators);\n\n\t\tpartTree = new PartTree(queryMethod.getName(), entityType);\n\t\tobjectDirectoryMapper = ldapOperations.getObjectDirectoryMapper();\n\t}\n\n\t@Override\n\tprotected LdapQuery createQuery(LdapParameterAccessor parameters) {\n\n\t\tList<String> inputProperties = Collections.emptyList();\n\t\tReturnedType returnedType = getQueryMethod().getResultProcessor().withDynamicProjection(parameters)\n\t\t\t\t.getReturnedType();\n\n\t\tif (returnedType.needsCustomConstruction()) {\n\t\t\tinputProperties = returnedType.getInputProperties();\n\t\t}\n\n\t\torg.springframework.data.ldap.repository.query.LdapQueryCreator queryCreator = new LdapQueryCreator(partTree,\n\t\t\t\tgetEntityClass(), objectDirectoryMapper, parameters, inputProperties);\n\t\treturn queryCreator.createQuery();\n\t}\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5173\u952e\u4ee3\u7801\u6bb5\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"if (returnedType.needsCustomConstruction()) {\n    inputProperties = returnedType.getInputProperties();\n}\n"})}),"\n",(0,a.jsxs)(e.p,{children:["\u5728Projection\u573a\u666f\u4e0b\uff0c",(0,a.jsx)(e.code,{children:"needsCustomConstruction()"}),"\u8fd4\u56de",(0,a.jsx)(e.code,{children:"true"}),"\uff0c",(0,a.jsx)(e.code,{children:"returnedType.getInputProperties()"}),"\u8fd4\u56deProjection\u58f0\u660e\u7684\u5b57\u6bb5\u540d\u3002"]}),"\n",(0,a.jsx)(e.p,{children:"\u95ee\u9898\u6839\u6e90\u5728\u4e8eSpring Data LDAP\u6ca1\u6709\u5bf9Projection\u5b57\u6bb5\u8fdb\u884c\u5b9e\u4f53\u5230LDAP\u7684\u5b57\u6bb5\u6620\u5c04\u3002\u6211\u4eec\u7684\u6620\u5c04\u5b9a\u4e49\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@Attribute(name = "gidNumber")\nprivate Integer groupId;\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u89e3\u51b3\u65b9\u6848",children:"\u89e3\u51b3\u65b9\u6848"}),"\n",(0,a.jsxs)(e.p,{children:["\u89e3\u51b3\u65b9\u6848\u662f\u5728",(0,a.jsx)(e.code,{children:"LdapQueryCreator.create"}),"\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u5b57\u6bb5\u6620\u5c04\u5904\u7406\u3002\u8be5\u7c7b\u7684",(0,a.jsx)(e.code,{children:"getAttribute"}),"\u65b9\u6cd5\u5df2\u7ecf\u5904\u7406\u5176\u4ed6\u573a\u666f\u7684\u6620\u5c04\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'private String getAttribute(Part part) {\n    PropertyPath path = part.getProperty();\n        if (path.hasNext()) {\n        throw new IllegalArgumentException("Nested properties are not supported");\n    }\n\n    return mapper.attributeFor(entityType, path.getSegment());\n}\n'})}),"\n",(0,a.jsxs)(e.p,{children:["\u901a\u8fc7",(0,a.jsx)(e.code,{children:"mapper.attributeFor"}),"\u53ef\u4ee5\u83b7\u53d6\u5b9e\u4f53\u5b57\u6bb5\u6620\u5c04\u540e\u7684LDAP\u5b57\u6bb5\u540d\u3002\u4fee\u6539",(0,a.jsx)(e.code,{children:"create"}),"\u65b9\u6cd5\u6765\u652f\u6301\u6620\u5c04\uff1a"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@Override\nprotected ContainerCriteria create(Part part, Iterator<Object> iterator) {\n\n\tEntry entry = AnnotatedElementUtils.findMergedAnnotation(entityType, Entry.class);\n\n\tLdapQueryBuilder query = query();\n\n\tif (entry != null) {\n\t\tquery = query.base(entry.base());\n\t}\n\n\tif (!inputProperties.isEmpty()) {\n\t\tquery.attributes(inputProperties.stream().map(prop -> mapper.attributeFor(entityType, prop)).toList().toArray(new String[0]));\n\t}\n\n\tConditionCriteria criteria = query.where(getAttribute(part));\n\n\treturn appendCondition(part, iterator, criteria);\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5b8c\u6574\u7684\u4fee\u6539\u4ee3\u7801\u5982\u4e0b\u3002\u8981\u5728\u672c\u5730\u9879\u76ee\u4e2d\u5e94\u7528\u6b64\u4fee\u590d\uff0c\u53ef\u4ee5\u521b\u5efa\u540c\u540d\u7c7b\u8986\u76d6Spring\u7684\u539f\u59cb\u5b9e\u73b0\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/*\n * Copyright 2016-2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.springframework.data.ldap.repository.query;\n\nimport static org.springframework.ldap.query.LdapQueryBuilder.*;\n\nimport java.util.Iterator;\nimport java.util.List;\n\nimport org.springframework.core.annotation.AnnotatedElementUtils;\nimport org.springframework.data.domain.Sort;\nimport org.springframework.data.mapping.PropertyPath;\nimport org.springframework.data.repository.query.parser.AbstractQueryCreator;\nimport org.springframework.data.repository.query.parser.Part;\nimport org.springframework.data.repository.query.parser.PartTree;\nimport org.springframework.ldap.odm.annotations.Entry;\nimport org.springframework.ldap.odm.core.ObjectDirectoryMapper;\nimport org.springframework.ldap.query.ConditionCriteria;\nimport org.springframework.ldap.query.ContainerCriteria;\nimport org.springframework.ldap.query.LdapQuery;\nimport org.springframework.ldap.query.LdapQueryBuilder;\nimport org.springframework.util.Assert;\n\n/**\n * Creator of dynamic queries based on method names.\n *\n * @author Mattias Hellborg Arthursson\n * @author Mark Paluch\n */\nclass LdapQueryCreator extends AbstractQueryCreator<LdapQuery, ContainerCriteria> {\n\n\tprivate final Class<?> entityType;\n\tprivate final ObjectDirectoryMapper mapper;\n\tprivate final List<String> inputProperties;\n\n\t/**\n\t * Constructs a new {@link LdapQueryCreator}.\n\t *\n\t * @param tree must not be {@literal null}.\n\t * @param entityType must not be {@literal null}.\n\t * @param mapper must not be {@literal null}.\n\t * @param parameterAccessor must not be {@literal null}.\n\t * @param inputProperties must not be {@literal null}.\n\t */\n\tLdapQueryCreator(PartTree tree, Class<?> entityType, ObjectDirectoryMapper mapper,\n\t\t\tLdapParameterAccessor parameterAccessor, List<String> inputProperties) {\n\n\t\tsuper(tree, parameterAccessor);\n\n\t\tAssert.notNull(entityType, "Entity type must not be null");\n\t\tAssert.notNull(mapper, "ObjectDirectoryMapper must not be null");\n\n\t\tthis.entityType = entityType;\n\t\tthis.mapper = mapper;\n\t\tthis.inputProperties = inputProperties;\n\t}\n\n\t@Override\n\tprotected ContainerCriteria create(Part part, Iterator<Object> iterator) {\n\n\t\tEntry entry = AnnotatedElementUtils.findMergedAnnotation(entityType, Entry.class);\n\n\t\tLdapQueryBuilder query = query();\n\n\t\tif (entry != null) {\n\t\t\tquery = query.base(entry.base());\n\t\t}\n\n\t\tif (!inputProperties.isEmpty()) {\n\t\t\tquery.attributes(inputProperties.stream().map(prop -> mapper.attributeFor(entityType, prop)).toList().toArray(new String[0]));\n\t\t}\n\n\t\tConditionCriteria criteria = query.where(getAttribute(part));\n\n\t\treturn appendCondition(part, iterator, criteria);\n\t}\n\n\tprivate ContainerCriteria appendCondition(Part part, Iterator<Object> iterator, ConditionCriteria criteria) {\n\n\t\tPart.Type type = part.getType();\n\n\t\tString value = null;\n\t\tif (iterator.hasNext()) {\n\t\t\tObject next = iterator.next();\n\t\t\tvalue = next != null ? next.toString() : null;\n\t\t}\n\t\tswitch (type) {\n\t\t\tcase NEGATING_SIMPLE_PROPERTY:\n\t\t\t\treturn criteria.not().is(value);\n\t\t\tcase SIMPLE_PROPERTY:\n\t\t\t\treturn criteria.is(value);\n\t\t\tcase STARTING_WITH:\n\t\t\t\treturn criteria.like(value + "*");\n\t\t\tcase ENDING_WITH:\n\t\t\t\treturn criteria.like("*" + value);\n\t\t\tcase CONTAINING:\n\t\t\t\treturn criteria.like("*" + value + "*");\n\t\t\tcase LIKE:\n\t\t\t\treturn criteria.like(value);\n\t\t\tcase NOT_LIKE:\n\t\t\t\treturn criteria.not().like(value);\n\t\t\tcase GREATER_THAN_EQUAL:\n\t\t\t\treturn criteria.gte(value);\n\t\t\tcase LESS_THAN_EQUAL:\n\t\t\t\treturn criteria.lte(value);\n\t\t\tcase IS_NOT_NULL:\n\t\t\t\treturn criteria.isPresent();\n\t\t\tcase IS_NULL:\n\t\t\t\treturn criteria.not().isPresent();\n\t\t\tdefault:\n\t\t\t\tthrow new IllegalArgumentException(String.format("%s queries are not supported for LDAP repositories", type));\n\t\t}\n\n\t}\n\n\tprivate String getAttribute(Part part) {\n\t\tPropertyPath path = part.getProperty();\n\t\tif (path.hasNext()) {\n\t\t\tthrow new IllegalArgumentException("Nested properties are not supported");\n\t\t}\n\n\t\treturn mapper.attributeFor(entityType, path.getSegment());\n\t}\n\n\t@Override\n\tprotected ContainerCriteria and(Part part, ContainerCriteria base, Iterator<Object> iterator) {\n\t\tConditionCriteria criteria = base.and(getAttribute(part));\n\n\t\treturn appendCondition(part, iterator, criteria);\n\t}\n\n\t@Override\n\tprotected ContainerCriteria or(ContainerCriteria base, ContainerCriteria criteria) {\n\t\treturn base.or(criteria);\n\t}\n\n\t@Override\n\tprotected LdapQuery complete(ContainerCriteria criteria, Sort sort) {\n\t\treturn criteria;\n\t}\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://github.com/spring-projects/spring-data-ldap/pull/573",children:"Github Pull Request"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"https://docs.spring.io/spring-data/ldap/reference/repositories/projections.html",children:"Spring Data Ldap - Projections"})}),"\n"]})]})}function d(t={}){const{wrapper:e}={...(0,i.R)(),...t.components};return e?(0,a.jsx)(e,{...t,children:(0,a.jsx)(l,{...t})}):l(t)}},22098:(t,e,r)=>{r.d(e,{A:()=>n});const n=r.p+"assets/images/a667049d7ea12a3153a1572ed5f6043c580f30cdf1104352b4303f3ebbdda3ba-912e3f37f9145098cb887b6212ef139f.png"},28453:(t,e,r)=>{r.d(e,{R:()=>o,x:()=>s});var n=r(96540);const a={},i=n.createContext(a);function o(t){const e=n.useContext(i);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function s(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:o(t.components),n.createElement(i.Provider,{value:e},t.children)}},82708:t=>{t.exports=JSON.parse('{"permalink":"/2025/09/11/spring-data-ldap-projection-attribute-mapping-fix","source":"@site/blog/2025-09-11-spring-data-ldap-projection-attribute-mapping-fix.md","title":"\u89e3\u51b3Spring Data LDAP\u4e2dProjection\u67e5\u8be2@Attribute\u5b57\u6bb5\u8fd4\u56de\u7a7a\u503c\u7684\u95ee\u9898","description":"Spring Data LDAP\u662fSpring Data\u9879\u76ee\u7684\u5b50\u9879\u76ee\uff0c\u63d0\u4f9b\u4e86\u9762\u5411LDAP\u5b58\u50a8\u5e93\u7684Spring Data\u89c4\u8303\u5b9e\u73b0\u3002","date":"2025-09-11T00:00:00.000Z","tags":[{"inline":true,"label":"troubleshooting","permalink":"/tags/troubleshooting"},{"inline":true,"label":"java","permalink":"/tags/java"},{"inline":true,"label":"spring-boot","permalink":"/tags/spring-boot"},{"inline":true,"label":"spring-data","permalink":"/tags/spring-data"},{"inline":true,"label":"spring-data-ldap","permalink":"/tags/spring-data-ldap"},{"inline":true,"label":"ldap","permalink":"/tags/ldap"}],"readingTime":6.89,"hasTruncateMarker":true,"authors":[{"name":"orange","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"orange","page":null}],"frontMatter":{"authors":["orange"],"tags":["troubleshooting","java","spring-boot","spring-data","spring-data-ldap","ldap"]},"unlisted":false,"nextItem":{"title":"\u89e3\u51b3Apache Guacamole\u4e2dSSH\u8fde\u63a5\u6570\u91cf\u8d85\u8fc760\u4e2a\u4ee5\u540e\u65e0\u6cd5\u5efa\u7acb\u65b0\u8fde\u63a5\u7684\u95ee\u9898","permalink":"/2025/08/28/fixing-guacamole-ssh-connection-limit-issue"}}')}}]);