"use strict";(self.webpackChunkmarkdowns=self.webpackChunkmarkdowns||[]).push([[1477],{30010:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"/2024/03/14/kopia-integration-with-volcano-cloud-tos-access-denied-issue-investigation-and-fix","metadata":{"permalink":"/blog/2024/03/14/kopia-integration-with-volcano-cloud-tos-access-denied-issue-investigation-and-fix","source":"@site/blog/2024-03-14/kopia-integration-with-volcano-cloud-tos-access-denied-issue-investigation-and-fix.md","title":"kopia\u63a5\u5165\u706b\u5c71\u4e91TOS\u62a5\u9519Access Denied\u95ee\u9898\u7684\u6392\u67e5\u53ca\u4fee\u590d","description":"kopia\u662f\u4e00\u4e2a\u5907\u4efd\u5de5\u5177, \u652f\u6301\u591a\u79cd\u5b58\u50a8\u540e\u7aef, \u5305\u62ec\u5bf9\u8c61\u5b58\u50a8, \u6587\u4ef6\u7cfb\u7edf\u7b49,","date":"2024-03-14T00:00:00.000Z","formattedDate":"March 14, 2024","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"golang","permalink":"/blog/tags/golang"},{"label":"kopia","permalink":"/blog/tags/kopia"},{"label":"volcengine","permalink":"/blog/tags/volcengine"},{"label":"tos","permalink":"/blog/tags/tos"},{"label":"s3","permalink":"/blog/tags/s-3"}],"readingTime":2.54,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","golang","kopia","volcengine","tos","s3"]},"unlisted":false,"nextItem":{"title":"\u5347\u7ea7\u6846\u67b6\u540e\u53d1\u73b0Feign\u8c03\u7528\u5931\u8d25\u65f6\u95f4\u683c\u5f0f\u5316\u95ee\u9898\u7684\u6392\u67e5\u548c\u89e3\u51b3","permalink":"/blog/2023/12/22/openfeign-zoned-datetime-formatting-problem"}},"content":"`kopia`\u662f\u4e00\u4e2a\u5907\u4efd\u5de5\u5177, \u652f\u6301\u591a\u79cd\u5b58\u50a8\u540e\u7aef, \u5305\u62ec`\u5bf9\u8c61\u5b58\u50a8`, `\u6587\u4ef6\u7cfb\u7edf`\u7b49,\\n\u901a\u8fc7kopia\u53ef\u4ee5\u5c06\u6570\u636e\u5907\u4efd\u5230\u4e0d\u540c\u7684\u5b58\u50a8\u540e\u7aef, \u4e5f\u53ef\u4ee5\u4ece\u4e0d\u540c\u7684\u5b58\u50a8\u540e\u7aef\u6062\u590d\u6570\u636e.\\n\u706b\u5c71\u4e91TOS\u662f\u706b\u5c71\u4e91\u63d0\u4f9b\u7684\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1, \u652f\u6301s3\u534f\u8bae.\\n\u6700\u8fd1\u5728\u4f7f\u7528kopia\u63a5\u5165\u706b\u5c71\u4e91TOS\u65f6, \u9047\u5230\u4e86\u4e00\u4e2a\u95ee\u9898, \u95ee\u9898\u7684\u73b0\u8c61\u662f\u8c03\u7528kopia\u63d0\u4f9b\u7684s3_storage\u63a5\u5165\u706b\u5c71\u4e91TOS\u65f6, \u62a5\u9519Access Denied.\\n\\n```log\\nunable to determine if bucket \\"xxxxx\\" exists: Access Denied.\\n```\\n\\n\u4ee5\u4e0b\u662f\u8be5\u95ee\u9898\u7684\u539f\u56e0\u53ca\u89e3\u51b3\u65b9\u6848\u603b\u7ed3.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n\u706b\u5c71\u4e91\u5bf9`S3`\u534f\u8bae\u53ea\u6709\u90e8\u5206\u5b9e\u73b0.\\n\u4ee5\u8bf7\u6c42\u65b9\u5f0f\u4e3a\u4f8b, \u53ea\u652f\u6301`Virtual Hosted-Style`\u7684\u8bf7\u6c42\u65b9\u5f0f, \u4e0d\u652f\u6301`Path-Style`\u7684\u8bf7\u6c42\u65b9\u5f0f.\\n> \u4e0a\u8ff0\u4e24\u79cd\u8bf7\u6c42\u65b9\u5f0f\u4e3b\u8981\u7528\u4e8e\u533a\u5206\u5bf9\u4e0d\u540c\u7684\u5b58\u50a8\u6876\u8fdb\u884c\u64cd\u4f5c.\\n> `Virtual Hosted-Style`:\\n> \u8fd9\u79cd\u8bf7\u6c42\u65b9\u5f0f\u662f\u901a\u8fc7\u5728\u57df\u540d\u4e2d\u6307\u5b9a\u5b58\u50a8\u6876\u540d\u79f0\u6765\u8fdb\u884c\u64cd\u4f5c, \u5982`https://{bucket-name}.s3.{region-code}.amazonaws.com`.\\n> `Path-Style`:\\n> \u8fd9\u79cd\u8bf7\u6c42\u65b9\u5f0f\u662f\u901a\u8fc7\u5728\u57df\u540d\u540e\u9762\u6307\u5b9a\u5b58\u50a8\u6876\u540d\u79f0\u6765\u8fdb\u884c\u64cd\u4f5c, \u5982`https://s3.{region-code}.amazonaws.com/{bucket-name}\\n\\n`kopia`\u901a\u8fc7`minio`\u5b9e\u73b0\u4e86\u5bf9s3\u534f\u8bae\u7684\u652f\u6301, `minio`\u4e2d\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528`Path-Style`\u7684\u8bf7\u6c42\u65b9\u5f0f,\\n\u6240\u4ee5\u5bfc\u81f4\u4e86`Access Denied`\u7684\u95ee\u9898.\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n`minio`\u5728\u521b\u5efa`client`\u7684\u65f6\u5019\u63d0\u4f9b\u4e86`BucketLookup`\u9009\u9879, \u7528\u4e8e\u6307\u5b9a`client`\u4f7f\u7528\u7684\u8bf7\u6c42\u65b9\u5f0f, \u4f46\u662f`kopia`\u6ca1\u6709\u66b4\u9732\u8fd9\u4e2a\u9009\u9879.<br/>\\n\u76ee\u524d\u5df2\u5728`kopia`\u7684`repo`\u4e2d\u5f00\u4e86\u4e00\u4e2a[issue](https://github.com/kopia/kopia/issues/3734), \u9700\u8981\u7b49\u5f85\u540e\u7eed\u7684\u8fdb\u5c55.\\n\\n## \u53c2\u8003\\n\\n- [AWS S3 \u534f\u8bae\u517c\u5bb9\u6027\u8bf4\u660e](https://www.volcengine.com/docs/6349/147050)\\n\\n> TOS \u4ec5\u652f\u6301\u4f7f\u7528\u865a\u62df\u4e3b\u673a\uff08\u5373 VirtualHostStyle\uff09\u7684\u8bf7\u6c42\u65b9\u5f0f\uff0c\u4e0d\u652f\u6301\u8def\u5f84\u6837\u5f0f\uff08\u5373 PathStyle\uff09\u7684\u8bf7\u6c42\u65b9\u5f0f\u3002\u56e0\u6b64\u4f7f\u7528\u5404\u79cd\u652f\u6301 S3 \u534f\u8bae\u7684\\n> SDK \u548c\u5de5\u5177\u8bbf\u95ee TOS \u65f6\uff0c\u8bf7\u52a1\u5fc5\u786e\u4fdd\u914d\u7f6e\u4e86 VirtualHostStyle \u7684\u8bf7\u6c42\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 AWS S3 Java SDK \u65f6\uff0c\u9700\u8981\u5728\u5ba2\u6237\u7aef\u521d\u59cb\u5316\u65f6\u786e\u4fdd\u8bbe\u7f6e\u4e86\u7981\u7528\\n> PathStyle \u7684\u914d\u7f6e\u53c2\u6570\uff1aAmazonS3Builder.withPathStyleAccessEnabled(false)\u3002\\n\\n- [Virtual hosting of buckets](https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html?spm=a2c4g.11186623.0.0.6b9d64012JMDoP)\\n\\n- [Custmize minio creation options](https://github.com/kopia/kopia/issues/3734)"},{"id":"/2023/12/22/openfeign-zoned-datetime-formatting-problem","metadata":{"permalink":"/blog/2023/12/22/openfeign-zoned-datetime-formatting-problem","source":"@site/blog/2023-12-22/openfeign-zoned-datetime-formatting-problem.md","title":"\u5347\u7ea7\u6846\u67b6\u540e\u53d1\u73b0Feign\u8c03\u7528\u5931\u8d25\u65f6\u95f4\u683c\u5f0f\u5316\u95ee\u9898\u7684\u6392\u67e5\u548c\u89e3\u51b3","description":"\u95ee\u9898\u73b0\u8c61","date":"2023-12-22T00:00:00.000Z","formattedDate":"December 22, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"spring-cloud","permalink":"/blog/tags/spring-cloud"},{"label":"spring-cloud-openfeign","permalink":"/blog/tags/spring-cloud-openfeign"},{"label":"openfeign","permalink":"/blog/tags/openfeign"}],"readingTime":8.31,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","spring-cloud","spring-cloud-openfeign","openfeign"]},"unlisted":false,"prevItem":{"title":"kopia\u63a5\u5165\u706b\u5c71\u4e91TOS\u62a5\u9519Access Denied\u95ee\u9898\u7684\u6392\u67e5\u53ca\u4fee\u590d","permalink":"/blog/2024/03/14/kopia-integration-with-volcano-cloud-tos-access-denied-issue-investigation-and-fix"},"nextItem":{"title":"\u5347\u7ea7\u5230spring-boot-3.1.0\u540enative-image\u542f\u52a8\u62a5\u9519\u4ee5\u53ca\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/06/01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions"}},"content":"## \u95ee\u9898\u73b0\u8c61\\n\\n\u5347\u7ea7\u5185\u90e8\u6846\u67b6\u7248\u672c\u540e\uff0c\u53d1\u73b0Feign\u8c03\u7528\u5931\u8d25\uff0c\u62a5\u9519\u5982\u4e0b\uff1a\\n\\n```log\\nFailed to convert value of type \'java.lang.String\' to required type \'java.time.ZonedDateTime\'; \\nnested exception is org.springframework.core.convert.ConversionFailedException: \\n\\tFailed to convert from type [java.lang.String] to type [@org.springframework.web.bind.annotation.RequestParam @org.springframework.format.annotation.DateTimeFormat java.time.ZonedDateTime] for value \'2023/12/18 02:57\'; \\n\\tnested exception is java.lang.IllegalArgumentException: Parse attempt failed for value [2023/12/18 02:57]\\n```\\n\\n\u5ba2\u6237\u7aef\u4f2a\u4ee3\u7801\u5982\u4e0b:\\n\\n```java\\npublic interface FeignClient {\\n\\n\\t@GetMapping(\\"/\\")\\n\\tList<PlatformStandardOrderDto> test(\\n\\t\\t\\t@RequestParam ZonedDateTime startTime,\\n\\t\\t\\t@RequestParam ZonedDateTime endTime\\n\\t);\\n\\n}\\n```\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u73b0\u8c61\u662fFeign\u8c03\u7528\u65f6\u53c2\u6570\u4e2d\u7684`ZonedDatetime`\u7c7b\u578b\u7684\u65f6\u95f4\u683c\u5f0f\u5316\u7684\u7ed3\u679c\u670d\u52a1\u7aef\u65e0\u6cd5\u89e3\u6790\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n> \u6846\u67b6\u5347\u7ea7\u524d\u540e\u5185\u90e8\u7684\u65f6\u95f4\u683c\u5f0f\u5316\u884c\u4e3a\u53d1\u751f\u4e86\u53d8\u5316\u5bfc\u81f4\u8fd9\u4e2a\u95ee\u9898\u7684\u51fa\u73b0.<br/>\\n> \u5728\u65e9\u671f\u6846\u67b6\u4e2d\u6211\u4eec\u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a`SpringMvcContract`.\\n\\n```kotlin\\n@Bean\\n@Primary\\nfun contract(mapper: ObjectMapper, discoverer: DefaultParameterNameDiscoverer): Contract =\\n\\tSpringMvcContract(\\n\\t\\tlistOf(\\n\\t\\t\\tEntityFiltersMappingParameterProcessor(mapper, discoverer),\\n\\t\\t\\tMatrixVariableParameterProcessor(),\\n\\t\\t\\tRequestHeaderParameterProcessor(),\\n\\t\\t\\tPathVariableParameterProcessor(),\\n\\t\\t\\tRequestPartParameterProcessor(),\\n\\t\\t\\tQueryMapParameterProcessor()\\n\\t\\t)\\n\\t)\\n```\\n\\n> `SpringMvcContract`\u591f\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0Feign\u7684\u6ce8\u89e3\u53c2\u6570\u7684\u89e3\u6790(\u4f8b\u5982`@RequestParam`, `@PathVariable`)\\n\\n> \u6846\u67b6\u5347\u7ea7\u524d\u7684\u884c\u4e3a:<br/>\\n> \u7531\u4e8e\u6846\u67b6\u5347\u7ea7\u524d\u7684\u4ee3\u7801\u6ca1\u6709\u4e3a`SpringMvcContract`\u914d\u7f6e`ConversionService`, \u6240\u4ee5`SpringMvcContract`\u65e0\u6cd5\u5904\u7406`ZonedDateTime`\\n> \u4ece\u800c\u5bfc\u81f4\u89e6\u53d1\u4e86Feign\u7684\u9ed8\u8ba4\u884c\u4e3a\u4e5f\u5c31\u662f\u8c03\u7528\u53c2\u6570\u7684`toString`\u65b9\u6cd5\u6765\u5c06\u53c2\u6570\u8f6c\u4e3aString, \u5bf9\u4e8e`ZonedDateTime`\u7c7b\u578b\u7684\u53c2\u6570,\\n> \u8c03\u7528`toString`\u65b9\u6cd5, \u751f\u6210\u7684\u5b57\u7b26\u4e32\u683c\u5f0f\u4e3a`iso-8601`\u683c\u5f0f, \u4f8b\u5982`2023-12-18T02:57:00+08:00[Asia/Shanghai]`,\\n> \u8fd9\u79cd\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u670d\u52a1\u7aef\u662f\u53ef\u4ee5\u89e3\u6790\u7684\\n>\\n> \u6846\u67b6\u5347\u7ea7\u540e\u7684\u884c\u4e3a:<br/>\\n> \u7531\u4e8e\u6846\u67b6\u5185\u90e8\u914d\u7f6e\u4e86`ConversionService`, \u6240\u4ee5\u4f1a\u8c03\u7528`ConversionService`\u7684`convert`\\n> \u65b9\u6cd5\u6765\u5b9e\u73b0\u5c06\u53c2\u6570\u7684\u89e3\u6790, `ConversionService`\\n> \u6700\u7ec8\u4f1a\u59d4\u6258`FormattingConversionService`\u5c06`ZonedDateTime`\u7c7b\u578b\u7684\u53c2\u6570\u8f6c\u4e3a\u5b57\u7b26\u4e32, \u8fd9\u79cd\u60c5\u51b5\u4e0b,\\n> \u4f1a\u5c06\u65f6\u95f4\u8f6c\u4e3a`yyyy/MM/dd HH:mm`\u683c\u5f0f\u7684\u5b57\u7b26\u4e32, \u6240\u4ee5\u5bfc\u81f4\u4e86\u670d\u52a1\u7aef\u65e0\u6cd5\u89e3\u6790.\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u4e3a\u53c2\u6570\u589e\u52a0`@DateTimeFormat`\u6ce8\u89e3\u6765\u6307\u5b9a\u65f6\u95f4\u683c\u5f0f\u5316\u7684\u683c\u5f0f, \u4f8b\u5982:\\n\\n```java\\npublic interface FeignClient {\\n\\n\\t@GetMapping(\\"/\\")\\n\\tList<PlatformStandardOrderDto> test(\\n\\t\\t\\t@DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) @RequestParam ZonedDateTime startTime,\\n\\t\\t\\t@DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) @RequestParam ZonedDateTime endTime\\n\\t);\\n\\n}\\n```\\n\\n## \u95ee\u9898\u6392\u67e5\u8fc7\u7a0b\\n\\n- \u5f53FeignClient\u63a5\u53e3\u7684\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6, \u4f1a\u8c03\u7528`ReflectiveFeign`\u6765\u59d4\u6258`MethodHandler`\u6765\u5904\u7406\u65b9\u6cd5\u8c03\u7528\\n\\n```java\\n\\n@Override\\npublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\\n\\tif (\\"equals\\".equals(method.getName())) {\\n\\t\\ttry {\\n\\t\\t\\tObject otherHandler =\\n\\t\\t\\t\\t\\targs.length > 0 && args[0] != null ? Proxy.getInvocationHandler(args[0]) : null;\\n\\t\\t\\treturn equals(otherHandler);\\n\\t\\t} catch (IllegalArgumentException e) {\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\t} else if (\\"hashCode\\".equals(method.getName())) {\\n\\t\\treturn hashCode();\\n\\t} else if (\\"toString\\".equals(method.getName())) {\\n\\t\\treturn toString();\\n\\t}\\n\\n\\treturn dispatch.get(method).invoke(args);\\n}\\n```\\n\\n\u5176\u4e2d`dispatch`\u662f\u7528\u6765\u4fdd\u5b58\u65b9\u6cd5\u540d\u79f0\u548c`MethodHandler`\u7684\u6620\u5c04\u5173\u7cfb\u7684, `MethodHandler`\u662f\u7528\u6765\u5904\u7406\u65b9\u6cd5\u8c03\u7528(\\n\u5f53\u524d\u7684\u5b9e\u73b0\u4e2d`MethodHandler`\u662f`SynchronousMethodHandler`)\\n\\n- MethodHandler\u5185\u90e8\u7684invoke\u6267\u884c\u6d41\u7a0b\u5982\u4e0b:\\n\\n```java\\n\\n@Override\\npublic Object invoke(Object[] argv) throws Throwable {\\n\\tRequestTemplate template = buildTemplateFromArgs.create(argv);\\n\\tOptions options = findOptions(argv);\\n\\tRetryer retryer = this.retryer.clone();\\n\\twhile (true) {\\n\\t\\ttry {\\n\\t\\t\\treturn executeAndDecode(template, options);\\n\\t\\t} catch (RetryableException e) {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tretryer.continueOrPropagate(e);\\n\\t\\t\\t} catch (RetryableException th) {\\n\\t\\t\\t\\tThrowable cause = th.getCause();\\n\\t\\t\\t\\tif (propagationPolicy == UNWRAP && cause != null) {\\n\\t\\t\\t\\t\\tthrow cause;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tthrow th;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tif (logLevel != Logger.Level.NONE) {\\n\\t\\t\\t\\tlogger.logRetry(metadata.configKey(), logLevel);\\n\\t\\t\\t}\\n\\t\\t\\tcontinue;\\n\\t\\t}\\n\\t}\\n}\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6211\u4eec\u9700\u8981\u5173\u5fc3\u7684\u662f`buildTemplateFromArgs.create(argv);`\u8fd9\u4e00\u884c,\\n\u8fd9\u4e00\u884c\u4ee3\u7801\u4f1a\u6839\u636e\u65b9\u6cd5\u7684\u53c2\u6570\u6765\u6784\u5efa`RequestTemplate`,\\n`RequestTemplate`\u662f\u7528\u6765\u4fdd\u5b58\u8bf7\u6c42\u7684\u4fe1\u606f\u7684, \u4f8b\u5982\u8bf7\u6c42\u7684URL, \u8bf7\u6c42\u7684\u65b9\u6cd5,\\n\u8bf7\u6c42\u7684\u53c2\u6570\u7b49\u7b49, \u53ea\u8981\u77e5\u9053\u4e86`RequestTemplate`\u4e2d\u5bf9\u5e94\u53c2\u6570\u7684\u6784\u9020\u8fc7\u7a0b\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053Feign\u662f\u5982\u4f55\u5c06\u53c2\u6570\u8f6c\u4e3a\u8bf7\u6c42\u7684\u53c2\u6570\u7684\u4e86\\n\\n- `buildTemplateFromArgs.create(argv);`\u7684\u5177\u4f53\u5b9e\u73b0\u5982\u4e0b:\\n\\n```java\\n\\n@Override\\npublic RequestTemplate create(Object[] argv) {\\n\\tRequestTemplate mutable = RequestTemplate.from(metadata.template());\\n\\tmutable.feignTarget(target);\\n\\tif (metadata.urlIndex() != null) {\\n\\t\\tint urlIndex = metadata.urlIndex();\\n\\t\\tcheckArgument(argv[urlIndex] != null, \\"URI parameter %s was null\\", urlIndex);\\n\\t\\tmutable.target(String.valueOf(argv[urlIndex]));\\n\\t}\\n\\tMap<String, Object> varBuilder = new LinkedHashMap<String, Object>();\\n\\tfor (Entry<Integer, Collection<String>> entry : metadata.indexToName().entrySet()) {\\n\\t\\tint i = entry.getKey();\\n\\t\\tObject value = argv[entry.getKey()];\\n\\t\\tif (value != null) { // Null values are skipped.\\n\\t\\t\\tif (indexToExpander.containsKey(i)) {\\n\\t\\t\\t\\tvalue = expandElements(indexToExpander.get(i), value);\\n\\t\\t\\t}\\n\\t\\t\\tfor (String name : entry.getValue()) {\\n\\t\\t\\t\\tvarBuilder.put(name, value);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\n\\tRequestTemplate template = resolve(argv, mutable, varBuilder);\\n\\tif (metadata.queryMapIndex() != null) {\\n\\t\\t// add query map parameters after initial resolve so that they take\\n\\t\\t// precedence over any predefined values\\n\\t\\tObject value = argv[metadata.queryMapIndex()];\\n\\t\\tMap<String, Object> queryMap = toQueryMap(value);\\n\\t\\ttemplate = addQueryMapQueryParameters(queryMap, template);\\n\\t}\\n\\n\\tif (metadata.headerMapIndex() != null) {\\n\\t\\ttemplate =\\n\\t\\t\\t\\taddHeaderMapHeaders((Map<String, Object>) argv[metadata.headerMapIndex()], template);\\n\\t}\\n\\n\\treturn template;\\n}\\n\\n\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6211\u4eec\u9700\u8981\u5173\u6ce8\u7684\u662f\u8fd9\u4e2a\u8bed\u53e5\\n\\n```log\\nif (value != null) { // Null values are skipped.\\n\\tif (indexToExpander.containsKey(i)) {\\n\\t\\tvalue = expandElements(indexToExpander.get(i), value);\\n\\t}\\n\\tfor (String name : entry.getValue()) {\\n\\t\\tvarBuilder.put(name, value);\\n\\t}\\n}\\n\\nprivate Object expandElements(Expander expander, Object value) {\\n\\tif (value instanceof Iterable) {\\n\\t\\treturn expandIterable(expander, (Iterable) value);\\n\\t}\\n\\treturn expander.expand(value);\\n}\\n```\\n\\n\u8fd9\u4e2a\u8bed\u53e5\u4f1a\u5c06\u53c2\u6570\u8f6c\u4e3a`RequestTemplate`\u4e2d\u7684\u53c2\u6570, `Expander`\u662f`Feign`\u4e2d\u7684\u4e00\u4e2a\u63a5\u53e3, \u7528\u6765\u5c06\u53c2\u6570\u8f6c\u4e3a\u5b57\u7b26\u4e32,\\n\u800c`indexToExpander`\u8868\u8fbe\u7684\u662f\u53c2\u6570\u7684\u7d22\u5f15\u548c`Expander`\u7684\u6620\u5c04\u5173\u7cfb,\\n\u5728\u6211\u4eec\u7684`Case`\u4e2d\u5b9e\u9645\u4e0a\u662f\u6ca1\u6709\u8d70\u5230`indexToExpander`\u7684, \u6240\u4ee5\u6700\u7ec8\u4f1a\u76f4\u63a5\u8c03\u7528`varBuilder.put(name, value);`\u8fd9\u4e00\u884c,\\n\u8fd9\u4e00\u884c\u4f1a\u5c06\u53c2\u6570\u8f6c\u4e3a`RequestTemplate`\u4e2d\u7684\u53c2\u6570,\\n\u540e\u7eed\u9700\u8981\u5c06\u53c2\u6570\u503c\u8f6c\u4e3a\u5b57\u7b26\u4e32, \u6240\u4ee5\u8fd8\u9700\u8981\u4e86\u89e3`RequestTemplate`\u4e2d\u7684\u53c2\u6570\u662f\u5982\u4f55\u8f6c\u4e3a\u5b57\u7b26\u4e32\u7684,\\n\u6240\u4ee5\u9700\u8981\u67e5\u770b`RequestTemplate template = resolve(argv, mutable, varBuilder);`\\n\u8fd9\u4e00\u6bb5\u8c03\u7528\u7684resolve\u65b9\u6cd5, \u5177\u4f53\u5b9e\u73b0\u5982\u4e0b:\\n\\n```log\\nprotected RequestTemplate resolve(Object[] argv,\\n\\t\\t\\t\\t\\t\\t\\t\\t  RequestTemplate mutable,\\n\\t\\t\\t\\t\\t\\t\\t\\t  Map<String, Object> variables) {\\n\\treturn mutable.resolve(variables);\\n}\\n```\\n\\n- \u63a5\u4e0b\u6765\u9700\u8981\u67e5\u770b`RequestTemplate`\u4e2d\u7684`resolve`\u65b9\u6cd5\u7684\u5b9e\u73b0, \u5177\u4f53\u5b9e\u73b0\u5982\u4e0b:\\n\\n```java\\npublic RequestTemplate resolve(Map<String, ?> variables) {\\n\\n\\tStringBuilder uri = new StringBuilder();\\n\\n\\t/* create a new template form this one, but explicitly */\\n\\tRequestTemplate resolved = RequestTemplate.from(this);\\n\\n\\tif (this.uriTemplate == null) {\\n\\t\\t/* create a new uri template using the default root */\\n\\t\\tthis.uriTemplate = UriTemplate.create(\\"\\", !this.decodeSlash, this.charset);\\n\\t}\\n\\n\\tString expanded = this.uriTemplate.expand(variables);\\n\\tif (expanded != null) {\\n\\t\\turi.append(expanded);\\n\\t}\\n\\n\\t/*\\n\\t * for simplicity, combine the queries into the uri and use the resulting uri to seed the\\n\\t * resolved template.\\n\\t */\\n\\tif (!this.queries.isEmpty()) {\\n\\t\\t/*\\n\\t\\t * since we only want to keep resolved query values, reset any queries on the resolved copy\\n\\t\\t */\\n\\t\\tresolved.queries(Collections.emptyMap());\\n\\t\\tStringBuilder query = new StringBuilder();\\n\\t\\tIterator<QueryTemplate> queryTemplates = this.queries.values().iterator();\\n\\n\\t\\twhile (queryTemplates.hasNext()) {\\n\\t\\t\\tQueryTemplate queryTemplate = queryTemplates.next();\\n\\t\\t\\tString queryExpanded = queryTemplate.expand(variables);\\n\\t\\t\\tif (Util.isNotBlank(queryExpanded)) {\\n\\t\\t\\t\\tquery.append(queryExpanded);\\n\\t\\t\\t\\tif (queryTemplates.hasNext()) {\\n\\t\\t\\t\\t\\tquery.append(\\"&\\");\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\tString queryString = query.toString();\\n\\t\\tif (!queryString.isEmpty()) {\\n\\t\\t\\tMatcher queryMatcher = QUERY_STRING_PATTERN.matcher(uri);\\n\\t\\t\\tif (queryMatcher.find()) {\\n\\t\\t\\t\\t/* the uri already has a query, so any additional queries should be appended */\\n\\t\\t\\t\\turi.append(\\"&\\");\\n\\t\\t\\t} else {\\n\\t\\t\\t\\turi.append(\\"?\\");\\n\\t\\t\\t}\\n\\t\\t\\turi.append(queryString);\\n\\t\\t}\\n\\t}\\n\\n\\t/* add the uri to result */\\n\\tresolved.uri(uri.toString());\\n\\n\\t/* headers */\\n\\tif (!this.headers.isEmpty()) {\\n\\t\\t/*\\n\\t\\t * same as the query string, we only want to keep resolved values, so clear the header map on\\n\\t\\t * the resolved instance\\n\\t\\t */\\n\\t\\tresolved.headers(Collections.emptyMap());\\n\\t\\tfor (HeaderTemplate headerTemplate : this.headers.values()) {\\n\\t\\t\\t/* resolve the header */\\n\\t\\t\\tString header = headerTemplate.expand(variables);\\n\\t\\t\\tif (!header.isEmpty()) {\\n\\t\\t\\t\\t/* split off the header values and add it to the resolved template */\\n\\t\\t\\t\\tString headerValues = header.substring(header.indexOf(\\" \\") + 1);\\n\\t\\t\\t\\tif (!headerValues.isEmpty()) {\\n\\t\\t\\t\\t\\t/* append the header as a new literal as the value has already been expanded. */\\n\\t\\t\\t\\t\\tresolved.header(headerTemplate.getName(), Literal.create(headerValues));\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\n\\tif (this.bodyTemplate != null) {\\n\\t\\tresolved.body(this.bodyTemplate.expand(variables));\\n\\t}\\n\\n\\t/* mark the new template resolved */\\n\\tresolved.resolved = true;\\n\\treturn resolved;\\n}\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u6bd4\u8f83\u957f, \u6211\u4eec\u9700\u8981\u5173\u6ce8\u7684\u662f\u8fd9\u4e00\u6bb5:\\n\\n```log\\n\\tif (!this.queries.isEmpty()) {\\n      /*\\n       * since we only want to keep resolved query values, reset any queries on the resolved copy\\n       */\\n      resolved.queries(Collections.emptyMap());\\n      StringBuilder query = new StringBuilder();\\n      Iterator<QueryTemplate> queryTemplates = this.queries.values().iterator();\\n\\n      while (queryTemplates.hasNext()) {\\n        QueryTemplate queryTemplate = queryTemplates.next();\\n        String queryExpanded = queryTemplate.expand(variables);\\n        if (Util.isNotBlank(queryExpanded)) {\\n          query.append(queryExpanded);\\n          if (queryTemplates.hasNext()) {\\n            query.append(\\"&\\");\\n          }\\n        }\\n      }\\n\\n      String queryString = query.toString();\\n      if (!queryString.isEmpty()) {\\n        Matcher queryMatcher = QUERY_STRING_PATTERN.matcher(uri);\\n        if (queryMatcher.find()) {\\n          /* the uri already has a query, so any additional queries should be appended */\\n          uri.append(\\"&\\");\\n        } else {\\n          uri.append(\\"?\\");\\n        }\\n        uri.append(queryString);\\n      }\\n    }\\n```\\n\\n\u6700\u7ec8\u8fd9\u4e2a\u8bed\u53e5`String queryExpanded = queryTemplate.expand(variables);`\u4f1a\u5c06\u53c2\u6570\u8f6c\u4e3a\u5b57\u7b26\u4e32, \u6240\u4ee5\u6700\u7ec8\u6211\u4eec\u5f97\u5230\u4e86\u53c2\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f,"},{"id":"/2023/06/01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions","metadata":{"permalink":"/blog/2023/06/01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions","source":"@site/blog/2023-06-01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions.md","title":"\u5347\u7ea7\u5230spring-boot-3.1.0\u540enative-image\u542f\u52a8\u62a5\u9519\u4ee5\u53ca\u95ee\u9898\u89e3\u51b3","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5347\u7ea7\u5230spring-boot-3.1.0\u540enative-image\u542f\u52a8\u62a5\u9519\u4ee5\u53ca\u5bf9\u5e94\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848","date":"2023-06-01T00:00:00.000Z","formattedDate":"June 1, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"spring-boot","permalink":"/blog/tags/spring-boot"},{"label":"spring-framework","permalink":"/blog/tags/spring-framework"},{"label":"native-image","permalink":"/blog/tags/native-image"}],"readingTime":4.9,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","spring-boot","spring-framework","native-image"]},"unlisted":false,"prevItem":{"title":"\u5347\u7ea7\u6846\u67b6\u540e\u53d1\u73b0Feign\u8c03\u7528\u5931\u8d25\u65f6\u95f4\u683c\u5f0f\u5316\u95ee\u9898\u7684\u6392\u67e5\u548c\u89e3\u51b3","permalink":"/blog/2023/12/22/openfeign-zoned-datetime-formatting-problem"},"nextItem":{"title":"\u57fa\u4e8ehibernate\u7684spring-data-jpa\u7684\u5e76\u53d1\u6027\u80fd\u4f18\u5316\u914d\u7f6e","permalink":"/blog/2023/05/26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios"}},"content":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5347\u7ea7\u5230spring-boot-3.1.0\u540enative-image\u542f\u52a8\u62a5\u9519\u4ee5\u53ca\u5bf9\u5e94\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\\n\\n\x3c!--truncate--\x3e\\n\\n## org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'entityManagerFactory\': No classes have been predefined during the image build to load from bytecodes at runtime.\\n\\n\u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name \'entityManagerFactory\': No classes have been predefined during the image build to load from bytecodes at runtime.\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1770) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[fastone-auditing:6.0.9]\\n        at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1156) ~[fastone-auditing:6.0.9]\\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:931) ~[fastone-auditing:6.0.9]\\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:608) ~[fastone-auditing:6.0.9]\\n        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[fastone-auditing:3.1.0]\\n        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733) ~[fastone-auditing:3.1.0]\\n        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435) ~[fastone-auditing:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:311) ~[fastone-auditing:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1305) ~[fastone-auditing:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1294) ~[fastone-auditing:3.1.0]\\n        at com.fastonetech.auditing.FastoneAuditingApplicationKt.main(FastoneAuditingApplication.kt:13) ~[fastone-auditing:na]\\n        at com.fastonetech.auditing.FastoneAuditingApplicationKt.main(FastoneAuditingApplication.kt) ~[fastone-auditing:na]\\nCaused by: com.oracle.svm.core.jdk.UnsupportedFeatureError: No classes have been predefined during the image build to load from bytecodes at runtime.\\n        at org.graalvm.nativeimage.builder/com.oracle.svm.core.util.VMError.unsupportedFeature(VMError.java:89) ~[na:na]\\n        at org.graalvm.nativeimage.builder/com.oracle.svm.core.hub.PredefinedClassesSupport.throwNoBytecodeClasses(PredefinedClassesSupport.java:76) ~[na:na]\\n        at org.graalvm.nativeimage.builder/com.oracle.svm.core.hub.PredefinedClassesSupport.loadClass(PredefinedClassesSupport.java:130) ~[na:na]\\n        at java.base@17.0.5/java.lang.ClassLoader.defineClass(ClassLoader.java:294) ~[fastone-auditing:na]\\n        at net.bytebuddy.utility.dispatcher.JavaDispatcher$DynamicClassLoader.invoker(JavaDispatcher.java:1383) ~[na:na]\\n        at net.bytebuddy.utility.dispatcher.JavaDispatcher$InvokerCreationAction.run(JavaDispatcher.java:459) ~[na:na]\\n        at net.bytebuddy.utility.dispatcher.JavaDispatcher$InvokerCreationAction.run(JavaDispatcher.java:452) ~[na:na]\\n        at java.base@17.0.5/java.security.AccessController.executePrivileged(AccessController.java:168) ~[na:na]\\n        at java.base@17.0.5/java.security.AccessController.doPrivileged(AccessController.java:318) ~[na:na]\\n        at net.bytebuddy.utility.dispatcher.JavaDispatcher.doPrivileged(JavaDispatcher.java) ~[na:na]\\n        at net.bytebuddy.utility.dispatcher.JavaDispatcher.<clinit>(JavaDispatcher.java:87) ~[na:na]\\n        at net.bytebuddy.description.type.TypeDescription$ForLoadedType.<clinit>(TypeDescription.java:8659) ~[na:na]\\n        at net.bytebuddy.matcher.ElementMatchers.isFinalizer(ElementMatchers.java:1624) ~[na:na]\\n        at org.hibernate.bytecode.internal.bytebuddy.ByteBuddyState$ProxyDefinitionHelpers.<init>(ByteBuddyState.java:296) ~[na:na]\\n        at org.hibernate.bytecode.internal.bytebuddy.ByteBuddyState.<clinit>(ByteBuddyState.java:71) ~[na:na]\\n        at org.hibernate.bytecode.internal.bytebuddy.BytecodeProviderImpl.<init>(BytecodeProviderImpl.java:123) ~[na:na]\\n        at org.hibernate.bytecode.internal.bytebuddy.BytecodeProviderImpl.<init>(BytecodeProviderImpl.java:115) ~[na:na]\\n        at org.hibernate.bytecode.internal.BytecodeProviderInitiator.buildBytecodeProvider(BytecodeProviderInitiator.java:59) ~[na:na]\\n        at org.hibernate.bytecode.internal.BytecodeProviderInitiator.buildDefaultBytecodeProvider(BytecodeProviderInitiator.java:46) ~[na:na]\\n        at org.hibernate.jpa.internal.enhance.EnhancingClassTransformerImpl.<init>(EnhancingClassTransformerImpl.java:34) ~[na:na]\\n        at org.hibernate.jpa.boot.internal.PersistenceUnitInfoDescriptor.pushClassTransformer(PersistenceUnitInfoDescriptor.java:113) ~[fastone-auditing:6.2.2.Final]\\n        at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.<init>(EntityManagerFactoryBuilderImpl.java:340) ~[na:na]\\n        at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.<init>(EntityManagerFactoryBuilderImpl.java:190) ~[na:na]\\n        at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:60) ~[na:na]\\n        at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376) ~[fastone-auditing:6.0.9]\\n        at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409) ~[fastone-auditing:6.0.9]\\n        at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396) ~[fastone-auditing:6.0.9]\\n        at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1816) ~[fastone-auditing:6.0.9]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1766) ~[fastone-auditing:6.0.9]\\n        ... 17 common frames omitted\\n```\\n\\n### \u95ee\u9898\u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u662f`springframework`\u548c`hibernate`\u4e4b\u95f4\u7684\u96c6\u6210\u95ee\u9898, \u9700\u8981\u5c06`springframework`\u5347\u7ea7\u5230`6.0.10-SNAPSHOT`\u7248\u672c\u5373\u53ef\u89e3\u51b3\u8be5\u95ee\u9898\\n\u8be6\u7ec6`issue`\\n\u89c1[Skip class transformer in PersistenceUnitInfoDescriptor for native images #30492](https://github.com/spring-projects/spring-framework/issues/30492)\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n:::note\\n\u73b0\u5728\u5728\u5199\u89e3\u51b3\u65b9\u6848\u7684\u65f6\u5019, `springframework`\u7684\u6700\u65b0\u7248\u672c\u662f`6.0.9`, \u5982\u679c\u540e\u7eed`6.0.10`\u7248\u672c\u53d1\u5e03, \u5219\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528`6.0.10`\u7248\u672c.\\n:::\\n\\n\u5c06`springframework`\u5347\u7ea7\u5230`6.0.10-SNAPSHOT`\u7248\u672c, \u8be5\u7248\u672c\u4e2d\u4fee\u590d\u4e86`hibernate`\u7684\u96c6\u6210\u95ee\u9898.\\n\\n```kotlin\\nimplementation(platform(\\"org.springframework:spring-framework-bom:6.0.10-SNAPSHOT\\"))\\n```\\n\\n## org.springframework.beans.factory.BeanCreationException: Error creating bean with name \'entityManagerFactory\': null\\n\\n\u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name \'entityManagerFactory\': null\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1770) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1156) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:931) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:608) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[springboot3-todo:3.1.0]\\n        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:733) ~[springboot3-todo:3.1.0]\\n        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:435) ~[springboot3-todo:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:311) ~[springboot3-todo:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1305) ~[springboot3-todo:3.1.0]\\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1294) ~[springboot3-todo:3.1.0]\\n        at com.example.Application.main(Application.java:16) ~[springboot3-todo:na]\\nCaused by: java.lang.ExceptionInInitializerError: null\\n        at org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.logSelectedDialect(DialectFactoryImpl.java:93) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.buildDialect(DialectFactoryImpl.java:88) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:224) ~[na:na]\\n        at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:34) ~[na:na]\\n        at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:119) ~[na:na]\\n        at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:264) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:239) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:216) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.boot.model.relational.Database.<init>(Database.java:45) ~[na:na]\\n        at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.getDatabase(InFlightMetadataCollectorImpl.java:229) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:197) ~[springboot3-todo:6.2.2.Final]\\n        at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:166) ~[na:na]\\n        at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1380) ~[na:na]\\n        at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1451) ~[na:na]\\n        at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:74) ~[na:na]\\n        at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1816) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1766) ~[springboot3-todo:6.0.10-SNAPSHOT]\\n        ... 16 common frames omitted\\nCaused by: java.lang.IllegalArgumentException: Invalid logger interface org.hibernate.dialect.DialectLogging (implementation not found in jdk.internal.loader.ClassLoaders$AppClassLoader@3ecf72fd)\\n        at org.jboss.logging.Logger.doGetMessageLogger(Logger.java:2564) ~[springboot3-todo:3.5.0.Final]\\n        at org.jboss.logging.Logger.getMessageLogger(Logger.java:2530) ~[springboot3-todo:3.5.0.Final]\\n        at org.jboss.logging.Logger.getMessageLogger(Logger.java:2516) ~[springboot3-todo:3.5.0.Final]\\n        at org.hibernate.dialect.DialectLogging.<clinit>(DialectLogging.java:31) ~[na:na]\\n        ... 37 common frames omitted\\n```\\n\\n### \u95ee\u9898\u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u662f`hibernate`\u4e2d\u6d89\u53ca\u5230\u53cd\u5c04\u8c03\u7528\u7684\u76f8\u5173\u7684\u7c7b\u6ca1\u6709\u6ce8\u518c\u5230`reflect-config.json`\u4e2d\u5bfc\u81f4\u7684.\\n\\n:::note\\n\u73b0\u5728\u5728\u5199\u8fd9\u7bc7\u6587\u7ae0\u7684\u65f6\u5019,`org.graalvm.buildtools.native`\u7684\u63d2\u4ef6\u4f7f\u7528\u7684`metadataRepository`\u7684\u7248\u672c\u8fd8\u662f`0.3.0`.\\n\u8fd9\u4e2a\u7248\u672c\u4e2d\u8fd8\u6ca1\u6709\u4e3a`hibernate`\u76f8\u5173\u7684\u7c7b\u6ce8\u518c\u5230`reflect-config.json`\u4e2d, \u5982\u679c\u540e\u7eed`0.3.2`\u7248\u672c\u53d1\u5e03\u4e86, \u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528`0.3.2`\\n\u7248\u672c\u7684\u63d2\u4ef6, \u4e0d\u9700\u8981\u518d\u624b\u52a8\u6dfb\u52a0`reflect-config.json`\u6587\u4ef6\u4e86.\\n:::\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`resources`\u4e0b\u7684`META-INF/native-image`\u4e0b\u7684\u540d\u4e3a`reflect-config.json`\u7684\u6587\u4ef6\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\\n\\n```json title=META-INF/native-image/reflect-config.json\\n[\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.dialect.DialectLogging_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.metamodel.mapping.MappingModelCreationLogging_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.engine.jdbc.env.internal.LobCreationLogging_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.boot.jaxb.JaxbLogger_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.cache.spi.SecondLevelCacheLogger_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.engine.jdbc.JdbcLogging_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.resource.beans.internal.BeansMessageLogger_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"org.hibernate.sql.results.graph.embeddable.EmbeddableLoadingLogger_$logger\\",\\n\\t\\t\\"methods\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"<init>\\",\\n\\t\\t\\t\\t\\"parameterTypes\\": [\\n\\t\\t\\t\\t\\t\\"org.jboss.logging.Logger\\"\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t]\\n\\t}\\n]\\n```\\n\\n### \u53c2\u8003\u8d44\u6599\\n\\n- [Fix compatibility with Hibernate 6.2.2](https://github.com/oracle/graalvm-reachability-metadata/pull/286)\\n- [Missing logger reflection entries for Hibernate 6.2](https://github.com/oracle/graalvm-reachability-metadata/issues/297)\\n- [Add missing logger metadata for Hibernate 6.2](https://github.com/oracle/graalvm-reachability-metadata/commit/afb9a1ee44e0a18b9cd31f04e038caea32d308a3)\\n\\n## \u603b\u7ed3\\n\\n\u4e0a\u9762\u662f\u6211\u76ee\u524d\u5347\u7ea7\u5230`spring-boot-3.1.0`\u540e\u9047\u5230\u7684\u95ee\u9898, \u603b\u7684\u6765\u8bf4\u8fd9\u4e9b\u95ee\u9898\u90fd\u662f\u56e0\u4e3a\u6846\u67b6\u5185\u90e8\u7684\u4e00\u4e9b\u96c6\u6210\u95ee\u9898\u5bfc\u81f4\u7684.<br/>\\n\u76ee\u524d`graalvm`\u7684`native-image`\u63d2\u4ef6\u8fd8\u4e0d\u662f\u5f88\u5b8c\u5584, \u6709\u4e9b\u95ee\u9898\u8fd8\u9700\u8981\u6211\u4eec\u81ea\u5df1\u53bb\u89e3\u51b3, \u4f46\u662f\u76f8\u4fe1\u968f\u7740`graalvm`\u7684\u53d1\u5c55, \u8fd9\u4e9b\u95ee\u9898\u90fd\u4f1a\u9010\u6e10\u89e3\u51b3\u7684.\\n`oracle`\u7ef4\u62a4\u4e86\u4e00\u4e2a`graalvm`\u7684`reachability-metadata`\u7684\u9879\u76ee, \u7528\u6765\u89e3\u51b3\u4e00\u4e9b\u6846\u67b6\u96c6\u6210\u7684\u95ee\u9898, \u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u9879\u76ee\u4e2d\u67e5\u770b\u5230\u4e00\u4e9b\u6846\u67b6\u7684\u96c6\u6210\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848.\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [graalvm-reachability-metadata](https://github.com/oracle/graalvm-reachability-metadata)"},{"id":"/2023/05/26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios","metadata":{"permalink":"/blog/2023/05/26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios","source":"@site/blog/2023-05-26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios.md","title":"\u57fa\u4e8ehibernate\u7684spring-data-jpa\u7684\u5e76\u53d1\u6027\u80fd\u4f18\u5316\u914d\u7f6e","description":"\u6458\u8981","date":"2023-05-26T00:00:00.000Z","formattedDate":"May 26, 2023","tags":[{"label":"spring-boot","permalink":"/blog/tags/spring-boot"},{"label":"spring-data-jpa","permalink":"/blog/tags/spring-data-jpa"},{"label":"hibernate","permalink":"/blog/tags/hibernate"},{"label":"performance","permalink":"/blog/tags/performance"}],"readingTime":5.87,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["spring-boot","spring-data-jpa","hibernate","performance"]},"unlisted":false,"prevItem":{"title":"\u5347\u7ea7\u5230spring-boot-3.1.0\u540enative-image\u542f\u52a8\u62a5\u9519\u4ee5\u53ca\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/06/01/upgrading-to-spring-boot-3.1.0-native-image-startup-errors-and-solutions"},"nextItem":{"title":"\u89e3\u51b3\u65e0\u6cd5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u5230vscode","permalink":"/blog/2023/05/15/solve-unable-to-input-chinese-character-into-vscode"}},"content":"## \u6458\u8981\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`spring-data-jpa`\u4f7f\u7528`hibernate`\u4f5c\u4e3a`jpa`\u7684\u5b9e\u73b0, \u5f53\u5e76\u53d1\u91cf\u8f83\u5927\u65f6, \u7531\u4e8e\u6846\u67b6\u7684\u4e00\u4e9b\u9ed8\u8ba4\u914d\u7f6e\u53ef\u80fd\u4f1a\u5f15\u53d1\u6027\u80fd\u74f6\u9888,\\n\u4e0b\u9762\u5c06\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u89c1\u7684\u914d\u7f6e\u9879\u6765\u6539\u5584\u5e76\u53d1\u91cf\u8f83\u5927\u65f6\u7684\u6027\u80fd\u95ee\u9898.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u7981\u7528`open-in-view`\\n\\n\u5728`spring-boot`\u4e2d\u9ed8\u8ba4\u5f00\u542f\u4e86`open-in-view`\uff0c\u8fd9\u4e2a\u914d\u7f6e\u9879\u7684\u4f5c\u7528\u662f\u5728\u6574\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u590d\u7528\u540c\u4e00\u4e2a`EntityManager`.<br/>\\n\u8be5\u5b9e\u73b0\u7684\u597d\u5904\u662f\u907f\u514d\u5728\u540c\u4e00\u4e2a\u8bf7\u6c42\u4e2d\u591a\u6b21\u521b\u5efa\u4e00\u4e2a`EntityManager`, \u4ece\u800c\u63d0\u9ad8\u6027\u80fd.<br/>\\n\u5f53\u7cfb\u7edf\u5e76\u53d1\u8f83\u5927\u65f6\u4e14\u7cfb\u7edf\u76f8\u5e94\u8f83\u6162, \u7531\u4e8e`EntityManager`\u4f1a\u6301\u6709\u6570\u636e\u5e93\u94fe\u63a5\u76f4\u5230\u6574\u4e2a\u8bf7\u6c42\u5904\u7406\u5b8c\u6210, \u5982\u679c\u6ca1\u6709\u7279\u522b\u7684\u9700\u6c42, \u4f8b\u5982:\\n\\n- \u5728`View`\u5c42\u4f7f\u7528Entity\u5bf9\u8c61\u4e2d`cascade`\u4e3a`lazy`\u7684\u5173\u8054\u5bf9\u8c61\\n\\n\u53ef\u4ee5\u8003\u8651\u7981\u7528`open-in-view`\u6765\u63d0\u9ad8\u6027\u80fd\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`application.yml`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e:\\n\\n```yaml title=\\"application.yml\\"\\nspring:\\n  jpa:\\n    open-in-view: false\\n```\\n\\n## \u8986\u76d6`hibernate.connection.handling_mode`\u914d\u7f6e\u9879\u7684\u9ed8\u8ba4\u914d\u7f6e\\n\\n`hibernate.connection.handling_mode`\u7528\u4e8e\u914d\u7f6e`EntityManager`\u4e2d\u5173\u8054\u7684\u6570\u636e\u5e93\u8fde\u63a5(\u521b\u5efa\u53ca\u9500\u6bc1\u65f6\u673a)\u7684\u63a7\u5236.<br/>\\n\u9ed8\u8ba4\u503c\u521b\u5efa\u65f6\u673a\u4e3a\u7b2c\u4e00\u6b21\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92, \u5173\u95ed\u65f6\u673a\u4e3a`EntitiyManager`\u88ab\u5173\u95ed, \u6b64\u4e3e\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u8fde\u63a5\u7684\u6700\u5927\u5316\u5229\u7528(\\n\u56e0\u4e3a\u6570\u636e\u5e93\u8fde\u63a5\u7684\u521b\u5efa\u901a\u5e38\u6bd4\u8f83\u6602\u8d35).<br/>\\n\u4f46\u662f\u5bf9\u4e8e\u5e26\u7528`DataSource`\u7684\u5e94\u7528\u6765\u8bf4, \u6b64\u914d\u7f6e\u5e76\u4e0d\u4f1a\u6539\u5584\u6027\u80fd\u95ee\u9898, \u56e0\u4e3a`DataSource`\u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u590d\u7528\u6570\u636e\u5e93\u8fde\u63a5.<br/>\\n\u5e76\u4e14\u7531\u4e8e`EntityManager`\u5173\u8054\u7684\u6570\u636e\u5e93\u8fde\u63a5\u53ea\u6709\u5728\u5173\u95ed\u65f6\u624d\u4f1a\u88ab\u91ca\u653e, \u5982\u679c\u9047\u5230`EntityManager`\\n\u957f\u65f6\u95f4\u5b58\u6d3b\u65f6\u5e76\u4e14\u6b64\u65f6\u7cfb\u7edf\u5e76\u53d1\u8f83\u5927\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u6ca1\u6709\u7a7a\u95f2\u7684\u8fde\u63a5\u5bfc\u81f4\u540e\u7eed\u8bf7\u6c42\u88ab\u5835\u585e\u751a\u81f3\u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5\u8d85\u65f6.<br/>\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u53ef\u4ee5\u8003\u8651\u914d\u7f6e`hibernate.connection.handling_mode`\u914d\u7f6e\u9879\u5bf9\u5e94\u7684\u503c,\\n\u8be5\u914d\u7f6e\u5bf9\u5e94\u7684\u679a\u4e3e\u7c7b\u4e3a`PhysicalConnectionHandlingMode`, \u679a\u4e3e\u7c7b\u4e2d\u6709\u5982\u4e0b\u51e0\u4e2a\u503c\\n\\n\u5bf9\u4e8e\u6ca1\u6709\u4f7f\u7528`DataSource`\u7684\u5e94\u7528\u6765\u8bf4, \u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u503c, \u8fd9\u51e0\u4e2a\u503c\u90fd\u662f\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6700\u5927\u5316\u5229\u7528, \u56e0\u4e3a\u521b\u5efa\u6570\u636e\u5e93\u8fde\u63a5\u6bd4\u8f83\u6602\u8d35.\\n\\n- IMMEDIATE_ACQUISITION_AND_HOLD\\n  <br/>\u8868\u793a\u8fde\u63a5\u4f1a\u5728`EntityManager`\u521b\u5efa\u65f6\u83b7\u53d6, \u5173\u95ed\u65f6\u91ca\u653e.\\n  <br/>\u8be5\u914d\u7f6e\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u80fd\u591f\u5728\u6574\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u590d\u7528\u540c\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5, \u56e0\u4e3a\u521b\u5efa\u6570\u636e\u5e93\u8fde\u63a5\u6bd4\u8f83\u6602\u8d35.\\n  \u4f46\u662f\u5bf9\u4e8e\u5e26\u7528`DataSource`\u7684\u5e94\u7528\u6765\u8bf4, \u6b64\u914d\u7f6e\u5e76\u4e0d\u4f1a\u6539\u5584\u6027\u80fd\u95ee\u9898, \u56e0\u4e3a`DataSource`\u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u590d\u7528\u6570\u636e\u5e93\u8fde\u63a5.\\n- DELAYED_ACQUISITION_AND_HOLD  \\n  <br/>\u8868\u793a\u8fde\u63a5\u4f1a`EntityManager`\u548c\u6570\u636e\u5e93\u4ea7\u751f\u4ea4\u4e92\u65f6\u83b7\u53d6, \u5173\u95ed\u65f6\u91ca\u653e. \u8fd9\u662f\u9ed8\u8ba4\u7684\u914d\u7f6e.\\n  <br/>\u6b64\u914d\u7f6e\u548c\u4e0a\u9762\u7684\u914d\u7f6e\u9664\u4e86\u83b7\u53d6\u8fde\u63a5\u7684\u65f6\u673a\u4e0d\u540c\u5916, \u5176\u4ed6\u90fd\u76f8\u540c.\\n\\n\u5bf9\u4e8e\u4f7f\u7528`DataSource`\u7684\u5e94\u7528\u6765\u8bf4, \u53ef\u4ee5\u79ef\u6781\u5730\u91ca\u653e\u6570\u636e\u5e93\u94fe\u63a5\u6765\u63d0\u9ad8\u7cfb\u7edf\u541e\u5410\u7387, \u56e0\u4e3a`DataSource`\u5df2\u7ecf\u5e2e\u6211\u4eec\u505a\u4e86\u6570\u636e\u5e93\u8fde\u63a5\u7684\u590d\u7528,\\n\\n- DELAYED_ACQUISITION_AND_RELEASE_AFTER_STATEMENT\\n  <br/>\u5982\u679c\u9700\u8981\u6267\u884c\u591a\u4e2a\u72ec\u7acb\u7684\u8bed\u53e5\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9\u6b64\u914d\u7f6e\\n- DELAYED_ACQUISITION_AND_RELEASE_BEFORE_TRANSACTION_COMPLETION\\n  <br/>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u6267\u884c\u591a\u4e2a\u4e8b\u52a1\uff0c\u5e76\u4e14\u4e0d\u5728\u4e4e\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9\u6b64\u914d\u7f6e.<br/>\\n  <br/>\u8fd9\u4e2a\u914d\u7f6e\u4e00\u4e2a\u6f5c\u5728\u7684\u95ee\u9898\u662f\u7531\u4e8e\u4e8b\u52a1\u63d0\u4ea4\u524d\u4f1a\u91ca\u653e\u6570\u636e\u5e93\u8fde\u63a5, \u5982\u679c\u540e\u7eed\u4e8b\u52a1\u63d0\u4ea4\u65f6\u9700\u8981\u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5\u65f6\u51fa\u73b0\u4e86\u95ee\u9898\u4f1a\u5bfc\u81f4\u4e8b\u52a1\u63d0\u4ea4\u5931\u8d25,\\n  \u4ece\u800c\u5bfc\u81f4\u6570\u636e\u5e93\u4e2d\u7684\u4e8b\u52a1\u4e00\u76f4\u5904\u4e8e\u5f00\u542f\u72b6\u6001\\n- DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION\\n  <br/>\u5982\u679c\u9700\u8981\u5904\u7406\u4e8b\u52a1, \u5e76\u4e14\u4e3a\u4e86\u4fdd\u8bc1\u4e8b\u52a1\u7684\u4e00\u81f4\u6027, \u90a3\u4e48\u53ef\u4ee5\u9009\u62e9\u6b64\u914d\u7f6e\\n\\n\u4e00\u822c\u6765\u8bf4, \u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5904\u7406\u4e8b\u52a1, \u5e76\u4e14\u4e3a\u4e86\u4fdd\u8bc1\u4e8b\u52a1\u7684\u4e00\u81f4\u6027,\\n\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9`DELAYED_ACQUISITION_AND_RELEASE_AFTER_TRANSACTION`\u914d\u7f6e.\\n\u5982\u679c\u5e94\u7528\u4e0d\u5728\u4e4e\u4e8b\u52a1\u7684\u4e00\u81f4\u6027, \u90a3\u4e48\u53ef\u4ee5\u9009\u62e9`DELAYED_ACQUISITION_AND_RELEASE_BEFORE_TRANSACTION_COMPLETION`\u914d\u7f6e,\\n\u7531\u4e8e\u6b64\u914d\u7f6e\u4f1a\u5728\u4e8b\u52a1\u63d0\u4ea4\u524d\u91ca\u653e\u6570\u636e\u5e93\u8fde\u63a5,\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u540e\u7eed\u4e8b\u52a1\u63d0\u4ea4\u65f6\u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25, \u4ece\u800c\u5bfc\u81f4\u4e8b\u52a1\u63d0\u4ea4\u5931\u8d25,\\n\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u5e93\u4e2d\u7684\u4e8b\u52a1\u4e00\u76f4\u5904\u4e8e\u5f00\u542f\u72b6\u6001, \u6240\u4ee5\u6b64\u914d\u7f6e\u9700\u8981\u8c28\u614e\u4f7f\u7528.\\n\u5982\u679c\u5e94\u7528\u4e0d\u9700\u8981\u5904\u7406\u4e8b\u52a1, \u90a3\u4e48\u53ef\u4ee5\u9009\u62e9`DELAYED_ACQUISITION_AND_RELEASE_AFTER_STATEMENT`\u914d\u7f6e.\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`application.yml`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e:\\n\\n```yaml title=\\"application.yml\\"\\nspring:\\n  jpa:\\n    properties:\\n      hibernate:\\n        connection:\\n          handling_mode: your_handling_mode\\n```\\n\\n## \u603b\u7ed3\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n### Open In View\\n\\n- [A Guide to Spring\u2019s Open Session in View](https://www.baeldung.com/spring-open-session-in-view)\\n- [OpenEntityManagerInViewInterceptor](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html)\\n\\n### Connection Control\\n\\n- [How does aggressive connection release work in Hibernate](https://vladmihalcea.com/hibernate-aggressive-connection-release/)\\n- [Connection handling](https://docs.jboss.org/hibernate/orm/6.2/userguide/html_single/Hibernate_User_Guide.html#database-connection-handling)\\n- [PhysicalConnectionHandlingMode](https://docs.jboss.org/hibernate/orm/6.2/javadocs/org/hibernate/resource/jdbc/spi/PhysicalConnectionHandlingMode.html)\\n- [AvailableSettings](https://docs.jboss.org/hibernate/orm/6.2/javadocs/org/hibernate/cfg/AvailableSettings.html)\\n\\n### Additional High-Performance Optimizations\\n\\n- [High-Performance Hibernate Tutorial](https://vladmihalcea.com/tutorials/hibernate/)\\n- [Performance Tuning and Best Practices](https://docs.jboss.org/hibernate/orm/6.2/userguide/html_single/Hibernate_User_Guide.html#best-practices)"},{"id":"/2023/05/15/solve-unable-to-input-chinese-character-into-vscode","metadata":{"permalink":"/blog/2023/05/15/solve-unable-to-input-chinese-character-into-vscode","source":"@site/blog/2023-05-15/solve-unable-to-input-chinese-character-into-vscode.md","title":"\u89e3\u51b3\u65e0\u6cd5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u5230vscode","description":"\u5f53\u901a\u8fc7snap\u5b89\u88c5vscode\u540e\uff0c\u65e0\u6cd5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\uff0c\u89e3\u51b3\u65b9\u6848\u662f\u5728\u5b98\u7f51\u4e0b\u8f7ddeb\u5305\u5b89\u88c5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u4e86.","date":"2023-05-15T00:00:00.000Z","formattedDate":"May 15, 2023","tags":[{"label":"vscode","permalink":"/blog/tags/vscode"},{"label":"snap","permalink":"/blog/tags/snap"},{"label":"deb","permalink":"/blog/tags/deb"}],"readingTime":0.26,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["vscode","snap","deb"]},"unlisted":false,"prevItem":{"title":"\u57fa\u4e8ehibernate\u7684spring-data-jpa\u7684\u5e76\u53d1\u6027\u80fd\u4f18\u5316\u914d\u7f6e","permalink":"/blog/2023/05/26/performance-optimization-strategies-for-hibernate-in-concurrent-scenarios"},"nextItem":{"title":"\u901a\u8fc7\u5173\u95edOpenEntityManagerInViewInterceptor\u786e\u4fdd\u5f53\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c","permalink":"/blog/2023/05/15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview"}},"content":"\u5f53\u901a\u8fc7`snap`\u5b89\u88c5`vscode`\u540e\uff0c\u65e0\u6cd5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\uff0c\u89e3\u51b3\u65b9\u6848\u662f\u5728[\u5b98\u7f51](https://code.visualstudio.com/)\u4e0b\u8f7d`deb`\u5305\u5b89\u88c5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u4e86.\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [unable to input chinese character](https://github.com/microsoft/vscode/issues/96041)"},{"id":"/2023/05/15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview","metadata":{"permalink":"/blog/2023/05/15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview","source":"@site/blog/2023-05-15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview.md","title":"\u901a\u8fc7\u5173\u95edOpenEntityManagerInViewInterceptor\u786e\u4fdd\u5f53\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c","description":"OpenEntityManagerInViewInterceptor\u662fspring\u4e2d\u7684\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5728\u6574\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u590d\u7528\u540c\u4e00\u4e2aEntityManager","date":"2023-05-15T00:00:00.000Z","formattedDate":"May 15, 2023","tags":[{"label":"spring-boot","permalink":"/blog/tags/spring-boot"},{"label":"spring-data-jpa","permalink":"/blog/tags/spring-data-jpa"}],"readingTime":3.03,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["spring-boot","spring-data-jpa"]},"unlisted":false,"prevItem":{"title":"\u89e3\u51b3\u65e0\u6cd5\u8f93\u5165\u4e2d\u6587\u5b57\u7b26\u5230vscode","permalink":"/blog/2023/05/15/solve-unable-to-input-chinese-character-into-vscode"},"nextItem":{"title":"\u901a\u8fc7\u521b\u5efarsa\u683c\u5f0f\u7684\u79c1\u94a5\u4ee5\u53ca\u670d\u52a1\u7aef\u542f\u7528rsa\u8ba4\u8bc1\u89e3\u51b3jsch\u8fde\u63a5ssh\u5931\u8d25\u7684\u95ee\u9898","permalink":"/blog/2023/05/05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server"}},"content":"`OpenEntityManagerInViewInterceptor`\u662f`spring`\u4e2d\u7684\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5728\u6574\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u590d\u7528\u540c\u4e00\u4e2a`EntityManager`\\n\uff0c\u4ece\u800c\u907f\u514d\u5728\u4e00\u4e2a\u8bf7\u6c42\u4e2d\u591a\u6b21\u521b\u5efa\u4e00\u4e2a`EntityManager`, \u4ece\u800c\u63d0\u9ad8\u6027\u80fd.<br/>\\n\u4f46\u662f\u5982\u679c\u5728\u4e00\u4e2a\u8bf7\u6c42\u7684\u5904\u7406\u4ee3\u7801\u4e2d\u8bf7\u6c42\u4e86\u4e0b\u6e38\u670d\u52a1\uff0c\u800c\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\uff0c\u90a3\u4e48\u5728\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u4e4b\u524d\uff0c`EntityManager`\\n\u4f1a\u4e00\u76f4\u88ab\u5360\u7528\uff0c\u76f4\u5230\u6574\u4e2a\u8bf7\u6c42\u5904\u7406\u5b8c\u6210\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u5f53\u670d\u52a1\u5e76\u53d1\u8bf7\u6c42\u91cf\u8f83\u5927\u65f6\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c.<br/>\\n\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u5173\u95ed`OpenEntityManagerInViewInterceptor`\u6765\u786e\u4fdd\u5f53\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c.\\n\u4e0b\u9762\u5c06\u4ecb\u7ecd\u5982\u4f55\u5173\u95ed`OpenEntityManagerInViewInterceptor`.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`spring-boot`\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e`spring.jpa.open-in-view`\u4e3a`false`\u6765\u5173\u95ed`OpenEntityManagerInViewInterceptor`\uff0c\u793a\u4f8b\u5982\u4e0b\\n\\n```yaml title=\\"application.yml\\"\\nspring:\\n  jpa:\\n    open-in-view: false\\n```\\n\\n## \u5907\u6ce8\\n\\n- `org.springframework.orm.hibernate5.support.OpenSessionInViewInterceptor`\u5728\u8bf7\u6c42\u5f00\u59cb\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a`EntityManager`\\n  \u5e76\u8c03\u7528`org.springframework.transaction.support.TransactionSynchronizationManager.bindResource`\\n  \u65b9\u6cd5\u6765\u7ed1\u5b9a`EntityManager`\u5230\u5f53\u524d\u7ebf\u7a0b\\n- \u540e\u7eed\u6846\u67b6\u5185\u90e8\u7684\u8c03\u7528\u4f8b\u5982`Repository.findAll()`\u7684\u5927\u81f4\u8c03\u7528\u94fe\u8def\u5982\u4e0b\\n\\t- Repository.findAll()\\n\\t- org.springframework.orm.jpa.SharedEntityManagerCreator.SharedEntityManagerInvocationHandler.invoke\\n\\t- org.springframework.orm.jpa.EntityManagerFactoryUtils.doGetTransactionalEntityManager\\n\\t- org.springframework.transaction.support.TransactionSynchronizationManager.getResource\\n\\t  <br/>\u56e0\u4e3a\u5728\u8bf7\u6c42\u5f00\u59cb\u65f6\u5df2\u7ecf\u5c06`EntityManager`\u7ed1\u5b9a\u5230\u5f53\u524d\u7ebf\u7a0b\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f1a\u83b7\u53d6\u5230\u4e4b\u524d\u521b\u5efa\u7684`EntityManager`\\n\\n- \u540e\u7eed\u6267\u884c`query`\u65f6\u4f1a\u4ece`DataSource`\u4e2d\u83b7\u53d6\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u7136\u540e\u6267\u884c\u67e5\u8be2\uff0c\u67e5\u8be2\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u4e0d\u4f1a\u7acb\u5373\u5173\u95ed\uff0c\\n  \u800c\u662f\u5728`EntityManager`\u88ab\u5173\u95ed\u65f6\u5173\u95ed\uff0c\u800c`EntityManager`\u4f1a\u5728`OpenEntityManagerInViewInterceptor`\u88ab\u5173\u95ed\u65f6\u5173\u95ed.\\n\\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u5f53`OpenEntityManagerInViewInterceptor`\u88ab\u5173\u95ed\u65f6\uff0c`EntityManager`\u4f1a\u88ab\u5173\u95ed\uff0c\u800c`EntityManager`\\n\u88ab\u5173\u95ed\u65f6\u5176\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8fde\u63a5\u4e5f\u4f1a\u88ab\u5173\u95ed.<br/>\\n`EntityManager`\u88ab\u521b\u5efa\u51fa\u6765\u65f6\u4e0d\u4f1a\u7acb\u5373\u521b\u5efa\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u800c\u662f\u5728\u6267\u884c`sql`\u65f6\u624d\u4f1a\u521b\u5efa\u6570\u636e\u5e93\u8fde\u63a5.<br/>\\n\u5982\u679c\u6574\u4e2a\u8bf7\u6c42\u94fe\u8def\u975e\u5e38\u8017\u65f6\uff0c\u90a3\u4e48\u5728\u6574\u4e2a\u8bf7\u6c42\u94fe\u8def\u4e2d\uff0c`EntityManager`\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8fde\u63a5\u90fd\u4f1a\u88ab\u5360\u7528\uff0c\u76f4\u5230\u6574\u4e2a\u8bf7\u6c42\u94fe\u8def\u6267\u884c\u5b8c\u6210.<br/>\\n\u5982\u679c\u540c\u65f6\u6709\u591a\u4e2a\u8bf7\u6c42\u6b63\u5728\u6267\u884c, \u90a3\u4e48\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c. \u4ece\u800c\u5bfc\u81f4\u540e\u7eed\u8bf7\u6c42\u65e0\u6cd5\u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5.<br/>\\n\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u5173\u95ed`OpenEntityManagerInViewInterceptor`\u6765\u786e\u4fdd\u5f53\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c.\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [When does JPA return connection to db pool](https://stackoverflow.com/questions/71140137/when-does-jpa-return-connection-to-db-pool)\\n- [A Guide to Spring\u2019s Open Session in View](https://www.baeldung.com/spring-open-session-in-view)"},{"id":"/2023/05/05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server","metadata":{"permalink":"/blog/2023/05/05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server","source":"@site/blog/2023-05-05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server.md","title":"\u901a\u8fc7\u521b\u5efarsa\u683c\u5f0f\u7684\u79c1\u94a5\u4ee5\u53ca\u670d\u52a1\u7aef\u542f\u7528rsa\u8ba4\u8bc1\u89e3\u51b3jsch\u8fde\u63a5ssh\u5931\u8d25\u7684\u95ee\u9898","description":"\u670d\u52a1\u5efa\u7acbssh\u8fde\u63a5\u5931\u8d25, \u95ee\u9898\u5b9a\u4f4d\u4e3ajsch\u4e0d\u652f\u6301openssh\u683c\u5f0f\u7684\u79c1\u94a5.","date":"2023-05-05T00:00:00.000Z","formattedDate":"May 5, 2023","tags":[{"label":"jsch","permalink":"/blog/tags/jsch"},{"label":"openssh","permalink":"/blog/tags/openssh"},{"label":"sshd","permalink":"/blog/tags/sshd"},{"label":"ssh-keygen","permalink":"/blog/tags/ssh-keygen"},{"label":"rsa","permalink":"/blog/tags/rsa"}],"readingTime":2.555,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["jsch","openssh","sshd","ssh-keygen","rsa"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u5173\u95edOpenEntityManagerInViewInterceptor\u786e\u4fdd\u5f53\u4e0b\u6e38\u670d\u52a1\u54cd\u5e94\u7f13\u6162\u65f6\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u8fde\u63a5\u88ab\u5360\u7528\u5b8c","permalink":"/blog/2023/05/15/to-ensure-that-database-connections-are-not-exhausted-when-downstream-services-respond-slowly-by-closing-open-session-inview"},"nextItem":{"title":"\u4f7f\u7528kind\u521b\u5efa\u4e00\u4e2ak8s\u96c6\u7fa4","permalink":"/blog/2023/04/23/use-kind-create-a-k8s-cluster"}},"content":"\u670d\u52a1\u5efa\u7acb`ssh`\u8fde\u63a5\u5931\u8d25, \u95ee\u9898\u5b9a\u4f4d\u4e3a`jsch`\u4e0d\u652f\u6301`openssh`\u683c\u5f0f\u7684\u79c1\u94a5.<br/>\\n\u5728`OpenSSH 7.8`\u53ca\u4e4b\u540e\u7684\u7248\u672c, `ssh-keygen`\u547d\u4ee4\u9ed8\u8ba4\u751f\u6210\u7684\u79c1\u94a5\u683c\u5f0f\u4e3a`openssh`.<br/>\\n\u8be5\u683c\u5f0f\u7684\u5934\u90e8\u4e3a`-----BEGIN OPENSSH PRIVATE KEY-----`.<br/>\\n\\n\u5728\u5c06\u79c1\u94a5\u8f6c\u6362\u4e3a`rsa`\u683c\u5f0f\u540e, \u53d1\u73b0\u670d\u52a1\u7aef\u8fd8\u9700\u8981\u542f\u7528`rsa`\u8ba4\u8bc1, \u5728\u542f\u7528`rsa`\u8ba4\u8bc1\u540e\u95ee\u9898\u89e3\u51b3.<br/>\\n\\n\u4e0b\u9762\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u751f\u6210`rsa`\u683c\u5f0f\u7684\u79c1\u94a5\u4ee5\u53ca\u670d\u52a1\u7aef\u542f\u7528`rsa`\u8ba4\u8bc1.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u751f\u6210rsa\u683c\u5f0f\u7684\u79c1\u94a5\\n\\n\u670d\u52a1\u5efa\u7acb`ssh`\u94fe\u63a5\u5931\u8d25, \u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\nCaused by: com.jcraft.jsch.JSchException: invalid privatekey: [B@e4487af\\n    at com.jcraft.jsch.KeyPair.load(KeyPair.java:664)\\n    at com.jcraft.jsch.KeyPair.load(KeyPair.java:561)\\n    at com.jcraft.jsch.IdentityFile.newInstance(IdentityFile.java:40)\\n    at com.jcraft.jsch.JSch.addIdentity(JSch.java:407)\\n    at com.jcraft.jsch.JSch.addIdentity(JSch.java:367)\\n```\\n\\n\u5728\u67e5\u9605\u4e86\u76f8\u5173\u95ee\u9898\u540e, \u53d1\u73b0`jsch`\u4e0d\u652f\u6301`openssh`\u683c\u5f0f\u7684\u79c1\u94a5, \u9700\u8981\u5c06\u79c1\u94a5\u8f6c\u6362\u4e3a`rsa`\u683c\u5f0f.<br/>\\n\\n\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u751f\u6210`rsa`\u683c\u5f0f\u7684\u79c1\u94a5\\n\\n```bash\\nssh-keygen -t rsa -b 4096 -m PEM\\n```\\n\\n\u540e\u7eed\u4f1a\u63d0\u793a\u8f93\u5165\u79c1\u94a5\u7684\u6587\u4ef6\u540d, \u4ee5\u53ca\u79c1\u94a5\u7684\u5bc6\u7801, \u4e00\u822c\u76f4\u63a5\u56de\u8f66\u5373\u53ef.\\n\\n## \u670d\u52a1\u7aef\u542f\u7528rsa\u8ba4\u8bc1\\n\\n:::note\\n`OpenSSH 8.8`\u53ca\u4e4b\u540e\u7684\u7248\u672c\u9ed8\u8ba4\u7981\u7528rsa\u8ba4\u8bc1, \u9700\u8981\u624b\u52a8\u542f\u7528, \u53ef\u4ee5\u901a\u8fc7`ssh -V`\u67e5\u770b`sshd`\u7248\u672c\\n:::\\n\\n\u5728\u751f\u6210\u4e86`rsa`\u683c\u5f0f\u7684\u79c1\u94a5\u540e, \u901a\u8fc7`ssh`\u8fde\u63a5\u670d\u52a1\u7aef, \u53d1\u73b0\u8fde\u63a5\u5931\u8d25, \u67e5\u770b`sshd`\u65e5\u5fd7\u53d1\u73b0\u5982\u4e0b\u9519\u8bef\\n\\n```bash\\njournalctl -t sshd -f\\n```\\n\\n\u8be5\u547d\u4ee4\u8f93\u51fa\u5982\u4e0b\u5185\u5bb9\\n\\n```log\\nMay 05 18:05:00 orange sshd[289365]: userauth_pubkey: signature algorithm ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]\\nMay 05 18:05:00 orange sshd[289365]: error: Received disconnect from 127.0.0.1 port 55904:3: com.jcraft.jsch.JSchException: Auth fail [preauth]\\nMay 05 18:05:00 orange sshd[289365]: Disconnected from authenticating user fastone 127.0.0.1 port 55904 [preauth]\\n```\\n\\n\u4e0a\u8ff0\u65e5\u5fd7\u4e2d\u7684`signature algorithm ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]`\u8bf4\u660e`sshd`\u4e0d\u652f\u6301`ssh-rsa`\u7b97\u6cd5.<br/>\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u9700\u8981\u7f16\u8f91`/etc/ssh/sshd_config`\u5e76\u589e\u52a0\u4ee5\u4e0b\u5185\u5bb9\\n\\n```properties title=\\"/etc/ssh/sshd_config\\"\\nPubkeyAcceptedAlgorithms +ssh-rsa\\n```\\n\\n\u7f16\u8f91\u5b8c\u6210\u540e\u91cd\u542f`sshd`\u670d\u52a1\\n\\n```bash\\nsudo systemctl restart sshd\\n```\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [\\"Invalid privatekey\\" when using JSch](https://stackoverflow.com/questions/53134212/invalid-privatekey-when-using-jsch)\\n- [support for openssh default key format in jsch fork](https://www.matez.de/index.php/2020/10/16/support-for-openssh-default-key-format-in-jsch-fork/#:~:text=If%20you%20are%20a%20user,them%20to%20old%20pem%20format.&text=Please%20upgrade%20to%20version%200.1,and%20give%20it%20a%20try.)\\n- [SSH server gives \\"userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]\\" when connecting with Putty](https://unix.stackexchange.com/questions/721606/ssh-server-gives-userauth-pubkey-key-type-ssh-rsa-not-in-pubkeyacceptedalgorit)\\n- [\u7b2c\u4e09\u65b9\u57fa\u4e8ejsch fork\u51fa\u6765\u7684\u5e93](https://github.com/mwiede/jsch)\\n- [Openssh Private Key to RSA Private Key](https://stackoverflow.com/questions/54994641/openssh-private-key-to-rsa-private-key)\\n- [SSH keys](https://wiki.archlinux.org/title/SSH_keys)"},{"id":"/2023/04/23/use-kind-create-a-k8s-cluster","metadata":{"permalink":"/blog/2023/04/23/use-kind-create-a-k8s-cluster","source":"@site/blog/2023-04-23/use-kind-create-a-k8s-cluster.md","title":"\u4f7f\u7528kind\u521b\u5efa\u4e00\u4e2ak8s\u96c6\u7fa4","description":"kind\u662f\u4e00\u4e2a\u7528\u4e8e\u521b\u5efak8s\u96c6\u7fa4\u7684\u5de5\u5177, \u5b83\u4f7f\u7528docker\u5bb9\u5668\u4f5c\u4e3a\u8282\u70b9, \u53ef\u4ee5\u5feb\u901f\u521b\u5efa\u4e00\u4e2ak8s\u96c6\u7fa4,","date":"2023-04-23T00:00:00.000Z","formattedDate":"April 23, 2023","tags":[{"label":"kind","permalink":"/blog/tags/kind"},{"label":"k8s","permalink":"/blog/tags/k-8-s"},{"label":"docker","permalink":"/blog/tags/docker"},{"label":"github-pr","permalink":"/blog/tags/github-pr"}],"readingTime":4.275,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["kind","k8s","docker","github-pr"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u521b\u5efarsa\u683c\u5f0f\u7684\u79c1\u94a5\u4ee5\u53ca\u670d\u52a1\u7aef\u542f\u7528rsa\u8ba4\u8bc1\u89e3\u51b3jsch\u8fde\u63a5ssh\u5931\u8d25\u7684\u95ee\u9898","permalink":"/blog/2023/05/05/solve-jsch-ssh-connection-failure-by-creating-rsa-private-key-and-enabling-rsa-authentication-on-server"},"nextItem":{"title":"\u4f7f\u7528S3\u6258\u7ba1\u9759\u6001\u7f51\u7ad9","permalink":"/blog/2023/04/16/hosting-a-static-website-using-s3"}},"content":"kind\u662f\u4e00\u4e2a\u7528\u4e8e\u521b\u5efa`k8s`\u96c6\u7fa4\u7684\u5de5\u5177, \u5b83\u4f7f\u7528`docker`\u5bb9\u5668\u4f5c\u4e3a\u8282\u70b9, \u53ef\u4ee5\u5feb\u901f\u521b\u5efa\u4e00\u4e2a`k8s`\u96c6\u7fa4,\\n\u7528\u4e8e\u6d4b\u8bd5\u6216\u8005\u5f00\u53d1.<br/>\\n\u5b98\u65b9\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u6587\u6863[Ingress](https://kind.sigs.k8s.io/docs/user/ingress/), \u5728\u4f7f\u7528\u8be5\u6587\u6863\u7684\u65f6\u5019\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898.<br/>\\n\u672c\u6587\u57fa\u4e8e\u5b98\u65b9\u6587\u6863\u5e76\u4f5c\u51fa\u4e86\u4e00\u5b9a\u7684\u4fee\u6539\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`kind`\u521b\u5efa\u4e00\u4e2a`k8s`\u96c6\u7fa4, \u5e76\u5728\u96c6\u7fa4\u4e2d\u90e8\u7f72`kong-ingress`.\u6700\u540e\u90e8\u7f72\u4e00\u4e2a\u6d4b\u8bd5\u5e94\u7528\u5e76\u901a\u8fc7`kong-ingress`\u8bbf\u95ee\u8be5\u5e94\u7528.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5b89\u88c5kind\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5`kind`\\n\\n```bash\\ngo install sigs.k8s.io/kind@v0.18.0\\n```\\n\\n## \u521b\u5efa\u4e00\u4e2ak8s\u96c6\u7fa4\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a`k8s`\u96c6\u7fa4, \u96c6\u7fa4\u4e2d\u5305\u542b\u4e00\u4e2a`master`\u8282\u548c\u4e00\u4e2a`worker`\u8282\u70b9.<br/>\\n\u540c\u65f6\u5c06`master`\u8282\u70b9\u7684`80&443`\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684`80&443`\u7aef\u53e3, \u7528\u4e8e\u540e\u7eed\u5c06`ingress`\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684`80&443`\u7aef\u53e3.<br/>\\n\\n```bash\\ncat <<EOF | kind create cluster --config=-\\nkind: Cluster\\napiVersion: kind.x-k8s.io/v1alpha4\\nnodes:\\n  - role: control-plane\\n    kubeadmConfigPatches:\\n      - |\\n        kind: InitConfiguration\\n        nodeRegistration:\\n          kubeletExtraArgs:\\n            node-labels: \\"ingress-ready=true\\"\\n    extraPortMappings:\\n      - containerPort: 80\\n        hostPort: 80\\n        protocol: TCP\\n      - containerPort: 443\\n        hostPort: 443\\n        protocol: TCP\\n  - role: worker\\nEOF\\n```\\n\\n\u6267\u884c`docker ps`\u547d\u4ee4\u67e5\u770b`kind`\u521b\u5efa\u7684`docker`\u5bb9\u5668\\n\\n```bash\\nCONTAINER ID   IMAGE                               COMMAND                  CREATED       STATUS       PORTS                                                                 NAMES\\nb4368e7fbfb1   kindest/node:v1.26.3                \\"/usr/local/bin/entr\u2026\\"   2 hours ago   Up 2 hours   0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp, 127.0.0.1:45145->6443/tcp   kind-control-plane\\nc0638805438a   kindest/node:v1.26.3                \\"/usr/local/bin/entr\u2026\\"   2 hours ago   Up 2 hours                                                                         kind-worker\\n```\\n\\n## \u5b89\u88c5`kong`\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5`kong-ingress`\\n\\n```bash\\nkubectl apply -f https://raw.githubusercontent.com/Kong/kubernetes-ingress-controller/main/deploy/single/all-in-one-dbless.yaml\\n```\\n\\n## \u914d\u7f6e`kong`\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u914d\u7f6e`kong`.<br/>\\n\u7b2c\u4e00\u4e2a\u547d\u4ee4\u7528\u4e8e\u5c06`deployment`\u4e3a`proxy-kong`\u4e0b\u9762\u7684`pod`\u7684`replicas`\u8bbe\u7f6e\u4e3a`1`\u540c\u65f6\u5c06\u7aef\u53e3\u6620\u5c04\u5230`host`\u4e0a(\\n\u8fd9\u91cc\u7684host\u5c31\u662f`docker`\u5bb9\u5668\u7684`host`, \u540c\u65f6docker\u5bb9\u5668\u5bf9\u5e94\u7684`port`\u53c8\u6620\u5c04\u5230\u4e86\u672c\u5730\u7684\u7aef\u53e3).<br/>\\n\\n\u7b2c\u4e8c\u4e2a\u547d\u4ee4\u7528\u4e8e\u5c06`kong-proxy`\u7684`service`\u7684\u7c7b\u578b\u8bbe\u7f6e\u4e3a`NodePort`, \u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7`host`\u7684`port`\u8bbf\u95ee`kong`\u4e86.\\n\\n```bash\\nkubectl patch deployment -n kong proxy-kong -p \'{\\"spec\\":{\\"replicas\\":1, \\"template\\":{\\"spec\\":{\\"containers\\":[{\\"name\\":\\"proxy\\", \\"ports\\":[{\\"containerPort\\":8000,\\"hostPort\\":80,\\"name\\":\\"proxy\\",\\"protocol\\":\\"TCP\\"},{\\"containerPort\\":8443,\\"hostPort\\":443,\\"name\\":\\"proxy-ssl\\",\\"protocol\\":\\"TCP\\"}]}],\\"nodeSelector\\":{\\"ingress-ready\\":\\"true\\"},\\"tolerations\\":[{\\"key\\":\\"node-role.kubernetes.io/control-plane\\",\\"operator\\":\\"Equal\\",\\"effect\\":\\"NoSchedule\\"},{\\"key\\":\\"node-role.kubernetes.io/master\\",\\"operator\\":\\"Equal\\",\\"effect\\":\\"NoSchedule\\"}]}}}}\'\\n```\\n\\n```bash\\nkubectl patch service -n kong kong-proxy -p \'{\\"spec\\":{\\"type\\":\\"NodePort\\"}}\'\\n```\\n\\n## \u542f\u52a8\u6d4b\u8bd5\u5e94\u7528\\n\\n\u521b\u5efa\u5982\u4e0b\u6587\u4ef6\u7528\u4e8e\u540e\u7eed\u6267\u884c`kubectl apply`\u547d\u4ee4\\n\\n```yaml title=\\"usage.yml\\"\\nkind: Pod\\napiVersion: v1\\nmetadata:\\n  name: foo-app\\n  labels:\\n    app: foo\\nspec:\\n  containers:\\n    - command:\\n        - /agnhost\\n        - netexec\\n        - --http-port\\n        - \\"8080\\"\\n      image: opsdockerimage/e2e-test-images-agnhost:2.26\\n      name: foo-app\\n---\\nkind: Service\\napiVersion: v1\\nmetadata:\\n  name: foo-service\\nspec:\\n  selector:\\n    app: foo\\n  ports:\\n    # Default port used by the image\\n    - port: 8080\\n---\\nkind: Pod\\napiVersion: v1\\nmetadata:\\n  name: bar-app\\n  labels:\\n    app: bar\\nspec:\\n  containers:\\n    - command:\\n        - /agnhost\\n        - netexec\\n        - --http-port\\n        - \\"8080\\"\\n      image: opsdockerimage/e2e-test-images-agnhost:2.26\\n      name: bar-app\\n---\\nkind: Service\\napiVersion: v1\\nmetadata:\\n  name: bar-service\\nspec:\\n  selector:\\n    app: bar\\n  ports:\\n    # Default port used by the image\\n    - port: 8080\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: example-ingress\\n  annotations:\\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\\nspec:\\n  rules:\\n    - http:\\n        paths:\\n          - pathType: Prefix\\n            path: /foo(/|$)(.*)\\n            backend:\\n              service:\\n                name: foo-service\\n                port:\\n                  number: 8080\\n          - pathType: Prefix\\n            path: /bar(/|$)(.*)\\n            backend:\\n              service:\\n                name: bar-service\\n                port:\\n                  number: 8080\\n---\\n```\\n\\n```bash\\ndocker puull kind load docker-image opsdockerimage/e2e-test-images-agnhost:2.26s\\nkind load docker-image opsdockerimage/e2e-test-images-agnhost:2.26\\nkubectl apply -f usage.yml\\n```\\n\\n## \u6d4b\u8bd5\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u6d4b\u8bd5\\n\\n```bash\\ncurl localhost/foo/hostname\\ncurl localhost/bar/hostname\\n```\\n\\n## \u9047\u5230\u7684\u95ee\u9898\\n\\n### `nginx`\u548c`contour`\u7b49`ingress`\u5b89\u88c5\u5931\u8d25\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u56fd\u5185\u65e0\u6cd5\u4e0b\u8f7d\u5bf9\u5e94\u7684\u955c\u50cf\u5bfc\u81f4\u65e0\u6cd5\u5b89\u88c5\u6210\u529f.<br/>\\n\u89e3\u51b3\u65b9\u6848\u662f\u91c7\u7528`kong`\u4f5c\u4e3a`ingress`.<br/>\\n\\n### \u5b98\u65b9\u6587\u6863\u4e2d\u7684\u5173\u4e8e`kong`\u7684`ingress`\u7684\u914d\u7f6e\u65e0\u6cd5\u751f\u6548\\n\\n\u6267\u884c\u5b98\u65b9\u6587\u6863\u4e2d\u7684\u5982\u4e0b\u547d\u4ee4\u5931\u8d25\\n\\n```bash\\nkubectl patch deployment -n kong ingress-kong -p \'{\\"spec\\":{\\"template\\":{\\"spec\\":{\\"containers\\":[{\\"name\\":\\"proxy\\",\\"ports\\":[{\\"containerPort\\":8000,\\"hostPort\\":80,\\"name\\":\\"proxy\\",\\"protocol\\":\\"TCP\\"},{\\"containerPort\\":8443,\\"hostPort\\":443,\\"name\\":\\"proxy-ssl\\",\\"protocol\\":\\"TCP\\"}]}],\\"nodeSelector\\":{\\"ingress-ready\\":\\"true\\"},\\"tolerations\\":[{\\"key\\":\\"node-role.kubernetes.io/control-plane\\",\\"operator\\":\\"Equal\\",\\"effect\\":\\"NoSchedule\\"},{\\"key\\":\\"node-role.kubernetes.io/master\\",\\"operator\\":\\"Equal\\",\\"effect\\":\\"NoSchedule\\"}]}}}}\'\\n```\\n\\n\u62a5\u9519\u5982\u4e0b\\n\\n```log\\nThe Deployment \\"ingress-kong\\" is invalid: spec.template.spec.containers[0].image: Required value\\n```\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a`deployment`\u7ed9\u9519\u4e86, \u6b63\u786e\u7684`deployment`\u5e94\u8be5\u662f`proxy-kong`.<br/>\\n\\n\u5c06\u547d\u4ee4\u4e2d\u7684`ingress-kong`\u66ff\u6362\u4e3a`proxy-kong`\u540e, \u6267\u884c\u6210\u529f.<br/>\\n\\n\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898, \u6211\u5df2\u7ecf\u63d0\u4ea4\u4e86pr, \u4f46\u662f\u8fd8\u6ca1\u6709\u88ab\u5408\u5e76, \u53ef\u4ee5\u53c2\u8003<br/>\\n[doc: fix wrong implementation of creation of kong-ingress #3183](https://github.com/kubernetes-sigs/kind/pull/3183)\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [kind](https://kind.sigs.k8s.io/)"},{"id":"/2023/04/16/hosting-a-static-website-using-s3","metadata":{"permalink":"/blog/2023/04/16/hosting-a-static-website-using-s3","source":"@site/blog/2023-04-16/hosting-a-static-website-using-s3.md","title":"\u4f7f\u7528S3\u6258\u7ba1\u9759\u6001\u7f51\u7ad9","description":"\u9759\u6001\u7f51\u7ad9\u662f\u6307\u4e0d\u9700\u8981\u540e\u7aef\u670d\u52a1\u7684\u7f51\u7ad9, \u6bd4\u5982\u4e2a\u4eba\u535a\u5ba2, \u4e2a\u4eba\u7b80\u5386, \u4e2a\u4eba\u4f5c\u54c1\u96c6\u7b49.","date":"2023-04-16T00:00:00.000Z","formattedDate":"April 16, 2023","tags":[{"label":"aws","permalink":"/blog/tags/aws"},{"label":"s3","permalink":"/blog/tags/s-3"}],"readingTime":2.105,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["aws","s3"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528kind\u521b\u5efa\u4e00\u4e2ak8s\u96c6\u7fa4","permalink":"/blog/2023/04/23/use-kind-create-a-k8s-cluster"},"nextItem":{"title":"\u4f7f\u7528Gradle\u7684JavaPackager\u63d2\u4ef6\u5c06Java\u5e94\u7528\u6253\u5305\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6","permalink":"/blog/2023/04/15/use-gradle-plugin-java-packager-to-build-binary-java-app"}},"content":"\u9759\u6001\u7f51\u7ad9\u662f\u6307\u4e0d\u9700\u8981\u540e\u7aef\u670d\u52a1\u7684\u7f51\u7ad9, \u6bd4\u5982\u4e2a\u4eba\u535a\u5ba2, \u4e2a\u4eba\u7b80\u5386, \u4e2a\u4eba\u4f5c\u54c1\u96c6\u7b49. <br/>\\n\u8fd9\u4e9b\u7f51\u7ad9\u7684\u5185\u5bb9\u90fd\u662f\u9759\u6001\u7684, \u4e0d\u9700\u8981\u540e\u7aef\u670d\u52a1, \u53ea\u9700\u8981\u5c06\u9759\u6001\u6587\u4ef6\u6258\u7ba1\u5230\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u5373\u53ef.<br/>\\n\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528AWS S3\u6258\u7ba1\u9759\u6001\u7f51\u7ad9.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u521b\u5efas3\u6876\\n\\n\u9996\u5148, \u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2as3\u6876, \u7528\u4e8e\u5b58\u653e\u9759\u6001\u6587\u4ef6.\\n\\n\u6253\u5f00AWS\u63a7\u5236\u53f0, \u9009\u62e9S3\u670d\u52a1, \u70b9\u51fb\u521b\u5efa\u6876.\\n\\n## \u542f\u7528s3\u9759\u6001\u7f51\u7ad9\u6258\u7ba1\\n\\n\u8fdb\u5165s3\u6876, \u70b9\u51fb`Properties`\u8fd9\u4e2a`Tab`, \u5728`Static website hosting`\u8fd9\u4e2a`Section`\u4e2d\u70b9\u51fb`Edit`\u6309\u94ae.\\n\u754c\u9762\u5982\u4e0b:\\n![2023-04-20 14-43-25.png](./2023-04-20-14-43-25.png)\\n\u586b\u5199\u5fc5\u8981\u7684\u4fe1\u606f, \u70b9\u51fb\u4fdd\u5b58.\\n\\n\u4fdd\u5b58\u5b8c\u6210\u4e4b\u540e\u518d\u6b21\u8fdb\u5165`Properties`\u8fd9\u4e2a`Tab`\u4e2d, \u5728`Static website hosting`\u8fd9\u4e2a`Section`\u4e2d\u53ef\u4ee5\u770b\u5230`Bucket website endpoint`\\n\u5df2\u7ecf\u663e\u793a\u51fa\u6765\u4e86, \u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u7684\u9759\u6001\u7f51\u7ad9\u5730\u5740.\\n\\n## \u516c\u5f00\u6876\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, s3\u662f\u79c1\u6709\u7684, \u65e0\u6cd5\u901a\u8fc7\u516c\u7f51\u8bbf\u95ee. \u6211\u4eec\u9700\u8981\u5c06\u6876\u8bbe\u7f6e\u4e3a\u516c\u5f00, \u4ee5\u4fbf\u901a\u8fc7\u516c\u7f51\u8bbf\u95ee.\\n\\n\u8fdb\u5165s3\u6876, \u70b9\u51fb`Permissions`\u8fd9\u4e2a`Tab`, \u5728`Block public access (bucket settings)`\u8fd9\u4e2a`Section`\u4e2d\u70b9\u51fb`Edit`\u6309\u94ae, \u754c\u9762\u5982\u4e0b:\\n![2023-04-20 14-49-00.png](./2023-04-20-14-50-45.png)\\n\u53d6\u6d88`Block all public access`\u7684\u52fe\u9009, \u70b9\u51fb\u4fdd\u5b58.\\n\\n\u53e6\u5916\u8fd8\u9700\u8981\u8bbe\u7f6e`Bucket policy`, \u5728`Bucket policy`\u8fd9\u4e2a`Section`\u4e2d\u70b9\u51fb`Edit`\u6309\u94ae, \u8f93\u5165\u5982\u4e0b\u914d\u7f6e\u540e\u4fdd\u5b58.\\n\\n:::note\\n\u5c06`Bucket-Name`\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u6876\u540d\u79f0\\n:::\\n\\n```json\\n{\\n\\t\\"Version\\": \\"2012-10-17\\",\\n\\t\\"Statement\\": [\\n\\t\\t{\\n\\t\\t\\t\\"Sid\\": \\"PublicReadGetObject\\",\\n\\t\\t\\t\\"Effect\\": \\"Allow\\",\\n\\t\\t\\t\\"Principal\\": \\"*\\",\\n\\t\\t\\t\\"Action\\": [\\n\\t\\t\\t\\t\\"s3:GetObject\\"\\n\\t\\t\\t],\\n\\t\\t\\t\\"Resource\\": [\\n\\t\\t\\t\\t\\"arn:aws:s3:::Bucket-Name/*\\"\\n\\t\\t\\t]\\n\\t\\t}\\n\\t]\\n}\\n```\\n\\n## \u4e0a\u4f20\u9759\u6001\u6587\u4ef6\\n\\n\u901a\u8fc7`aws-cli`\u6216\u8005`web-console`\u4e0a\u4f20\u9759\u6001\u6587\u4ef6\u5230s3\u6876\u4e2d.\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Hosting a static website using Amazon S3](https://docs.amazonaws.cn/en_us/AmazonS3/latest/userguide/WebsiteHosting.html)\\n- [Setting permissions for website access](https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteAccessPermissionsReqd.html)"},{"id":"/2023/04/15/use-gradle-plugin-java-packager-to-build-binary-java-app","metadata":{"permalink":"/blog/2023/04/15/use-gradle-plugin-java-packager-to-build-binary-java-app","source":"@site/blog/2023-04-15/use-gradle-plugin-java-packager-to-build-binary-java-app.md","title":"\u4f7f\u7528Gradle\u7684JavaPackager\u63d2\u4ef6\u5c06Java\u5e94\u7528\u6253\u5305\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6","description":"\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d, \u6211\u4ecb\u7ecd\u8fc7\u5982\u4f55\u901a\u8fc7graalvm\u5c06java\u5e94\u7528\u6253\u5305\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6, \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u5728graalvm\u4e2d\u5b89\u88c5native-image","date":"2023-04-15T00:00:00.000Z","formattedDate":"April 15, 2023","tags":[{"label":"native-image","permalink":"/blog/tags/native-image"},{"label":"java-packager","permalink":"/blog/tags/java-packager"},{"label":"gradle-plugin","permalink":"/blog/tags/gradle-plugin"},{"label":"github-pr","permalink":"/blog/tags/github-pr"}],"readingTime":6.38,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["native-image","java-packager","gradle-plugin","github-pr"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528S3\u6258\u7ba1\u9759\u6001\u7f51\u7ad9","permalink":"/blog/2023/04/16/hosting-a-static-website-using-s3"},"nextItem":{"title":"\u89e3\u51b3\u5728Kotlin Coroutines\u4e2d\u7684\u547d\u4ee4\u884c\u8c03\u7528\u4e2d\u51fa\u73b0Stream Closed\u5f02\u5e38","permalink":"/blog/2023/04/05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine"}},"content":"\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d, \u6211\u4ecb\u7ecd\u8fc7\u5982\u4f55\u901a\u8fc7`graalvm`\u5c06`java`\u5e94\u7528\u6253\u5305\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6, \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u5728`graalvm`\u4e2d\u5b89\u88c5`native-image`\\n\u5de5\u5177, \u5e76\u4e14\u9700\u8981\u5728`graalvm`\u4e2d\u7f16\u8bd1`java`\u5e94\u7528, \u8fd9\u6837\u7684\u65b9\u5f0f\u5bf9\u4e8e`java`\u5e94\u7528\u7684\u5f00\u53d1\u8005\u6765\u8bf4, \u6709\u4e00\u5b9a\u7684\u95e8\u69db, \u800c\u4e14\u4e5f\u4e0d\u591f\u7075\u6d3b.\\n\u5e76\u4e14\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7531\u4e8e\u4ee3\u7801\u6ca1\u6709\u6ee1\u8db3`graalvm`\u7684\u8981\u6c42, \u4f8b\u5982\u4f7f\u7528\u4e86`java`\u7684\u53cd\u5c04\u673a\u5236, \u4f1a\u5bfc\u81f4\u6784\u5efa\u5931\u8d25(\\ngraalvm\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u5c31\u77e5\u9053\u8fd9\u4e9b\u4fe1\u606f\u6765\u751f\u6210)\\n\u4e0b\u9762\u5c06\u4ecb\u7ecd\u53e6\u4e00\u79cd\u65b9\u5f0f, \u901a\u8fc7`gradle`\u7684`JavaPackager`\u63d2\u4ef6\u6765\u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6dfb\u52a0\u63d2\u4ef6\\n\\n\u8981\u542f\u7528\u6b64\u63d2\u4ef6, \u9700\u8981\u5728`build.gradle.kts`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e:\\n\\n:::note\\n\u7531\u4e8e\u8be5\u63d2\u4ef6\u6ca1\u6709\u53d1\u5e03\u5230`gradle`\u7684\u63d2\u4ef6\u4ed3\u5e93\u4e2d, \u6240\u4ee5\u9700\u8981\u5728`buildscript`\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7684\u4f9d\u8d56\u5e76\u901a\u8fc7`apply`\u6765\u542f\u7528\u8be5\u63d2\u4ef6\\n:::\\n\\n```kotlin title=\\"build.gradle.kts\\"\\nbuildscript {\\n\\trepositories {\\n\\t\\tmaven { setUrl(\\"https://mirrors.huaweicloud.com/repository/maven/\\") }\\n\\t\\tmaven { setUrl(\\"https://mirrors.tencent.com/nexus/repository/maven-public/\\") }\\n\\t\\tmaven { setUrl(\\"https://maven.aliyun.com/nexus/content/groups/public/\\") }\\n\\t\\tmaven { setUrl(\\"https://oss.sonatype.org/content/repositories/snapshots\\") }\\n\\t}\\n\\tdependencies {\\n\\t\\tclasspath(\\"io.github.fvarrui:javapackager:1.7.0\\")\\n\\t}\\n}\\n\\napply(plugin = \\"io.github.fvarrui.javapackager.plugin\\")\\n```\\n\\n## \u63d2\u4ef6\u914d\u7f6e\\n\\n\u4ee5`linux`\u4e3a\u4f8b, \u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e`JavaPackager`\u63d2:\\n\\n```kotlin title=\\"build.gradle.kts\\"\\nconfigure<PackagePluginExtension>() {\\n\\tmainClass(\\"<MAIN-CLASS>\\")\\n\\tplatform(Platform.linux)\\n\\tpackagingJdk(file(System.getProperty(\\"java.home\\")))\\n\\t// arch(Arch.x64) not work\\n\\t// arch is not configured in DefaultPackageTask(\u5bfc\u81f4\u81ea\u5b9a\u4e49arch\u5931\u6548)\\n\\t// packagingJdk\u6ca1\u6709\u8bbe\u7f6e\u9ed8\u8ba4\u503c(\u5bfc\u81f4jink\u5b9a\u4f4d\u5230\u4e86/bin\u76ee\u5f55\u4e0b\u800c\u4e0d\u662f\u7528\u6237\u7684jdk\u7684home\u76ee\u5f55\u4e0b\u7684bin\u76ee\u5f55)\\n}\\n```\\n\\n\u5c06\u4e0a\u9762\u7684\u7684\u6a21\u677f\u66ff\u6362\u4e3a\u81ea\u5df1\u7684`mainClass`\u5373\u53ef, \u5176\u4ed6\u7684\u914d\u7f6e\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8fdb\u884c\u4fee\u6539.\\n\\n## \u6784\u5efa\\n\\n\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u6784\u5efa:\\n\\n```bash\\n./gradlew package -x test\\n```\\n\\n## \u5df2\u77e5\u95ee\u9898\\n\\n### `packagingJdk`\u4e0d\u4f1a\u81ea\u52a8\u63a8\u65ad\u5bfc\u81f4\u6253\u5305\u5931\u8d25\\n\\n\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u5982\u4e0b\u9519\u8bef\\n\\n```log\\n /bin/sh: 1: /bin/jdeps: not found\\n ```\\n\\n#### \u95ee\u9898\u539f\u56e0\\n\\n\u8be5\u95ee\u9898\u7684\u539f\u56e0\u662f`JavaPackager`\u63d2\u4ef6\u5728\u6267\u884c`jdeps`\u547d\u4ee4\u65f6\u4f1a\u6839\u636e`packagingJdk`\u914d\u7f6e\u7684\u503c\u62fc\u63a5`/bin/jdeps`\u6765\u6267\u884c,\\n\u4f46\u662f\u7531\u4e8e\u6ca1\u6709\u914d\u7f6e`packagingJdk`\u7684\u503c, \u6240\u4ee5\u9ed8\u8ba4\u4f7f\u7528\u4e86`/bin/jdeps`\u6765\u6267\u884c, \u4f46\u662f`/bin/jdeps`\u5e76\u4e0d\u5b58\u5728, \u6240\u4ee5\u5bfc\u81f4\u4e86\u4e0a\u9762\u7684\u9519\u8bef.\\n\\n\u76f8\u5173\u4ee3\u7801\u5728`io.github.fvarrui.javapackager.packagers.BundleJre`\u7c7b\u7684`doApply`\u65b9\u6cd5\u4e2d, \u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528`jdeps`\u547d\u4ee4\u6765\u83b7\u53d6\u4f9d\u8d56\u4fe1\u606f.\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u5728\u4e0a\u9762\u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0`packagingJdk`\u7684\u914d\u7f6e`packagingJdk(file(System.getProperty(\\"java.home\\")))`.\\n\\n:::note\\n2023-05-23<br/>\\n\u76f8\u5173pr\u5df2\u63d0\u4ea4, \u94fe\u63a5\u5982\u4e0b<br/>\\n[fix(gradle-default-package-task): Set default packagingJdk for bundle-jre #332](https://github.com/fvarrui/JavaPackager/pull/332).\\n:::\\n\\n### `jdeps`\u547d\u4ee4\u6267\u884c\u5931\u8d25\u62a5\u9519`Module xxx not found, required by xxx`\\n\\n\u5728\u6211\u7684`case`\u4e2d\u62a5\u9519\u4e3a:\\n\\n```log\\nModule org.yaml.snakeyaml not found, required by com.fasterxml.jackson.dataformat.yaml\\n```\\n\\n#### \u95ee\u9898\u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u901a\u5e38\u662f\u56e0\u4e3a\u88ab\u4f9d\u8d56\u7684\u6a21\u5757\u7248\u672c\u9700\u8981\u5347\u7ea7\u5230\u652f\u6301`java9`\u6a21\u5757\u5316\u4e4b\u540e\u7684\u7248\u672c\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728\u6211\u7684`case`\u4e2d\u662f`org.yaml.snakeyaml`\u9700\u8981\u5347\u7ea7, \u5728`build.gradle.kts`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u540e\u95ee\u9898\u89e3\u51b3:\\n\\n```kotlin title=\\"build.gradle.kts\\"\\nimplementation(\\"org.yaml:snakeyaml:2.0\\")\\n```\\n\\n### `jdeps`\u547d\u4ee4\u6267\u884c\u5931\u8d25\u62a5\u9519`java.util.concurrent.ExecutionException: com.sun.tools.jdeps.MultiReleaseException`\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3ajdk17\u4e2d\u7684`jdeps`\u547d\u4ee4\u5b58\u5728`bug`(\u65e0\u6cd5\u5904\u7406\u4e0d\u540cjar\u4e2d\u5177\u6709\u76f8\u540c\u540d\u79f0\u7684\u7c7b)\u5bfc\u81f4\u7684, \u5728jdk18\u4e2d\u5df2\u7ecf\u4fee\u590d\u4e86\u8fd9\u4e2a\u95ee\u9898.\\n\\n\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u66f4\u591a\u4fe1\u606f\u53ef\u4ee5\u53c2\u8003\\n\\n- [jdeps can\'t print-module-deps due to a MultiReleaseException](https://stackoverflow.com/questions/69943899/jdeps-cant-print-module-deps-due-to-a-multireleaseexception)\\n- [JDK-8277165](https://bugs.openjdk.org/browse/JDK-8277165)\\n- [JDK-8277166](https://bugs.openjdk.org/browse/JDK-8277166)\\n- [JDK-8277123](https://bugs.openjdk.org/browse/JDK-8277123)\\n\\n### \u6784\u5efa\u8fc7\u7a0b\u4e2d\u51fa\u73b0`java.lang.Exception: https://github.com/AppImage/AppImageKit/releases/download/13/appimagetool-x86_64.AppImagenot found! ... Unsupported OS architecture x86_64?`\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u5728\u6253\u5305`linux`\u7684`AppImage`\u65f6, \u4f1a\u53bb\u4e0b\u8f7d`appimagetool`\u6765\u8fdb\u884c\u6253\u5305, \u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u4e0b\u8f7d\u5931\u8d25,\\n\u4ece\u800c\u5bfc\u81f4\u6253\u5305\u5931\u8d25.\\n\u4f46\u662f\u4f5c\u8005\u6355\u83b7\u76f8\u5173\u5f02\u5e38\u540e\u6ca1\u6709\u5c06\u539f\u59cb\u4fe1\u606f\u6253\u5370\u51fa\u6765, \u5bfc\u81f4\u6211\u4eec\u65e0\u6cd5\u77e5\u9053\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f, \u4ece\u800c\u5bfc\u81f4\u4e86\u4e0a\u9762\u7684\u9519\u8bef.\\n(\u8fd9\u4e2a\u5f02\u5e38\u4fe1\u606f\u662f\u4f2a\u4fe1\u606f)\\n\\n\u76f8\u5173\u4ee3\u7801\u5728`io.github.fvarrui.javapackager.packagers.GenerateAppImage`\u4e2d\u7684`getAppImageTool`\u65b9\u6cd5\u4e2d.<br/>\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u91cd\u8bd5\u540e\u95ee\u9898\u89e3\u51b3.\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\u540e\u7eed\u8ba1\u5212\u63d0PR\u7ed9\u4f5c\u8005.\\n\\n:::note\\n2023-06-10<br/>\\n\u76f8\u5173pr\u5df2\u63d0\u4ea4, \u94fe\u63a5\u5982\u4e0b<br/>\\n[improvement: Improve the error message when downloading the AppImageTool fails #337](https://github.com/fvarrui/JavaPackager/pull/337)\\n:::\\n\\n### `arch`\u914d\u7f6e\u4e0d\u751f\u6548\u5bfc\u81f4\u751f\u6210\u51fa\u7684deb\u6587\u4ef6\u65e0\u6cd5\u5b89\u88c5\\n\\n\u6267\u884c\u5b8c`package`\u4efb\u52a1\u540e, \u4f1a\u5728`build`\u76ee\u5f55\u4e0b\u751f\u6210\u76f8\u5e94\u7684`deb`\u6587\u4ef6\u540d\u79f0\u4e3a`xxx.deb`.\\n\u5bf9\u6b64\u6587\u4ef6\u6267\u884c`sudo dpkg -i xxx.deb`\u547d\u4ee4\u4f1a\u51fa\u73b0\u5982\u4e0b\u9519\u8bef:\\n\\n```log\\ndpkg: warning: parsing file \'/var/lib/dpkg/tmp.ci/control\' near line 5 package \'upshift:${info.arch.deb}\':\\n \'${info.arch.deb}\' is not a valid architecture name in \'Architecture\' field: must start with an alphanumeric\\ndpkg: error processing archive upshift_1.0-SNAPSHOT.deb (--install):\\n package architecture (${info.arch.deb}) does not match system (amd64)\\nErrors were encountered while processing:\\n upshift_1.0-SNAPSHOT.deb\\n```\\n\\n\u540e\u7eed\u5728`gradle`\u4e2d\u7684task\u914d\u7f6e`arch(Arch.x64)`\u4f9d\u7136\u4e0d\u751f\u6548.\\n\\n#### \u95ee\u9898\u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f`JavaPackager`\u63d2\u4ef6\u5bf9\u5e94\u7684gradle\u4e2d\u7684\u5b9e\u73b0\u7c7b\u662f`io.github.fvarrui.javapackager.gradle.DefaultPackageTask`,\\n\u6b64\u63d2\u4ef6\u5e76\u6ca1\u6709\u83b7\u53d6\u6211\u4eec\u914d\u7f6e\u7684`PackagePluginExtension`\u4e2d\u7684\u503c.\\n\u540e\u7eed`io.github.fvarrui.javapackager.packagers.GenerateDeb`\u4f1a\u8c03\u7528`velocity`\u6765\u6e32\u67d3`control.vtl`.\\n\u7531\u4e8e`arch`\u4e3a\u7a7a, \u6240\u4ee5\u5bfc\u81f4`${info.arch.deb}`\u6ca1\u6709\u88ab\u6e32\u67d3, \u6a21\u677f\u5185\u5bb9\u5982\u4e0b\\n\\n```title=\\"control.vtl\\"\\nPackage: ${info.name}\\nVersion: ${info.version}\\nSection: misc\\nPriority: optional\\nArchitecture: ${info.arch.deb}\\nMaintainer: ${info.organizationName} <$!{info.organizationEmail}>\\nDescription: ${info.description}\\nDistribution: development\\n#if(${info.url})\\nHomepage: ${info.url}\\n#end\\n```\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u76ee\u524d\u6ca1\u6709\u4e00\u4e2a\u597d\u7684\u529e\u6cd5\u89e3\u51b3\u6b64\u95ee\u9898, \u540e\u7eed\u51c6\u5907\u5728`JavaPackager`\u63d2\u4ef6\u4e2d\u63d0\u4e00\u4e2a`PR`\u6765\u89e3\u51b3\u6b64\u95ee\u9898.\\n\\n:::note\\n2023-05-22<br/>\\n\u76f8\u5173pr\u5df2\u63d0\u4ea4, \u94fe\u63a5\u5982\u4e0b<br/>\\n[fix(gradle-default-package-task): Set arch field for deb control file rendering #331](https://github.com/fvarrui/JavaPackager/pull/331)\\n:::\\n\\n## \u5907\u6ce8\\n\\n### \u89e3\u538bAppImage\\n\\n```bash\\n./xxx.AppImage --appimage-extract\\n```\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [BundleJre.java](https://github.com/fvarrui/JavaPackager/blob/master/src/main/java/io/github/fvarrui/javapackager/packagers/BundleJre.java)\\n- [DefaultPackageTask.java](https://github.com/fvarrui/JavaPackager/blob/master/src/main/java/io/github/fvarrui/javapackager/gradle/DefaultPackageTask.java)\\n- [LinuxPackager.java](https://github.com/fvarrui/JavaPackager/blob/master/src/main/java/io/github/fvarrui/javapackager/packagers/LinuxPackager.java)\\n- [GenerateDeb.java](https://github.com/fvarrui/JavaPackager/blob/master/src/main/java/io/github/fvarrui/javapackager/packagers/GenerateDeb.java)\\n- [control.vtl](https://github.com/fvarrui/JavaPackager/blob/master/src/main/resources/linux/control.vtl)\\n- [GenerateAppImage.java](https://github.com/fvarrui/JavaPackager/blob/master/src/main/java/io/github/fvarrui/javapackager/packagers/GenerateAppImage.java)"},{"id":"/2023/04/05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine","metadata":{"permalink":"/blog/2023/04/05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine","source":"@site/blog/2023-04-05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine.md","title":"\u89e3\u51b3\u5728Kotlin Coroutines\u4e2d\u7684\u547d\u4ee4\u884c\u8c03\u7528\u4e2d\u51fa\u73b0Stream Closed\u5f02\u5e38","description":"\u4e4b\u524d\u6709\u4e00\u4e2a\u670d\u52a1\u5185\u90e8\u9700\u8981\u8c03\u7528\u5916\u90e8\u7a0b\u5e8f(rclone), \u4e8e\u662f\u6211\u5199\u4e86\u4e00\u4e2a\u7c7b\u6765\u5c01\u88c5\u547d\u4ee4\u884c\u8c03\u7528, \u8be5\u7c7b\u4e3b\u8981\u662f\u57fa\u4e8ekotlinx.coroutines","date":"2023-04-05T00:00:00.000Z","formattedDate":"April 5, 2023","tags":[{"label":"kotlin","permalink":"/blog/tags/kotlin"},{"label":"coroutines","permalink":"/blog/tags/coroutines"},{"label":"command-line","permalink":"/blog/tags/command-line"}],"readingTime":2.86,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["kotlin","coroutines","command-line"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528Gradle\u7684JavaPackager\u63d2\u4ef6\u5c06Java\u5e94\u7528\u6253\u5305\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6","permalink":"/blog/2023/04/15/use-gradle-plugin-java-packager-to-build-binary-java-app"},"nextItem":{"title":"\u4e3aDocusaurus\u4e2d\u7684Blog\u542f\u7528\u8bc4\u8bba\u529f\u80fd","permalink":"/blog/2023/04/04/enable-comment-in-docusaurus"}},"content":"\u4e4b\u524d\u6709\u4e00\u4e2a\u670d\u52a1\u5185\u90e8\u9700\u8981\u8c03\u7528\u5916\u90e8\u7a0b\u5e8f(`rclone`), \u4e8e\u662f\u6211\u5199\u4e86\u4e00\u4e2a\u7c7b\u6765\u5c01\u88c5\u547d\u4ee4\u884c\u8c03\u7528, \u8be5\u7c7b\u4e3b\u8981\u662f\u57fa\u4e8e`kotlinx.coroutines`\\n\u6765\u5b9e\u73b0\u7684.<br/>\\n\u4ee3\u7801\u5982\u4e0b:\\n\\n```kotlin title=\\"CommandExecutorImpl.kt\\"\\nimport java.io.IOException\\nimport java.io.InputStream\\n\\nclass CommandExecutorImpl : CommandExecutor, LogCapability {\\n\\n\\toverride suspend fun execute(options: CommandExecutionOptions) =\\n\\t\\tcoroutineScope {\\n\\t\\t\\tval command: String = options.command.joinToString(separator = \\" \\")\\n\\t\\t\\tlogger.info(\\"$ {}\\", command)\\n\\t\\t\\tval process: Process = createProcess(options)\\n\\n\\t\\t\\tval asyncReadStdOut = asyncRead(input = process.inputStream, consume = options.onNewStdoutRead)\\n\\t\\t\\tval asyncReadStderr = asyncRead(input = process.errorStream, consume = options.onNewStderrRead)\\n\\t\\t\\ttry {\\n\\t\\t\\t\\twhile (process.isAlive) {\\n\\t\\t\\t\\t\\tdelay(500)\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (process.exitValue() != 0) {\\n\\t\\t\\t\\t\\tthrow IllegalStateException(\\"Process exited with non-zero exit code\\")\\n\\t\\t\\t\\t}\\n\\t\\t\\t} finally {\\n\\t\\t\\t\\t// https://kotlinlang.org/docs/cancellation-and-timeouts.html#run-non-cancellable-block\\n\\t\\t\\t\\twithContext(NonCancellable) {\\n\\t\\t\\t\\t\\tprocess.destroy()\\n\\t\\t\\t\\t\\tasyncReadStdOut.cancelAndJoin()\\n\\t\\t\\t\\t\\tasyncReadStderr.cancelAndJoin()\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\tprivate suspend fun createProcess(options: CommandExecutionOptions): Process =\\n\\t\\twithContext(Dispatchers.IO) {\\n\\t\\t\\tRuntime.getRuntime().exec(options.command.toTypedArray())\\n\\t\\t}\\n\\n\\tprivate fun CoroutineScope.asyncRead(input: InputStream, consume: suspend (String) -> Unit): Job =\\n\\t\\tlaunch {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tinput.bufferedReader()\\n\\t\\t\\t\\t\\t.lineSequence()\\n\\t\\t\\t\\t\\t.asFlow()\\n\\t\\t\\t\\t\\t.collect { line ->\\n\\t\\t\\t\\t\\t\\tconsume(line)\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t} catch (ex: IOException) {\\n\\t\\t\\t\\tlogger.warn(\\"Error while reading from process\\", ex)\\n\\t\\t\\t\\tthrow ex\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\tcompanion object : LogCapability\\n\\n}\\n```\\n\\n\u6700\u8fd1\u6211\u53d1\u73b0\u5728\u4f7f\u7528\u8be5\u7c7b\u65f6, \u6709\u65f6\u4f1a\u629b\u51fa`java.io.IOException: Stream closed`\u5f02\u5e38<br/>\\n\u5f02\u5e38\u6808\u5982\u4e0b:\\n\\n```log\\n14:10:38.016 [DefaultDispatcher-worker-117] WARN com.fastonetech.billing.sync.infra.command.CommandExecutorImpl - Error while reading from process\\njava.io.IOException: Stream closed\\n\\tat java.base/java.io.BufferedInputStream.getBufIfOpen(BufferedInputStream.java:168)\\n\\tat java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:334)\\n\\tat java.base/sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:270)\\n\\tat java.base/sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:313)\\n\\tat java.base/sun.nio.cs.StreamDecoder.read(StreamDecoder.java:188)\\n\\tat java.base/java.io.InputStreamReader.read(InputStreamReader.java:177)\\n\\tat java.base/java.io.BufferedReader.fill(BufferedReader.java:162)\\n\\tat java.base/java.io.BufferedReader.readLine(BufferedReader.java:329)\\n\\tat java.base/java.io.BufferedReader.readLine(BufferedReader.java:396)\\n\\tat kotlin.io.LinesSequence$iterator$1.hasNext(ReadWrite.kt:79)\\n\\tat kotlinx.coroutines.flow.FlowKt__BuildersKt$asFlow$$inlined$unsafeFlow$5.collect(SafeCollector.common.kt:114)\\n\\tat com.fastonetech.billing.sync.infra.command.CommandExecutorImpl$asyncRead$1.invokeSuspend(CommandExecutorImpl.kt:58)\\n\\tat kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\\n\\tat kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)\\n\\tat kotlinx.coroutines.internal.LimitedDispatcher.run(LimitedDispatcher.kt:42)\\n\\tat kotlinx.coroutines.scheduling.TaskImpl.run(Tasks.kt:95)\\n\\tat kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:570)\\n\\tat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:750)\\n\\tat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:677)\\n\\tat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:664)\\n\\n```\\n\\n\u4e0b\u9762\u5c06\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u539f\u56e0\u548c\u89e3\u51b3\u65b9\u6848.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n> \u6839\u672c\u539f\u56e0\u662f`Process`\u5bf9\u8c61\u88ab\u9500\u6bc1\u540e, \u4ecd\u7136\u5728\u8bfb\u53d6`Process`\u7684`InputStream`\u548c`ErrorStream`.<br/>\\n> \u6709\u7684\u65f6\u5019\u547d\u4ee4\u6267\u884c\u4f1a\u6bd4\u8f83\u5feb\u8fd9\u4e2a\u65f6\u5019`InputStream`\u548c`ErrorStream`\u8fd8\u6ca1\u8bfb\u5b8c.\\n\\n\u6211\u4eec\u8c03\u7528`process.destroy()`\u524d\u53ea\u5224\u65ad\u4e86`process.exitValue()`\u662f\u5426\u4e3a`0`, \u6ca1\u6709\u5224\u65ad`InputStream`\u548c`ErrorStream`\u662f\u5426\u8bfb\u5b8c.<br/>\\n\u8fd9\u4f1a\u5bfc\u81f4\u9500\u6bc1`Process`\u5bf9\u8c61\u5e76\u5bfc\u81f4`InputStream`\u548c`ErrorStream`\u88ab\u5173\u95ed\u4ece\u800c\u629b\u51fa`Stream Closed`\u5f02\u5e38.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n> \u5728`finally`\u5757\u4e2d\u7b49\u5f85`InputStream`\u548c`ErrorStream`\u7684\u8bfb\u53d6\u64cd\u4f5c\u5b8c\u6210\u540e\u518d\u9500\u6bc1`Process`\u5bf9\u8c61.\\n\\n\u4fee\u6539\u540e\u7684\u4ee3\u7801\u5982\u4e0b:\\n\\n```kotlin\\nwhile (asyncReadStdOut.isActive || asyncReadStderr.isActive || process.isAlive) {\\n\\tdelay(500)\\n}\\n```\\n\\n## \u5907\u6ce8\\n\\n### Stream Closed\u5f02\u5e38\u6d4b\u8bd5\\n\\n\u4e0b\u9762\u7684\u4ee3\u7801\u662f\u7528\u6765\u590d\u73b0`Stream Closed`\u5f02\u5e38\u7684\u6d4b\u8bd5\u4ee3\u7801:\\n\\n```kotlin\\nrunBlocking {\\n\\tval executor = CommandExecutorImpl()\\n\\t(1..1000).map {\\n\\t\\tCoroutineScope(Dispatchers.IO).async {\\n\\t\\t\\texecutor.execute(\\n\\t\\t\\t\\toptions = CommandExecutionOptions(\\n\\t\\t\\t\\t\\tcommand = listOf(\\"echo\\", \\"1\\")\\n\\t\\t\\t\\t)\\n\\t\\t\\t)\\n\\t\\t}\\n\\t}.awaitAll()\\n}\\n```\\n\\n### \u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528`Process.waitFor()`\u65b9\u6cd5\u66ff\u4ee3`delay(500)`\u65b9\u6cd5\\n\\n\u56e0\u4e3a`waitFor`\u65b9\u6cd5\u6bd4\u8f83\u91cd\u91cf\u7ea7\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b, \u800c\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6848\u662f\u534f\u7a0b\u76ee\u7684\u662f\u4e3a\u4e86\u4e0d\u963b\u585e\u5f53\u524d\u7ebf\u7a0b, \u6240\u4ee5\u624d\u4f1a\u91c7\u7528`delay`\u65b9\u6cd5.\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Coroutines guide](https://kotlinlang.org/docs/coroutines-guide.html)\\n- [Run non-cancellable block](https://kotlinlang.org/docs/cancellation-and-timeouts.html#run-non-cancellable-block)"},{"id":"/2023/04/04/enable-comment-in-docusaurus","metadata":{"permalink":"/blog/2023/04/04/enable-comment-in-docusaurus","source":"@site/blog/2023-04-04/enable-comment-in-docusaurus.md","title":"\u4e3aDocusaurus\u4e2d\u7684Blog\u542f\u7528\u8bc4\u8bba\u529f\u80fd","description":"\u6700\u8fd1\u60f3\u5728Docusaurus\u4e2d\u542f\u7528\u8bc4\u8bba\u529f\u80fd, \u4f46\u662f\u5b98\u65b9\u5e76\u6ca1\u6709\u63d0\u4f9b\u8fd9\u4e2a\u529f\u80fd, \u6240\u4ee5\u53ea\u80fd\u81ea\u5df1\u52a8\u624b\u4e86.","date":"2023-04-04T00:00:00.000Z","formattedDate":"April 4, 2023","tags":[{"label":"docusaurus","permalink":"/blog/tags/docusaurus"},{"label":"giscus","permalink":"/blog/tags/giscus"},{"label":"github","permalink":"/blog/tags/github"}],"readingTime":4.565,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["docusaurus","giscus","github"]},"unlisted":false,"prevItem":{"title":"\u89e3\u51b3\u5728Kotlin Coroutines\u4e2d\u7684\u547d\u4ee4\u884c\u8c03\u7528\u4e2d\u51fa\u73b0Stream Closed\u5f02\u5e38","permalink":"/blog/2023/04/05/fix-stream-closed-exception-in-command-line-invocation-in-kotlin-coroutine"},"nextItem":{"title":"Gitlab\u4e2d\u5e38\u89c1\u7684\u6807\u7b7e","permalink":"/blog/2023/03/31/common-tags-in-gitlab"}},"content":"\u6700\u8fd1\u60f3\u5728`Docusaurus`\u4e2d\u542f\u7528\u8bc4\u8bba\u529f\u80fd, \u4f46\u662f\u5b98\u65b9\u5e76\u6ca1\u6709\u63d0\u4f9b\u8fd9\u4e2a\u529f\u80fd, \u6240\u4ee5\u53ea\u80fd\u81ea\u5df1\u52a8\u624b\u4e86.<br/>\\n\\n\u76ee\u524d\u7684\u89e3\u51b3\u65b9\u6848\u662f\u901a\u8fc7`Giscus`\u6765\u5b9e\u73b0, \u5b83\u662f\u4e00\u4e2a\u57fa\u4e8e`Github`\u7684`Discussions`\u7684\u8bc4\u8bba\u7cfb\u7edf\u5b9e\u73b0\u7684.<br/>\\n`Discussions`\u9700\u8981\u4f9d\u8d56`Github`\u8d26\u53f7\u6765\u8fdb\u884c\u8bc4\u8bba, \u6240\u4ee5\u540e\u7eed\u9700\u8981\u4e00\u4e2a\u516c\u5171\u7684\u4ed3\u5e93\u6765\u5b58\u653e\u8bc4\u8bba\u6570\u636e.<br/>\\n\u5982\u679c\u4f60\u7684\u535a\u5ba2\u662f\u79c1\u6709\u9879\u76ee, \u53ef\u4ee5\u8003\u8651\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u516c\u5171\u7684\u4ed3\u5e93\u7528\u4e8e\u5b58\u653e\u8bc4\u8bba\u6570\u636e, \u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u539f\u6765\u7684\u9879\u76ee\u8fd8\u53ef\u4ee5\u4e3a\u79c1\u6709\u7684.<br/>\\n\\n\u4ee5\u4e0b\u5185\u5bb9\u4f1a\u5047\u8bbe\u4f60\u62e5\u6709`Github`\u76f8\u5173\u77e5\u8bc6<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u914d\u7f6e`Giscus`\\n\\n\u8fdb\u5165[Giscus](https://giscus.app/)\u5b98\u7f51\u6d4f\u89c8\u6587\u6863, \u7136\u540e\u6839\u636e\u6587\u6863\u4e2d\u7684\u8981\u6c42\u8fdb\u884c\u914d\u7f6e.<br/>\\n\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4:\\n\\n- \u51c6\u5907\u4e00\u4e2a\u516c\u5171\u7684\u4ed3\u5e93\\n  <br/>\u8be5\u4ed3\u5e93\u4e3b\u8981\u7528\u4e8e\u5b58\u653e\u8bc4\u8bba\u6570\u636e, \u5982\u679c\u4f60\u7684\u535a\u5ba2\u662f\u79c1\u6709\u9879\u76ee\u53ef\u4ee5\u8003\u8651\u521b\u5efa\u4e00\u4e2a\u516c\u5171\u7684\u4ed3\u5e93\u7528\u4e8e\u5b58\u653e\u8bc4\u8bba\u6570\u636e\\n- \u4e3a\u516c\u5171\u7684\u4ed3\u5e93\u542f\u7528`Github Discussions`,\\n  \u53c2\u8003[Enabling or disabling GitHub Discussions for a repository](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/enabling-or-disabling-github-discussions-for-a-repository)\\n- \u5b89\u88c5[giscus-github-app](https://github.com/apps/giscus)\u5e76\u914d\u7f6e\u53ef\u4ee5\u8bbf\u95ee\u54ea\u4e9b\u4ed3\u5e93,\\n  \u5b89\u88c5\u9875\u9762\u5b8c\u6210\u540e\u53ef\u4ee5\u5728\u5e94\u7528\u9875\u9762\u4e2d\u53ef\u4ee5\u627e\u5230`Configure`\u6309\u94ae, \u70b9\u51fb\u8be5\u6309\u94ae\u8fdb\u5165\u914d\u7f6e\u9875\u9762\\n\\n\u4ee5\u4e0a\u662f\u5927\u81f4\u7684\u914d\u7f6e\u6b65\u9aa4, \u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u53ef\u4ee5\u5728\u521a\u624d\u7684\u5b98\u7f51\u9875\u9762\u4e2d\u67e5\u770b\u5177\u4f53\u7684\u914d\u7f6e\u8bf4\u660e. \u4f8b\u5982:<br/>\\n\\n- `Docusaurus`\u535a\u5ba2\u7684\u8bc4\u8bba\u5230`Discussion`\u4e2d\u7684\u6620\u5c04\u5173\u7cfb\\n\\n## \u9a8c\u8bc1\u914d\u7f6e\\n\\n\u8fd9\u4e9b\u914d\u7f6e\u505a\u597d\u4e4b\u540e, \u4f60\u9700\u8981\u5bf9\u4f60\u7684\u914d\u7f6e\u8fdb\u884c\u9a8c\u8bc1, \u4ee5\u786e\u4fdd\u4f60\u7684\u914d\u7f6e\u662f\u6b63\u786e\u7684.<br/>\\n\\n[giscus](https://giscus.app/)\u9875\u9762\u4e0b\u7684`Repository`\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u9a8c\u8bc1\u4f60\u7684`repo`\\n\\n## \u83b7\u53d6\u53c2\u6570\\n\\n\u4e3a\u4e86\u540e\u7eed\u5728`Docusaurus`\u4e2d\u542f\u7528\u8bc4\u8bba\u529f\u80fd, \u8fd8\u9700\u8981\u83b7\u53d6\u4e00\u4e9b\u53c2\u6570, \u8fd9\u4e9b\u53c2\u6570\u540e\u7eed\u4f1a\u5728`Docusaurus`\u4e2d\u4f7f\u7528.<br/>\\n\\n[giscus](https://giscus.app/)\u9875\u9762\u4e0b\u7684`Enable giscus`\u4f1a\u6839\u636e\u4f60\u7684\u914d\u7f6e\u751f\u6210\u4e00\u6bb5\u4ee3\u7801, \u8be5\u4ee3\u7801\u5305\u542b\u4e86\u4f60\u9700\u8981\u7684\u53c2\u6570.<br/>\\n\u5b83\u770b\u8d77\u6765\u50cf\u8fd9\u6837:\\n\\n```html\\n\\n<script src=\\"https://giscus.app/client.js\\"\\n\\t\\tdata-repo=\\"[ENTER REPO HERE]\\"\\n\\t\\tdata-repo-id=\\"[ENTER REPO ID HERE]\\"\\n\\t\\tdata-category=\\"[ENTER CATEGORY NAME HERE]\\"\\n\\t\\tdata-category-id=\\"[ENTER CATEGORY ID HERE]\\"\\n\\t\\tdata-mapping=\\"pathname\\"\\n\\t\\tdata-strict=\\"0\\"\\n\\t\\tdata-reactions-enabled=\\"1\\"\\n\\t\\tdata-emit-metadata=\\"0\\"\\n\\t\\tdata-input-position=\\"bottom\\"\\n\\t\\tdata-theme=\\"preferred_color_scheme\\"\\n\\t\\tdata-lang=\\"en\\"\\n\\t\\tcrossorigin=\\"anonymous\\"\\n\\t\\tasync>\\n<\/script>\\n```\\n\\n## \u5b89\u88c5`Giscus`\\n\\n`Giscus`\u7ec4\u4ef6\u662f\u4e00\u4e2a`React`\u7ec4\u4ef6, \u7528\u4e8e\u5728`Docusaurus`\u4e2d\u542f\u7528\u8bc4\u8bba\u529f\u80fd.<br/>\\n\u6211\u4eec\u9700\u8981\u5728\u9879\u76ee\u4e2d\u5b89\u88c5`Giscus`\u7ec4\u4ef6\\n\\n```bash\\nnpm install --save @giscus/react\\n```\\n\\n## \u7ec4\u4ef6\u6269\u5c55\\n\\n`Docusaurus`\u4e2d\u63d0\u4f9b\u4e86[Swizzling](https://docusaurus.io/docs/swizzling)\u529f\u80fd, \u53ef\u4ee5\u5bf9`Docusaurus`\\n\u4e2d\u7684\u7ec4\u4ef6\u8fdb\u884c\u6269\u5c55\u5e76\u589e\u52a0\u65b0\u7684\u529f\u80fd.<br/>\\n`BlogPostItem`\u662f`Docusaurus`\u4e2d\u7528\u4e8e\u5c55\u793a\u535a\u5ba2\u6587\u7ae0\u7684\u7ec4\u4ef6, \u8be5\u7ec4\u4ef6\u4f4d\u4e8e`@theme-original/BlogPostItem`\u4e2d.<br/>\\n\u4e3a\u4e86\u7ed9\u5728`Docusaurus`\u4e2d\u542f\u7528\u8bc4\u8bba\u529f\u80fd, \u9700\u8981\u5bf9`BlogPostItem`\u8fdb\u884c\u6269\u5c55.<br/>\\n\\n\u6267\u884c`swizzle`\u547d\u4ee4\u521b\u5efa`BlogPostItem`\u7ec4\u4ef6\\n\\n```bash\\nnpm run swizzle @docusaurus/theme-classic BlogPostItem -- --wrap\\n```\\n\\n\u8be5\u547d\u4ee4\u6267\u884c\u5b8c\u6210\u540e`src/theme/BlogPostItem/index.js`\u6587\u4ef6\u4f1a\u88ab\u521b\u5efa<br/>\\n\\n\u63a5\u4e0b\u6765\u5bf9\u8be5\u6587\u4ef6\u8fdb\u884c\u7f16\u8f91<br/>\\n\\n> \u6ce8\u610f: \u8be5\u6587\u4ef6\u4e2d\u7684`Giscus`\u7ec4\u4ef6\u7684xxx\u53c2\u6570\u9700\u8981\u6839\u636e\u4f60\u7684\u914d\u7f6e\u8fdb\u884c\u4fee\u6539, \u914d\u7f6e\u7684\u53c2\u6570\u5728\u4e0a\u4e00\u8282\u4e2d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4e86\\n\\n```jsx title=\\"src/theme/BlogPostItem/index.js\\"\\nimport React from \'react\'\\nimport BlogPostItem from \'@theme-original/BlogPostItem\'\\nimport Giscus from \\"@giscus/react\\"\\nimport {useBlogPost} from \'@docusaurus/theme-common/internal\'\\nimport {useColorMode} from \'@docusaurus/theme-common\'\\nimport useDocusaurusContext from \'@docusaurus/useDocusaurusContext\'\\n\\nexport default function BlogPostItemWrapper(props) {\\n  const {i18n: {defaultLocale, localeConfigs}} = useDocusaurusContext()\\n\\n  const {colorMode} = useColorMode()\\n\\n  const {metadata, isBlogPostPage} = useBlogPost()\\n  return (\\n      <>\\n        <BlogPostItem {...props} />\\n        {(isBlogPostPage) && (\\n            <Giscus\\n                repo=\\"xxx\\"\\n                repoId=\\"xxx\\"\\n                category=\\"xxx\\"\\n                categoryId=\\"xxx\\"\\n                mapping=\\"xxx\\"\\n                strict=\\"xxx\\"\\n                reactionsEnabled=\\"xxx\\"\\n                emitMetadata=\\"xxx\\"\\n                inputPosition=\\"xxx\\"\\n                theme={colorMode}\\n                lang={defaultLocale}\\n                crossorigin=\\"anonymous\\"\\n                term=\\"Welcome to @giscus/react component!\\"\\n                loading=\\"lazy\\"\\n                async\\n            />\\n        )}\\n      </>\\n  );\\n}\\n```\\n\\n## \u6700\u7ec8\u6548\u679c\\n\\n\u6700\u7ec8\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a:\\n\\n![enable-comment-in-docusaurus.png](enable-comment-in-docusaurus.png)\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Giscus\u5b98\u7f51](https://giscus.app/)\\n- [Giscus\u7684github-app](https://github.com/apps/giscus)\\n- [\u542f\u7528Github\u4e2d\u7684Discussions](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/enabling-or-disabling-github-discussions-for-a-repository)\\n- [\u5173\u4e8euseBlogPost\u51fd\u6570\u7684github-issue](https://github.com/facebook/docusaurus/issues/7759)\\n- [Swizzling\u7684\u76f8\u5173\u4ecb\u7ecd](https://docusaurus.io/docs/swizzling)\\n- [\u5728Docusaurus\u4e0a\u914d\u7f6eGiscus\u8bc4\u8bba\u7cfb\u7edf](https://www.wjwei.blog/docs/Potpourri/giscus-docusaurus)\\n- [How to add Giscus comments to Docusaurus](https://m19v.github.io/blog/how-to-add-giscus-to-docusaurus)"},{"id":"/2023/03/31/common-tags-in-gitlab","metadata":{"permalink":"/blog/2023/03/31/common-tags-in-gitlab","source":"@site/blog/2023-03-31/common-tags-in-gitlab.mdx","title":"Gitlab\u4e2d\u5e38\u89c1\u7684\u6807\u7b7e","description":"Gitlab\u4e2d\u7684\u6807\u7b7e\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u7528\u7684\u529f\u80fd, \u8be5\u529f\u80fd\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u7ba1\u7406ISSUE.","date":"2023-03-31T00:00:00.000Z","formattedDate":"March 31, 2023","tags":[{"label":"gitlab","permalink":"/blog/tags/gitlab"}],"readingTime":3.85,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["gitlab"]},"unlisted":false,"prevItem":{"title":"\u4e3aDocusaurus\u4e2d\u7684Blog\u542f\u7528\u8bc4\u8bba\u529f\u80fd","permalink":"/blog/2023/04/04/enable-comment-in-docusaurus"},"nextItem":{"title":"\u89e3\u51b3elm\u4f9d\u8d56\u4e0b\u8f7d\u5931\u8d25\u7684\u95ee\u9898","permalink":"/blog/2023/03/30/fix-elm-package-download-failed"}},"content":"`Gitlab`\u4e2d\u7684\u6807\u7b7e\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u7528\u7684\u529f\u80fd, \u8be5\u529f\u80fd\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u7ba1\u7406`ISSUE`.<br/>\\n\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b`Gitlab`\u4e2d\u5e38\u89c1\u7684\u6807\u7b7e\u7684\u5b9a\u4e49\u548c\u5176\u4f7f\u7528\u5e0c\u671b\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6807\u7b7e\u7684\u5b9a\u4e49\\n\\n\u4e0b\u9762\u4ecb\u7ecd\u5e38\u89c1\u7684\u4e00\u4e9b\u6807\u7b7e\u7684\u5b9a\u4e49, \u4ee5\u4fbf\u6211\u4eec\u66f4\u597d\u7684\u4f7f\u7528.\\n\\nexport const Label = ({name, color}) => (\\n\\t<span style={{\\n\\t\\tfontSize: \\"1rem\\",\\n\\t\\tcolor: \\"white\\",\\n\\t\\tbackground: color,\\n\\t\\tborderRadius: \\"22px\\",\\n\\t\\tpadding: \\"4px 12px\\",\\n\\t}}>{name}</span>\\n)\\n\\n\\n<table>\\n\\t<thead>\\n\\t<tr>\\n\\t\\t<th align=\\"center\\">\u540d\u79f0</th>\\n\\t\\t<th align=\\"center\\">\u989c\u8272</th>\\n\\t\\t<th align=\\"center\\">16\u8fdb\u5236\u4ee3\u7801</th>\\n\\t\\t<th align=\\"center\\">\u63cf\u8ff0</th>\\n\\t\\t<th align=\\"center\\">\u4f7f\u7528\u65f6\u673a</th>\\n\\t</tr>\\n\\t</thead>\\n\\t<tbody>\\n\\t{[\\n\\t\\t{\\n\\t\\t\\tname: \\"Bug\\",\\n\\t\\t\\tcolorName: \\"\u7ea2\\",\\n\\t\\t\\tcolorHex: \\"#FF0000\\",\\n\\t\\t\\tdesc: \\"\u9519\u8bef\u6216\u9700\u4fee\u590d\\",\\n\\t\\t\\tusage: \\"\u53d1\u73b0/\u62a5\u544a \u4e00\u4e2a\u95ee\u9898\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Duplicate\\",\\n\\t\\t\\tcolorName: \\"\u7070\\",\\n\\t\\t\\tcolorHex: \\"#808080\\",\\n\\t\\t\\tdesc: \\"\u91cd\u590d\u7684issue\\",\\n\\t\\t\\tusage: \\"\u53d1\u73b0/\u62a5\u544a \u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u95ee\u9898\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Feature\\",\\n\\t\\t\\tcolorName: \\"\u84dd\\",\\n\\t\\t\\tcolorHex: \\"#0000FF\\",\\n\\t\\t\\tdesc: \\"\u65b0\u529f\u80fd\u6216\u9700\u6c42\\",\\n\\t\\t\\tusage: \\"\u63d0\u51fa/\u5b9e\u73b0 \u4e00\u4e2a\u65b0\u7684\u529f\u80fd\u6216\u9700\u6c42\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Fixed\\",\\n\\t\\t\\tcolorName: \\"\u7eff\\",\\n\\t\\t\\tcolorHex: \\"#00FF00\\",\\n\\t\\t\\tdesc: \\"\u5df2\u4fee\u590d\u6216\u5b8c\u6210\\",\\n\\t\\t\\tusage: \\"\u89e3\u51b3/\u5b8c\u6210 \u4e00\u4e2a\u95ee\u9898\u6216\u4efb\u52a1\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Invalid\\",\\n\\t\\t\\tcolorName: \\"\u9ed1\\",\\n\\t\\t\\tcolorHex: \\"#000000\\",\\n\\t\\t\\tdesc: \\"\u65e0\u6548\u6216\u4e0d\u5408\u7406\\",\\n\\t\\t\\tusage: \\"\u53d1\u73b0/\u62a5\u544a \u4e00\u4e2a\u4e0d\u7b26\u5408 \u89c4\u8303/\u903b\u8f91 \u7684\u95ee\u9898\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Proposal\\",\\n\\t\\t\\tcolorName: \\"\u7d2b\\",\\n\\t\\t\\tcolorHex: \\"#800080\\",\\n\\t\\t\\tdesc: \\"\u5efa\u8bae\u6216\u60f3\u6cd5\\",\\n\\t\\t\\tusage: \\"\u63d0\u51fa/\u8ba8\u8bba \u4e00\u4e2a\u5efa\u8bae\u6216\u60f3\u6cd5\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Task\\",\\n\\t\\t\\tcolorName: \\"\u6a59\\",\\n\\t\\t\\tcolorHex: \\"#FFA500\\",\\n\\t\\t\\tdesc: \\"\u4efb\u52a1\u6216\u5de5\u4f5c\\",\\n\\t\\t\\tusage: \\"\u5206\u914d/\u6267\u884c \u4e00\u4e2a\u4efb\u52a1\u6216\u5de5\u4f5c\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Wontfix\\",\\n\\t\\t\\tcolorName: \\"\u68d5\\",\\n\\t\\t\\tcolorHex: \\"#A52A2A\\",\\n\\t\\t\\tdesc: \\"\u4e0d\u4f1a\u6216\u4e0d\u9700\u4fee\u590d\\",\\n\\t\\t\\tusage: \\"\u51b3\u5b9a\u4e0d\u5904\u7406/\u5ffd\u7565 \u4e00\u4e2a\u95ee\u9898\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Improvement\\",\\n\\t\\t\\tcolorName: \\"\u7c89\\",\\n\\t\\t\\tcolorHex: \\"#FFC0CB\\",\\n\\t\\t\\tdesc: \\"\u6539\u8fdb\u6216\u4f18\u5316\\",\\n\\t\\t\\tusage: \\"\u5bf9\u4e00\u4e2a\u529f\u80fd\u6216\u9700\u6c42\u8fdb\u884c \u6539\u8fdb/\u4f18\u5316\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Enhancement\\",\\n\\t\\t\\tcolorName: \\"\u6de1\u84dd\\",\\n\\t\\t\\tcolorHex: \\"#ADD8E6\\",\\n\\t\\t\\tdesc: \\"\u589e\u5f3a\u6216\u6269\u5c55\\",\\n\\t\\t\\tusage: \\"\u5bf9\u4e00\u4e2a\u529f\u80fd\u6216\u9700\u6c42\u8fdb\u884c \u589e\u5f3a/\u6269\u5c55\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Question\\",\\n\\t\\t\\tcolorName: \\"\u9ec4\\",\\n\\t\\t\\tcolorHex: \\"#FFFF00\\",\\n\\t\\t\\tdesc: \\"\u7591\u95ee\u6216\u8be2\u95ee\\",\\n\\t\\t\\tusage: \\"\u5bf9\u4e00\u4e2a\u95ee\u9898\u6216\u4efb\u52a1\u6709 \u7591\u95ee/\u8be2\u95ee\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Help wanted\\",\\n\\t\\t\\tcolorName: \\"\u7d2b\u7ea2\\",\\n\\t\\t\\tcolorHex: \\"#FF00FF\\",\\n\\t\\t\\tdesc: \\"\u9700\u8981\u5e2e\u52a9\u6216\u534f\u4f5c\\",\\n\\t\\t\\tusage: \\"\u9700\u8981\u5176\u4ed6\u4eba\u7684 \u5e2e\u52a9/\u534f\u4f5c\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tname: \\"Documentation\\",\\n\\t\\t\\tcolorName: \\"\u6d45\u7eff\\",\\n\\t\\t\\tcolorHex: \\"#90EE90\\",\\n\\t\\t\\tdesc: \\"\u9700\u8981\u6216\u6d89\u53ca\u6587\u6863\\",\\n\\t\\t\\tusage: \\"\u6d89\u53ca\u6587\u6863\u7684 \u7f16\u5199/\u66f4\u65b0\\"\\n\\t\\t}\\n\\t].map((item, index) => (\\n\\t\\t<tr key={index}>\\n\\t\\t\\t<td align=\\"center\\">\\n\\t\\t\\t\\t<Label name={item.name} color={item.colorHex}/>\\n\\t\\t\\t</td>\\n\\t\\t\\t<td align=\\"center\\" style={{whiteSpace: \'nowrap\'}}>{item.colorName}</td>\\n\\t\\t\\t<td align=\\"center\\">\\n\\t\\t\\t\\t<strong>{item.colorHex}</strong>\\n\\t\\t\\t</td>\\n\\t\\t\\t<td align=\\"center\\">{item.desc}</td>\\n\\t\\t\\t<td align=\\"center\\">{item.usage}</td>\\n\\t\\t</tr>\\n\\t))}\\n\\t</tbody>\\n</table>\\n\\n\\n:::note\\nImprovement\u548cEnhancement\u4e4b\u95f4\u7684\u533a\u522b<br/>\\n\\nImprovement: <br/>\\n\u8868\u793a\u5bf9\u4e00\u4e2a\u4e0d\u592a\u597d\u7684\u4e8b\u7269\u8fdb\u884c\u6539\u5584\u6216\u63d0\u9ad8, \u4f7f\u5176\u8fbe\u5230\u66f4\u597d\u7684\u6c34\u5e73\u6216\u72b6\u6001.<br/>\\nWe need to improve our product quality to meet the customer\u2019s needs.(\u6211\u4eec\u9700\u8981\u6539\u5584\u6211\u4eec\u7684\u4ea7\u54c1\u8d28\u91cf, \u4ee5\u6ee1\u8db3\u5ba2\u6237\u7684\u9700\u6c42.)<br/>\\n\\nEnhancement: <br/>\\n\u8868\u793a\u5bf9\u4e00\u4e2a\u5df2\u7ecf\u5f88\u597d\u7684\u4e8b\u7269\u8fdb\u884c\u589e\u5f3a\u6216\u6269\u5c55, \u4f7f\u5176\u66f4\u52a0\u4f18\u79c0\u6216\u6709\u5438\u5f15\u529b.<br/>\\nThe new feature of this phone enhanced its competitiveness.(\u8fd9\u6b3e\u624b\u673a\u7684\u65b0\u529f\u80fd\u589e\u5f3a\u4e86\u5b83\u7684\u7ade\u4e89\u529b.)<br/>\\n:::\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Labels project management guidelines | GitLab](https://about.gitlab.com/handbook/marketing/project-management-guidelines/labels/)\\n<br/>\u8fd9\u662fGitlab\u5173\u4e8e\u6807\u7b7e\u9879\u76ee\u7ba1\u7406\u6307\u5357\u7684\u9875\u9762, \u5305\u542b\u4e86\u4e00\u4e9b\u521b\u5efa\u548c\u4f7f\u7528\u6807\u7b7e\u7684\u89c4\u8303\u548c\u5efa\u8bae.\\n- [GitLab Labeling Training | GitLab](https://about.gitlab.com/handbook/support/support-ops/training/gitlab-labeling.html)\\n  <br/>\u8fd9\u662fGitlab\u5173\u4e8e\u6807\u7b7e\u57f9\u8bad\u7684\u9875\u9762, \u5305\u542b\u4e86\u4e00\u4e9b\u6807\u7b7e\u7684\u6700\u4f73\u5b9e\u8df5\u548c\u793a\u4f8b."},{"id":"/2023/03/30/fix-elm-package-download-failed","metadata":{"permalink":"/blog/2023/03/30/fix-elm-package-download-failed","source":"@site/blog/2023-03-30/fix-elm-package-download-failed.md","title":"\u89e3\u51b3elm\u4f9d\u8d56\u4e0b\u8f7d\u5931\u8d25\u7684\u95ee\u9898","description":"\u6700\u8fd1\u5728\u672c\u5730\u6784\u5efaopen-radiant\u9879\u76ee.","date":"2023-03-30T00:00:00.000Z","formattedDate":"March 30, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"elm","permalink":"/blog/tags/elm"},{"label":"jetbrains","permalink":"/blog/tags/jetbrains"},{"label":"code2art","permalink":"/blog/tags/code-2-art"},{"label":"open-radiant","permalink":"/blog/tags/open-radiant"}],"readingTime":5.1,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","elm","jetbrains","code2art","open-radiant"]},"unlisted":false,"prevItem":{"title":"Gitlab\u4e2d\u5e38\u89c1\u7684\u6807\u7b7e","permalink":"/blog/2023/03/31/common-tags-in-gitlab"},"nextItem":{"title":"node.js v17\u53ca\u4ee5\u4e0a\u7248\u672c\u4f7f\u7528openssl v3.0\u5f15\u53d1\u7684\u54c8\u5e0c\u7b97\u6cd5\u9519\u8bef\u53ca\u5176\u89e3\u51b3\u65b9\u6cd5","permalink":"/blog/2023/03/30/fix-node-v17-upwards-openssl-hash-error"}},"content":"\u6700\u8fd1\u5728\u672c\u5730\u6784\u5efa[open-radiant](https://github.com/JetBrains/open-radiant)\u9879\u76ee.<br/>\\n\u8be5\u9879\u76ee\u662f`JetBrains`\u5f00\u6e90\u7684\u4e00\u4e2a\u9879\u76ee, \u7528\u4e8e\u751f\u6210AI\u827a\u672f\u56fe\u7247, \u5728\u7ebf\u6f14\u793a\u5730\u5740\u4e3a: [code2art](https://code2art.jetbrains.com/)<br/>\\n\u5728\u6784\u5efa\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898.<br/>\\n\u5176\u4e2d\u7684\u4e00\u4e2a\u95ee\u9898\u662f\u5f53\u6267\u884c`elm make`\u65f6\u4f9d\u8d56\u4e0b\u8f7d\u5931\u8d25, \u65e5\u5fd7\u5982\u4e0b:\\n\\n```log\\nStarting downloads...\\n\\n  \u25cf elm/json 1.1.3\\n  \u25cf elm-community/list-extra 8.2.2\\n  \u25cf elm/random 1.0.0\\n  \u25cf elm/file 1.0.5\\n  \u25cf elm/virtual-dom 1.0.2\\n  \u25cf elm/parser 1.1.0\\n  \u25cf rtfeldman/elm-iso8601-date-strings 1.1.3\\n  \u25cf elm/url 1.0.0\\n  \u25cf elm-community/random-extra 3.1.0\\n  \u25cf elm-explorations/webgl 1.1.1\\n  \u25cf elm/core 1.0.2\\n  \u2717 elm/http 2.0.0\\n  \u2717 owanturist/elm-union-find 1.0.0\\n  \u2717 elm/bytes 1.0.8\\n  \u2717 elm/svg 1.0.1\\n  \u2717 avh4/elm-color 1.0.0\\n  \u2717 elm/time 1.0.0\\n  \u2717 elm-community/json-extra 4.2.0\\n  \u2717 fredcy/elm-parseint 2.0.1\\n  \u2717 noahzgordon/elm-color-extra 1.0.2\\n  \u2717 elm/html 1.0.0\\n  \u2717 elm/browser 1.0.2\\n  \u2717 newlandsvalley/elm-binary-base64 1.0.3\\n  \u2717 elm-community/easing-functions 2.0.0\\n\\nDependency problem!           \\n-- PROBLEM DOWNLOADING PACKAGE -------------------------------------------------\\n\\nI was trying to download the source code for avh4/elm-color 1.0.0, so I tried to\\nfetch:\\n\\n    https://github.com/avh4/elm-color/zipball/1.0.0/\\n\\nBut my HTTP library is giving me the following error message:\\n\\n    ConnectionTimeout\\n\\nAre you somewhere with a slow internet connection? Or no internet? Does the link\\nI am trying to fetch work in your browser? Maybe the site is down? Does your\\ninternet connection have a firewall that blocks certain domains? It is usually\\nsomething like that!\\n\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f`elm`\u7684\u4f9d\u8d56\u5728\u56fd\u5185\u8bbf\u95ee\u4f1a\u6bd4\u8f83\u6162, \u751a\u81f3\u4f1a\u51fa\u73b0\u4e0b\u8f7d\u5931\u8d25\u7684\u60c5\u51b5.<br/>\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u4e0b\u8f7d\u4f9d\u8d56\u5305, \u7136\u540e\u653e\u5230`elm`\u7684\u4f9d\u8d56\u76ee\u5f55\u4e0b, \u4ee5\u540e\u518d\u6267\u884c`elm make`\u65f6\u5c31\u4e0d\u4f1a\u518d\u53bb\u4e0b\u8f7d\u4f9d\u8d56\u4e86.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u6848\u4f8b:\\n\\n- \u9879\u76ee\u4f9d\u8d56`avh4/elm-color 1.0.0`\\n- elm\u7248\u672c\u4e3a`0.19.0`\\n\\n### \u786e\u5b9a\u4f9d\u8d56\u7684\u76ee\u5f55\\n\\n`elm`\u7684\u4f9d\u8d56\u76ee\u5f55\u5728`~/.elm`\u4e0b, \u4f9d\u8d56\u5305\u7684\u76ee\u5f55\u7ed3\u6784\u53ef\u4ee5\u901a\u8fc7`tree`\u547d\u4ee4\u67e5\u770b:\\n\\n```bash\\ntree ~/.elm\\n```\\n\\n```log\\n.\\n\u2514\u2500\u2500 0.19.1\\n    \u2514\u2500\u2500 packages\\n        \u251c\u2500\u2500 avh4\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 elm-color\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u251c\u2500\u2500 elm\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 browser\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.2\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Browser\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Debugger\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 bytes\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.8\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Bytes\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 core\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.2\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Platform\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 file\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.5\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 File\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 html\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Html\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 http\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 2.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 json\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.1.3\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Json\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 parser\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.1.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Parser\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 random\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 regex\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 svg\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.1\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Svg\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 time\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 url\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Url\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Parser\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 virtual-dom\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.0.2\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0             \u2514\u2500\u2500 Elm\\n        \u2502\xa0\xa0                 \u2514\u2500\u2500 Kernel\\n        \u251c\u2500\u2500 elm-community\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 easing-functions\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 2.0.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 json-extra\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 4.2.0\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Json\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u251c\u2500\u2500 Decode\\n        \u2502\xa0\xa0 \u2502\xa0\xa0             \u2514\u2500\u2500 Encode\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 list-extra\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 8.2.2\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 List\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 random-extra\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 3.1.0\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0             \u2514\u2500\u2500 Random\\n        \u251c\u2500\u2500 elm-explorations\\n        \u2502\xa0\xa0 \u251c\u2500\u2500 linear-algebra\\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 1.0.3\\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0 \u2502\xa0\xa0         \u2514\u2500\u2500 Math\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 webgl\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.1.1\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0             \u251c\u2500\u2500 Elm\\n        \u2502\xa0\xa0             \u2502\xa0\xa0 \u2514\u2500\u2500 Kernel\\n        \u2502\xa0\xa0             \u2514\u2500\u2500 WebGL\\n        \u2502\xa0\xa0                 \u2514\u2500\u2500 Settings\\n        \u251c\u2500\u2500 fredcy\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 elm-parseint\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 2.0.1\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u251c\u2500\u2500 newlandsvalley\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 elm-binary-base64\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.0.3\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u251c\u2500\u2500 noahzgordon\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 elm-color-extra\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.0.2\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u2502\xa0\xa0             \u2514\u2500\u2500 Color\\n        \u251c\u2500\u2500 owanturist\\n        \u2502\xa0\xa0 \u2514\u2500\u2500 elm-union-find\\n        \u2502\xa0\xa0     \u2514\u2500\u2500 1.0.0\\n        \u2502\xa0\xa0         \u2514\u2500\u2500 src\\n        \u2514\u2500\u2500 rtfeldman\\n            \u2514\u2500\u2500 elm-iso8601-date-strings\\n                \u2514\u2500\u2500 1.1.3\\n                    \u2514\u2500\u2500 src\\n\\n135 directories\\n```\\n\\n\u901a\u8fc7\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\u5176\u76ee\u5f55\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\\n\\n- \u7b2c\u4e00\u7ea7\u76ee\u5f55\u4e3a`packages`\\n- \u7b2c\u4e8c\u7ea7\u76ee\u5f55\u4e3a`group`(\u4ee5`avh4/elm-color 1.0.0`\u4e3a\u4f8b, `group`\u4e3a`avh4`)\\n- \u7b2c\u4e09\u7ea7\u76ee\u5f55\u4e3a`artifact`(\u4ee5`avh4/elm-color 1.0.0`\u4e3a\u4f8b, `artifact`\u4e3a`elm-color`)\\n- \u7b2c\u56db\u7ea7\u76ee\u5f55\u4e3a`version`(\u4ee5`avh4/elm-color 1.0.0`\u4e3a\u4f8b, `version`\u4e3a`1.0.0`)\\n\\n### \u4e0b\u8f7d\u4f9d\u8d56\\n\\n\u4ee5`avh4/elm-color 1.0.0`\u4e3a\u4f8b, \u6211\u4eec\u901a\u8fc7`https://github.com/avh4/elm-color/zipball/1.0.0/` \u94fe\u63a5\u4e0b\u8f7d\u5bf9\u5e94\u7684\u5b89\u88c5\u5305\\n\\n### \u5b89\u88c5\\n\\n\u5c06\u8be5\u5b89\u88c5\u5305\u91cc\u7684\u6587\u4ef6\u89e3\u538b\u5230`~/.elm/0.19.0/package/avh4/elm-color/1.0.0`\u76ee\u5f55\u4e0b\\n\\n> \u6ce8\u610f:\\n> \u5b89\u88c5\u5305\u6253\u5f00\u4f1a\u6709\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u5f55, \u8fd9\u4e2a\u76ee\u5f55\u91cc\u9762\u7684\u6587\u4ef6\u662f\u6211\u4eec\u9700\u8981\u89e3\u538b\u7684\u6587\u4ef6\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [open-radiant](https://github.com/JetBrains/open-radiant)\\n- [code2art](https://code2art.jetbrains.com/)\\n- [elm](https://elm-lang.org/)"},{"id":"/2023/03/30/fix-node-v17-upwards-openssl-hash-error","metadata":{"permalink":"/blog/2023/03/30/fix-node-v17-upwards-openssl-hash-error","source":"@site/blog/2023-03-30/fix-node-v17-upwards-openssl-hash-error.md","title":"node.js v17\u53ca\u4ee5\u4e0a\u7248\u672c\u4f7f\u7528openssl v3.0\u5f15\u53d1\u7684\u54c8\u5e0c\u7b97\u6cd5\u9519\u8bef\u53ca\u5176\u89e3\u51b3\u65b9\u6cd5","description":"\u6700\u8fd1\u5728\u672c\u5730\u6784\u5efaopen-radiant\u9879\u76ee.","date":"2023-03-30T00:00:00.000Z","formattedDate":"March 30, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"nodejs","permalink":"/blog/tags/nodejs"},{"label":"openssl","permalink":"/blog/tags/openssl"},{"label":"compatibility","permalink":"/blog/tags/compatibility"},{"label":"jetbrains","permalink":"/blog/tags/jetbrains"},{"label":"code2art","permalink":"/blog/tags/code-2-art"},{"label":"open-radiant","permalink":"/blog/tags/open-radiant"}],"readingTime":2.145,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","nodejs","openssl","compatibility","jetbrains","code2art","open-radiant"]},"unlisted":false,"prevItem":{"title":"\u89e3\u51b3elm\u4f9d\u8d56\u4e0b\u8f7d\u5931\u8d25\u7684\u95ee\u9898","permalink":"/blog/2023/03/30/fix-elm-package-download-failed"},"nextItem":{"title":"\u901a\u8fc7\u5ef6\u957folcIdleTimeout\u4ee5\u51cf\u5c11nslcd\u4e2d\u7684Can\'t contact LDAP server\u65e5\u5fd7\u62a5\u9519","permalink":"/blog/2023/03/28/ldap-idle-timeout"}},"content":"\u6700\u8fd1\u5728\u672c\u5730\u6784\u5efa[open-radiant](https://github.com/JetBrains/open-radiant)\u9879\u76ee.<br/>\\n\u8be5\u9879\u76ee\u662f`JetBrains`\u5f00\u6e90\u7684\u4e00\u4e2a\u9879\u76ee, \u7528\u4e8e\u751f\u6210AI\u827a\u672f\u56fe\u7247, \u5728\u7ebf\u6f14\u793a\u5730\u5740\u4e3a: [code2art](https://code2art.jetbrains.com/)<br/>\\n\u5728\u6784\u5efa\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898.<br/>\\n\\n\u5176\u4e2d\u7684\u4e00\u4e2a\u95ee\u9898\u662f\u5f53\u6267\u884c`npm start`\u65f6\u62a5\u9519, \u76f8\u5173\u9519\u8bef\u4fe1\u606f\u5982\u4e0b:\\n\\n```bash\\n\\n> jb-animation-generator@1.0.0 start\\n> ./node_modules/.bin/webpack-dev-server --mode=development\\n\\n\u2139 \uff62wds\uff63: Project is running at http://localhost:8080/\\n\u2139 \uff62wds\uff63: webpack output is served from /\\n\u2139 \uff62wds\uff63: Content not from webpack is served from /home/orange/Documents/Project/Github/open-radiant\\nnode:internal/crypto/hash:71\\n  this[kHandle] = new _Hash(algorithm, xofLen);\\n                  ^\\n\\nError: error:0308010C:digital envelope routines::unsupported\\n    at new Hash (node:internal/crypto/hash:71:19)\\n    at Object.createHash (node:crypto:133:10)\\n    at module.exports (/home/orange/Documents/Project/Github/open-radiant/node_modules/webpack/lib/util/createHash.js:135:53)\\n    at NormalModule._initBuildHash (/home/orange/Documents/Project/Github/open-radiant/node_modules/webpack/lib/NormalModule.js:417:16)\\n    at handleParseError (/home/orange/Documents/Project/Github/open-radiant/node_modules/webpack/lib/NormalModule.js:471:10)\\n    at /home/orange/Documents/Project/Github/open-radiant/node_modules/webpack/lib/NormalModule.js:503:5\\n    at /home/orange/Documents/Project/Github/open-radiant/node_modules/webpack/lib/NormalModule.js:358:12\\n    at /home/orange/Documents/Project/Github/open-radiant/node_modules/loader-runner/lib/LoaderRunner.js:373:3\\n    at iterateNormalLoaders (/home/orange/Documents/Project/Github/open-radiant/node_modules/loader-runner/lib/LoaderRunner.js:214:10)\\n    at Array.<anonymous> (/home/orange/Documents/Project/Github/open-radiant/node_modules/loader-runner/lib/LoaderRunner.js:205:4) {\\n  opensslErrorStack: [ \'error:03000086:digital envelope routines::initialization error\' ],\\n  library: \'digital envelope routines\',\\n  reason: \'unsupported\',\\n  code: \'ERR_OSSL_EVP_UNSUPPORTED\'\\n}\\n\\nNode.js v18.12.1\\n```\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n\u7ecf\u8fc7\u7f51\u4e0a\u7684\u4e00\u756a\u641c\u7d22, \u53d1\u73b0\u8fd9\u4e2a\u95ee\u9898\u662f\u7531\u4e8e`node.js`\u7684\u7248\u672c\u5347\u7ea7\u5230`v17`\u53ca\u4ee5\u4e0a\u7248\u672c, \u800c`openssl`\u7684\u7248\u672c\u5347\u7ea7\u5230`v3.0`\u5f15\u8d77\u7684.<br/>\\n\\n`openssl`\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5b89\u5168\u5957\u63a5\u5b57\u5c42\u5bc6\u7801\u5e93, \u7528\u4e8e\u63d0\u4f9b\u52a0\u5bc6\u548c\u8ba4\u8bc1\u670d\u52a1.<br/>\\n`node.js`\u5728`v17`\u53ca\u4ee5\u4e0a\u7248\u672c\u4e2d\u4f7f\u7528\u4e86`openssl`\u7684`v3.0`\u7248\u672c, \u8be5\u7248\u672c\u4e2d\u79fb\u9664\u4e86\u4e00\u4e9b\u54c8\u5e0c\u7b97\u6cd5, \u5bfc\u81f4\u5728\u4f7f\u7528\u8fd9\u4e9b\u7b97\u6cd5\u65f6\u62a5\u9519.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u89e3\u51b3\u65b9\u6848\u6709\u4ee5\u4e0b\u51e0\u79cd:\\n\\n- \u964d\u4f4e`node.js`\u7684\u7248\u672c\u5230v16\u53ca\u4ee5\u4e0b\u7248\u672c\\n- `npm start`\u4e4b\u524d\u5148\u6267\u884c`export NODE_OPTIONS=--openssl-legacy-provider`\\n  <br/>\u901a\u8fc7\u8be5\u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u542f\u7528`openssl`\u7684`legacy provider`\uff0c\u652f\u6301\u4e00\u4e9b\u65e7\u7684\u54c8\u5e0c\u7b97\u6cd5.<br/>\\n- \u5347\u7ea7\u76f8\u5173\u4f9d\u8d56\u5305\u5230\u6700\u65b0\u7248\u672c\uff0c\u53ef\u80fd\u4f1a\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898.<br/>\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Stack Overflow\u4e0a\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u8ba8\u8bba](https://stackoverflow.com/questions/69692842/error-message-error0308010cdigital-envelope-routinesunsupported)\\n- [Node.js\u5b98\u65b9\u6587\u6863\u4e2d\u5173\u4e8eOpenSSL 3.0\u7684\u8bf4\u660e](https://nodejs.org/api/crypto.html#crypto_openssl_3_0)\\n- [GitHub\u4e0a\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u62a5\u544a](https://github.com/nodejs/help/issues/4021)"},{"id":"/2023/03/28/ldap-idle-timeout","metadata":{"permalink":"/blog/2023/03/28/ldap-idle-timeout","source":"@site/blog/2023-03-28/ldap-idle-timeout.md","title":"\u901a\u8fc7\u5ef6\u957folcIdleTimeout\u4ee5\u51cf\u5c11nslcd\u4e2d\u7684Can\'t contact LDAP server\u65e5\u5fd7\u62a5\u9519","description":"\u5ba2\u6237\u7528\u4f8b\u6267\u884c\u5931\u8d25, \u5176\u731c\u6d4b\u53ef\u80fd\u662fnslcd\u670d\u52a1\u4e2d\u7684Can\'t contact LDAP server\u76f8\u5173\u62a5\u9519\u5bfc\u81f4\u5176\u751f\u4ea7\u7528\u4f8b\u6267\u884c\u5931\u8d25.","date":"2023-03-28T00:00:00.000Z","formattedDate":"March 28, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"ldap","permalink":"/blog/tags/ldap"},{"label":"nslcd","permalink":"/blog/tags/nslcd"}],"readingTime":6.88,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","ldap","nslcd"]},"unlisted":false,"prevItem":{"title":"node.js v17\u53ca\u4ee5\u4e0a\u7248\u672c\u4f7f\u7528openssl v3.0\u5f15\u53d1\u7684\u54c8\u5e0c\u7b97\u6cd5\u9519\u8bef\u53ca\u5176\u89e3\u51b3\u65b9\u6cd5","permalink":"/blog/2023/03/30/fix-node-v17-upwards-openssl-hash-error"},"nextItem":{"title":"grpc\u670d\u52a1tls\u8fde\u63a5\u63e1\u624b\u5931\u8d25\u95ee\u9898\u6392\u67e5","permalink":"/blog/2023/03/27/grpc-tls-handshake-failed"}},"content":"\u5ba2\u6237\u7528\u4f8b\u6267\u884c\u5931\u8d25, \u5176\u731c\u6d4b\u53ef\u80fd\u662f`nslcd`\u670d\u52a1\u4e2d\u7684`Can\'t contact LDAP server`\u76f8\u5173\u62a5\u9519\u5bfc\u81f4\u5176\u751f\u4ea7\u7528\u4f8b\u6267\u884c\u5931\u8d25.<br/>\\n\\n`nslcd`\u65e5\u5fd7\u5982\u4e0b:\\n\\n```log\\n[fastone@layout01 ~]$ sudo journalctl -t nslcd| tail --line 20\\nMar 28 11:58:24 layout01 nslcd[25607]: [debc9e] <group=\\"fsadmin\\"> connected to LDAP server ldap://172.20.3.126:389\\nMar 28 11:59:17 layout01 nslcd[25607]: [fe8aa7] <passwd=2032> ldap_search_ext() failed: Can\'t contact LDAP server: Broken pipe\\nMar 28 11:59:17 layout01 nslcd[25607]: [fe8aa7] <passwd=2032> no available LDAP server found, sleeping 1 seconds\\nMar 28 11:59:18 layout01 nslcd[25607]: [fe8aa7] <passwd=2032> connected to LDAP server ldap://172.20.3.126:389\\nMar 28 12:00:01 layout01 nslcd[25607]: [272b88] <group/member=\\"root\\"> ldap_result() failed: Can\'t contact LDAP server\\nMar 28 12:00:36 layout01 nslcd[25607]: [66b17f] <group=2001> ldap_search_ext() failed: Can\'t contact LDAP server: Broken pipe\\nMar 28 12:00:36 layout01 nslcd[25607]: [66b17f] <group=2001> no available LDAP server found, sleeping 1 seconds\\nMar 28 12:00:37 layout01 nslcd[25607]: [66b17f] <group=2001> connected to LDAP server ldap://172.20.3.126:389\\nMar 28 12:00:38 layout01 nslcd[25607]: [a15030] <passwd=2004> ldap_search_ext() failed: Can\'t contact LDAP server: Broken pipe\\nMar 28 12:00:38 layout01 nslcd[25607]: [a15030] <passwd=2004> no available LDAP server found, sleeping 1 seconds\\nMar 28 12:00:39 layout01 nslcd[25607]: [a15030] <passwd=2004> connected to LDAP server ldap://172.20.3.126:389\\nMar 28 12:00:39 layout01 nslcd[25607]: [9b7b93] <passwd=2001> ldap_result() failed: Can\'t contact LDAP server\\nMar 28 12:00:54 layout01 nslcd[25607]: [97bb68] <passwd=2011> ldap_result() failed: Can\'t contact LDAP server\\nMar 28 12:01:36 layout01 nslcd[25607]: [005d16] <group=2011> ldap_result() failed: Can\'t contact LDAP server\\nMar 28 12:03:39 layout01 nslcd[25607]: [b9081a] <group=\\"fsadmin\\"> ldap_search_ext() failed: Can\'t contact LDAP server: Broken pipe\\nMar 28 12:03:39 layout01 nslcd[25607]: [b9081a] <group=\\"fsadmin\\"> no available LDAP server found, sleeping 1 seconds\\nMar 28 12:03:40 layout01 nslcd[25607]: [b9081a] <group=\\"fsadmin\\"> connected to LDAP server ldap://172.20.3.126:389\\nMar 28 12:03:47 layout01 nslcd[25607]: [0f614b] <group/member=\\"root\\"> ldap_search_ext() failed: Can\'t contact LDAP server: Broken pipe\\nMar 28 12:03:47 layout01 nslcd[25607]: [0f614b] <group/member=\\"root\\"> no available LDAP server found, sleeping 1 seconds\\nMar 28 12:03:48 layout01 nslcd[25607]: [0f614b] <group/member=\\"root\\"> connected to LDAP server ldap://172.20.3.126:389\\n```\\n\\n\u4ece\u65e5\u5fd7\u4e2d\u53ef\u4ee5\u53d1\u73b0`nslcd`\u670d\u52a1\u7ecf\u5e38\u51fa\u73b0`Can\'t contact LDAP server`.<br/>\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n### \u89e6\u53d1\u4e86`ldap-server`\u7684\u8fde\u63a5\u8d85\u65f6\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u89e6\u53d1\u4e86`ldap-server`\u7684\u8d85\u65f6\u65f6\u95f4, \u4ece\u800c\u5bfc\u81f4`nslcd`\u670d\u52a1\u4e2d\u7684`Can\'t contact LDAP server`\u76f8\u5173\u62a5\u9519.<br/>\\n`ldap-server`\u7684\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u6211\u4eec\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u4e3a`30s`\u4e3a\u4e86\u786e\u4fdd\u8fde\u63a5\u4e0d\u4f1a\u88ab\u4e00\u76f4\u5360\u7528\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u7aef\u8d1f\u8f7d\u8fc7\u9ad8.<br/>\\n\u4f46\u662f\u9891\u7e41\u51fa\u73b0\u8fd9\u4e2a\u9519\u8bef\u4f1a\u8ba9\u5ba2\u6237\u8ba4\u4e3a\u662f\u6211\u4eec\u7684`ldap-server`\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u5176\u7528\u4f8b\u5931\u8d25, \u6211\u4eec\u9700\u8981\u5ef6\u957f\u8d85\u65f6\u65f6\u95f4\u6765\u907f\u514d\u5ba2\u6237\u7684\u8bef\u89e3.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u9700\u8981\u4fee\u6539`ldap-server`\u7684\u8d85\u65f6\u65f6\u95f4.<br/>\\n`ldap-server`\u4e2d\u7684\u8d85\u65f6\u65f6\u95f4\u662f\u901a\u8fc7`olcIdleTimeout`\u6765\u8bbe\u7f6e\u7684.<br/>\\n\u901a\u8fc7\u4fee\u6539\u6b64\u503c\u53ef\u4ee5\u5ef6\u957f`ldap-server`\u7684\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4.<br/>\\n\u9700\u8981\u6ce8\u610f\u7684\u662f, `olcIdleTimeout`\u7684\u5355\u4f4d\u662f\u79d2.<br/>\\n\u53e6\u5916\u7684\u4e00\u4e2a\u6ce8\u610f\u4e8b\u9879\u662f\u4fee\u6539\u6b64\u503c\u9700\u8981\u901a\u8fc7`ldap`\u4e2d\u7684`config`\u6570\u636e\u5e93\u7684`admin`\u7528\u6237\u6765\u4fee\u6539.<br/>\\n\u4fee\u6539\u5b8c\u6210\u4e4b\u540e, \u6211\u4eec\u9700\u8981\u91cd\u542f`ldap-server`\u670d\u52a1.<br/>\\n\\n### \u521b\u5efa`change-timeout.ldif`\u6587\u4ef6\\n\\n\u5148\u521b\u5efa\u5982\u4e0b\u6587\u4ef6, \u4e3a\u4e86\u65b9\u4fbf, \u6211\u4eec\u5c06\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a`12h`.\\n\\n```ldif title=\\"change-timeout.ldif\\"\\ndn: cn=config\\nchangetype: modify\\nreplace: olcIdleTimeout\\nolcIdleTimeout: 43200\\n```\\n\\n### \u901a\u8fc7`ldapmodify`\u547d\u4ee4\u4fee\u6539\u8d85\u65f6\u65f6\u95f4\\n\\n\u6211\u4eec\u9700\u8981\u8fde\u63a5`ldap-server`\u5e76\u6267\u884c`ldapmodify`\u547d\u4ee4\u6765\u4fee\u6539`ldap`\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4.<br/>\\n\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f, \u6267\u884c`ldapmodify`\u547d\u4ee4`bind`\u7684\u7528\u6237\u4e3a`cn=admin,cn=config`\u7528\u6237, \u8be5\u7528\u6237\u662f`config`\u6570\u636e\u5e93\u7684`admin`\u7528\u6237.<br/>\\n\\n```bash\\nldapmodify -x -D cn=admin,cn=config -w <password-of-config-admin> -f change-timeout.ldif\\n```\\n\\n\u8be5\u547d\u4ee4\u5c06\u4f1a\u8f93\u51fa\u5982\u4e0b\u5185\u5bb9\\n\\n```log\\nmodifying entry \\"cn=config\\"\\n```\\n\\n\u5f53\u770b\u5230\u4e0a\u9762\u7684\u8f93\u51fa\u65f6, \u8bf4\u660e\u8d85\u65f6\u65f6\u95f4\u5df2\u7ecf\u4fee\u6539\u6210\u529f.<br/>\\n\\n### \u786e\u8ba4\u8d85\u65f6\u65f6\u95f4\u662f\u5426\u4fee\u6539\u6210\u529f\\n\\n\u6267\u884c\u5982\u4e0b\u547d\u4ee4\\n\\n```bash\\nldapsearch -x -D cn=admin,cn=config -w <password-of-config-admin> -b cn=config|grep olcIdleTimeout\\n```\\n\\n\u8be5\u547d\u4ee4\u5c06\u4f1a\u8f93\u51fa\u5982\u4e0b\u5185\u5bb9\\n\\n```log\\nolcIdleTimeout: 43200\\nolcAttributeTypes: ( OLcfgGlAt:18 NAME \'olcIdleTimeout\' SYNTAX OMsInteger SING\\n PendingAuth $ olcDisallows $ olcGentleHUP $ olcIdleTimeout $ olcIndexSubstrIf\\n```\\n\\n\u901a\u8fc7\u8f93\u51fa\u7684\u5185\u5bb9\u53ef\u4ee5\u770b\u5230`olcIdleTimeout`\u7684\u503c\u5df2\u7ecf\u88ab\u4fee\u6539\u4e3a`43200`.<br/>\\n\\n### \u91cd\u542f`ldap-server`\\n\\n\u4e3a\u4e86\u786e\u4fdd\u914d\u7f6e\u751f\u6548, \u6211\u4eec\u9700\u8981\u91cd\u542f`ldap`\u670d\u52a1.<br/>\\n\u4e0d\u540c\u7684`ldap`\u670d\u52a1\u7684\u91cd\u542f\u65b9\u5f0f\u4e0d\u540c, \u8fd9\u91cc\u4ee5`ldap`\u5bb9\u5668\u4e3a\u4f8b.<br/>\\n\\n```bash\\ndocker restart <ldap-container>\\n```\\n\\n### \u9a8c\u8bc1\u914d\u7f6e\u662f\u5426\u751f\u6548\\n\\n\u5728\u5b89\u88c5\u6709`nslcd`\u670d\u52a1\u7684\u673a\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4.<br/>\\n\u4e24\u4e2a\u547d\u4ee4\u4e2d\u95f4\u95f4\u9694`35s`. \u5982\u679c\u914d\u7f6e\u6ca1\u751f\u6548\u90a3\u4e4830s\u540e\u4f1a\u518d\u6b21\u51fa\u73b0`Can\'t contact LDAP server`\u7684\u62a5\u9519.<br/>\\n\u56e0\u4e3a\u6211\u4eec\u4e00\u5f00\u59cb\u9ed8\u8ba4\u7684\u8d85\u65f6\u65f6\u95f4\u662f`30s`, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u95f4\u9694`35s`\u6765\u9a8c\u8bc1\u914d\u7f6e\u662f\u5426\u751f\u6548.<br/>\\n\\n```bash\\ngetent passwd -s ldap && sleep 35s && getent passwd -s ldap\\n```\\n\\n\u6267\u884c\u671f\u95f4\u6211\u4eec\u9700\u8981\u89c2\u5bdf`nslcd`\u670d\u52a1\u7684\u65e5\u5fd7.<br/>\\n\u6700\u597d\u5f00\u4e24\u4e2a\u7ec8\u7aef, \u4e00\u4e2a\u6267\u884c\u547d\u4ee4, \u4e00\u4e2a\u67e5\u770b\u65e5\u5fd7. \u8fd9\u6837\u53ef\u4ee5\u66f4\u52a0\u76f4\u89c2\u7684\u770b\u5230\u65e5\u5fd7.<br/>\\n\\n```bash\\njournalctl -u nslcd -f\\n```\\n\\n\u5982\u679c\u914d\u7f6e\u751f\u6548\u90a3\u4e48\u6211\u4eec\u5c06\u4e0d\u4f1a\u770b\u5230`Can\'t contact LDAP server`\u7684\u62a5\u9519.<br/>\\n\\n## \u5907\u6ce8\\n\\n### \u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u7684\u914d\u7f6e\u6587\u4ef6\\n\\n```ldif title=\\"change-timeout.ldif\\"\\ndn: cn=config\\nchangetype: modify\\nreplace: olcIdleTimeout\\nolcIdleTimeout: 30\\n```\\n\\n### \u67e5\u770b\u7cfb\u7edf\u4e2d\u7684`nslcd`\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\\n\\n```bash\\ncat /etc/nslcd.conf\\n```\\n\\n### \u67e5\u770b`ldap-server`\u7684`olcRoot`\u7528\u6237\u7684\u4fe1\u606f\\n\\n`olcRoot`\u662f`ldap-server`\u7684\u8d85\u7ea7\u7ba1\u7406\u5458, \u901a\u8fc7\u8be5\u7528\u6237\u53ef\u4ee5\u5bf9`ldap-server`\u8fdb\u884c\u7ba1\u7406.<br/>\\n\\n\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u770b`ldap-server`\u7684`olcRoot`\u7528\u6237\u7684\u4fe1\u606f.<br/>\\n\\n```bash\\ncd /etc/ldap/slapd.d/cn=config && grep -r \'olcRoot\' *\\n```\\n\\n\u8be5\u547d\u4ee4\u5c06\u4f1a\u8f93\u51fa\u5982\u4e0b\u53c2\u8003\u5185\u5bb9\\n\\n```log\\nolcDatabase={0}config.ldif:olcRootDN: cn=admin,cn=config\\nolcDatabase={0}config.ldif:olcRootPW:: xxxx\\nolcDatabase={1}mdb.ldif:olcRootDN: cn=admin,dc=demo,dc=com\\nolcDatabase={1}mdb.ldif:olcRootPW:: xxxx\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u8f93\u51fa\u53ef\u4ee5\u770b\u5230\u6709\u4e24\u4e2a`olcRoot`\u7528\u6237, \u4e00\u4e2a\u662f`cn=admin,cn=config`, \u53e6\u4e00\u4e2a\u662f`cn=admin,dc=demo,dc=com`.<br/>\\n\u6709\u8fd9\u4e24\u4e2a\u7528\u6237\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u5176\u662f\u4e0d\u540c`olcDatabase`\u7684`olcRoot`\u7528\u6237.<br/>\\n`olcDatabase={0}config.ldif`\u662f`ldap-server`\u7684\u914d\u7f6e\u6570\u636e\u5e93. \u5176\u4e3b\u8981\u5b58\u653e\u4e86`ldap-server`\u7684\u914d\u7f6e\u4fe1\u606f.<br/>\\n`olcDatabase={1}mdb.ldif`\u662f`ldap-server`\u7684\u6570\u636e\u6570\u636e\u5e93. \u5176\u4e3b\u8981\u5b58\u653e\u4e86`ldap-server`\u7684\u6570\u636e\u4fe1\u606f, \u8be5\u6570\u636e\u662f\u7ed9\u6211\u4eec\u4f7f\u7528\u7684.<br/>\\n\\n### \u786e\u4fdd`fd`\u6570\u91cf\u53ef\u7528\\n\\n\u56e0\u4e3a\u4e0a\u9762\u4fee\u6539\u4e86`ldap-server`\u7684\u8d85\u65f6\u65f6\u95f4, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u786e\u4fdd`ldap-server`\u7684`fd`\u6570\u91cf\u8db3\u591f.<br/>\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Configuring slapd](https://www.openldap.org/devel/admin/slapdconf2.html)\\n- [ldapmodify(1) - Linux man page](https://linux.die.net/man/1/ldapmodify)"},{"id":"/2023/03/27/grpc-tls-handshake-failed","metadata":{"permalink":"/blog/2023/03/27/grpc-tls-handshake-failed","source":"@site/blog/2023-03-27/grpc-tls-handshake-failed.md","title":"grpc\u670d\u52a1tls\u8fde\u63a5\u63e1\u624b\u5931\u8d25\u95ee\u9898\u6392\u67e5","description":"\u8fd1\u671f\u5728\u8bbf\u95ee\u901a\u8fc7\u516c\u7f51\u66b4\u9732\u7684grpc\u670d\u52a1\u65f6\u8fde\u63a5\u65f6\u62a5\u9519, \u5f02\u5e38\u4fe1\u606f\u5982\u4e0b","date":"2023-03-27T00:00:00.000Z","formattedDate":"March 27, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"grpc","permalink":"/blog/tags/grpc"},{"label":"tls","permalink":"/blog/tags/tls"},{"label":"aws","permalink":"/blog/tags/aws"},{"label":"network-loadbalancer","permalink":"/blog/tags/network-loadbalancer"}],"readingTime":2.26,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","grpc","tls","aws","network-loadbalancer"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u5ef6\u957folcIdleTimeout\u4ee5\u51cf\u5c11nslcd\u4e2d\u7684Can\'t contact LDAP server\u65e5\u5fd7\u62a5\u9519","permalink":"/blog/2023/03/28/ldap-idle-timeout"},"nextItem":{"title":"\u901a\u8fc7\u4f7f\u7528evans\u6765\u66f4\u52a0\u4fbf\u6377\u5730\u8c03\u8bd5grpc\u670d\u52a1","permalink":"/blog/2023/03/25/evans"}},"content":"\u8fd1\u671f\u5728\u8bbf\u95ee\u901a\u8fc7\u516c\u7f51\u66b4\u9732\u7684`grpc`\u670d\u52a1\u65f6\u8fde\u63a5\u65f6\u62a5\u9519, \u5f02\u5e38\u4fe1\u606f\u5982\u4e0b\\n\\n```log\\nException in thread \\"main\\" io.grpc.StatusException: UNAVAILABLE: io exception\\nChannel Pipeline: [SslHandler#0, ProtocolNegotiators$ClientTlsHandler#0, WriteBufferingAndExceptionHandler#0, DefaultChannelPipeline$TailContext#0]\\n\\tat io.grpc.Status.asException(Status.java:554)\\n\\tat io.grpc.kotlin.ClientCalls$rpcImpl$1$1$1.onClose(ClientCalls.kt:296)\\n\\tat io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:576)\\n\\tat io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:70)\\n\\tat io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:757)\\n\\tat io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:736)\\n\\tat io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\\n\\tat io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 485454502f312e312034303320466f7262696464656e0a436f6e74656e742d547970653a20746578742f68746d6c3b20636861727365743d7574662d380a5365727665723a2041444d2f322e312e310a436f6e6e656374696f6e3a20636c6f73650a436f6e74656e742d4c656e6774683a203531320a0a3c68746d6c3e0a3c686561643e0a3c6d65746120687474702d65717569763d22436f6e74656e742d547970652220636f6e74656e743d22746578746d6c3b636861727365743d5554462d3822202f3e0a2020203c7374796c653e626f64797b6261636b67726f756e642d636f6c6f723a234646464646467d3c2f7374796c653e200a3c7469746c653e7a687935342d48473130302d32e99d9ee6b395e998bbe696ad3c2f7469746c653e0a20203c736372697074206c616e67756167653d226a6176617363726970742220747970653d22746578742f6a617661736372697074223e0a20202020202020202077696e646f772e6f6e6c6f6164203d2066756e6374696f6e202829207b200a2020202020202020202020646f63756d656e742e676574456c656d656e744279496428226d61696e4672616d6522292e7372633d2022687474703a2f2f3230332e39332e3137302e3231393a393038302f6572726f722e68746d6c223b200a2020202020202020202020207d0a3c2f7363726970743e2020200a3c2f686561643e0a20203c626f64793e0a2020202020203c696672616d652069643d226d61696e4672616d6522207372633d2222206672616d65626f726465723d2230222077696474683d223130302522206865696768743d2231303025223e3c2f696672616d653e0a20203c2f626f64793e0a3c2f68746d6c3e\\n\\tat io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1215)\\n\\tat io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1285)\\n\\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)\\n\\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)\\n\\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\\n\\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\\n\\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\\n\\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\\n\\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\\n\\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\\n\\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\\n\\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\\n\\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\\n\\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\t... 1 more\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n## \u539f\u56e0\\n\\n\u8be5\u670d\u52a1\u662f\u901a\u8fc7`aws`\u7684`nlb`\u6765\u5b9e\u73b0\u516c\u7f51\u8bbf\u95ee\u7684, \u7531\u4e8e`aws`\u8fd1\u671f\u7684\u5b89\u5168\u9650\u5236\u5bfc\u81f4`tls`\u7684\u8fde\u63a5\u65e0\u6cd5\u5efa\u7acb\u9700\u8981\u8fdb\u884c\u5907\u6848, \u8be5\u95ee\u9898\u662f\u8fd1\u671f\u53d1\u751f\u7684,\\n\u4e4b\u524d\u662f\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u7684.<br/>\\n\\n\u6839\u636e\u5f02\u5e38\u4fe1\u606f\u53ef\u4ee5\u770b\u51fa, \u670d\u52a1\u7aef\u8fd4\u56de\u7684\u662f\u975essl\u7684\u54cd\u5e94\u5bfc\u81f4\u5ba2\u6237\u7aef\u629b\u51fa`NotSslRecordException`<br/>\\n\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u5185\u5bb9\u4e3a16\u8fdb\u5236\u7684\u5982\u4e0b\u5185\u5bb9\\n\\n```log\\n485454502f312e312034303320466f7262696464656e0a436f6e74656e742d547970653a20746578742f68746d6c3b20636861727365743d7574662d380a5365727665723a2041444d2f322e312e310a436f6e6e656374696f6e3a20636c6f73650a436f6e74656e742d4c656e6774683a203531320a0a3c68746d6c3e0a3c686561643e0a3c6d65746120687474702d65717569763d22436f6e74656e742d547970652220636f6e74656e743d22746578746d6c3b636861727365743d5554462d3822202f3e0a2020203c7374796c653e626f64797b6261636b67726f756e642d636f6c6f723a234646464646467d3c2f7374796c653e200a3c7469746c653e7a687935342d48473130302d32e99d9ee6b395e998bbe696ad3c2f7469746c653e0a20203c736372697074206c616e67756167653d226a6176617363726970742220747970653d22746578742f6a617661736372697074223e0a20202020202020202077696e646f772e6f6e6c6f6164203d2066756e6374696f6e202829207b200a2020202020202020202020646f63756d656e742e676574456c656d656e744279496428226d61696e4672616d6522292e7372633d2022687474703a2f2f3230332e39332e3137302e3231393a393038302f6572726f722e68746d6c223b200a2020202020202020202020207d0a3c2f7363726970743e2020200a3c2f686561643e0a20203c626f64793e0a2020202020203c696672616d652069643d226d61696e4672616d6522207372633d2222206672616d65626f726465723d2230222077696474683d223130302522206865696768743d2231303025223e3c2f696672616d653e0a20203c2f626f64793e0a3c2f68746d6c3e\\n```\\n\\n\u4f7f\u752816\u8fdb\u5236\u8f6c\u6362\u5de5\u5177\u8f6c\u6362\u4e3a\u6587\u672c\u5185\u5bb9\u5982\u4e0b\\n\\n```html\\nHTTP/1.1 403 Forbidden\\nContent-Type: text/html; charset=utf-8\\nServer: ADM/2.1.1\\nConnection: close\\nContent-Length: 512\\n\\n<html>\\n<head>\\n\\t<meta http-equiv=\\"Content-Type\\" content=\\"textml;charset=UTF-8\\"/>\\n\\t<style>body {\\n\\t\\tbackground-color: #FFFFFF\\n\\t}</style>\\n\\t<title>zhy54-HG100-2\u975e\u6cd5\u963b\u65ad</title>\\n\\t<script language=\\"javascript\\" type=\\"text/javascript\\">\\n\\t\\twindow.onload = function () {\\n\\t\\t\\tdocument.getElementById(\\"mainFrame\\").src = \\"http://203.93.170.219:9080/error.html\\";\\n\\t\\t}\\n\\t<\/script>\\n</head>\\n<body>\\n<iframe id=\\"mainFrame\\" src=\\"\\" frameborder=\\"0\\" width=\\"100%\\" height=\\"100%\\"></iframe>\\n</body>\\n</html>\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u662f\u4e00\u4e2a`403`\u7684`html`\u9875\u9762, \u8be5\u9875\u9762\u662f\u7531`aws`\u7684`nlb`\u8fd4\u56de\u7684, \u8be5\u9875\u9762\u5d4c\u5957\u4e86\u4e00\u4e2a`iframe`\u6807\u7b7e,\\n\u91cc\u9762\u7684\u76ee\u6807\u662f`http://203.93.170.219:9080/error.html` <br/>\\n\\n\u8bbf\u95ee\u8be5\u9875\u9762\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u5185\u5bb9\\n\\n![\u9875\u9762\u622a\u56fe](./screenshot.jpeg)\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u6839\u636e\u76ee\u524d\u7684\u4fe1\u606f\u6765\u770b, \u8be5\u95ee\u9898\u662f\u7531\u4e8e`aws`\u7684\u5b89\u5168\u9650\u5236\u5bfc\u81f4\u7684, `nlb`\u66b4\u9732\u7684\u670d\u52a1\u9700\u8981\u8fdb\u884c\u5907\u6848.<br/>\\n\\n## \u53c2\u8003\\n\\n- [AWS+ICP\u5907\u6848\u4f7f\u7528ELB\u9884\u7559IP\u6307\u5357_V2.1(\u65b0\u7248).pdf](https://s3.cn-north-1.amazonaws.com.cn/sinnetcloud/%E5%85%AC%E5%AE%89%E5%A4%87%E6%A1%88/%E8%8E%B7%E5%8F%96ELB%E7%9A%84IP/AWS+ICP%E5%A4%87%E6%A1%88%E4%BD%BF%E7%94%A8ELB%E9%A2%84%E7%95%99IP%E6%8C%87%E5%8D%97_V2.1(%E6%96%B0%E7%89%88).pdf)\\n- [\u5173\u4e8e ICP \u5907\u6848/\u516c\u5b89\u5907\u6848/ICP \u8bc1\u4e66\u7533\u8bf7\u6d41\u7a0b\u7684\u6307\u5bfc](http://s3.cn-northwest-1.amazonaws.com.cn/www.nwcdcloud.cn/icp.pdf)"},{"id":"/2023/03/25/evans","metadata":{"permalink":"/blog/2023/03/25/evans","source":"@site/blog/2023-03-25/evans.md","title":"\u901a\u8fc7\u4f7f\u7528evans\u6765\u66f4\u52a0\u4fbf\u6377\u5730\u8c03\u8bd5grpc\u670d\u52a1","description":"\u6709\u7684\u65f6\u5019\u9700\u8981\u8c03\u8bd5grpc\u670d\u52a1, \u4f46\u662f\u901a\u8fc7\u4ee3\u7801\u6765\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u9ebb\u70e6, \u56e0\u4e3a\u9700\u8981\u7f16\u5199\u76f8\u5173\u4ee3\u7801, \u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u4e00\u4e2a\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u8c03\u8bd5,","date":"2023-03-25T00:00:00.000Z","formattedDate":"March 25, 2023","tags":[{"label":"evans","permalink":"/blog/tags/evans"},{"label":"grpc","permalink":"/blog/tags/grpc"}],"readingTime":4.49,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["evans","grpc"]},"unlisted":false,"prevItem":{"title":"grpc\u670d\u52a1tls\u8fde\u63a5\u63e1\u624b\u5931\u8d25\u95ee\u9898\u6392\u67e5","permalink":"/blog/2023/03/27/grpc-tls-handshake-failed"},"nextItem":{"title":"transport endpoint is not connected\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/03/23/transport-endpoint-is-not-connected"}},"content":"\u6709\u7684\u65f6\u5019\u9700\u8981\u8c03\u8bd5`grpc`\u670d\u52a1, \u4f46\u662f\u901a\u8fc7\u4ee3\u7801\u6765\u8fdb\u884c\u8c03\u8bd5\u6bd4\u8f83\u9ebb\u70e6, \u56e0\u4e3a\u9700\u8981\u7f16\u5199\u76f8\u5173\u4ee3\u7801, \u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u4e00\u4e2a\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u8c03\u8bd5,\\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e2a\u5de5\u5177`evans`.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5b89\u88c5\\n\\n\u8fdb\u5165[Releases](https://github.com/ktr0731/evans/releases)\u9875\u9762\u4e0b\u8f7d\u5bf9\u5e94\u7684\u7248\u672c, \u7136\u540e\u8fdb\u884c\u89e3\u538b. <br/>\\n\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u6709\u4e00\u4e2a`evans`\u7684\u53ef\u6267\u884c\u6587\u4ef6, \u5982\u679c\u60f3\u5728\u4efb\u610f\u4f4d\u7f6e\u90fd\u901a\u8fc7`evans`\u6765\u8c03\u7528, \u90a3\u4e48\u9700\u8981\u505a\u4ee5\u4e0b\u64cd\u4f5c\u5217\u8868\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\\n\\n- \u653e\u5230`/usr/local/bin`\u76ee\u5f55\u4e0b.\\n- \u5c06`/path/to/evans`\u6dfb\u52a0\u5230`PATH`\u73af\u5883\u53d8\u91cf\u4e2d.\\n\\n## \u542f\u52a8\\n\\n\u901a\u8fc7`evans`\u547d\u4ee4\u542f\u52a8, \u7531\u4e8e\u670d\u52a1\u8c03\u7528\u9700\u8981\u77e5\u9053\u5951\u7ea6, \u6240\u4ee5\u9700\u8981\u6307\u5b9a\u5951\u7ea6\u6587\u4ef6, \u6709\u4e24\u79cd\u65b9\u5f0f\\n\\n- \u7ed9\u5b9aprotobuf\u6587\u4ef6\\n\\n```log\\nevans --host <HOST> --port <PORT> --path <PROTOBUF_ROOT> --proto <PROTOBUF_FILE>\\n```\\n\\n\u5176\u4e2d:<br/>\\n`<PROTOBUF_ROOT>`\u662fprotobuf\u6587\u4ef6\u7684\u6839\u76ee\u5f55<br/>\\n`<PROTOBUF_FILE>`\u662fprotobuf\u6587\u4ef6\u76f8\u5bf9\u4e8e`<PROTOBUF_ROOT>`\u7684\u8def\u5f84<br/>\\n\\n\u4f8b\u5982\u4ee5\u4e0b\u7ed9\u5b9a\u53c2\u6570:<br/>\\n`--path /Users/kuoxiangcheng/protobuf --proto test/test.proto`<br/>\\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d`test/test.proto`\u662f\u5904\u4e8e`/Users/kuoxiangcheng/protobuf`\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6.<br/>\\n\u5f53\u591a\u4e2a`protobuf`\u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u65f6, \u914d\u7f6e`--path`\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u5f0f, \u56e0\u4e3a\u53ef\u4ee5\u901a\u8fc7`--path`\u6765\u6307\u5b9aprotobuf\u6587\u4ef6\u7684\u6839\u76ee\u5f55\\n\\n- \u901a\u8fc7reflection\u65b9\u5f0f\u8fd0\u884c\\n\\n```log\\nevans --host <HOST> --port <PORT> -r\\n```\\n\\n\u5f53\u6267\u884c\u4e0a\u9762\u7684\u547d\u4ee4\u540e, \u4f1a\u8fdb\u5165evans\u7684\u4ea4\u4e92\u5f0f\u754c\u9762, \u5185\u5bb9\u5982\u4e0b\\n\\n```log\\n\\n  ______\\n |  ____|\\n | |__    __   __   __ _   _ __    ___\\n |  __|   \\\\ \\\\ / /  / _. | | \'_ \\\\  / __|\\n | |____   \\\\ V /  | (_| | | | | | \\\\__ \\\\\\n |______|   \\\\_/    \\\\__,_| |_| |_| |___/\\n\\n more expressive universal gRPC client\\n\\n\\n192.168.16.243:27778>\\n```\\n\\n## \u670d\u52a1\u8c03\u7528\\n\\n\u5f53\u8fdb\u5165evans\u7684\u4ea4\u4e92\u5f0f\u754c\u9762\u540e, \u540e\u7eed\u8fde\u63a5\u7279\u5b9a\u7684\u670d\u52a1, \u8c03\u7528\u7279\u5b9a\u7684\u65b9\u6cd5, \u4ee5\u53ca\u4f20\u9012\u53c2\u6570\u90fd\u662f\u901a\u8fc7\u4ea4\u4e92\u5f0f\u754c\u9762\u6765\u5b8c\u6210\u7684.<br/>\\n\u63a5\u4e0b\u6765\u9700\u8981\u51e0\u4e2a\u6b65\u9aa4\u6765\u5b8c\u6210\u670d\u52a1\u7684\u8c03\u7528\\n\\n- \u8bbe\u7f6e`package`\\n- \u8bbe\u7f6e`service`\\n- \u8c03\u7528`rpc`\\n\\n### \u5217\u51fa`package`\\n\\n\u901a\u8fc7`show package`\u547d\u4ee4\u6765\u67e5\u770b\u5f53\u524d\u8fde\u63a5\u7684\u670d\u52a1\u4e2d\u7684`package`\\n\\n```bash\\nshow package\\n```\\n\\n\u5f53\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u540e, \u4f1a\u5217\u51fa\u5f53\u524d\u8fde\u63a5\u7684\u670d\u52a1\u4e2d\u7684\u6240\u6709`package`, \u53c2\u8003\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\n+---------------+\\n|    PACKAGE    |\\n+---------------+\\n| nott.v1.nottd |\\n| nott.v1.nottm |\\n+---------------+\\n```\\n\\n### \u8bbe\u7f6e`package`\\n\\n\u6839\u636e\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684`package`\u8fdb\u884c\u8bbe\u7f6e.<br/>\\n\u4f8b\u5982: \u8bbe\u7f6e`package`\u4e3a`nott.v1.nottm`\\n\\n```bash\\nservice nott.v1.nottm\\n```\\n\\n### \u5217\u51fa`service`\\n\\n\u5f53\u8bbe\u7f6e\u5b8c`package`\u540e, \u8fd8\u9700\u8981\u8bbe\u7f6e`service`, \u901a\u8fc7`show service`\u547d\u4ee4\u6765\u67e5\u770b\u5f53\u524d`package`\u4e0b\u7684\u6240\u6709`service`\\n\\n```bash\\nshow service\\n```\\n\\n\u5f53\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u540e, \u4f1a\u5217\u51fa\u5f53\u524d\u8fde\u63a5\u7684\u670d\u52a1\u4e2d\u7684\u6240\u6709`service`, \u53c2\u8003\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\n+---------+---------------------+-----------------------+------------------------+\\n| SERVICE |         RPC         |     REQUEST TYPE      |     RESPONSE TYPE      |\\n+---------+---------------------+-----------------------+------------------------+\\n| Nottm   | Register            | RegisterRequest       | RegisterResponse       |\\n| Nottm   | ListRegisters       | ListRegistersRequest  | ListRegistersResponse  |\\n| Nottm   | UpdateRegister      | UpdateRegisterRequest | UpdateRegisterResponse |\\n| Nottm   | RevokeRegister      | RevokeRegisterRequest | RevokeRegisterResponse |\\n| Nottm   | Push                | PushRequest           | PushResponse           |\\n| Nottm   | Poll                | PollRequest           | PollResponse           |\\n| Nottm   | RetrieveSentMessage | PollRequest           | PollResponse           |\\n| Nottm   | QueryMessages       | QueryMessagesRequest  | QueryMessagesResponse  |\\n| Nottm   | CheckState          | CheckStateRequest     | CheckStateResponse     |\\n| Nottm   | QueueStatus         | QueueStatusRequest    | QueueStatusResponse    |\\n| Nottm   | InspectNottd        | InspectNottdRequest   | InspectNottdResponse   |\\n| Nottm   | InspectNottm        | InspectNottmRequest   | InspectNottmResponse   |\\n| Nottm   | RestartNottd        | RestartNottdRequest   | RestartNottdResponse   |\\n+---------+---------------------+-----------------------+------------------------+\\n```\\n\\n### \u8bbe\u7f6e`service`\\n\\n\u6839\u636e\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684`service`\u8fdb\u884c\u8bbe\u7f6e.<br/>\\n\u4f8b\u5982: \u8bbe\u7f6e`service`\u4e3a`Nottm`\\n\\n```bash\\nservice Nottm\\n```\\n\\n### \u8c03\u7528`rpc`\\n\\n\u5f53\u8bbe\u7f6e\u5b8c`service`\u540e, \u53ef\u4ee5\u901a\u8fc7`call <RPC>`\u547d\u4ee4\u6765\u8c03\u7528`rpc`\u65b9\u6cd5.<br/>\\n\\n\u4f8b\u5982: \u8c03\u7528`Register`\u65b9\u6cd5\\n\\n```bash\\ncall Register\\n```\\n\\n\u7136\u540e\u6839\u636e\u63d0\u793a\u8f93\u5165\u53c2\u6570, \u5f53\u8f93\u5165\u5b8c\u6bd5\u540e, \u4f1a\u8fd4\u56de\u8c03\u7528\u7ed3\u679c.<br/>\\n\\n## \u53c2\u8003\\n\\n- [evans](https://github.com/ktr0731/evans)\\n- [\u8d85\u5b9e\u7528\u7684 gRPC \u5ba2\u6237\u7aef\u8c03\u8bd5\u5de5\u5177](https://cloud.tencent.com/developer/article/1892716)"},{"id":"/2023/03/23/transport-endpoint-is-not-connected","metadata":{"permalink":"/blog/2023/03/23/transport-endpoint-is-not-connected","source":"@site/blog/2023-03-23/transport-endpoint-is-not-connected.md","title":"transport endpoint is not connected\u95ee\u9898\u89e3\u51b3","description":"\u5728\u5347\u7ea7\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898, \u5347\u7ea7\u6267\u884c\u8fc7\u7a0b\u4f1adown\u8001\u7684\u73af\u5883\u5e76setup\u65b0\u7684\u73af\u5883","date":"2023-03-23T00:00:00.000Z","formattedDate":"March 23, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"umount","permalink":"/blog/tags/umount"},{"label":"fuse","permalink":"/blog/tags/fuse"}],"readingTime":1.725,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","umount","fuse"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u4f7f\u7528evans\u6765\u66f4\u52a0\u4fbf\u6377\u5730\u8c03\u8bd5grpc\u670d\u52a1","permalink":"/blog/2023/03/25/evans"},"nextItem":{"title":"TestContainers\u56fa\u5b9a\u5bb9\u5668\u7aef\u53e3","permalink":"/blog/2023/03/16/testcontainers-fixed-port"}},"content":"\u5728\u5347\u7ea7\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898, \u5347\u7ea7\u6267\u884c\u8fc7\u7a0b\u4f1a`down`\u8001\u7684\u73af\u5883\u5e76`setup`\u65b0\u7684\u73af\u5883<br/>\\n\u5728`ymir setup`\u8fc7\u7a0b\u4e2d\u51fa\u73b0`transport endpoint is not connected`, \u8be5\u95ee\u9898\u5bfc\u81f4\u5347\u7ea7\u5931\u8d25<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u539f\u56e0\\n\\n\u65e7\u73af\u5883\u6267\u884c`ymir down`\u7684\u65f6\u5019\u6ca1\u6709\u6210\u529f`detach`\u6389\u76f8\u5173\u6302\u8f7d<br/>\\n\\n\u76ee\u524d`detach`\u6302\u8f7d\u7684\u884c\u4e3a\u662f\u5728`fastone-rclone`\u5bb9\u5668\u4e2d\u8d1f\u8d23\u7684, \u5176\u6267\u884c\u539f\u7406\u662f\u5f53\u8fdb\u7a0b\u6536\u5230`sigkill`\u4fe1\u53f7(\u8be5\u4fe1\u53f7\u7531`ymir down`\u89e6\u53d1)\\n\u65f6\u8fdb\u884c\u8c03\u7528`fusermount -u /fastone-mnt`\u547d\u4ee4\u6765\u8fdb\u884c`detach`, \u6b64detach\u884c\u4e3a\u6ca1\u6267\u884c\u6210\u529f\u76ee\u524d\u63a8\u6d4b\u6709\u4ee5\u4e0b\u51e0\u79cd\u53ef\u80fd\\n\\n- \u8d85\u51fa\u4e86`ymir down`\u6700\u5927\u5bb9\u5fcd\u65f6\u95f4(`ymir down`\u5e95\u5c42\u8c03\u7528`docker-compose`\u6765\u505c\u6b62\u670d\u52a1\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u662f10s)\\n- \u5728`fastone-rclone`\u5bb9\u5668\u6536\u5230`sigkill`\u4fe1\u53f7\u5e76\u6267\u884c`detach`\u65f6\u7531\u4e8e\u8be5`devide`\u4e0b\u7684`fd`\u88ab\u76f8\u5173\u8fdb\u7a0b\u5360\u7528\u5bfc\u81f4\u65e0\u6cd5`detach`\\n  <br/>(\u5982\u679c\u5728\u5378\u8f7d\u8bbe\u5907\u6216\u6587\u4ef6\u7cfb\u7edf\u65f6, \u4ecd\u7136\u6709\u8fdb\u7a0b\u4f7f\u7528\u76f8\u5173\u6587\u4ef6\u53e5\u67c4, \u90a3\u4e48\u5378\u8f7d\u64cd\u4f5c\u901a\u5e38\u4f1a\u5931\u8d25. \u8fd9\u662f\u56e0\u4e3a`linux`\u5185\u6838\u4f1a\u68c0\u6d4b\u5230\u6709\u8fdb\u7a0b\u4ecd\u7136\u5728\u4f7f\u7528\u6587\u4ef6\u53e5\u67c4, \u56e0\u6b64\u65e0\u6cd5\u5378\u8f7d\u8bbe\u5907\u6216\u6587\u4ef6\u7cfb\u7edf.)\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n- `ymir down`\u7684\u8d85\u65f6\u65f6\u95f4\u53ef\u914d\u7f6e\u786e\u4fdd\u670d\u52a1\u80fd\u591f\u90fd\u6b63\u5e38\u6e05\u7406\u5e76\u6210\u529f\u9000\u51fa\\n- `fastone-rclone`\u670d\u52a1`detach`\u6302\u8f7d\u65f6\u9700\u8981\u5f3a\u5236`detach`, \u8003\u8651\u91c7\u7528`umount -l`\u6765\u5b9e\u73b0\u8be5\u529f\u80fd"},{"id":"/2023/03/16/testcontainers-fixed-port","metadata":{"permalink":"/blog/2023/03/16/testcontainers-fixed-port","source":"@site/blog/2023-03-16/testcontainers-fixed-port.md","title":"TestContainers\u56fa\u5b9a\u5bb9\u5668\u7aef\u53e3","description":"\u8fd9\u7bc7\u6587\u7ae0\u7684\u5185\u5bb9\u53d1\u751f\u7684\u80cc\u666f\u548c\u6d4b\u8bd5java\u7684ldap\u7684failover\u6709\u5173.","date":"2023-03-16T00:00:00.000Z","formattedDate":"March 16, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"testcontainers","permalink":"/blog/tags/testcontainers"},{"label":"docker","permalink":"/blog/tags/docker"},{"label":"ldap-failover","permalink":"/blog/tags/ldap-failover"}],"readingTime":1.205,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","testcontainers","docker","ldap-failover"]},"unlisted":false,"prevItem":{"title":"transport endpoint is not connected\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/03/23/transport-endpoint-is-not-connected"},"nextItem":{"title":"\u901a\u8fc7\u589e\u52a0timeout-control\u4ee5\u89e3\u51b3\u5f53tcp\u8fde\u63a5\u4e00\u76f4\u5904\u4e8eSYN_SENT\u72b6\u6001\u5bfc\u81f4java\u4e2d\u7684ldap-client\u7684failover\u4e0d\u5de5\u4f5c\u7684\u95ee\u9898","permalink":"/blog/2023/03/15/ldap-client-failover"}},"content":"\u8fd9\u7bc7\u6587\u7ae0\u7684\u5185\u5bb9\u53d1\u751f\u7684\u80cc\u666f\u548c\u6d4b\u8bd5`java`\u7684`ldap`\u7684`failover`\u6709\u5173.<br/>\\n\u6d4b\u8bd5`failover`\u9700\u8981\u542f\u52a8\u4e24\u4e2a`ldap`\u7684\u5bb9\u5668\u5e76`stop`\u5176\u4e2d\u4e00\u4e2a. <br/>\\n\u4f46\u662f`stop`\u5b8c\u4e4b\u540e\u9047\u5230\u4e86\u4e00\u4e2a\u95ee\u9898\u5f53\u4e0b\u6b21\u542f\u52a8\u540e\u5206\u914d\u7684\u7aef\u53e3\u4f1a\u53d8\u5316(\u8fd9\u662f\u7531\u4e8e`docker`\u7684\u5185\u90e8\u673a\u5236\u5bfc\u81f4\u7684).<br/>\\n\u63a5\u4e0b\u6765\u5c06\u4f1a\u4ecb\u7ecd\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898.\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u542f\u52a8\u5bb9\u5668\u65f6\u589e\u52a0`fixedExposedPort`\\n\\n```kotlin\\nval container = FixedHostPortGenericContainer<*>(\\"<your-docker-image>\\")\\ncontainer.withExposedPorts(389)\\ncontainer.withFixedExposedPort(\\n\\tTestSocketUtils.findAvailableTcpPort(),\\n\\t389\\n) // we need to fix the port to make sure the port is the same when the container is restarted\\n```\\n\\n### \u6ce8\u610f\u4e8b\u9879\\n\\n\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9:\\n\\n- \u521b\u5efaFixedHostPortGenericContainer\u7684\u5b9e\u4f8b\u6765\u56fa\u5b9a\u7aef\u53e3\\n  <br/>`FixedHostPortGenericContainer`\u662f`TestContainers`\u63d0\u4f9b\u7684\u4e00\u4e2a`GenericContainer`\u7684\u5b50\u7c7b, \u7528\u6765\u56fa\u5b9a\u5bb9\u5668\u7684\u7aef\u53e3\\n- \u4f7f\u7528`TestSocketUtils.findAvailableTcpPort()`\u83b7\u53d6\u4e00\u4e2a\u53ef\u7528\u7684\u7aef\u53e3\\n  <br/>\u4f7f\u7528`TestSocketUtils.findAvailableTcpPort()`\u83b7\u53d6\u4e00\u4e2a\u53ef\u7528\u7684\u7aef\u53e3\u786e\u4fdd`host`\u4e0a\u7684\u7aef\u53e3\u6ca1\u6709\u88ab\u5360\u7528\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Class TestSocketUtils](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/util/TestSocketUtils.html)\\n- [Class FixedHostPortGenericContainer\\\\<SELF extends FixedHostPortGenericContainer\\\\<SELF\\\\>\\\\>](https://javadoc.io/static/org.testcontainers/testcontainers/1.15.1/org/testcontainers/containers/FixedHostPortGenericContainer.html)\\n- [How to useFixedHostPortGenericContainerinorg.testcontainers.containers](https://www.tabnine.com/code/java/classes/org.testcontainers.containers.FixedHostPortGenericContainer)"},{"id":"/2023/03/15/ldap-client-failover","metadata":{"permalink":"/blog/2023/03/15/ldap-client-failover","source":"@site/blog/2023-03-15/ldap-client-failover.md","title":"\u901a\u8fc7\u589e\u52a0timeout-control\u4ee5\u89e3\u51b3\u5f53tcp\u8fde\u63a5\u4e00\u76f4\u5904\u4e8eSYN_SENT\u72b6\u6001\u5bfc\u81f4java\u4e2d\u7684ldap-client\u7684failover\u4e0d\u5de5\u4f5c\u7684\u95ee\u9898","description":"\u4eca\u5929\u9047\u5230\u4e00\u4e2a\u95ee\u9898\u662f\u5f53\u6d4b\u8bd5\u6a21\u62dfldap\u7684\u670d\u52a1\u7aef\u4e3b\u8282\u70b9\u6302\u6389\u7684\u65f6\u5019\u5e76\u5728\u9875\u9762\u70b9\u51fb\u767b\u5f55, \u540e\u7aef\u4e00\u76f4\u672a\u4f5c\u51fa\u54cd\u5e94.","date":"2023-03-15T00:00:00.000Z","formattedDate":"March 15, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"java","permalink":"/blog/tags/java"},{"label":"ldap","permalink":"/blog/tags/ldap"},{"label":"failover","permalink":"/blog/tags/failover"},{"label":"spring","permalink":"/blog/tags/spring"}],"readingTime":9.175,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","java","ldap","failover","spring"]},"unlisted":false,"prevItem":{"title":"TestContainers\u56fa\u5b9a\u5bb9\u5668\u7aef\u53e3","permalink":"/blog/2023/03/16/testcontainers-fixed-port"},"nextItem":{"title":"IntelliJ IDEA\u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e2d\u7684\u8bed\u6cd5\u9ad8\u4eae","permalink":"/blog/2023/03/14/intellij-idea-language-injection"}},"content":"\u4eca\u5929\u9047\u5230\u4e00\u4e2a\u95ee\u9898\u662f\u5f53\u6d4b\u8bd5\u6a21\u62df`ldap`\u7684\u670d\u52a1\u7aef\u4e3b\u8282\u70b9\u6302\u6389\u7684\u65f6\u5019\u5e76\u5728\u9875\u9762\u70b9\u51fb\u767b\u5f55, \u540e\u7aef\u4e00\u76f4\u672a\u4f5c\u51fa\u54cd\u5e94.<br/>\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u4ee3\u7801\u4e2d\u7684`ldap-client`\u7684`failover`\u672a\u751f\u6548, \u901a\u8fc7\u6392\u67e5\u53d1\u73b0`ldap-client`\u4e00\u76f4\u5728\u8fde\u63a5`ldap`\u7684\u4e3b\u8282\u70b9,\\n\u5e76\u4e14`tcp`\u8fde\u63a5\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001.<br/>\\n\u7531\u4e8e`ldap-client`\u6ca1\u6709\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6ca1\u6709\u63a7\u5236\u8d85\u65f6, \u5bfc\u81f4\u4ee3\u7801\u4e00\u76f4\u5835\u585e, \u4ece\u800c\u5bfc\u81f4`failover`\u4e0d\u5de5\u4f5c.<br/>\\n\u4e0b\u9762\u5c06\u5f00\u59cb\u4ecb\u7ecd\u5177\u4f53\u7ec6\u8282\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6392\u67e5\u8fc7\u7a0b\\n\\n### \u786e\u8ba4\u670d\u52a1\u914d\u7f6e\u7684`ldap`\u5730\u5740\u6709\u90a3\u4e9b\\n\\n\u6267\u884c`docker inspect`\u547d\u4ee4, \u786e\u8ba4\u670d\u52a1\u914d\u7f6e\u7684`ldap`\u5730\u5740\\n\\n```log\\nsudo docker inspect fastone-api |grep \'spring.ldap.urls\'\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\n                \\"spring.ldap.urls=ldap://10.0.3.16:389,ldap://10.0.3.3:389\\",\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u914d\u7f6e\u4e86\u4e24\u4e2a`ldap`\u5730\u5740\u5206\u522b\u4e3a\\n\\n- ldap://10.0.3.16:389\\n- ldap://10.0.3.3:389\\n\\n### \u786e\u8ba4\u670d\u52a1\u7684\u8fdb\u7a0bID\\n\\n\u6267\u884c`ps`\u547d\u4ee4, \u786e\u8ba4\u670d\u52a1\u7684\u8fdb\u7a0bID\\n\\n```bash\\nps -ef |grep FastoneApplication\\n```\\n\\n\u547d\u4ee4\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nubuntu   22663 14459  0 16:52 pts/5    00:00:00 grep --color=auto FastoneApplication\\nroot     31320 31246  1 14:23 ?        00:02:39 java -cp @/app/jib-classpath-file com.fastonetech.fastone.FastoneApplication\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u8fdb\u7a0bID\u4e3a`31320`, \u63a5\u4e0b\u6765\u901a\u8fc7`lsof`\u547d\u4ee4\u67e5\u770b`31320`\u8fdb\u7a0b\u7684`tcp`\u8fde\u63a5\u72b6\u6001<br/>\\n\\n### \u786e\u8ba4\u670d\u52a1\u8fdb\u7a0b\u7684`tcp`\u8fde\u63a5\u72b6\u6001\\n\\n\u901a\u8fc7`lsof`\u67e5\u770b`tcp`\u8fde\u63a5\u72b6\u6001\\n\\n```bash\\nsudo lsof -p 31320 |grep \'10.0.3.16\'\\n```\\n\\n\u547d\u4ee4\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\njava    31320 root  506u     IPv6            5728853       0t0     TCP fastone:37408->10.0.3.16:ldap (SYN_SENT)\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u8fdb\u7a0b\u7684`tcp`\u8fde\u63a5\u72b6\u6001\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001.<br/>\\n\\n> `SYN_SENT`\u72b6\u6001\u7684\u8fde\u63a5, \u8bf4\u660e\u5ba2\u6237\u7aef\u5df2\u7ecf\u53d1\u9001\u4e86`SYN`\u5305, \u4f46\u662f\u6ca1\u6709\u6536\u5230`SYN/ACK`\u5305, \u6b64\u65f6\u4f1a\u5904\u4e8e`SYN_SENT`\u72b6\u6001<br/>\\n\\n## Workaround\\n\\n\u7531\u4e8e\u8fd9\u4e2a\u95ee\u9898\u4f1a`blocking`\u6d4b\u8bd5\u8fdb\u5ea6\u6240\u4ee5\u9700\u8981\u5148\u7ed9\u51fa\u4e00\u4e2a`workaround`\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898.<br/>\\n\u76ee\u524d\u7684\u89e3\u51b3\u65b9\u6848\u662f\u901a\u8fc7`iptables`\u9650\u5236`tcp`\u8fde\u63a5, \u4f7f\u5176\u76f4\u63a5`Connection refused`. \u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u6d4b\u8bd5\u80fd\u591f\u7ee7\u7eed\u8fdb\u884c<br/>\\n\\n### \u901a\u8fc7`iptables`\u65b0\u589e`OUTPUT`\u89c4\u5219\u4f7f`tcp`\u8fde\u63a5\u76f4\u63a5\u5931\u8d25\\n\\n- \u65b0\u589eOUTPUT\u89c4\u5219\\n\\n> \u6ce8\u610f`target`\u5e94\u8be5\u4e3a`REJECT`\u800c\u4e0d\u662f`DROP`.<br/>\\n> \u8fd9\u662f\u56e0\u4e3a`DROP`\u5bf9\u4e8e`tcp`\u8fde\u63a5\u6765\u8bf4, \u4f1a\u76f4\u63a5\u4e22\u5f03\u6570\u636e\u5305.<br/>\\n> \u6240\u4ee5\u9700\u8981\u4f7f\u7528`REJECT`\u6765\u62d2\u7edd\u8fde\u63a5, \u5e76\u4e14\u9700\u8981\u6307\u5b9a`--reject-with tcp-reset`\u6765\u62d2\u7edd\u8fde\u63a5.<br/>\\n> \u8fd9\u6837\u5ba2\u6237\u7aef\u4f1a\u77e5\u9053\u8fde\u63a5\u88ab\u62d2\u7edd\u4e86\u800c\u4e0d\u662f\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001.<br/>\\n\\n```bash\\nsudo iptables -A OUTPUT -p tcp -d 10.0.3.16 --dport 389 -j REJECT --reject-with tcp-reset\\n```\\n\\n- \u67e5\u770b\u89c4\u5219\u5217\u8868\\n\\n```bash\\nsudo iptables -L OUTPUT -v -n\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nChain OUTPUT (policy ACCEPT 301 packets, 95101 bytes)\\npkts bytes target     prot opt in     out     source               destination         \\n0     0 REJECT     tcp  --  *      *       0.0.0.0/0            10.0.3.16            tcp dpt:389 reject-with tcp-reset\\n```\\n\\n\u53ef\u4ee5\u770b\u5230, \u65b0\u589e\u4e86\u4e00\u6761`REJECT`\u89c4\u5219<br/>\\n\\n- \u6d4b\u8bd5\u89c4\u5219\u662f\u5426\u751f\u6548\\n\\n```bash\\ntelnet 10.0.3.16 389\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nTrying 10.0.3.16...\\ntelnet: Unable to connect to remote host: Connection refused\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u8fde\u63a5\u88ab\u62d2\u7edd\u4e86, \u8bf4\u660e\u89c4\u5219\u751f\u6548\u4e86<br/>\\n\\n### \u5220\u9664\u89c4\u5219\\n\\n\u5f53\u4fee\u590d\u4ee3\u7801\u540e, \u9700\u8981\u5220\u9664\u89c4\u5219, \u4ee5\u4fbf\u6d4b\u8bd5\u7ee7\u7eed\u8fdb\u884c<br/>\\n\\n- \u5220\u9664\u89c4\u5219\\n\\n```bash\\nsudo iptables -D OUTPUT -p tcp -d 10.0.3.16 --dport 389 -j REJECT --reject-with tcp-reset\\n```\\n\\n- \u67e5\u770b\u89c4\u5219\u5217\u8868\\n\\n```bash\\nsudo iptables -L OUTPUT -v -n\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nChain OUTPUT (policy ACCEPT 1922 packets, 947K bytes)\\n pkts bytes target     prot opt in     out     source               destination    \\n```\\n\\n- \u786e\u8ba4\u8fde\u63a5\u72b6\u6001\u6062\u590d\u5982\u521d\\n\\n```bash\\ntelnet 10.0.3.16 389\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nTrying 10.0.3.16...\\n^C\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u8fde\u63a5\u72b6\u6001\u6062\u590d\u5982\u521d, \u5ba2\u6237\u7aef\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001<br/>\\n\\n## \u95ee\u9898\u539f\u56e0\\n\\n\u6839\u636e\u4e0a\u9762\u7684\u5206\u6790, \u95ee\u9898\u7684\u539f\u56e0`TCP`\u8fde\u63a5\u72b6\u6001\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001\u5bfc\u81f4`ldap`\u7684`failover`\u672a\u751f\u6548<br/>\\n\\n### \u504f\u79bb\u8bbe\u8ba1\u9884\u671f\\n\\n\u8fd9\u91cc\u8ddf\u6211\u4e00\u5f00\u59cb\u8bbe\u8ba1\u6709\u504f\u5dee, \u56e0\u4e3a\u6211\u4e00\u5f00\u59cb\u7684\u8bbe\u60f3\u7684\u9884\u671f\u5e94\u8be5\u662f\u76f4\u63a5`Connection refused`, \u7c7b\u4f3c\u5982\u4e0b\u884c\u4e3a\\n\\n#### \u975e\u5835\u585e\\n\\n```bash\\ntelnet localhost 389\\n```\\n\\n\u5f53\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u65f6, \u4f1a\u76f4\u63a5\u62a5\u9519\\n\\n```log\\nTrying 127.0.0.1...\\ntelnet: Unable to connect to remote host: Connection refused\\n```\\n\\n\u670d\u52a1\u7aef\u4f1a\u76f4\u63a5\u62d2\u7edd\u8fde\u63a5, \u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u8fd9\u6837\u7684\u884c\u4e3a, \u670d\u52a1\u7aef\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001, \u4e5f\u5c31\u662f\u8bf4\u670d\u52a1\u7aef\u4e00\u76f4\u5728\u5c1d\u8bd5\u8fde\u63a5<br/>\\n\\n#### \u5835\u585e\\n\\n\u7c7b\u4f3c\u5982\u4e0b\u884c\u4e3a\\n\\n```bash\\ntelnet 10.0.3.16 389\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b\\n\\n```log\\nTrying 10.0.3.16...\\n^C\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u4e00\u76f4\u5728\u5c1d\u8bd5\u8fde\u63a5, \u4f46\u662f\u5e76\u6ca1\u6709\u8d85\u65f6, \u4e5f\u5c31\u662f\u8bf4\u4e00\u76f4\u5728\u5c1d\u8bd5\u8fde\u63a5<br/>\\n\\n### `ldap-client`\u7684`timeout-control`\u672a\u751f\u6548\\n\\n\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\u662f`tpc`\u4e00\u76f4\u5904\u4e8e`SYN_SENT`\u72b6\u6001\u7406\u8bba\u6765\u8bf4\u5e94\u8be5\u89e6\u53d1`timeout-control`, \u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u89e6\u53d1<br/>\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u770b\u4e00\u4e0b`java-ldap`\u4e2d\u662f\u5982\u4f55\u5b9e\u73b0`timeout-control`\u7684<br/>\\n\\n#### \u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\\n\\n\u5728`java`\u4e2d`ldap`\u7684\u8fde\u63a5\u662f\u7531`com.sun.jndi.ldap.LdapCtx.connectTimeout`\u63a7\u5236\u7684.<br/>\\n\u53c2\u8003\u4ee3\u7801\u5982\u4e0b\\n\\n```java\\npublic final class LdapCtx extends ComponentDirContext\\n\\timplements EventDirContext, LdapContext {\\n\\n\\tprivate int connectTimeout = -1;         // no timeout value\\n\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230`connectTimeout`\u9ed8\u8ba4\u503c\u4e3a`-1`, \u4e5f\u5c31\u662f\u8bf4\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u6ca1\u6709\u8d85\u65f6\u7684. \u8fd9\u5176\u5b9e\u4e0d\u5408\u7406, \u56e0\u4e3a\u7f51\u7edc\u8fde\u63a5\u662f\u6709\u8d85\u65f6\u7684,\\n\u5426\u5219\u4f1a\u5bfc\u81f4\u4ee3\u7801\u4e00\u76f4\u5835\u585e<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u7ee7\u627f`LdapContextSource`\u5e76\u589e\u52a0`timeout-control`\u914d\u7f6e\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b`ldap`\u662f\u6ca1\u6709`timeout-control`\u7684, \u4e0d\u8fc7\u5176\u63d0\u4f9b\u4e86\u914d\u7f6e`connectTimeout`\u7684\u65b9\u6cd5, \u662f\u901a\u8fc7`environment`\u6765\u914d\u7f6e\u7684.<br/>\\n\u5bf9\u4e8e\u4e0a\u5c42\u5e94\u7528\u6765\u8bf4\u6211\u4eec\u7528\u7684\u662f\u901a\u8fc7`spring`\u5c01\u88c5\u8fc7\u7684`ldap`, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u4e8e`spring`\u8fdb\u884c\u6269\u5c55,\\n\u4e3b\u8981\u662f\u901a\u8fc7\u7ee7\u627f`LdapContextSource`\u6765\u5b9e\u73b0<br/>\\n\\n```java title=\\"WithMoreEnvironmentContextSource.java\\"\\n/**\\n * The extension of {@link LdapContextSource} to support more environment.\\n * Sometimes we need to set more environment to environment.\\n * For example, we need to set the connectTimeout to avoid thread blocking and makesure the failover works.\\n * For more details about the connectTimeout, see {@link com.sun.jndi.ldap.LdapCtx.connectTimeout}\\n * For more details about the readTimeout, see {@link com.sun.jndi.ldap.LdapCtx.readTimeout}\\n * For more details about the ldap failover, see {@link com.sun.jndi.ldap.LdapCtxFactory#getUsingURLs}\\n *\\n * @author Xiangcheng.Kuo\\n */\\npublic class WithMoreEnvironmentContextSource extends LdapContextSource {\\n\\n\\tprivate Integer connectTimeout = -1;\\n\\n\\tprivate Integer readTimeout = -1;\\n\\n\\tpublic void setConnectTimeout(Integer connectTimeout) {\\n\\t\\tthis.connectTimeout = connectTimeout;\\n\\t}\\n\\n\\tpublic void setReadTimeout(Integer readTimeout) {\\n\\t\\tthis.readTimeout = readTimeout;\\n\\t}\\n\\n\\t@Override\\n\\tprotected DirContext getDirContextInstance(Hashtable<String, Object> environment) throws NamingException {\\n\\t\\t// The module named \\"com.sun.jndi.ldap.LdapCtx\\" is not exported.\\n\\t\\t// So we can\'t use the following code\\n\\t\\t// LdapCtx.CONNECT_TIMEOUT\\n\\t\\t// For more information about CONNECT_TIMEOUT\\n\\t\\t// see 1. LdapCtx.initEnv 2. Connection.createSocket\\n\\t\\tenvironment.put(\\"com.sun.jndi.ldap.connect.timeout\\", connectTimeout.toString());\\n\\t\\tenvironment.put(\\"com.sun.jndi.ldap.read.timeout\\", readTimeout.toString());\\n\\t\\treturn super.getDirContextInstance(environment);\\n\\t}\\n\\n}\\n```\\n\\n### \u5c06`WithMoreEnvironmentContextSource`\u6dfb\u52a0\u5230\u5bb9\u5668\u4e2d\\n\\n\u63a5\u4e0b\u6765\u9700\u8981\u5c06`WithMoreEnvironmentContextSource`\u6dfb\u52a0\u5230\u5bb9\u5668\u4e2d, \u786e\u4fdd\u4e0a\u5c42\u7684\u4f9d\u8d56\u5982`LdapTemplate`\u4ee5\u53ca\u81ea\u5b9a\u4e49\u7684`Reposity`\\n\u4f7f\u7528\u5230\u6211\u4eec\u6269\u5c55\u7684`LdapContextSource`<br/>\\n\\n```java title=\\"LdapConfiguration.java\\"\\n\\n@Configuration\\npublic class LdapConfiguration {\\n\\n\\t@Bean\\n\\tpublic LdapContextSource ldapContextSource(\\n\\t\\tLdapProperties properties,\\n\\t\\tEnvironment environment,\\n\\t\\tObjectProvider<DirContextAuthenticationStrategy> dirContextAuthenticationStrategy\\n\\t) {\\n\\t\\t// copy from org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration#ldapContextSource\\n\\t\\tWithMoreEnvironmentContextSource source = new WithMoreEnvironmentContextSource();\\n\\t\\tdirContextAuthenticationStrategy.ifUnique(source::setAuthenticationStrategy);\\n\\t\\tPropertyMapper propertyMapper = PropertyMapper.get().alwaysApplyingWhenNonNull();\\n\\t\\tpropertyMapper.from(properties.getUsername()).to(source::setUserDn);\\n\\t\\tpropertyMapper.from(properties.getPassword()).to(source::setPassword);\\n\\t\\tpropertyMapper.from(properties.getAnonymousReadOnly()).to(source::setAnonymousReadOnly);\\n\\t\\tpropertyMapper.from(properties.getBase()).to(source::setBase);\\n\\t\\tpropertyMapper.from(properties.determineUrls(environment)).to(source::setUrls);\\n\\t\\tpropertyMapper.from(properties.getBaseEnvironment()).to(\\n\\t\\t\\t(baseEnvironment) -> source.setBaseEnvironmentProperties(Collections.unmodifiableMap(baseEnvironment)));\\n\\n\\t\\t// We need to make sure the failover works fast when using multiple ldap backend\\n\\t\\tif (properties.getUrls().length > 1) {\\n\\t\\t\\tsource.setConnectTimeout(2000);\\n\\t\\t\\tsource.setReadTimeout(2000);\\n\\t\\t}\\n\\n\\t\\treturn source;\\n\\t}\\n\\n}\\n```\\n\\n\u4e3b\u8981\u4ee3\u7801\u590d\u5236\u81ea`org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration#ldapContextSource`,\\n\u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003\u5176\u6e90\u7801<br/>\\n\\n## \u5907\u6ce8\\n\\n### \u5f53`iptables`\u89c4\u5219\u8f83\u591a\u81ea\u5b9a\u4e49\u7684\u53d7\u5f71\u54cd, \u5982\u4e0b\u6240\u793a\\n\\n```bash\\nsudo iptables -L OUTPUT -v -n\\n```\\n\\n```log\\nChain OUTPUT (policy ACCEPT 186K packets, 95M bytes)\\n pkts bytes target     prot opt in     out     source               destination         \\n    0     0 DROP       tcp  --  *      *       10.0.3.16            0.0.0.0/0            tcp dpt:3306\\n    0     0 DROP       tcp  --  *      *       10.0.3.16            0.0.0.0/0            tcp dpt:389\\n    0     0 DROP       tcp  --  *      *       10.0.3.16            0.0.0.0/0            tcp spt:389\\n    0     0 DROP       tcp  --  *      *       10.0.3.16            0.0.0.0/0            tcp spt:389\\n   63  3276 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:389\\n    0     0 REJECT     tcp  --  *      *       0.0.0.0/0            10.0.3.16            tcp dpt:389 reject-with tcp-reset\\n```\\n\\n\u9700\u8981\u6e05\u7a7a\u6240\u6709OUTPUT\u89c4\u5219\\n\\n```bash\\nsudo iptables -F OUTPUT\\n```\\n\\n\u91cd\u65b0\u67e5\u770bOUTPUT\u89c4\u5219\\n\\n```bash\\nsudo iptables -L OUTPUT -v -n\\n```\\n\\n```log\\nChain OUTPUT (policy ACCEPT 1883 packets, 1126K bytes)\\n pkts bytes target     prot opt in     out     source               destination      \\n```\\n\\n## \u53c2\u8003\\n\\n- [What means SYN_SENT status in a socket?](https://medium.com/devsys/what-means-syn-sent-status-in-a-socket-5ea03eaf6ca9)\\n- [Viewing NETSTAT Information](https://www.cisco.com/assets/sol/sb/CVR100W_GUI_EN/help/EN_help/status13.html)\\n- [What is SYN_SENT socket status?](http://karunsubramanian.com/network/what-is-syn_sent-socket-status/)\\n- [REJECT vs. DROP When Using iptables](https://www.baeldung.com/linux/iptables-reject-vs-drop)\\n- [REJECT vs DROP when using iptables](https://serverfault.com/questions/157375/reject-vs-drop-when-using-iptables)\\n- [A way to define / implement failover ldap servers in java code](https://stackoverflow.com/questions/40218516/a-way-to-define-implement-failover-ldap-servers-in-java-code)\\n- [Setting Timeout for Ldap Operations](https://docs.oracle.com/javase/tutorial/jndi/newstuff/readtimeout.html)"},{"id":"/2023/03/14/intellij-idea-language-injection","metadata":{"permalink":"/blog/2023/03/14/intellij-idea-language-injection","source":"@site/blog/2023-03-14/intellij-idea-language-injection.md","title":"IntelliJ IDEA\u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e2d\u7684\u8bed\u6cd5\u9ad8\u4eae","description":"\u8fd9\u7bc7\u6587\u7ae0\u662f\u57fa\u4e8eclojure\u8868\u8fbe\u5f0f\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1\u7684\u540e\u7eed\u4f18\u5316\u7684\u6587\u7ae0.","date":"2023-03-14T00:00:00.000Z","formattedDate":"March 14, 2023","tags":[{"label":"intellij-idea","permalink":"/blog/tags/intellij-idea"}],"readingTime":1.325,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["intellij-idea"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u589e\u52a0timeout-control\u4ee5\u89e3\u51b3\u5f53tcp\u8fde\u63a5\u4e00\u76f4\u5904\u4e8eSYN_SENT\u72b6\u6001\u5bfc\u81f4java\u4e2d\u7684ldap-client\u7684failover\u4e0d\u5de5\u4f5c\u7684\u95ee\u9898","permalink":"/blog/2023/03/15/ldap-client-failover"},"nextItem":{"title":"\u4f7f\u7528IntelliJ IDEA\u4e2d\u7684java-decompiler\u63d2\u4ef6\u5c06jar\u5305\u53cd\u7f16\u8bd1\u4e3ajava\u6e90\u7801","permalink":"/blog/2023/03/13/intellij-idea-java-decompiler"}},"content":"\u8fd9\u7bc7\u6587\u7ae0\u662f[\u57fa\u4e8e`clojure`\u8868\u8fbe\u5f0f\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1](/blog/2023/03/02/clojure-validation)\u7684\u540e\u7eed\u4f18\u5316\u7684\u6587\u7ae0.<br/>\\n\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u5b9e\u73b0\u5728`IntelliJ IDEA`\u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e2d`clojure`\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u9ad8\u4eae\u95ee\u9898.<br/>\\n\u901a\u8fc7\u8bed\u6cd5\u9ad8\u4eae, \u53ef\u4ee5\u66f4\u52a0\u76f4\u89c2\u7684\u770b\u5230\u8868\u8fbe\u5f0f\u7684\u7ed3\u6784, \u4ee5\u53ca\u8868\u8fbe\u5f0f\u4e2d\u7684\u9519\u8bef. \u4ece\u800c\u66f4\u52a0\u4fbf\u6377\u5730\u5b9e\u73b0\u8868\u8fbe\u5f0f\u7684\u7f16\u5199.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u8981\u6c42\\n\\n`IntelliJ IDEA`\u4e2d\u9700\u8981\u5b89\u88c5\u4ee5\u4e0b\u63d2\u4ef6\\n\\n- `cursive`(\u6b64\u63d2\u4ef6\u662f`clojure`\u8bed\u8a00\u7684\u652f\u6301\u63d2\u4ef6, \u5e76\u4e14\u652f\u6301`clojure`\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u9ad8\u4eae.)\\n- `IntelliLang`(`Make sure that the IntelliLang plugin is enabled before you start working with language injections.`)\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u4ee3\u7801\u4e2d\u589e\u52a0`@Language`\u6ce8\u89e3, \u5982\u4e0b\u6240\u793a\\n\\n```kotlin title=\\"ClojureExpressionConstraint.kt\\"\\nannotation class ClojureExpressionConstraint(\\n\\tval message: String,\\n\\tval groups: Array<KClass<*>> = [],\\n\\tval payload: Array<KClass<out Payload>> = [],\\n\\t@Language(\\"clojure\\") // to enable syntax highlighting\\n\\tval value: String,\\n)\\n```\\n\\n## \u6548\u679c\u5c55\u793a\\n\\n\u5b9e\u73b0\u540e\u7684\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a\\n\\n![idea-clojure-syntax-highlighting](./intellij-idea-language-injection.jpeg)\\n\\n\u53ef\u4ee5\u770b\u5230, \u5f53\u9f20\u6807\u60ac\u6d6e\u5230\u8868\u8fbe\u5f0f\u5f15\u7528\u7684\u5730\u65b9\u65f6, \u4f1a\u6709\u76f8\u5e94\u7684\u63d0\u793a\u4fe1\u606f.<br/>\\n\\n## \u53c2\u8003\\n\\n- [Language injections](https://www.jetbrains.com/help/idea/using-language-injections.html)"},{"id":"/2023/03/13/intellij-idea-java-decompiler","metadata":{"permalink":"/blog/2023/03/13/intellij-idea-java-decompiler","source":"@site/blog/2023-03-13/intellij-idea-java-decompiler.md","title":"\u4f7f\u7528IntelliJ IDEA\u4e2d\u7684java-decompiler\u63d2\u4ef6\u5c06jar\u5305\u53cd\u7f16\u8bd1\u4e3ajava\u6e90\u7801","description":"\u6709\u7684\u65f6\u5019\u9700\u8981\u5c06jar\u5305\u4e2d\u7684class\u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3ajava\u6e90\u7801\u6587\u4ef6\u5e76\u5bf9\u5176\u884c\u4e3a\u8fdb\u884c\u5206\u6790.","date":"2023-03-13T00:00:00.000Z","formattedDate":"March 13, 2023","tags":[{"label":"java","permalink":"/blog/tags/java"},{"label":"decompiler","permalink":"/blog/tags/decompiler"},{"label":"intellij-idea","permalink":"/blog/tags/intellij-idea"}],"readingTime":1.425,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["java","decompiler","intellij-idea"]},"unlisted":false,"prevItem":{"title":"IntelliJ IDEA\u4e2d\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e2d\u7684\u8bed\u6cd5\u9ad8\u4eae","permalink":"/blog/2023/03/14/intellij-idea-language-injection"},"nextItem":{"title":"SSH\u547d\u4ee4\u65e0\u6cd5\u521b\u5efa\u8fdc\u7a0b\u8fde\u63a5","permalink":"/blog/2023/03/09/ssh-execution-timeout"}},"content":"\u6709\u7684\u65f6\u5019\u9700\u8981\u5c06`jar`\u5305\u4e2d\u7684`class`\u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3a`java`\u6e90\u7801\u6587\u4ef6\u5e76\u5bf9\u5176\u884c\u4e3a\u8fdb\u884c\u5206\u6790.<br/>\\n`IntelliJ IDEA`\u4e2d\u7684`java-decompiler`\u63d2\u4ef6\u53ef\u4ee5\u5c06`jar`\u5305\u4e2d\u7684`class`\u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3a`java`\u6e90\u7801\u6587\u4ef6.<br/>\\n\u4e0b\u9762\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`IntelliJ IDEA`\u4e2d\u7684`java-decompiler`\u63d2\u4ef6\u5c06`jar`\u5305\u53cd\u7f16\u8bd1\u4e3a`java`\u6e90\u7801.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u83b7\u53d6`java-decompiler`\u63d2\u4ef6\\n\\n\u4ece`IDEA`\u5b89\u88c5\u76ee\u5f55\u4e0b\u7684`plugins/java-decompiler/lib`\u76ee\u5f55\u4e0b\u83b7\u53d6`java-decompiler.jar`.<br/>\\n\u5982\u679c\u6ca1\u6709\u5b89\u88c5`java-decompiler`\u63d2\u4ef6,\u53ef\u4ee5\u4ece[\u70b9\u51fb\u8fd9\u91cc](java-decompiler.jar)\u4e0b\u8f7d\\n\\n### \u53cd\u7f16\u8bd1`jar`\u5305\\n\\n\u76ee\u524d`java-decompiler`\u53cd\u7f16\u8bd1\u540e\u7684\u7684\u6e90\u7801\u6587\u4ef6\u662f\u6253\u5305\u5728`jar`\u5305\u4e2d\u7684,\u9700\u8981\u5c06\u5176\u89e3\u538b\u51fa\u6765. <br/>\\n\u8fd9\u6837\u6bd4\u8f83\u4e0d\u65b9\u4fbf, \u4e0b\u9762\u6211\u63d0\u4f9b\u4e00\u4e2a\u811a\u672c\u6765\u53cd\u7f16\u8bd1\u4ee5\u53ca\u89e3\u538b`jar`\u5305\u4e2d\u7684\u6e90\u7801\u6587\u4ef6.<br/>\\n\\n```bash title=\\"decompile.sh\\"\\n#!/bin/bash\\n\\nset -ex\\n\\nJAR_FILE_PATH=$(realpath $1)\\nDEST_DIRECTORY=$(realpath $2)\\n\\nrm -rf $DEST_DIRECTORY\\nmkdir $DEST_DIRECTORY\\njava -cp java-decompiler.jar org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -hdc=0 -dgs=1 -rsy=1 -rbr=1 -lit=1 -nls=1 -mpm=60 $JAR_FILE_PATH $DEST_DIRECTORY\\nunzip $DEST_DIRECTORY/$(basename $JAR_FILE_PATH) -d $DEST_DIRECTORY\\n```\\n\\n\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\\n\\n```bash\\n./decompile.sh drm-control.jar ./decompiled\\n```\\n\\n\u8fd9\u4e2a\u811a\u672c\u4f1a\u5c06`drm-control.jar`\u53cd\u7f16\u8bd1\u4e3a`java`\u6e90\u7801\u6587\u4ef6\u5e76\u89e3\u538b\u5230`./decompiled`\u76ee\u5f55\u4e0b.<br/>\\n\\n## \u53c2\u8003\\n\\n- [How to decompile to java files intellij idea](https://stackoverflow.com/questions/28389006/how-to-decompile-to-java-files-intellij-idea)\\n- [java-decompiler](https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine)\\n- [java-decompiler](java-decompiler.jar)\\n- [decompile.sh](decompile.sh)"},{"id":"/2023/03/09/ssh-execution-timeout","metadata":{"permalink":"/blog/2023/03/09/ssh-execution-timeout","source":"@site/blog/2023-03-09/ssh-execution-timeout.md","title":"SSH\u547d\u4ee4\u65e0\u6cd5\u521b\u5efa\u8fdc\u7a0b\u8fde\u63a5","description":"\u4eca\u5929\u7ebf\u4e0a\u51fa\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898, \u6b64\u95ee\u9898\u7684\u73b0\u8c61\u662f\u7528\u6237\u5728\u9875\u9762\u4e0a\u70b9\u51fb\u521b\u5efaVNC\u8fdc\u7a0b\u94fe\u63a5\u4f1a\u7b49\u5f85\u5f88\u4e45\u4e14\u54cd\u5e94\u5931\u8d25","date":"2023-03-09T00:00:00.000Z","formattedDate":"March 9, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"ssh","permalink":"/blog/tags/ssh"},{"label":"ldap","permalink":"/blog/tags/ldap"}],"readingTime":5.965,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","ssh","ldap"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528IntelliJ IDEA\u4e2d\u7684java-decompiler\u63d2\u4ef6\u5c06jar\u5305\u53cd\u7f16\u8bd1\u4e3ajava\u6e90\u7801","permalink":"/blog/2023/03/13/intellij-idea-java-decompiler"},"nextItem":{"title":"\u4f7f\u7528spring\u6784\u5efanative\u9047\u5230\u7684\u95ee\u9898","permalink":"/blog/2023/03/06/problem-build-native-springboot-application"}},"content":"\u4eca\u5929\u7ebf\u4e0a\u51fa\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898, \u6b64\u95ee\u9898\u7684\u73b0\u8c61\u662f\u7528\u6237\u5728\u9875\u9762\u4e0a\u70b9\u51fb\u521b\u5efa`VNC`\u8fdc\u7a0b\u94fe\u63a5\u4f1a\u7b49\u5f85\u5f88\u4e45\u4e14\u54cd\u5e94\u5931\u8d25<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a`ssh`\u547d\u4ee4\u6267\u884c\u8d85\u65f6, `ssh`\u547d\u4ee4\u8d85\u65f6\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u6bcf\u6b21`ssh`\u6267\u884c\u547d\u4ee4\u65f6\u9700\u8981\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1,\\n\u7cfb\u7edf\u4e2d\u63a5\u5165\u4e86\u5916\u7f6e\u8ba4\u8bc1\u7cfb\u7edf`ldap`\u8fdb\u884c\u8ba4\u8bc1, \u4f46\u7531\u4e8e\u8bbf\u95ee\u5916\u90e8\u8ba4\u8bc1\u670d\u52a1\u5f88\u6162\u5bfc\u81f4\u89e6\u53d1\u4e86\u8d85\u65f6.<br/>\\n\u8ba4\u8bc1\u670d\u52a1\u5bf9\u5e94`lb`\u4f1a\u8f6c\u53d1\u5230\u51fa\u95ee\u9898\u7684`ldap`\u670d\u52a1\u5668, \u4ece\u800c\u5bfc\u81f4\u8ba4\u8bc1\u670d\u52a1\u8bbf\u95ee\u5f88\u6162.<br/>\\n\\n## \u6392\u67e5\u8fc7\u7a0b\\n\\n### 1. \u67e5\u770b\u540e\u7aef\u670d\u52a1\u65e5\u5fd7\\n\\n\u540e\u7aef\u65e5\u5fd7\u5982\u4e0b<br/>\\n\\n```bash\\n2023-03-09 10:34:37\\t2023-03-09T02:34:36.844168954Z stdout F 2023-03-09 02:34:36.844  INFO 1 --- [nio-2000-exec-6] c.f.c.s.c.LocalAuthenticationProvider    : into local DB authenticate, user is::foo\\n2023-03-09 10:34:40\\t2023-03-09T02:34:40.258742954Z stdout F 2023-03-09 02:34:40.258  INFO 1 --- [io-2000-exec-11] com.jcabi.ssh.Execution$Default          : $ getent passwd foo | awk -F: \'{print $6}\'\\n2023-03-09 10:34:44\\t2023-03-09T02:34:44.382676144Z stdout F 2023-03-09 02:34:44.382  INFO 1 --- [io-2000-exec-11] com.jcabi.ssh.Execution$Default          : $ sudo -i -u foo mkdir -p /fastone/users/foo/.foo\\n2023-03-09 10:34:49\\t2023-03-09T02:34:49.36267293Z stdout F 2023-03-09 02:34:49.362  INFO 1 --- [io-2000-exec-11] com.jcabi.ssh.Execution$Default          : $ echo -e \\"foo\\\\foo\\\\nn\\\\n\\" | sudo -i -u foo sh -c \\"VNC_HOME=/fastone/users/foo/.foo vncserver -nolisten unix -listen tcp -maxclients 512 2>&1\\"\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.409356857Z stdout F 2023-03-09 02:35:04.409  WARN 1 --- [io-2000-exec-11] com.jcabi.ssh.Ssh                        : an exception during authentication\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.409378051Z stdout F java.net.SocketTimeoutException: Read timed out\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.410988161Z stdout F 2023-03-09 02:35:04.410 ERROR 1 --- [io-2000-exec-11] c.f.common.ssh.client.SshClient          : \u547d\u4ee4\u6267\u884c\u5931\u8d25!\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.411003386Z stdout F\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.411007586Z stdout F java.io.IOException: com.jcraft.jsch.JSchException: Auth fail\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.411011213Z stdout F \\tat com.jcabi.ssh.Ssh.session(Ssh.java:281) ~[jcabi-ssh-1.6.1.jar:na]\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.411014796Z stdout F \\tat com.jcabi.ssh.AbstractSshShell.exec(AbstractSshShell.java:95) ~[jcabi-ssh-1.6.1.jar:na]\\n2023-03-09 10:35:04\\t2023-03-09T02:35:04.41101828Z stdout F \\tat com.jcabi.ssh.Ssh.exec(Ssh.java:77) ~[jcabi-ssh-1.6.1.jar:na]\\n```\\n\\n\u5728\u4ee3\u7801\u4e2d, \u6211\u4eec\u4f7f\u7528\u4e86`jcabi-ssh`\u6765\u6267\u884c`ssh`\u547d\u4ee4.<br/>\\n\u6574\u4e2a\u521b\u5efa`VNC`\u8fdc\u7a0b\u8fde\u63a5\u7684\u4e8b\u52a1\u9700\u8981\u6267\u884c\u56db\u6761`ssh`\u547d\u4ee4, \u524d\u4e09\u6761\u547d\u4ee4\u90fd\u6267\u884c\u6210\u529f\u4e86, \u4f46\u662f\u6700\u540e\u4e00\u6761\u547d\u4ee4\u6267\u884c\u5931\u8d25\u4e86<br/>\\n\u62a5\u9519\u4fe1\u606f\u5982\u4e0b<br/>\\n\\n```log\\njava.net.SocketTimeoutException: Read timed out\\njava.io.IOException: com.jcraft.jsch.JSchException: Auth fail\\n```\\n\\n### 2. \u767b\u5f55\u670d\u52a1\u5668\u5e76\u67e5\u770b`sshd`\u65e5\u5fd7\\n\\n\u9996\u5148\u9700\u8981\u770b\u4e0b`sshd`\u7684\u65e5\u5fd7, \u901a\u8fc7`journalctl`\u547d\u4ee4\u67e5\u770b<br/>\\n\\n```bash\\nsudo journalctl -t sshd\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b<br/>\\n\\n```log\\nMar 09 02:34:38 desktop-1 sshd[11758]: Accepted publickey for fastone from 10.0.109.90 port 49590 ssh2: RSA SHA256:\\nsqOIF4lpjrA0+1At5dDQRZgcwWEK+oO1Lwv9fad\\nMar 09 02:34:38 desktop-1 sshd[11758]: pam_unix(sshd:session): session opened for user fastone by (uid=0)\\nMar 09 02:34:41 desktop-1 sshd[11758]: pam_unix(sshd:session): session closed for user fastone\\nMar 09 02:34:42 desktop-1 sshd[11766]: Accepted publickey for fastone from 10.0.109.90 port 57700 ssh2: RSA SHA256:\\nsqOIF4lpjrA0+1At5dDQRZgcwWEK+oO1Lwv9fad\\nMar 09 02:34:42 desktop-1 sshd[11766]: pam_unix(sshd:session): session opened for user fastone by (uid=0)\\nMar 09 02:34:46 desktop-1 sshd[11766]: pam_unix(sshd:session): session closed for user fastone\\nMar 09 02:34:47 desktop-1 sshd[11778]: Accepted publickey for fastone from 10.0.109.90 port 57710 ssh2: RSA SHA256:\\nsqOIF4lpjrA0+1At5dDQRZgcwWEK+oO1Lwv9fad\\nMar 09 02:34:47 desktop-1 sshd[11778]: pam_unix(sshd:session): session opened for user fastone by (uid=0)\\nMar 09 02:34:54 desktop-1 sshd[11778]: pam_unix(sshd:session): session closed for user fastone\\nMar 09 02:35:04 desktop-1 sshd[11875]: error: Received disconnect from 10.0.109.90 port 41620:3:\\ncom.jcraft.jsch.JSchException: Auth fail [preauth]\\nMar 09 02:35:04 desktop-1 sshd[11875]: Disconnected from authenticating user fastone 10.0.109.90 port 41620 [preauth]\\n```\\n\\nssh\u65e5\u5fd7\u4e2d\u524d\u4e09\u6b21\u662f\u6b63\u5e38\u7684, \u4f46\u662f\u7b2c\u56db\u6b21\u5c31\u62a5\u9519\u4e86, \u4ece\u62a5\u9519\u4fe1\u606f\u6765\u770b, \u662f`Auth fail`\u7684\u95ee\u9898.<br/>\\n\u4ece\u65e5\u5fd7\u4e0a\u770b\u53d1\u73b0\u6bcf\u6b21\u6267\u884c\u547d\u4ee4\u7684\u65f6\u95f4\u90fd\u5f88\u957f, \u6709\u65f6\u5019\u4f1a\u8d85\u8fc7`10s`, \u6240\u4ee5\u6211\u731c\u6d4b\u662f`ssh`\u8fde\u63a5\u8d85\u65f6\u4e86.<br/>\\n\\n### 3. \u67e5\u770b`nslcd`\u65e5\u5fd7\\n\\n\u6839\u636e\u4e0a\u8ff0\u7684\u65e5\u5fd7\u5f97\u51fa\u662f`auth fail`\u7684\u95ee\u9898, \u90a3\u4e48\u5927\u6982\u7387\u8ddf\u7528\u6237\u8ba4\u8bc1\u6709\u5173<br/>\\n\u76ee\u524d\u7cfb\u7edf\u4e2d\u4f7f\u7528\u7684\u8ba4\u8bc1\u670d\u52a1\u662f`ldap`, \u5e76\u901a\u8fc7`nslcd`\u670d\u52a1\u6765\u8fde\u63a5`ldap`\u5e76\u63d0\u4f9b\u8ba4\u8bc1\u670d\u52a1\u7684.<br/>\\n\u6839\u636e\u7ecf\u9a8c\u5224\u65ad\u53ef\u80fd\u662f\u7cfb\u7edf\u4e2d\u7684`nslcd`\u670d\u52a1\u95ee\u9898. \u63a5\u4e0b\u6765\u9700\u8981\u67e5\u770b\u5176\u65e5\u5fd7<br/>\\n\\n```bash\\nsudo service nslcd status\\n```\\n\\n\u8f93\u51fa\u5982\u4e0b<br/>\\n\\n```log\\n\u25cf nslcd.service - LSB: LDAP connection daemon\\nLoaded: loaded (/etc/init.d/nslcd; generated)\\nActive: active (running) since Thu 2023-03-09 02:00:08 UTC; 58min ago\\nDocs: man:systemd-sysv-generator(8)\\nProcess: 1360 ExecStart=/etc/init.d/nslcd start (code=exited, status=0/SUCCESS)\\nTasks: 6 (limit: 4915)\\nCGroup: /system.slice/nslcd.service\\n\u2514\u25001497 /usr/sbin/nslcd\\n\\n\\n\\n\\nMar 09 02:53:36 desktop-1 nslcd[1497]: [de9570] <group/member=\\"root\\"> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:53:51 desktop-1 nslcd[1497]: [39d9ef] <group/member=\\"root\\"> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:53:51 desktop-1 nslcd[1497]: [2e5952] <passwd=9159> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:54:01 desktop-1 nslcd[1497]: [0d1fd6] <passwd=9159> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:54:57 desktop-1 nslcd[1497]: [bec5a1] <passwd=9159> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:54:57 desktop-1 nslcd[1497]: [44bbc8] <passwd=9159> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:55:34 desktop-1 nslcd[1497]: [f50bda] <passwd=9159> ldap_result() failed: Can\'t contact LDAP server\\nMar 09 02:56:25 desktop-1 nslcd[1497]: [c5f72e] <group/member=\\"fastone\\"> ldap_result() timed out\\nMar 09 02:56:25 desktop-1 nslcd[1497]: [f644f7] <group/member=\\"u18846424945\\"> ldap_result() timed out\\nMar 09 02:56:25 desktop-1 nslcd[1497]: [4db6bf] <group/member=\\"u18846424945\\"> ldap_result() timed out\\n```\\n\\n\u4ece\u65e5\u5fd7\u4e2d\u53ef\u4ee5\u770b\u5230, `nslcd`\u670d\u52a1\u8bbf\u95ee`ldap`\u8d85\u65f6\u4e86\\n\\n### 4. \u542f\u7528`nscd`\u670d\u52a1\u4ece\u800c`workaround`\u6b64\u95ee\u9898\\n\\n\u542f\u7528`nscd`\u670d\u52a1, \u4ece\u800c`workaround`\u6b64\u95ee\u9898, `nscd`\u670d\u52a1\u4f1a\u7f13\u5b58`nslcd`\u670d\u52a1\u7684\u7ed3\u679c, \u4ece\u800c\u63d0\u5347\u901f\u5ea6.<br/>\\n\u4f46\u662f\u8fd9\u4e2a\u65b9\u6848\u53ea\u662f`workaround`\u800c\u5df2, \u540e\u7eed\u9700\u8981\u8fd0\u7ef4\u540c\u5b66\u6765\u89e3\u51b3`ldap`\u7684\u8fde\u63a5\u95ee\u9898<br/>\\n\\n```bash\\nsudo service nscd start\\n```\\n\\n\u542f\u7528`nscd`\u670d\u52a1\u540e, \u786e\u8ba4\u4e0b\u901f\u5ea6\u662f\u5426\u6709\u63d0\u5347\\n\\n```bash\\ntime sudo getent passwd -s ldap\\n```\\n\\n```log\\nreal0m1.326s\\nuser0m0.023s\\nsys0m0.023s\\n```\\n\\n## \u5907\u6ce8\\n\\n### \u5982\u4f55\u907f\u514d\u7c7b\u4f3c\u95ee\u9898\\n\\n#### \u670d\u52a1\u4fa7\\n\\n\u5bf9\u4e8e\u8ba4\u8bc1\u670d\u52a1\u4fa7\u9700\u8981\u786e\u4fdd\u670d\u52a1\u7684\u7a33\u5b9a\u6027\\n\\n#### \u5ba2\u6237\u7aef\u4fa7\\n\\n\u5bf9\u4e8e\u8ba4\u8bc1\u7cfb\u7edf\u7684\u5ba2\u6237\u7aef\u4fa7, \u9700\u8981\u786e\u4fdd\u5ba2\u6237\u7aef\u7684\u7a33\u5b9a, \u4f8b\u5982\u589e\u52a0\u7f13\u5b58\u673a\u5236, \u4ece\u800c\u63d0\u5347\u901f\u5ea6\\n\\n## \u53c2\u8003\\n\\n- [Multiple SSH connections to the same system - is it possible?](https://superuser.com/questions/1032251/multiple-ssh-connections-to-the-same-system-is-it-possible)\\n- [How to check sshd log?](https://serverfault.com/questions/130482/how-to-check-sshd-log)"},{"id":"/2023/03/06/problem-build-native-springboot-application","metadata":{"permalink":"/blog/2023/03/06/problem-build-native-springboot-application","source":"@site/blog/2023-03-06/problem-build-native-springboot-application.md","title":"\u4f7f\u7528spring\u6784\u5efanative\u9047\u5230\u7684\u95ee\u9898","description":"\u672c\u6587\u4e3b\u8981\u6574\u7406\u4e86\u5728\u6784\u5efaspring-boot\u5e94\u7528\u4e3anative\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898.","date":"2023-03-06T00:00:00.000Z","formattedDate":"March 6, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"spring-boot","permalink":"/blog/tags/spring-boot"},{"label":"spring","permalink":"/blog/tags/spring"},{"label":"native-image","permalink":"/blog/tags/native-image"}],"readingTime":7.535,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","spring-boot","spring","native-image"]},"unlisted":false,"prevItem":{"title":"SSH\u547d\u4ee4\u65e0\u6cd5\u521b\u5efa\u8fdc\u7a0b\u8fde\u63a5","permalink":"/blog/2023/03/09/ssh-execution-timeout"},"nextItem":{"title":"\u5347\u7ea7springboot3\u9047\u5230\u7684\u95ee\u9898","permalink":"/blog/2023/03/05/problem-springboot3-upgrade"}},"content":"\u672c\u6587\u4e3b\u8981\u6574\u7406\u4e86\u5728\u6784\u5efa`spring-boot`\u5e94\u7528\u4e3a`native`\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u79fb\u9664`spring-native`\u4f9d\u8d56, \u56e0\u4e3a\u5df2\u88ab`spring-core`\u63d0\u4f9b\u7684`aot`\u529f\u80fd\u53d6\u4ee3\\n\\n`spring-native`\u5df2\u88ab`spring-core`\u63d0\u4f9b\u7684`aot`\u529f\u80fd\u53d6\u4ee3, \u6240\u4ee5\u4e0d\u9700\u8981\u5f15\u5165\u8001\u7684`spring-native`\u4f9d\u8d56.<br/>\\n\u5728github[spring-native](https://github.com/spring-attic/spring-native)\u7684\u4e3b\u9875\u4e0a\u6709\u5982\u4e0b\u8bf4\u660e\\n> This project is now superseded by Spring Boot 3+ official native support, see the related reference documentation for\\n> more details.\\n\\n\u65b0\u7684`aot`\\n\u529f\u80fd\u7684\u6587\u6863\u53ef\u4ee5\u53c2\u9605[GraalVM Native Image Support](https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html)<br/>\\n\\n\u5176\u5185\u90e8\u5de5\u4f5c\u539f\u7406\u4e3b\u8981\u901a\u8fc7`ReflectiveProcessor`\u548c`RuntimeHintsRegistrar`\u7528\u6765\u5e2e\u52a9\u751f\u6210\u53cd\u5c04\u63d0\u793a, \u5e76\u5728`graalvm`\\n\u7f16\u8bd1\u671f\u95f4\u4f7f\u7528.<br/>\\n\\n## `@RegisterReflectionForBinding`\u65e0\u6cd5\u96c6\u6210`querysdl`\u751f\u6210\u7684`Q`\u7c7b\\n\\n\u7531\u4e8e`querydsl`\u751f\u6210\u7684Q\u7c7b\u4e0d\u80fd\u653e\u5728`@RegisterReflectionForBinding`\u4e0a(\u56e0\u4e3a\u7f16\u8bd1\u4f18\u5148\u7ea7\u539f\u56e0),\\n\u5219\u9700\u8981\u91cd\u65b0\u5b9e\u73b0`@RegisterReflectionForBinding`\u7684\u5177\u4f53\u5b9e\u73b0\u903b\u8f91.<br/>\\n\u4e3b\u8981\u662f\u7ee7\u627f`ReflectiveProcessor`\u5e76\u914d\u5408`BindingReflectionHintsRegistrar`.<br/>\\n\u53c2\u8003\u4ee3\u7801:<br/>\\n\\n```kotlin\\nclass ReflectiveProcessorImpl : ReflectiveProcessor {\\n\\n\\toverride fun registerReflectionHints(hints: ReflectionHints, element: AnnotatedElement) {\\n\\t\\tval function = BindingReflectionHintsRegistrar()::registerReflectionHints.partially1(hints)\\n\\t\\tfunction(\\n\\t\\t\\tarrayOf(\\n\\t\\t\\t\\tPage::class.java,\\n\\t\\t\\t\\tResponseResult::class.java,\\n\\t\\t\\t\\tSignInRequest::class.java,\\n\\t\\t\\t\\tSignInResponse::class.java\\n\\t\\t\\t)\\n\\t\\t)\\n\\t}\\n\\n}\\n```\\n\\n## \u5347\u7ea7`graalvm`\u7248\u672c\\n\\n\u5982\u679c\u4f7f\u7528\u7684`graalvm`\u7248\u672c\u8fc7\u4e8e\u8001, \u5219\u4f1a\u51fa\u73b0\u5982\u4e0b\u7c7b\u4f3c\u7684\u9519\u8bef\\n\\n```\\nGraalVM version 22.3 is required but 22.0 has been detected, please upgrade.\\n```\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u9700\u8981\u5c06`graalvm`\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c\\n\\n## `paketo`\u4f9d\u8d56\u4e0b\u8f7d\u5931\u8d25\\n\\n\u901a\u8fc7`./gradlew bootBuildImage`\u6784\u5efa\u955c\u50cf\u65f6, \u8f93\u51fa\u4ee5\u4e0b\u9519\u8bef\\n\\n```log\\nunable to copy from https://github.com/bell-sw/Liberica/releases/download/17.0.5+8/bellsoft-jre17.0.5+8-linux-amd64.tar.gz to /tmp/ee56d911dd187d4965fe2d5280e17b76253eb40eb4e5c8582a17cd46ea0168b1/bellsoft-jre17.0.5+8-linux-amd64.tar.gz\\n[creator]     stream error: stream ID 1; PROTOCOL_ERROR; received from peer\\n```\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a`paketo`\u7684\u8fdb\u884c\u6784\u5efa\u8fc7\u7a0b\u4e2d\u4f1a\u4e0b\u8f7d\u4e00\u4e9b\u4f9d\u8d56, \u4f46\u662f\u8fd9\u4e9b\u4f9d\u8d56\u5728\u56fd\u5916, \u4e0b\u8f7d\u901f\u5ea6\u4f1a\u53d8\u6162, \u751a\u81f3\u4f1a\u4e0b\u8f7d\u5931\u8d25.<br/>\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u4f7f\u7528`binding-tool`\u5de5\u5177\u751f\u6210`dependency-mapping`\u5230`bindings`\u5e76\u6620\u5c04\u5230`builder`\u5bb9\u5668\u4e2d\\n\\n### \u53c2\u8003\\n\\n- [Override paketo-buildpacks download URIs](https://github.com/paketo-buildpacks/bellsoft-liberica/issues/7).<br/>\\n- [binding-tool](https://github.com/dmikusa/binding-tool)\\n\\n### \u5907\u6ce8\\n\\n#### `gradle`\u4e2d`native`\u76f8\u5173\u547d\u4ee4\\n\\n```bash\\n./gradlew nativeCompile\\n./gradlew bootBuildImage\\n./build/native/nativeCompile/fastone-auditing\\n```\\n\\n#### `gradle`\u4e2d\u7684`BootBuildImage`\u914d\u7f6e\u53c2\u8003\\n\\n```kotlin title=\\"build.kts\\"\\ntasks.withType<BootBuildImage> {\\n\\t// https://docs.spring.io/spring-boot/docs/3.0.0/gradle-plugin/reference/htmlsingle/#build-image.examples.caches\\n\\tbuildCache {\\n\\t\\tvolume {\\n\\t\\t\\tname.set(\\"cache-${rootProject.name}.build\\")\\n\\t\\t}\\n\\t}\\n\\tlaunchCache {\\n\\t\\tvolume {\\n\\t\\t\\tname.set(\\"cache-${rootProject.name}.launch\\")\\n\\t\\t}\\n\\t}\\n\\tpublish.set(true)\\n\\tdocker {\\n\\t\\tpublishRegistry {\\n\\t\\t\\tusername.set(System.getenv(\\"HARBOR_USERNAME\\"))\\n\\t\\t\\tpassword.set(System.getenv(\\"HARBOR_PASSWORD\\"))\\n\\t\\t}\\n\\t}\\n\\n\\tval labels = System.getenv(\\"LABELS\\")?.replace(\\",\\", \\" \\")\\n\\n\\t// https://github.com/paketo-buildpacks/image-labels\\n\\tmapOf(\\"SERVICE_BINDING_ROOT\\" to \\"/bindings\\").plus(\\n\\t\\twhen (labels) {\\n\\t\\t\\tnull -> emptyMap()\\n\\t\\t\\telse -> mapOf(\\"BP_IMAGE_LABELS\\" to labels)\\n\\t\\t}\\n\\t).let { environment.set(it) }\\n\\tbindings.set(listOf(\\"${project.projectDir}/bindings:/bindings\\"))\\n\\tval formatter = DateTimeFormatter.ofPattern(\\"yyyyMMdd-HHmmss\\")\\n\\timageName.set(\\"hub.fastonetech.com/infra/${project.name}:${formatter.format(ZonedDateTime.now(ZoneId.of(\\"UTC\\")))}\\")\\n}\\n```\\n\\n- [native-image.developing-your-first-application](https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.developing-your-first-application.native-build-tools.gradle)\\n- [build-image.examples](https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples)\\n\\n#### `binding-tool`\u4f7f\u7528\u65b9\u5f0f\u53c2\u8003\\n\\n```bash\\n./bt dm -t buildpack.toml\\n./bt dm -b paketo-buildpacks/bellsoft-liberica\\n./bt dm -b paketo-buildpacks/syft\\n```\\n\\n- [buildpack.toml](https://raw.githubusercontent.com/paketo-buildpacks/bellsoft-liberica/main/buildpack.toml)\\n\\n## \u56fa\u5b9a`builder`\u548c`run`\u955c\u50cf\u7248\u672c\u4ee5\u907f\u514d\u7ecf\u5e38\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684`builder`\u548c`run`\u955c\u50cf\\n\\n\u5728\u4f7f\u7528`packeto-builder`\u6784\u5efa\u955c\u50cf\u65f6, \u4f1a\u7ecf\u5e38\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684`paketo`\u4f9d\u8d56, \u8fd9\u6837\u4f1a\u5bfc\u81f4\u81ea\u5b9a\u4e49`dependency-mapping`\u5931\u6548,\\n\u4ece\u800c\u5bfc\u81f4\u6784\u5efa\u5931\u8d25.<br/>\\n\\n### \u539f\u56e0\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u5c1d\u8bd5\u4e0b\u8f7d\u6700\u65b0\u7684`builder`\u548c`run`\u955c\u50cf, \u4f46\u662f\u8fd9\u4e9b\u955c\u50cf\u4e2d\u5305\u542b\u4e86`paketo`\u7684\u4f9d\u8d56, \u4ece\u800c\u5bfc\u81f4\u4e0b\u8f7d\u6700\u65b0\u7684\u4f9d\u8d56.<br/>\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898, \u6211\u4eec\u9700\u8981\u56fa\u5b9a`builder`\u548c`run`\u955c\u50cf\u7684\u7248\u672c, \u4ece\u800c\u907f\u514d\u4e0b\u8f7d\u6700\u65b0\u7684\u4f9d\u8d56.<br/>\\n\\n\u53c2\u8003\u4ee3\u7801\u5982\u4e0b\\n\\n```kotlin title=\\"build.kts\\"\\ntasks.withType<BootBuildImage> {\\n\\t// TO FIX THE VERSION OF BUILDER AND RUN IMAGE to avoid updating it\'s buildpack version which name is bellsoft\\n\\tbuilder.set(\\"paketobuildpacks/builder@sha256:317066766dcb7f47535fe5d97b860be6aabab57da5ef056a11f9db855a73f9e8\\")\\n\\trunImage.set(\\"paketobuildpacks/run@sha256:e9bae15ccc7e230da6ae6c6cd6eef519b10b5ec2187729f60e70c08415a330a0\\")\\n}\\n```\\n\\n### \u53c2\u8003\\n- [Custom Image Builder and Run Image](https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples.custom-image-builder)\\n\\n\u4e0a\u9762\u7684\u4ee3\u7801\u662f\u56fa\u5b9a\u4e86`builder`\u548c`run`\u955c\u50cf\u7684\u7248\u672c, \u4ece\u800c\u907f\u514d\u4e0b\u8f7d\u6700\u65b0\u7684\u4f9d\u8d56.<br/>\\n\\n## kotlinx-coroutines\u9700\u8981\u914d\u7f6e\u53cd\u5c04\u63d0\u793a\\n\\n\u5c06\u542b\u6709`kotlinx-coroutines`\u7684`kotlin`\u4ee3\u7801\u7f16\u8bd1\u4e3a`native`\u65f6, \u8fd0\u884c\u540e\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\\n\\n```log\\njava.lang.NoSuchMethodException: kotlin.internal.jdk8.JDK8PlatformImplementations.<init>()\\n```\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`classpath`\u4e0b\u7684`META-INF/native-image/reflect-config.json`\u6587\u4ef6\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\u7528\u4e8e\u914d\u7f6e\u53cd\u5c04\u63d0\u793a\\n\\n```json\\n[\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.reflect.jvm.internal.ReflectionFactoryImpl\\",\\n\\t\\t\\"allDeclaredConstructors\\": true\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.KotlinVersion\\",\\n\\t\\t\\"allPublicMethods\\": true,\\n\\t\\t\\"allDeclaredFields\\": true,\\n\\t\\t\\"allDeclaredMethods\\": true,\\n\\t\\t\\"allDeclaredConstructors\\": true\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.KotlinVersion[]\\"\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.KotlinVersion$Companion\\"\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.KotlinVersion$Companion[]\\"\\n\\t},\\n\\t{\\n\\t\\t\\"name\\": \\"kotlin.internal.jdk8.JDK8PlatformImplementations\\",\\n\\t\\t\\"allPublicMethods\\": true,\\n\\t\\t\\"allDeclaredFields\\": true,\\n\\t\\t\\"allDeclaredMethods\\": true,\\n\\t\\t\\"allDeclaredConstructors\\": true\\n\\t}\\n]\\n```\\n\\n### \u53c2\u8003\\n\\n- [How to provide RuntimeHints for Internal Classes in SpringBoot3](https://stackoverflow.com/questions/74612654/how-to-provide-runtimehints-for-internal-classes-in-springboot3)\\n- [Kotlin: Native reflection config missing kotlin.internal.jdk8.JDK8PlatformImplementations #1646](https://github.com/spring-projects-experimental/spring-native/issues/1646)\\n- [PlatformImplementations loading is not compatible with graalvm native-image --no-fallback](https://youtrack.jetbrains.com/issue/KT-51579)\\n\\n## `ktor`\u5e93\u9700\u8981\u914d\u7f6e\u53cd\u5c04\u63d0\u793a\\n\\n\u5c06\u542b\u6709`ktor`\u7684`kotlin`\u4ee3\u7801\u7f16\u8bd1\u4e3a`native`\u540e\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\\n\\n```log\\nCaused by: java.lang.RuntimeException: java.lang.NoSuchFieldException: top\\n\\tat java.util.concurrent.atomic.AtomicLongFieldUpdater$CASUpdater.<init>(AtomicLongFieldUpdater.java:205)\\n\\tat java.util.concurrent.atomic.AtomicLongFieldUpdater.newUpdater(AtomicLongFieldUpdater.java:95)\\n\\tat io.ktor.utils.io.pool.DefaultPool.<clinit>(DefaultPool.kt:97)\\n\\tat com.oracle.svm.core.hub.ClassInitializationInfo.invokeClassInitializer(ClassInitializationInfo.java:350)\\n\\tat com.oracle.svm.core.hub.ClassInitializationInfo.initialize(ClassInitializationInfo.java:270)\\n\\t... 39 more\\nCaused by: java.lang.NoSuchFieldException: top\\n\\tat java.lang.Class.getDeclaredField(DynamicHub.java:2411)\\n\\tat java.util.concurrent.atomic.AtomicLongFieldUpdater$CASUpdater.<init>(AtomicLongFieldUpdater.java:202)\\n\\t... 43 more\\n```\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\nclasspath\u4e0b\u7684`META-INF/native-image/reflect-config.json`\u6587\u4ef6\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\u7528\u4e8e\u914d\u7f6e\u53cd\u5c04\u63d0\u793a\\n\\n```json\\n[\\n\\t{\\n\\t\\t\\"name\\": \\"io.ktor.utils.io.pool.DefaultPool\\",\\n\\t\\t\\"fields\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\"name\\": \\"top\\",\\n\\t\\t\\t\\t\\"allowUnsafeAccess\\": true\\n\\t\\t\\t}\\n\\t\\t]\\n\\t}\\n]\\n```\\n\\n### \u53c2\u8003\\n\\n- [GraalVM native-image support broken due to Payload #77](https://github.com/rsocket/rsocket-kotlin/issues/77)\\n\\n## \u4e3a\u9700\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u914d\u7f6e\u53cd\u5c04\u63d0\u793a\\n\\n\u4e3a\u4e86\u80fd\u591f\u8ba9\u53c2\u4e0e\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u80fd\u591f\u5728`native`\u73af\u5883\u4e0b\u6b63\u5e38\u8fd0\u884c, \u9700\u8981\u914d\u7f6e\u53cd\u5c04\u63d0\u793a.\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u4f7f\u7528`springframework`\u4e2d\u7684\u7c7b\u63d0\u4f9b\u53cd\u5c04\u63d0\u793a, \u53c2\u8003\u4ee3\u7801\u5982\u4e0b\\n\\n```kotlin\\nclass ReflectiveProcessorImpl : ReflectiveProcessor {\\n\\n\\toverride fun registerReflectionHints(hints: ReflectionHints, element: AnnotatedElement) {\\n\\t\\tval function = BindingReflectionHintsRegistrar()::registerReflectionHints.partially1(hints)\\n\\t\\tfunction(\\n\\t\\t\\tarrayOf(\\n\\t\\t\\t\\tPage::class.java,\\n\\t\\t\\t\\tResponseResult::class.java,\\n\\t\\t\\t\\tSignInRequest::class.java,\\n\\t\\t\\t\\tSignInResponse::class.java\\n\\t\\t\\t)\\n\\t\\t)\\n\\t}\\n\\n}\\n\\nclass RuntimeHintsImpl : RuntimeHintsRegistrar {\\n\\n\\toverride fun registerHints(hints: RuntimeHints, classLoader: ClassLoader?) {\\n\\t\\t// Caused by: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `java.util.HashSet` (no Creators, like default constructor, exist): no default no-arguments constructor found\\n\\t\\t// at [Source: (InputStreamReader); line: 1, column: 20] (through reference chain: com.fastonetech.lib.web.ResponseResult[\\"data\\"]->com.fastonetech.billing.sync.infra.client.Page[\\"content\\"])\\n\\t\\thints.reflection().registerConstructor(\\n\\t\\t\\tReflectionUtils.accessibleConstructor(java.util.HashSet::class.java),\\n\\t\\t\\tExecutableMode.INVOKE\\n\\t\\t)\\n\\t}\\n\\n}\\n\\n@Reflective(ReflectiveProcessorImpl::class)\\n@ImportRuntimeHints(RuntimeHintsImpl::class)\\nclass BillingSyncApplication\\n```\\n\\n### \u53c2\u8003\\n\\n- [Annotation Interface Reflective](https://docs.spring.io/spring-framework/docs/current/javadoc-api//org/springframework/aot/hint/annotation/Reflective.html)\\n- [Annotation Interface ImportRuntimeHints](https://docs.spring.io/spring-framework/docs/current/javadoc-api//org/springframework/context/annotation/ImportRuntimeHints.html)\\n\\n## \u6784\u5efa\u51fa\u7684\u955c\u50cf\u4e0d\u662f`native`\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u914d\u7f6e\u4e86`bootBuildImage`\u8fd9\u4e2a`task`\u4e2d\u8986\u76d6\u4e86\u73af\u5883\u53d8\u91cf, \u5bfc\u81f4`BP_NATIVE_IMAGE`\u4e3a\u7a7a\\n\\n### \u539f\u59cb\u914d\u7f6e\\n\\n```kotlin\\nmapOf(\\"SERVICE_BINDING_ROOT\\" to \\"/bindings\\").plus(\\n\\twhen (labels) {\\n\\t\\tnull -> emptyMap()\\n\\t\\telse -> mapOf(\\"BP_IMAGE_LABELS\\" to labels)\\n\\t}\\n).let {\\n\\tenvironment.set(it) // ensure BP_NATIVE_IMAGE exists, and it\'s value is true\\n}\\n```\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u7531\u4e8eenvironment.set\u4f1a\u8986\u76d6\u539f\u6709\u7684\u73af\u5883\u53d8\u91cf, \u6240\u4ee5\u9700\u8981\u663e\u5f0f\u58f0\u660e`BP_NATIVE_IMAGE`\\n\\n```kotlin\\nmapOf(\\"SERVICE_BINDING_ROOT\\" to \\"/bindings\\", \\"BP_NATIVE_IMAGE\\" to \\"true\\").plus(\\n\\twhen (labels) {\\n\\t\\tnull -> emptyMap()\\n\\t\\telse -> mapOf(\\"BP_IMAGE_LABELS\\" to labels)\\n\\t}\\n).let {\\n\\tenvironment.set(it) // ensure BP_NATIVE_IMAGE exists, and it\'s value is true\\n}\\n```\\n\\n### \u53c2\u8003\\n\\n- [5.3. Image Customizations\u4e0b\u7684environment\u9ed8\u8ba4\u503c\u4ecb\u7ecd](https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/)\\n\\n## `aot`\u5e94\u7528\u8fd0\u884c\u65f6\u8c03\u7528\u7531`@ConfigurationProperty`\u6ce8\u89e3\u6ce8\u91ca\u7684\u5bf9\u8c61\u7684\u5c5e\u6027\u65f6\u62a5\u9519\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5bf9\u4e8e`ConfigurationProperties`\u4e2d\u5d4c\u5957\u7684\u5bf9\u8c61\u52a0\u5165`@NestedConfigurationProperty`\u6ce8\u89e3\u8fdb\u884c\u6807\u8bc6\\n\\n### \u53c2\u8003\\n\\n- [Nested Configuration Properties](https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.advanced.nested-configuration-properties)\\n\\n> Reflection hints are automatically created for configuration properties by the Spring ahead-of-time engine.\\n> Nested configuration properties which are not inner classes, however, must be annotated with\\n> @NestedConfigurationProperty, otherwise they won\u2019t be detected and will not be bindable.\\n\\n## `aot`\u5e94\u7528\u8fd0\u884c\u65f6\u83b7\u53d6`classpath`\u4e0b\u7684\u8d44\u6e90\u65f6\u62a5\u9519\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728`RuntimeHintsRegistrar`\u7684`registerHints`\u65b9\u6cd5\u4e2d\u6ce8\u518c\u9759\u6001\u8d44\u6e90\\n\\n```kotlin\\nhints.resources().registerResource(ClassPathResource(\\"ca.crt\\"))\\nhints.resources().registerResource(ClassPathResource(\\"client.crt\\"))\\nhints.resources().registerResource(ClassPathResource(\\"client.key\\"))\\n```\\n\\n## `aot`\u5e94\u7528\u8fd0\u884c\u65f6`@Conditional`\u6ce8\u89e3\u4e0d\u751f\u6548\\n\\nspring-boot-native not supported @ConditionalOnProperty yet\\n\\n### \u53c2\u8003\\n\\n- [Possibility of @ConditionalOnProperty support on spring-native](https://github.com/spring-projects-experimental/spring-native/issues/1613)\\n\\n### \u53c2\u8003\\n\\n- [server.error.include-message](https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#application-properties.server.server.error.include-message)\\n- [Error Handling for REST with Spring](https://www.baeldung.com/exception-handling-for-rest-with-spring)"},{"id":"/2023/03/05/problem-springboot3-upgrade","metadata":{"permalink":"/blog/2023/03/05/problem-springboot3-upgrade","source":"@site/blog/2023-03-05/problem-springboot3-upgrade.md","title":"\u5347\u7ea7springboot3\u9047\u5230\u7684\u95ee\u9898","description":"\u672c\u6587\u4e3b\u8981\u6574\u7406\u4e86\u5728\u5347\u7ea7springboot3\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898.","date":"2023-03-05T00:00:00.000Z","formattedDate":"March 5, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"spring-boot","permalink":"/blog/tags/spring-boot"},{"label":"spring","permalink":"/blog/tags/spring"},{"label":"github-pr","permalink":"/blog/tags/github-pr"}],"readingTime":10.995,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","spring-boot","spring","github-pr"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528spring\u6784\u5efanative\u9047\u5230\u7684\u95ee\u9898","permalink":"/blog/2023/03/06/problem-build-native-springboot-application"},"nextItem":{"title":"\u811a\u672c\u4e2d\u5b9e\u73b0\u4fee\u6539\u7528\u6237\u5bc6\u7801","permalink":"/blog/2023/03/03/passwd-in-script"}},"content":"\u672c\u6587\u4e3b\u8981\u6574\u7406\u4e86\u5728\u5347\u7ea7`springboot3`\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5347\u7ea7`spring-boot3`\u540e\u4ee3\u7801\u4e2d\u7684`javax`\u5305\u9700\u8981\u5207\u6362\u4e3a`jakarta`\\n\\n\u9879\u76ee\u4e2d\u4f7f\u7528\u5230\u4e86`apache-guacamole-common`\u4f9d\u8d56, \u8be5\u4f9d\u8d56\u4e2d\u4f7f\u7528\u4e86`javax`\u5305\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u7531\u4e8e\u8be5\u4f9d\u8d56\u76ee\u524d\u6700\u65b0\u7684\u7248\u672c\u8fd8\u6ca1\u6709\u5347\u7ea7\u5230`jakarta`, \u6240\u4ee5\u9700\u8981\u76f8\u5173\u4f9d\u8d56\u4ee3\u7801\u590d\u5236\u5230\u9879\u76ee\u4e2d, \u5e76\u5c06`javax`\u5305\u5207\u6362\u4e3a`jakarta`.<br/>\\n\\n```java title=\\"GuacamoleWebSocketTunnelEndpoint.java\\"\\npackage com.fastonetech.remote.access.websocket;\\n/*\\n * Licensed to the Apache Software Foundation (ASF) under one\\n * or more contributor license agreements.  See the NOTICE file\\n * distributed with this work for additional information\\n * regarding copyright ownership.  The ASF licenses this file\\n * to you under the Apache License, Version 2.0 (the\\n * \\"License\\"); you may not use this file except in compliance\\n * with the License.  You may obtain a copy of the License at\\n *\\n *   http://www.apache.org/licenses/LICENSE-2.0\\n *\\n * Unless required by applicable law or agreed to in writing,\\n * software distributed under the License is distributed on an\\n * \\"AS IS\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\\n * KIND, either express or implied.  See the License for the\\n * specific language governing permissions and limitations\\n * under the License.\\n */\\n\\nimport java.io.IOException;\\nimport java.util.List;\\nimport jakarta.websocket.CloseReason;\\nimport jakarta.websocket.CloseReason.CloseCode;\\nimport jakarta.websocket.Endpoint;\\nimport jakarta.websocket.EndpointConfig;\\nimport jakarta.websocket.MessageHandler;\\nimport jakarta.websocket.OnClose;\\nimport jakarta.websocket.OnMessage;\\nimport jakarta.websocket.OnOpen;\\nimport jakarta.websocket.RemoteEndpoint;\\nimport jakarta.websocket.Session;\\nimport org.apache.guacamole.GuacamoleException;\\nimport org.apache.guacamole.io.GuacamoleReader;\\nimport org.apache.guacamole.io.GuacamoleWriter;\\nimport org.apache.guacamole.net.GuacamoleTunnel;\\nimport org.apache.guacamole.GuacamoleClientException;\\nimport org.apache.guacamole.GuacamoleConnectionClosedException;\\nimport org.apache.guacamole.protocol.FilteredGuacamoleWriter;\\nimport org.apache.guacamole.protocol.GuacamoleFilter;\\nimport org.apache.guacamole.protocol.GuacamoleInstruction;\\nimport org.apache.guacamole.protocol.GuacamoleStatus;\\nimport org.slf4j.Logger;\\nimport org.slf4j.LoggerFactory;\\n\\n/**\\n * A WebSocket implementation of GuacamoleTunnel functionality, compatible with\\n * the Guacamole.WebSocketTunnel object included with the JavaScript API.\\n * Messages sent/received are simply chunks of the Guacamole protocol\\n * instruction stream.\\n */\\npublic abstract class GuacamoleWebSocketTunnelEndpoint extends Endpoint {\\n\\n\\t/**\\n\\t * The default, minimum buffer size for instructions.\\n\\t */\\n\\tprivate static final int BUFFER_SIZE = 8192;\\n\\n\\t/**\\n\\t * The opcode of the instruction used to indicate a connection stability\\n\\t * test ping request or response. Note that this instruction is\\n\\t * encapsulated within an internal tunnel instruction (with the opcode\\n\\t * being the empty string), thus this will actually be the value of the\\n\\t * first element of the received instruction.\\n\\t */\\n\\tprivate static final String PING_OPCODE = \\"ping\\";\\n\\n\\t/**\\n\\t * Logger for this class.\\n\\t */\\n\\tprivate final Logger logger = LoggerFactory.getLogger(GuacamoleWebSocketTunnelEndpoint.class);\\n\\n\\t/**\\n\\t * The underlying GuacamoleTunnel. WebSocket reads/writes will be handled\\n\\t * as reads/writes to this tunnel. This value may be null if no connection\\n\\t * has been established.\\n\\t */\\n\\tprivate GuacamoleTunnel tunnel;\\n\\n\\t/**\\n\\t * Remote (client) side of this connection. This value will always be\\n\\t * non-null if tunnel is non-null.\\n\\t */\\n\\tprivate RemoteEndpoint.Basic remote;\\n\\n\\t/**\\n\\t * Sends the numeric Guacaomle Status Code and Web Socket\\n\\t * code and closes the connection.\\n\\t *\\n\\t * @param session\\n\\t *     The outbound WebSocket connection to close.\\n\\t *\\n\\t * @param guacamoleStatusCode\\n\\t *     The numeric Guacamole status to send.\\n\\t *\\n\\t * @param webSocketCode\\n\\t *     The numeric WebSocket status to send.\\n\\t */\\n\\tprivate void closeConnection(Session session, int guacamoleStatusCode,\\n\\t\\t\\t\\t\\t\\t\\t\\t int webSocketCode) {\\n\\n\\t\\ttry {\\n\\t\\t\\tCloseCode code = CloseReason.CloseCodes.getCloseCode(webSocketCode);\\n\\t\\t\\tString message = Integer.toString(guacamoleStatusCode);\\n\\t\\t\\tsession.close(new CloseReason(code, message));\\n\\t\\t} catch (IOException e) {\\n\\t\\t\\tlogger.debug(\\"Unable to close WebSocket connection.\\", e);\\n\\t\\t}\\n\\n\\t}\\n\\n\\t/**\\n\\t * Sends the given Guacaomle Status and closes the given\\n\\t * connection.\\n\\t *\\n\\t * @param session\\n\\t *     The outbound WebSocket connection to close.\\n\\t *\\n\\t * @param guacStatus\\n\\t *     The status to use for the connection.\\n\\t */\\n\\tprivate void closeConnection(Session session, GuacamoleStatus guacStatus) {\\n\\t\\tcloseConnection(session, guacStatus.getGuacamoleStatusCode(),\\n\\t\\t\\tguacStatus.getWebSocketCode());\\n\\t}\\n\\n\\t/**\\n\\t * Sends a Guacamole instruction along the outbound WebSocket connection to\\n\\t * the connected Guacamole client. If an instruction is already in the\\n\\t * process of being sent by another thread, this function will block until\\n\\t * in-progress instructions are complete.\\n\\t *\\n\\t * @param instruction\\n\\t *     The instruction to send.\\n\\t *\\n\\t * @throws IOException\\n\\t *     If an I/O error occurs preventing the given instruction from being\\n\\t *     sent.\\n\\t */\\n\\tprivate void sendInstruction(String instruction)\\n\\t\\tthrows IOException {\\n\\n\\t\\t// NOTE: Synchronization on the non-final remote field here is\\n\\t\\t// intentional. The remote (the outbound websocket connection) is only\\n\\t\\t// sensitive to simultaneous attempts to send messages with respect to\\n\\t\\t// itself. If the remote changes, then the outbound websocket\\n\\t\\t// connection has changed, and synchronization need only be performed\\n\\t\\t// in context of the new remote.\\n\\t\\tsynchronized (remote) {\\n\\t\\t\\tremote.sendText(instruction);\\n\\t\\t}\\n\\n\\t}\\n\\n\\t/**\\n\\t * Sends a Guacamole instruction along the outbound WebSocket connection to\\n\\t * the connected Guacamole client. If an instruction is already in the\\n\\t * process of being sent by another thread, this function will block until\\n\\t * in-progress instructions are complete.\\n\\t *\\n\\t * @param instruction\\n\\t *     The instruction to send.\\n\\t *\\n\\t * @throws IOException\\n\\t *     If an I/O error occurs preventing the given instruction from being\\n\\t *     sent.\\n\\t */\\n\\tprivate void sendInstruction(GuacamoleInstruction instruction)\\n\\t\\tthrows IOException {\\n\\t\\tsendInstruction(instruction.toString());\\n\\t}\\n\\n\\t/**\\n\\t * Returns a new tunnel for the given session. How this tunnel is created\\n\\t * or retrieved is implementation-dependent.\\n\\t *\\n\\t * @param session The session associated with the active WebSocket\\n\\t *                connection.\\n\\t * @param config Configuration information associated with the instance of\\n\\t *               the endpoint created for handling this single connection.\\n\\t * @return A connected tunnel, or null if no such tunnel exists.\\n\\t * @throws GuacamoleException If an error occurs while retrieving the\\n\\t *                            tunnel, or if access to the tunnel is denied.\\n\\t */\\n\\tprotected abstract GuacamoleTunnel createTunnel(Session session, EndpointConfig config)\\n\\t\\tthrows GuacamoleException;\\n\\n\\t@Override\\n\\t@OnOpen\\n\\tpublic void onOpen(final Session session, EndpointConfig config) {\\n\\n\\t\\t// Store underlying remote for future use via sendInstruction()\\n\\t\\tremote = session.getBasicRemote();\\n\\n\\t\\ttry {\\n\\n\\t\\t\\t// Get tunnel\\n\\t\\t\\ttunnel = createTunnel(session, config);\\n\\t\\t\\tif (tunnel == null) {\\n\\t\\t\\t\\tcloseConnection(session, GuacamoleStatus.RESOURCE_NOT_FOUND);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t} catch (GuacamoleException e) {\\n\\t\\t\\tlogger.error(\\"Creation of WebSocket tunnel to guacd failed: {}\\", e.getMessage());\\n\\t\\t\\tlogger.debug(\\"Error connecting WebSocket tunnel.\\", e);\\n\\t\\t\\tcloseConnection(session, e.getStatus().getGuacamoleStatusCode(),\\n\\t\\t\\t\\te.getWebSocketCode());\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\t// Manually register message handler\\n\\t\\tsession.addMessageHandler(new MessageHandler.Whole<String>() {\\n\\n\\t\\t\\t@Override\\n\\t\\t\\tpublic void onMessage(String message) {\\n\\t\\t\\t\\tGuacamoleWebSocketTunnelEndpoint.this.onMessage(message);\\n\\t\\t\\t}\\n\\n\\t\\t});\\n\\n\\t\\t// Prepare read transfer thread\\n\\t\\tThread readThread = new Thread() {\\n\\n\\t\\t\\t@Override\\n\\t\\t\\tpublic void run() {\\n\\n\\t\\t\\t\\tStringBuilder buffer = new StringBuilder(BUFFER_SIZE);\\n\\t\\t\\t\\tGuacamoleReader reader = tunnel.acquireReader();\\n\\t\\t\\t\\tchar[] readMessage;\\n\\n\\t\\t\\t\\ttry {\\n\\n\\t\\t\\t\\t\\t// Send tunnel UUID\\n\\t\\t\\t\\t\\tsendInstruction(new GuacamoleInstruction(\\n\\t\\t\\t\\t\\t\\tGuacamoleTunnel.INTERNAL_DATA_OPCODE,\\n\\t\\t\\t\\t\\t\\ttunnel.getUUID().toString()\\n\\t\\t\\t\\t\\t));\\n\\n\\t\\t\\t\\t\\ttry {\\n\\n\\t\\t\\t\\t\\t\\t// Attempt to read\\n\\t\\t\\t\\t\\t\\twhile ((readMessage = reader.read()) != null) {\\n\\n\\t\\t\\t\\t\\t\\t\\t// Buffer message\\n\\t\\t\\t\\t\\t\\t\\tbuffer.append(readMessage);\\n\\n\\t\\t\\t\\t\\t\\t\\t// Flush if we expect to wait or buffer is getting full\\n\\t\\t\\t\\t\\t\\t\\tif (!reader.available() || buffer.length() >= BUFFER_SIZE) {\\n\\t\\t\\t\\t\\t\\t\\t\\tsendInstruction(buffer.toString());\\n\\t\\t\\t\\t\\t\\t\\t\\tbuffer.setLength(0);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\t// No more data\\n\\t\\t\\t\\t\\t\\tcloseConnection(session, GuacamoleStatus.SUCCESS);\\n\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t// Catch any thrown guacamole exception and attempt\\n\\t\\t\\t\\t\\t// to pass within the WebSocket connection, logging\\n\\t\\t\\t\\t\\t// each error appropriately.\\n\\t\\t\\t\\t\\tcatch (GuacamoleClientException e) {\\n\\t\\t\\t\\t\\t\\tlogger.info(\\"WebSocket connection terminated: {}\\", e.getMessage());\\n\\t\\t\\t\\t\\t\\tlogger.debug(\\"WebSocket connection terminated due to client error.\\", e);\\n\\t\\t\\t\\t\\t\\tcloseConnection(session, e.getStatus().getGuacamoleStatusCode(),\\n\\t\\t\\t\\t\\t\\t\\te.getWebSocketCode());\\n\\t\\t\\t\\t\\t} catch (GuacamoleConnectionClosedException e) {\\n\\t\\t\\t\\t\\t\\tlogger.debug(\\"Connection to guacd closed.\\", e);\\n\\t\\t\\t\\t\\t\\tcloseConnection(session, GuacamoleStatus.SUCCESS);\\n\\t\\t\\t\\t\\t} catch (GuacamoleException e) {\\n\\t\\t\\t\\t\\t\\tlogger.error(\\"Connection to guacd terminated abnormally: {}\\", e.getMessage());\\n\\t\\t\\t\\t\\t\\tlogger.debug(\\"Internal error during connection to guacd.\\", e);\\n\\t\\t\\t\\t\\t\\tcloseConnection(session, e.getStatus().getGuacamoleStatusCode(),\\n\\t\\t\\t\\t\\t\\t\\te.getWebSocketCode());\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t} catch (IOException e) {\\n\\t\\t\\t\\t\\tlogger.debug(\\"I/O error prevents further reads.\\", e);\\n\\t\\t\\t\\t\\tcloseConnection(session, GuacamoleStatus.SERVER_ERROR);\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t}\\n\\n\\t\\t};\\n\\n\\t\\treadThread.start();\\n\\n\\t}\\n\\n\\t@OnMessage\\n\\tpublic void onMessage(String message) {\\n\\n\\t\\t// Ignore inbound messages if there is no associated tunnel\\n\\t\\tif (tunnel == null)\\n\\t\\t\\treturn;\\n\\n\\t\\t// Filter received instructions, handling tunnel-internal instructions\\n\\t\\t// without passing through to guacd\\n\\t\\tGuacamoleWriter writer = new FilteredGuacamoleWriter(tunnel.acquireWriter(), new GuacamoleFilter() {\\n\\n\\t\\t\\t@Override\\n\\t\\t\\tpublic GuacamoleInstruction filter(GuacamoleInstruction instruction)\\n\\t\\t\\t\\tthrows GuacamoleException {\\n\\n\\t\\t\\t\\t// Filter out all tunnel-internal instructions\\n\\t\\t\\t\\tif (instruction.getOpcode().equals(GuacamoleTunnel.INTERNAL_DATA_OPCODE)) {\\n\\n\\t\\t\\t\\t\\t// Respond to ping requests\\n\\t\\t\\t\\t\\tList<String> args = instruction.getArgs();\\n\\t\\t\\t\\t\\tif (args.size() >= 2 && args.get(0).equals(PING_OPCODE)) {\\n\\n\\t\\t\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\t\\t\\tsendInstruction(new GuacamoleInstruction(\\n\\t\\t\\t\\t\\t\\t\\t\\tGuacamoleTunnel.INTERNAL_DATA_OPCODE,\\n\\t\\t\\t\\t\\t\\t\\t\\tPING_OPCODE, args.get(1)\\n\\t\\t\\t\\t\\t\\t\\t));\\n\\t\\t\\t\\t\\t\\t} catch (IOException e) {\\n\\t\\t\\t\\t\\t\\t\\tlogger.debug(\\"Unable to send \\\\\\"ping\\\\\\" response for WebSocket tunnel.\\", e);\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\treturn null;\\n\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t// Pass through all non-internal instructions untouched\\n\\t\\t\\t\\treturn instruction;\\n\\n\\t\\t\\t}\\n\\n\\t\\t});\\n\\n\\t\\ttry {\\n\\t\\t\\t// Write received message\\n\\t\\t\\twriter.write(message.toCharArray());\\n\\t\\t} catch (GuacamoleConnectionClosedException e) {\\n\\t\\t\\tlogger.debug(\\"Connection to guacd closed.\\", e);\\n\\t\\t} catch (GuacamoleException e) {\\n\\t\\t\\tlogger.debug(\\"WebSocket tunnel write failed.\\", e);\\n\\t\\t}\\n\\n\\t\\ttunnel.releaseWriter();\\n\\n\\t}\\n\\n\\t@Override\\n\\t@OnClose\\n\\tpublic void onClose(Session session, CloseReason closeReason) {\\n\\n\\t\\ttry {\\n\\t\\t\\tif (tunnel != null)\\n\\t\\t\\t\\ttunnel.close();\\n\\t\\t} catch (GuacamoleException e) {\\n\\t\\t\\tlogger.debug(\\"Unable to close WebSocket tunnel.\\", e);\\n\\t\\t}\\n\\n\\t}\\n\\n}\\n\\n```\\n\\n### \u53c2\u8003\\n\\n- [Apache Tomcat 10.0 Servlet API incompatibility](https://issues.apache.org/jira/browse/GUACAMOLE-1325)\\n\\n## querydsl\u4f9d\u8d56\u53d8\u66f4\\n\\n\u7531\u4e8e`springboot3`\u4e2d\u7684`javax`\u4f9d\u8d56\u53d8\u4e3a\u4e86`jakarta`, \u6240\u4ee5`querydsl`\u7684\u4f9d\u8d56\u4e5f\u9700\u8981\u53d8\u66f4\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5c06`querydsl`\u76f8\u5173\u4f9d\u8d56\u7684`classfiier`\u8bbe\u7f6e\u4e3a`jakarta`.\\n\\n```kotlin title=\\"build.kts\\"\\nimplementation(\\"com.querydsl:querydsl-jpa:5.0.0:jakarta\\")\\nkapt(\\"com.querydsl:querydsl-apt:5.0.0:jakarta\\")\\n```\\n\\n### \u53c2\u8003\\n\\n- [Are there plans to support SpringBoot3.0(Java17)?](https://github.com/querydsl/querydsl/issues/3296)\\n\\n`springboot3`\u7684`javax`\u4f9d\u8d56\u53d8\u4e3a\u4e86`jakarta`, \u4ee3\u7801\u4e2d\u9700\u8981\u5c06\u5305\u5bfc\u5165\u4ece`javax`\u5207\u6362\u5230`jakarta`.\\n\\n## \u5347\u7ea7`spring-boot3`\u540e\u8bbf\u95ee\u7531`@PreAuthorize`\u6ce8\u89e3\u4fdd\u62a4\u7684\u63a5\u53e3\u62a5\u9519\\n\\n\u5347\u7ea7`spring-boot3`\u540e\u8bbf\u95ee\u7531`@PreAuthorize`\u6ce8\u89e3\u4fdd\u62a4\u7684\u63a5\u53e3\u62a5\u9519, \u62a5\u9519\u4e3a401\\n\\n### \u539f\u56e0\\n\\n`RoleHierarchy`\u5931\u6548, \u5bfc\u81f4`MGMT_SUPER_ADMIN`\u65e0\u6cd5\u8bbf\u95ee`@PreAuthorize(\\"hasRole(\\"MGMT_ADMIN\\")\\")`\u6ce8\u89e3\u4fdd\u62a4\u7684\u63a5\u53e3\u3002<br/>\\n\u56e0\u4e3a`MGMT_SUPER_ADMIN`\u7ee7\u627f\u81ea`MGMT_ADMIN`\u3002<br/>\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u7531`@EnableGlobalMethodSecurity`\u5230`@EnableMethodSecurity`\u7684\u8fc1\u79fb\u5bfc\u81f4\u3002<br/>\\n\u8fd9\u4e24\u8005\u5185\u90e8\u5bf9\u4e8e`defaultMethodExpressionHandler`\u7684\u521d\u59cb\u5316\u884c\u4e3a\u4e0d\u4e00\u81f4\u5bfc\u81f4`RoleHierarchy`\u5931\u6548\u3002<br/>\\n\u533a\u522b\u5982\u4e0b\\n\\n- `@EnableGlobalMethodSecurity`\\n  <br/>\u5b9e\u73b0\u7c7b`GlobalMethodSecurityConfiguration`\u521b\u5efa`defaultMethodExpressionHandler`\u65f6\u4f1a\u5c1d\u8bd5\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6`RoleHierarchy`\u3002\\n- `@EnableMethodSecurity`\\n  <br/>\u5b9e\u73b0\u7c7b`PrePostMethodSecurityConfiguration`\u521b\u5efa`defaultMethodExpressionHandler`\u65f6\u4e0d\u4f1a\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6`RoleHierarchy`\u3002\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n- \u4e3a`spring-security`\u521b\u5efa`pull request`\u786e\u4fdd\u521d\u59cb\u5316`defaultMethodExpressionHandler`\u884c\u4e3a\u4fdd\u6301\u4e00\u81f4\\n- \u5bf9\u4e8e\u81ea\u8eab\u9879\u76ee\u5f53\u524d\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u521d\u59cb\u5316`MethodExpressionHandler`\\n\\n### \u5907\u6ce8\\n\\n```java title=\\"GlobalMethodSecurityConfiguration.java\\"\\npublic class GlobalMethodSecurityConfiguration implements ImportAware, SmartInitializingSingleton, BeanFactoryAware {\\n\\n\\t@Override\\n\\tpublic void afterSingletonsInstantiated() {\\n\\t\\ttry {\\n\\t\\t\\tinitializeMethodSecurityInterceptor();\\n\\t\\t} catch (Exception ex) {\\n\\t\\t\\tthrow new RuntimeException(ex);\\n\\t\\t}\\n\\t\\tPermissionEvaluator permissionEvaluator = getSingleBeanOrNull(PermissionEvaluator.class);\\n\\t\\tif (permissionEvaluator != null) {\\n\\t\\t\\tthis.defaultMethodExpressionHandler.setPermissionEvaluator(permissionEvaluator);\\n\\t\\t}\\n\\t\\tRoleHierarchy roleHierarchy = getSingleBeanOrNull(RoleHierarchy.class);\\n\\t\\tif (roleHierarchy != null) {\\n\\t\\t\\tthis.defaultMethodExpressionHandler.setRoleHierarchy(roleHierarchy);\\n\\t\\t}\\n\\t\\tAuthenticationTrustResolver trustResolver = getSingleBeanOrNull(AuthenticationTrustResolver.class);\\n\\t\\tif (trustResolver != null) {\\n\\t\\t\\tthis.defaultMethodExpressionHandler.setTrustResolver(trustResolver);\\n\\t\\t}\\n\\t\\tGrantedAuthorityDefaults grantedAuthorityDefaults = getSingleBeanOrNull(GrantedAuthorityDefaults.class);\\n\\t\\tif (grantedAuthorityDefaults != null) {\\n\\t\\t\\tthis.defaultMethodExpressionHandler.setDefaultRolePrefix(grantedAuthorityDefaults.getRolePrefix());\\n\\t\\t}\\n\\n\\t\\tthis.defaultMethodExpressionHandler = this.objectPostProcessor.postProcess(this.defaultMethodExpressionHandler);\\n\\t}\\n\\n}\\n```\\n\\n```java title=\\"PrePostMethodSecurityConfiguration.java\\"\\nfinal class PrePostMethodSecurityConfiguration {\\n\\n\\tprivate static MethodSecurityExpressionHandler defaultExpressionHandler(\\n\\t\\tObjectProvider<GrantedAuthorityDefaults> defaultsProvider, ApplicationContext context) {\\n\\t\\tDefaultMethodSecurityExpressionHandler handler = new DefaultMethodSecurityExpressionHandler();\\n\\t\\tdefaultsProvider.ifAvailable((d) -> handler.setDefaultRolePrefix(d.getRolePrefix()));\\n\\t\\thandler.setApplicationContext(context);\\n\\t\\treturn handler;\\n\\t}\\n\\n}\\n```\\n\\n### \u53c2\u8003\\n\\n- [issue](https://github.com/spring-projects/spring-security/issues/12662)\\n- [pull request](https://github.com/spring-projects/spring-security/pull/12673)\\n- [GlobalMethodSecurityConfiguration.java ](https://github.com/spring-projects/spring-security/blob/6.0.x/config/src/main/java/org/springframework/security/config/annotation/method/configuration/GlobalMethodSecurityConfiguration.java)\\n- [PrePostMethodSecurityConfiguration.java](https://github.com/spring-projects/spring-security/blob/6.0.x/config/src/main/java/org/springframework/security/config/annotation/method/configuration/PrePostMethodSecurityConfiguration.java)\\n\\n## \u5347\u7ea7`spring-boot3`\u540e\u4f7f\u7528Token\u8bf7\u6c42\u4fdd\u62a4\u8d44\u6e90\u62a5\u9519\\n\\n\u4f7f\u7528Token\u8bf7\u6c42\u4fdd\u62a4\u8d44\u6e90\u62a5\u9519401\\n\\n### \u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f`spring-security`\u4e2d\u8fdb\u884c\u4e86\u91cd\u6784\u9700\u8981\u5bf9`securityContext`\u8fdb\u884c\u914d\u7f6e\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n1. `http.securityContext().requireExplicitSave(false).and()`\\n2. `http.securityContext().securityContextRepository(new HttpSessionSecurityContextRepository()).and()`\\n\\n### \u5907\u6ce8\\n\\n> spring6\u4e4b\u540eSecurityContextHolderFilter\u66ff\u6362\u4e86SecurityContextPersistenceFilter<br/>\\n> SecurityContextRepository\u9ed8\u8ba4\u5b9e\u73b0\u4e5f\u53d8\u4e86<br/>\\n> (HttpSessionSecurityContextRepository) -> (RequestAttributeSecurityContextRepository)<br/>\\n\\n### \u53c2\u8003\\n\\n- [Spring Security 6 CustomAuthenticationFilter(intend to replace the UsernamePasswordAuthenticationFilter) does not work](https://stackoverflow.com/questions/74629234/spring-security-6-customauthenticationfilterintend-to-replace-the-usernamepassw)\\n- [Default to SecurityContextHolderFilter instead of SecurityContextPersistenceFilter #11110](https://github.com/spring-projects/spring-security/issues/11110)\\n\\n## \u5347\u7ea7`spring-boot3`\u540e\u8bf7\u6c42`/swagger-ui/index.html`\u62a5\u9519\\n\\n\u63a5\u53e3\u62a5\u9519, \u5185\u5bb9\u5982\u4e0b\\n\\n```log title=\\"chrome\\"\\nThis page isn\u2019t working\\nIf the problem continues, contact the site owner.\\nHTTP ERROR 401\\n```\\n\\n### \u539f\u56e0\\n\\nspringdoc\u7248\u672c\u8fc7\u8001, \u9700\u8981\u5347\u7ea7\u5230v2\u7248\u672c\u3002<br/>\\n[springdoc.org](https://springdoc.org/)\\n\u4e0a\u7684\u6709\u76f8\u5173\u8bf4\u660e`For spring-boot v3 support, make sure you use springdoc-openapi v2`\\n\\n\u672c\u9879\u76ee\u7684\u539f\u59cb\u914d\u7f6e\u5982\u4e0b\\n\\n```xml title=\\"pom.xml\\"\\n\\n<dependency>\\n\\t<groupId>org.springdoc</groupId>\\n\\t<artifactId>springdoc-openapi-ui</artifactId>\\n\\t<version>1.6.14</version>\\n</dependency>\\n```\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u5347\u7ea7springdoc\u7248\u672c\u5230v2, \u5347\u7ea7\u540e\u7684\u914d\u7f6e\u5982\u4e0b, v2\u7684artifactId\u53d1\u751f\u4e86\u53d8\u5316\\n\\n```xml title=\\"pom.xml\\"\\n\\n<dependency>\\n\\t<groupId>org.springdoc</groupId>\\n\\t<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>\\n\\t<version>2.0.2</version>\\n</dependency>\\n```\\n\\n### \u53c2\u8003\\n\\n- [springdoc.org](https://springdoc.org/)\\n- [springdocv2](https://springdoc.org/v2/)\\n- [How to run Swagger 3 on Spring Boot 3](https://stackoverflow.com/questions/74614369/how-to-run-swagger-3-on-spring-boot-3)\\n\\n### \u4ee3\u7801\u8c03\u7528\u6d41\u7a0b\\n\\n```log title=\\"AuthorizationFilter.doFilter\\"\\nthis.authorizationManager.check(this::getAuthentication, request);\\n```\\n\\n```log title=\\"ObservationAuthorizationManager.check\\"\\nAuthorizationDecision decision = this.delegate.check(wrapped, object);\\n```\\n\\n```log title=\\"RequestMatcherDelegatingAuthorizationManager.check\\"\\nmatcher.matcher(request);\\n```\\n\\n```log title=\\"MvcRequestMatcher.matcher\\"\\n// \u8fd4\u56de\u4e86`path`\u4e3a`/error`\u7684`handlerMapping`(\u8bf4\u660e\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684`handlerMapping`)\\nMatchableHandlerMapping mapping = getMapping(request);\\n```\\n\\n```log title=\\"RequestMatcherDelegatingAuthorizationManager.check\\"\\nRequestMatcher matcher = mapping.getRequestMatcher();\\nMatchResult matchResult = matcher.matcher(request);\\n// \u7531\u4e8eswagger\u5bf9\u5e94\u7684handler\u627e\u4e0d\u5230, \u6240\u4ee5\u6ca1\u6709Match\\nif (matchResult.isMatch()) {\\n\\tAuthorizationManager<RequestAuthorizationContext> manager = mapping.getEntry();\\n\\tif (this.logger.isTraceEnabled()) {\\n\\t\\tthis.logger.trace(LogMessage.format(\\"Checking authorization on %s using %s\\", request, manager));\\n\\t}\\n\\t// \u540e\u7eed\u547d\u4e2d\u4e86Mvc [pattern=\'/*/*.html\']\u5bf9\u5e94\u7684Matcher, \u800c\u8be5Matcher\u5bf9\u5e94\u7684\u5339\u914d\u89c4\u5219\u8981\u6c42\u9700\u8981`authentication`\u4e0d\u4e3a\u7a7a, \u5bfc\u81f4\u62a5\u9519\\n\\treturn manager.check(authentication, new RequestAuthorizationContext(request, matchResult.getVariables()));\\n}\\n```\\n\\n## api\u63a5\u53e3\u62a5\u9519\u540e\u6ca1\u6709\u8fd4\u56de\u5f02\u5e38\u4fe1\u606f\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u65b0\u7248\u672c\u7684`spring-boot`\u9ed8\u8ba4\u4e0d\u8fd4\u56de\u5f02\u5e38\u4fe1\u606f, \u9700\u8981\u5728`application.yml`\u4e2d\u589e\u52a0\u4ee5\u4e0b\u914d\u7f6e\\n\\n```yaml\\nserver:\\n  error:\\n    include-message: always\\n```"},{"id":"/2023/03/03/passwd-in-script","metadata":{"permalink":"/blog/2023/03/03/passwd-in-script","source":"@site/blog/2023-03-03/passwd-in-script.md","title":"\u811a\u672c\u4e2d\u5b9e\u73b0\u4fee\u6539\u7528\u6237\u5bc6\u7801","description":"\u5e73\u65f6\u5728\u5199\u811a\u672c\u7684\u65f6\u5019, \u6709\u65f6\u5019\u4f1a\u9700\u8981\u4f7f\u7528passwd\u547d\u4ee4\u6765\u4fee\u6539\u7528\u6237\u7684\u5bc6\u7801.","date":"2023-03-03T00:00:00.000Z","formattedDate":"March 3, 2023","tags":[{"label":"linux","permalink":"/blog/tags/linux"}],"readingTime":2.885,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["linux"]},"unlisted":false,"prevItem":{"title":"\u5347\u7ea7springboot3\u9047\u5230\u7684\u95ee\u9898","permalink":"/blog/2023/03/05/problem-springboot3-upgrade"},"nextItem":{"title":"\u57fa\u4e8eclojure\u8868\u8fbe\u5f0f\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1","permalink":"/blog/2023/03/02/clojure-validation"}},"content":"\u5e73\u65f6\u5728\u5199\u811a\u672c\u7684\u65f6\u5019, \u6709\u65f6\u5019\u4f1a\u9700\u8981\u4f7f\u7528`passwd`\u547d\u4ee4\u6765\u4fee\u6539\u7528\u6237\u7684\u5bc6\u7801.<br/>\\n\u4f8b\u5982\u4e3a`NIS`\u7684\u6d4b\u8bd5\u670d\u52a1\u5668\u65b0\u589e\u4e00\u4e9b\u6d4b\u8bd5\u7528\u6237, \u5e76\u4e14\u4e3a\u8fd9\u4e9b\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801.<br/>\\n\u7531\u4e8e`passwd`\u9700\u8981\u4ea4\u4e92\u5f0f\u7684\u8f93\u5165, \u6240\u4ee5\u5728\u811a\u672c\u4e2d\u4f7f\u7528`passwd`\u547d\u4ee4\u4f1a\u62a5\u9519.<br/>\\n\u4e00\u4e2a\u6f5c\u5728\u7684\u89e3\u51b3\u65b9\u6848\u662f\u52a0\u5165`--stdin`\u53c2\u6570\u4f46\u662f\u6709\u7684`linux`\u53d1\u884c\u7248\u4e2d`passwd`\u547d\u4ee4\u4e2d\u7684`--stdin`\u4e0d\u5b58\u5728.<br/>\\n\u5982\u679c\u4f60\u8fd8\u8fd9\u6837\u6267\u884c\u7684\u8bdd\u5c06\u4f1a\u663e\u793a\u4ee5\u4e0b\u9519\u8bef.<br/>\\n\\n```log\\npasswd: unrecognized option \'--stdin\'\\nUsage: passwd [options] [LOGIN]\\n\\nOptions:\\n  -a, --all                     report password status on all accounts\\n  -d, --delete                  delete the password for the named account\\n  -e, --expire                  force expire the password for the named account\\n  -h, --help                    display this help message and exit\\n  -k, --keep-tokens             change password only if expired\\n  -i, --inactive INACTIVE       set password inactive after expiration\\n                                to INACTIVE\\n  -l, --lock                    lock the password of the named account\\n  -n, --mindays MIN_DAYS        set minimum number of days before password\\n                                change to MIN_DAYS\\n  -q, --quiet                   quiet mode\\n  -r, --repository REPOSITORY   change password in REPOSITORY repository\\n  -R, --root CHROOT_DIR         directory to chroot into\\n  -S, --status                  report password status on the named account\\n  -u, --unlock                  unlock the password of the named account\\n  -w, --warndays WARN_DAYS      set expiration warning days to WARN_DAYS\\n  -x, --maxdays MAX_DAYS        set maximum number of days before password\\n                                change to MAX_DAYS\\n```\\n\\n\u7531\u4e8e`passwd`\u547d\u4ee4\u4e2d\u6ca1\u6709`--stdin`\u9009\u9879, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5176\u4ed6\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u4f7f\u7528`chpasswd`\\n\\n`chpasswd`\u547d\u4ee4\u53ef\u4ee5\u7528\u4e8e\u6279\u91cf\u4fee\u6539\u7528\u6237\u7684\u5bc6\u7801, \u8be5\u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b.\\n\\n```bash\\necho \\"user1:password1\\" | chpasswd\\n```\\n\\n## \u5907\u6ce8\\n\\n\u4e0d\u5efa\u8bae\u5728\u811a\u672c\u4e2d\u4fee\u6539\u5bc6\u7801, \u56e0\u4e3a\u8fd9\u6837\u4f1a\u6cc4\u6f0f\u5bc6\u7801.<br/>\\n\u4f8b\u5982\u5f53\u811a\u672c\u589e\u52a0`set -x`\u9009\u9879\u65f6, \u4f1a\u5c06\u5bc6\u7801\u6253\u5370\u51fa\u6765.<br/>\\n\u8fd9\u79cd\u65b9\u5f0f\u6700\u597d\u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u4f7f\u7528.<br/>\\n\\n> Nothing you can do in bash can possibly work. \\n> passwd(1) does not read from standard input. \\n> This is intentional. It is for your protection. \\n> Passwords were never intended to be put into programs, or generated by programs. \\n> They were intended to be entered only by the fingers of an actual human being, with a functional brain, and never, ever written down anywhere. \\n> Nonetheless, we get hordes of users asking how they can circumvent 35 years of Unix security.\\n\\nfrom\\n- [I want to set a user\'s password using the Unix passwd command, but how do I script that? It doesn\'t read standard input!](http://mywiki.wooledge.org/BashFAQ/078)\\n\\n## \u53c2\u8003\\n\\n- [Using the passwd Command from Within a Shell Script](https://www.baeldung.com/linux/passwd-shell-script#1-using-stdin-option)\\n- [Alternative to passwd --stdin in Ubuntu](https://askubuntu.com/questions/1115795/alternative-to-passwd-stdin-in-ubuntu)\\n- [Using the passwd command from within a shell script](https://stackoverflow.com/questions/714915/using-the-passwd-command-from-within-a-shell-script)\\n- [I want to set a user\'s password using the Unix passwd command, but how do I script that? It doesn\'t read standard input!](http://mywiki.wooledge.org/BashFAQ/078)"},{"id":"/2023/03/02/clojure-validation","metadata":{"permalink":"/blog/2023/03/02/clojure-validation","source":"@site/blog/2023-03-02/clojure-validation.md","title":"\u57fa\u4e8eclojure\u8868\u8fbe\u5f0f\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1","description":"\u6570\u636e\u9a8c\u8bc1\u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42, \u5bf9\u4e8ejava\u9879\u76ee\u6765\u8bf4, \u76ee\u524djakarta\u7684bean validation\u5df2\u7ecf\u6210\u4e3a\u4e86java\u4e2d\u7684\u6807\u51c6.","date":"2023-03-02T00:00:00.000Z","formattedDate":"March 2, 2023","tags":[{"label":"clojure","permalink":"/blog/tags/clojure"},{"label":"kotlin","permalink":"/blog/tags/kotlin"},{"label":"java","permalink":"/blog/tags/java"},{"label":"spring","permalink":"/blog/tags/spring"},{"label":"validation","permalink":"/blog/tags/validation"}],"readingTime":15.07,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["clojure","kotlin","java","spring","validation"]},"unlisted":false,"prevItem":{"title":"\u811a\u672c\u4e2d\u5b9e\u73b0\u4fee\u6539\u7528\u6237\u5bc6\u7801","permalink":"/blog/2023/03/03/passwd-in-script"},"nextItem":{"title":"ubuntu\u4e2d\u5e38\u7528\u7684apt\u6e90","permalink":"/blog/2023/02/26/apt-mirror"}},"content":"\u6570\u636e\u9a8c\u8bc1\u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42, \u5bf9\u4e8e`java`\u9879\u76ee\u6765\u8bf4, \u76ee\u524d`jakarta`\u7684`bean validation`\u5df2\u7ecf\u6210\u4e3a\u4e86java\u4e2d\u7684\u6807\u51c6. <br/>\\n\u5176\u81ea\u5e26\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684\u6570\u636e\u9a8c\u8bc1\u6ce8\u89e3, \u4f8b\u5982`@NotNull`, `@NotEmpty`, `@Size`\u7b49.<br/>\\n\u8fd9\u4e9b\u6ce8\u89e3\u5982\u679c\u9047\u5230\u590d\u6742\u7684\u6570\u636e\u9a8c\u8bc1\u9700\u6c42\u65f6, \u5c31\u4f1a\u663e\u5f97\u529b\u4e0d\u4ece\u5fc3. \u6240\u4ee5\u9700\u8981\u4e00\u79cd\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1\u65b9\u5f0f.<br/>\\n\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u79cd\u9700\u6c42, \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7`clojure`\u8868\u8fbe\u5f0f\u6765\u5b9e\u73b0\u6570\u636e\u9a8c\u8bc1.<br/>\\n\u540c\u65f6\u6211\u4eec\u9700\u8981\u548c\u73b0\u6709\u7684`bean validation`\u4e00\u8d77\u4f7f\u7528, \u4ee5\u4fbf\u4e8e\u6ee1\u8db3\u73b0\u6709\u7684\u4e1a\u52a1\u9700\u6c42.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## Why clojure\\n\\n### \u57fa\u4e8e\u8868\u8fbe\u5f0f\\n\\n`clojure`\u662f\u4e00\u4e2a\u57fa\u4e8e\u8868\u8fbe\u5f0f\u7684\u8bed\u8a00, \u6240\u4ee5\u5b83\u7684\u6570\u636e\u9a8c\u8bc1\u529f\u80fd\u4e5f\u662f\u57fa\u4e8e\u8868\u8fbe\u5f0f\u7684.<br/>\\n\u8868\u8fbe\u5f0f\u7684\u597d\u5904\u662f, \u5b83\u7684\u8868\u8fbe\u80fd\u529b\u975e\u5e38\u5f3a\u5927, \u901a\u8fc7\u8868\u8fbe\u5f0f, \u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u975e\u5e38\u590d\u6742\u7684\u6570\u636e\u9a8c\u8bc1.<br/>\\n\u540c\u65f6\u8868\u8fbe\u5f0f\u7684\u53ef\u8bfb\u6027\u4e5f\u975e\u5e38\u5f3a, \u901a\u8fc7\u8868\u8fbe\u5f0f, \u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u7406\u89e3\u6570\u636e\u9a8c\u8bc1\u7684\u903b\u8f91.<br/>\\n\\n### \u6570\u636e\u5904\u7406\\n\\n`clojure`\u662f\u4e00\u4e2a\u51fd\u6570\u5f0f\u8bed\u8a00(`functional programming`).<br/>\\n\u51fd\u6570\u5f0f\u8bed\u8a00\u7684\u4e00\u4e2a\u7279\u70b9\u5c31\u662f\u6570\u636e\u5904\u7406\u80fd\u529b\u975e\u5e38\u5f3a\u5927.<br/>\\n\u5b83\u62bd\u8c61\u4e86\u6570\u636e\u7684\u64cd\u4f5c, \u901a\u8fc7\u51fd\u6570\u5f0f\u7684\u65b9\u5f0f\u6765\u5904\u7406\u6570\u636e.<br/>\\n\u5bf9\u4e8e`clojure`\u6765\u8bf4, \u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u975e\u5e38\u65b9\u4fbf\u7684\u6570\u636e\u64cd\u4f5c\u51fd\u6570, \u4f8b\u5982\\n\\n- `map`\\n- `filter`\\n- `reduce`\\n- `zipmap`\\n- `group-by`\\n- `partition`\\n- `sort-by`\\n- `sort-with`\\n- `take`\\n- `take-while`\\n- `drop`\\n- ...\\n\\n### \u57fa\u4e8e`jvm`\\n\\n`clojure`\u662f\u57fa\u4e8e`jvm`\u7684, \u6240\u4ee5\u5b83\u53ef\u4ee5\u548c`java`\u65e0\u7f1d\u96c6\u6210.<br/>\\n\\n## \u5b9e\u73b0\\n\\n\u5b9e\u73b0\u4e3b\u8981\u5206\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\\n\\n- `jakarta`\u6269\u5c55\u5b9e\u73b0\\n- `clojure`\u8868\u8fbe\u5f0f\u5904\u7406\\n- `springboot`\u96c6\u6210\\n\\n### `jakarta`\u6269\u5c55\u5b9e\u73b0\\n\\n#### \u65b0\u589e\u81ea\u5b9a\u4e49\u6ce8\u89e3`@ClojureExpressionConstraint`\\n\\n\u56e0\u4e3a`jakarta`\u7684`bean validation`\u662f\u57fa\u4e8e\u6ce8\u89e3\u7684, \u6700\u7ec8\u7528\u6237\u5728\u4f7f\u7528\u65f6, \u9700\u8981\u901a\u8fc7\u6ce8\u89e3\u7684\u65b9\u5f0f\u6765\u4f7f\u7528\u8be5\u529f\u80fd.<br/>\\n\u6240\u4ee5\u6211\u4eec\u4e5f\u9700\u8981\u8bbe\u8ba1\u4e00\u4e2a\u6ce8\u89e3, \u901a\u8fc7\u8be5\u6ce8\u89e3\u6765\u4f7f\u7528\u6211\u4eec\u7684\u6570\u636e\u9a8c\u8bc1\u529f\u80fd.<br/>\\n\\n\u4ee3\u7801\u5982\u4e0b:\\n\\n```kotlin\\n/**\\n * This is a validation annotation based on clojure expression to validate your data.\\n *\\n * Note:\\n * 1. The expression only has one parameter, which is the value that will be validated.\\n * The parameter is bound to the symbol \\"it\\". You can use \\"it\\" to refer to the value.\\n * 2. The expression must return a boolean value.\\n * Example:\\n * Right expression: (> (count it) 5)\\n * Bad expression: (count it)\\n * 3. The size of the outer form must be 1.\\n * If you want to use multiple expressions, you can use \\"and\\" or \\"or\\" to combine them.\\n * Example:\\n * The expression \\"(and (> (count it) 5) (= it (clojure.string/lower-case it)))\\" is right.\\n * The expression \\"(> (count it) 5) (= it (clojure.string/lower-case it))\\" is wrong.\\n *\\n * Examples:\\n * 1. The type of value is string. We validate the length of the string must be greater than 5.\\n * (> (count it) 5)\\n * 2. The type of value is collection. We validate the size of the collection must be greater than 5.\\n * (> (count it) 5)\\n * 3. The type of value is string. We validate the string must be a lower case string.\\n * (= it (clojure.string/lower-case it))\\n * 4. The type is javaBean, and it has a property named age. We validate the age must be greater than 0 and less than 100.\\n * (let [age (:age it)] (and (> age 0) (< age 100)))\\n *\\n * @author Xiangcheng.Kuo\\n * @see ClojureExpressionConstraintValidator\\n */\\n@Repeatable\\n@Target(AnnotationTarget.PROPERTY, AnnotationTarget.FIELD)\\n@Retention(AnnotationRetention.RUNTIME)\\n@Constraint(validatedBy = [ClojureExpressionConstraintValidator::class])\\nannotation class ClojureExpressionConstraint(\\n\\tval message: String,\\n\\tval groups: Array<KClass<*>> = [],\\n\\tval payload: Array<KClass<out Payload>> = [],\\n\\tval value: String,\\n)\\n```\\n\\n#### \u65b0\u589e`ClojureExpressionConstraintValidator`\u4ee5\u5b9e\u73b0\u6ce8\u89e3\u7684\u9a8c\u8bc1\\n\\n\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\u7684\u5904\u7406, \u6211\u4eec\u9700\u8981\u5b9e\u73b0`ConstraintValidator`\u6765\u8fdb\u884c\u9a8c\u8bc1.<br/>\\n\\n\u4ee3\u7801\u5982\u4e0b:\\n\\n```kotlin\\n/**\\n * This is a validator for [ClojureExpressionConstraint] annotation.\\n * It will evaluate the expression with the given value and return the boolean result as the validation result.\\n *\\n * @author Xiangcheng.Kuo\\n * @see ClojureExpressionConstraint\\n */\\nclass ClojureExpressionConstraintValidator(\\n\\tprivate val evaluator: ClojureExpressionEvaluator\\n) : ConstraintValidator<ClojureExpressionConstraint, Any> {\\n\\n\\tprivate lateinit var annotation: ClojureExpressionConstraint\\n\\n\\toverride fun initialize(constraintAnnotation: ClojureExpressionConstraint) {\\n\\t\\tthis.annotation = constraintAnnotation\\n\\t}\\n\\n\\toverride fun isValid(value: Any?, context: ConstraintValidatorContext): Boolean {\\n\\t\\treturn evaluator.evaluate(annotation.value, value) as Boolean\\n\\t}\\n\\n}\\n```\\n\\n### `clojure`\u8868\u8fbe\u5f0f\u5904\u7406\\n\\n#### \u65b0\u589e`ClojureExpressionEvaluator`\u4ee5\u5b9e\u73b0`clojure`\u8868\u8fbe\u5f0f\u7684\u5904\u7406\\n\\n`ClojureExpressionEvaluator`\u62bd\u8c61\u4e86`clojure`\u8868\u8fbe\u5f0f\u7684\u5904\u7406. \u5bf9\u4e8e\u4e0a\u5c42\u8c03\u7528\u65b9\u6765\u8bf4\u4e0d\u9700\u8981\u5173\u5fc3`clojure`\u8868\u8fbe\u5f0f\u7684\u5904\u7406\u7ec6\u8282,\\n\u53ea\u9700\u8981\u8c03\u7528`evaluate`\u65b9\u6cd5\u5373\u53ef.<br/>\\n\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u6839\u636e\u7ed9\u5b9a\u7684`clojure`\u8868\u8fbe\u5f0f\u53ca\u8f93\u5165\u8fdb\u884c\u5904\u7406\u5e76\u5f97\u51fa\u8fd4\u56de\u7ed3\u679c.<br/>\\n\u901a\u8fc7\u4e0e`clojure`\u7684\u4e92\u64cd\u4f5c, \u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0`clojure`\u8868\u8fbe\u5f0f\u7684\u89e3\u6790.<br/>\\n\u4ee5\u4e0b\u662f\u76f8\u5173\u4ee3\u7801:\\n\\n```kotlin\\n/**\\n * An interface used to evaluate the clojure expression with the given param and return the result.\\n *\\n * @author Xiangcheng.Kuo\\n */\\ninterface ClojureExpressionEvaluator {\\n\\n\\tfun evaluate(expression: String, param: Any?): Any?\\n\\n}\\n\\n/**\\n * The default implementation of [ClojureExpressionEvaluator].\\n *\\n * @author Xiangcheng.Kuo\\n * @see Class to refer to\\n */\\nobject DefaultClojureExpressionEvaluator : ClojureExpressionEvaluator {\\n\\n\\tprivate val evalFun: IFn\\n\\n\\tinit {\\n\\t\\tcom.fastonetech.lib.clojure.require(\\"com.fastonetech.lib.clojure.support.evaluation\\".toCljSymbol())\\n\\t\\tevalFun = Clojure.`var`(\\"com.fastonetech.lib.clojure.support.evaluation/evaluate-expression\\")\\n\\t}\\n\\n\\toverride fun evaluate(expression: String, param: Any?): Any? =\\n\\t\\tevalFun(expression, param.toCljValue())\\n\\n}\\n```\\n\\n#### \u65b0\u589eevaluation.clj\u6765\u5b9e\u73b0\u6700\u7ec8\u7684`clojure`\u8868\u8fbe\u5f0f\u7684\u89e3\u6790\u5904\u7406\\n\\n`evaluation.clj`\u662f\u4e00\u4e2a`clojure`\u7684\u6587\u4ef6, \u7528\u4e8e\u5b9e\u73b0`clojure`\u8868\u8fbe\u5f0f\u7684\u89e3\u6790.<br/>\\n\u4ee5\u4e0b\u662f\u76f8\u5173\u4ee3\u7801:\\n\\n```clojure\\n(ns com.fastonetech.lib.clojure.support.evaluation\\n  (:require [clojure.java.data :as data]))\\n\\n; We need to convert the list to vector to avoid the evaluator think the list is a function call.\\n; For example, if we have a list like (1 2 3), the evaluator will think it is a function call.\\n; So we need to convert it to [1 2 3] to avoid this problem.\\n(defn as-available-form [form]\\n  (if (seq? form) (into [] form) form))\\n\\n(defn object-to-map [object]\\n  (data/from-java-deep object {:add-class false}))\\n\\n(defn object-to-form [^Object object]\\n  (clojure.walk/postwalk as-available-form (object-to-map object)))\\n\\n(defn build-form [value-form expression-form]\\n  (list `let [\'it value-form] expression-form))\\n\\n(defn expression-as-form [^String expression]\\n  (read-string expression))\\n\\n(defn evaluate-expression [^String expression ^Object param]\\n  (let [value-form (object-to-form param)\\n        expression-form (expression-as-form expression)\\n        form (build-form value-form expression-form)]\\n    (println \\"Expression form: \\" form)\\n    (let [result (eval form)]\\n      (println \\"Result: \\" result)\\n      result)))\\n```\\n\\n### `springboot`\u96c6\u6210\\n\\n\u8be5\u90e8\u5206\u4e3b\u8981\u662f\u5c06\u4e0a\u9762\u7684\u4ee3\u7801\u96c6\u6210\u5230`springboot`\u4e2d.<br/>\\n\u4e3b\u8981\u662f\u5c06`ClojureExpressionConstraintValidator`\u6dfb\u52a0\u5230\u5bb9\u5668\u4e2d\u8fd9\u6837`springboot`\u5c31\u53ef\u4ee5\u81ea\u52a8\u7684\u5bf9\u6ce8\u89e3\u8fdb\u884c\u9a8c\u8bc1\u4e86.<br/>\\n\\n#### ClojureExpressionValidationAutoConfiguration\\n\\n```kotlin\\n@AutoConfiguration\\nclass ClojureExpressionValidationAutoConfiguration {\\n\\n\\t@Bean\\n\\t@ConditionalOnMissingBean\\n\\tfun clojureExpressionConstraintValidator(evaluator: ClojureExpressionEvaluator): ClojureExpressionConstraintValidator =\\n\\t\\tClojureExpressionConstraintValidator(\\n\\t\\t\\tevaluator = evaluator\\n\\t\\t)\\n\\n\\t@Bean\\n\\t@ConditionalOnMissingBean\\n\\tfun clojureExpressionEvaluator(): ClojureExpressionEvaluator =\\n\\t\\tDefaultClojureExpressionEvaluator\\n\\n}\\n```\\n\\n#### \u914d\u7f6e`META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports`\\n\\n\u5728springboot3\u4e2d, \u6211\u4eec\u9700\u8981\u5728`META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports`\\n\u4e2d\u6dfb\u52a0\u9700\u8981\u81ea\u52a8\u914d\u7f6e\u7684\u7c7b.<br/>\\n\u65e7\u7684\u7248\u672c\u662f`spring.factories`, \u4f46\u662f\u5728springboot3\u4e2d\u5df2\u7ecf\u4e0d\u80fd\u7ee7\u7eed\u4f7f\u7528\u4e86.<br/>\\n\\n```kotlin\\ncom.fastonetech.lib.validation.spring.autoconfigure.ClojureExpressionValidationAutoConfiguration\\n```\\n\\n## \u603b\u7ed3\\n\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230, \u901a\u8fc7`clojure`\u7684\u4e92\u64cd\u4f5c, \u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0`clojure`\u8868\u8fbe\u5f0f\u7684\u89e3\u6790.<br/>\\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728`springboot`\u4e2d\u4f7f\u7528`clojure`\u8868\u8fbe\u5f0f\u6765\u8fdb\u884c\u9a8c\u8bc1\u4e86.<br/>\\n\u4f46\u662f\u76ee\u524d\u7684\u5b9e\u73b0\u8fd8\u6709\u5f88\u591a\u4e0d\u8db3, \u4e3b\u8981\u5982\u4e0b\\n\\n- \u6ca1\u6709\u5bf9`clojure`\u8868\u8fbe\u5f0f\u8fdb\u884c\u7f13\u5b58, \u5bf9\u4e8e\u540c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u591a\u6b21\u9a8c\u8bc1\u4f1a\u91cd\u590d\u89e3\u6790<br/>\\n- `clojure`\u8868\u8fbe\u5f0f\u5185\u53ea\u80fd\u8bbf\u95ee`clojure.core`\u547d\u540d\u7a7a\u95f4\u7684\u5185\u5bb9, \u4e0d\u80fd\u8bbf\u95ee\u5176\u4ed6\u547d\u540d\u7a7a\u95f4\u7684\u5185\u5bb9<br/>\\n\\n\u8fd9\u4e9b\u90fd\u662f\u53ef\u4ee5\u4f18\u5316\u7684\u5730\u65b9, \u4f46\u662f\u76ee\u524d\u8fd8\u6ca1\u6709\u65f6\u95f4\u53bb\u505a.<br/>\\n\\n## \u9047\u5230\u7684\u95ee\u9898\\n\\n### \u81ea\u5b9a\u4e49\u6ce8\u89e3\u6ca1\u6709\u88ab\u8bc6\u522b\\n\\n#### \u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u4e3b\u8981\u539f\u56e0\u5728\u5b9a\u4e49\u6ce8\u89e3\u662f\u6307\u5b9a\u4e86`@Target`\u6ce8\u89e3\u4e2d\u7684`AnnotationTarget.PROPERTY`\u9020\u6210\u7684\\n\\n\u53cd\u7f16\u8bd1\u540e\u7684`java`\u4ee3\u7801\u5982\u4e0b\\n\\n```java\\n\\n@Metadata(\\n\\t\\tmv = {1, 8, 0},\\n\\t\\tk = 1,\\n\\t\\td1 = {\\"\\\\u0000\\\\\\"\\\\n\\\\u0002\\\\u0018\\\\u0002\\\\n\\\\u0002\\\\u0010\\\\u0000\\\\n\\\\u0000\\\\n\\\\u0002\\\\u0010\\\\u000e\\\\n\\\\u0002\\\\b\\\\b\\\\n\\\\u0002\\\\u0010\\\\u000b\\\\n\\\\u0002\\\\b\\\\u0002\\\\n\\\\u0002\\\\u0010\\\\b\\\\n\\\\u0002\\\\b\\\\u0002\\\\b\\\\u0086\\\\b\\\\u0018\\\\u00002\\\\u00020\\\\u0001B\\\\r\\\\u0012\\\\u0006\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u0003\xa2\\\\u0006\\\\u0002\\\\u0010\\\\u0004J\\\\t\\\\u0010\\\\t\\\\u001a\\\\u00020\\\\u0003H\xc6\\\\u0003J\\\\u0013\\\\u0010\\\\n\\\\u001a\\\\u00020\\\\u00002\\\\b\\\\b\\\\u0002\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u0003H\xc6\\\\u0001J\\\\u0013\\\\u0010\\\\u000b\\\\u001a\\\\u00020\\\\f2\\\\b\\\\u0010\\\\r\\\\u001a\\\\u0004\\\\u0018\\\\u00010\\\\u0001H\xd6\\\\u0003J\\\\t\\\\u0010\\\\u000e\\\\u001a\\\\u00020\\\\u000fH\xd6\\\\u0001J\\\\t\\\\u0010\\\\u0010\\\\u001a\\\\u00020\\\\u0003H\xd6\\\\u0001R\\\\u001c\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u00038\\\\u0006X\\\\u0087\\\\u0004\xa2\\\\u0006\\\\u000e\\\\n\\\\u0000\\\\u0012\\\\u0004\\\\b\\\\u0005\\\\u0010\\\\u0006\\\\u001a\\\\u0004\\\\b\\\\u0007\\\\u0010\\\\b\xa8\\\\u0006\\\\u0011\\"},\\n\\t\\td2 = {\\"Lcom/fastonetech/lib/validation/clojure/PatchUser;\\", \\"\\", \\"username\\", \\"\\", \\"(Ljava/lang/String;)V\\", \\"getUsername$annotations\\", \\"()V\\", \\"getUsername\\", \\"()Ljava/lang/String;\\", \\"component1\\", \\"copy\\", \\"equals\\", \\"\\", \\"other\\", \\"hashCode\\", \\"\\", \\"toString\\", \\"fastone-web-spring-boot-starter\\"}\\n)\\npublic final class PatchUser {\\n\\n\\t@NotNull\\n\\tprivate final String username;\\n\\n\\t/** @deprecated */\\n\\t// $FF: synthetic method\\n\\t@ClojureExpressionConstraint(\\n\\t\\t\\tmessage = \\"the username must be a string and the length must be greater than 5\\",\\n\\t\\t\\tvalue = \\"(and (string? it) (> (count it) 5))\\"\\n\\t)\\n\\tpublic static void getUsername$annotations() {\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic final String getUsername() {\\n\\t\\treturn this.username;\\n\\t}\\n\\n\\tpublic PatchUser(@NotNull String username) {\\n\\t\\tIntrinsics.checkNotNullParameter(username, \\"username\\");\\n\\t\\tsuper();\\n\\t\\tthis.username = username;\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic final String component1() {\\n\\t\\treturn this.username;\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic final PatchUser copy(@NotNull String username) {\\n\\t\\tIntrinsics.checkNotNullParameter(username, \\"username\\");\\n\\t\\treturn new PatchUser(username);\\n\\t}\\n\\n\\t// $FF: synthetic method\\n\\tpublic static PatchUser copy$default(PatchUser var0, String var1, int var2, Object var3) {\\n\\t\\tif ((var2 & 1) != 0) {\\n\\t\\t\\tvar1 = var0.username;\\n\\t\\t}\\n\\n\\t\\treturn var0.copy(var1);\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic String toString() {\\n\\t\\treturn \\"PatchUser(username=\\" + this.username + \\")\\";\\n\\t}\\n\\n\\tpublic int hashCode() {\\n\\t\\tString var10000 = this.username;\\n\\t\\treturn var10000 != null ? var10000.hashCode() : 0;\\n\\t}\\n\\n\\tpublic boolean equals(@Nullable Object var1) {\\n\\t\\tif (this != var1) {\\n\\t\\t\\tif (var1 instanceof PatchUser) {\\n\\t\\t\\t\\tPatchUser var2 = (PatchUser) var1;\\n\\t\\t\\t\\tif (Intrinsics.areEqual(this.username, var2.username)) {\\n\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn false;\\n\\t\\t} else {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\t}\\n\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u6ce8\u89e3\u6700\u7ec8\u5e76\u6ca1\u6709\u5728`getUsername`\u65b9\u6cd5\u4e0a, \u800c\u662f\u5728`getUsername$annotations`\u65b9\u6cd5\u4e0a.<br/>\\n\u6211\u4e4b\u524d\u4ee5\u4e3a`AnnotationTarget.PROPERTY`\u662f\u4f1a\u5c06\u6ce8\u89e3\u5e94\u7528\u5230`get`\u548c`set`\u65b9\u6cd5\u4e0a, \u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u8fd9\u6837.<br/>\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u662f\u5c06`@Target`\u6ce8\u89e3\u4e2d\u7684`AnnotationTarget.PROPERTY`\u53bb\u6389.<br/>\\n\\n\u89e3\u51b3\u540e\u53cd\u7f16\u8bd1\u7684`java`\u4ee3\u7801\u5982\u4e0b\\n\\n```java\\npackage com.fastonetech.lib.validation.clojure;\\n\\nimport kotlin.Metadata;\\nimport kotlin.jvm.internal.Intrinsics;\\nimport org.jetbrains.annotations.NotNull;\\nimport org.jetbrains.annotations.Nullable;\\n\\n@Metadata(\\n\\t\\tmv = {1, 8, 0},\\n\\t\\tk = 1,\\n\\t\\td1 = {\\"\\\\u0000\\\\\\"\\\\n\\\\u0002\\\\u0018\\\\u0002\\\\n\\\\u0002\\\\u0010\\\\u0000\\\\n\\\\u0000\\\\n\\\\u0002\\\\u0010\\\\u000e\\\\n\\\\u0002\\\\b\\\\u0006\\\\n\\\\u0002\\\\u0010\\\\u000b\\\\n\\\\u0002\\\\b\\\\u0002\\\\n\\\\u0002\\\\u0010\\\\b\\\\n\\\\u0002\\\\b\\\\u0002\\\\b\\\\u0086\\\\b\\\\u0018\\\\u00002\\\\u00020\\\\u0001B\\\\r\\\\u0012\\\\u0006\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u0003\xa2\\\\u0006\\\\u0002\\\\u0010\\\\u0004J\\\\t\\\\u0010\\\\u0007\\\\u001a\\\\u00020\\\\u0003H\xc6\\\\u0003J\\\\u0013\\\\u0010\\\\b\\\\u001a\\\\u00020\\\\u00002\\\\b\\\\b\\\\u0002\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u0003H\xc6\\\\u0001J\\\\u0013\\\\u0010\\\\t\\\\u001a\\\\u00020\\\\n2\\\\b\\\\u0010\\\\u000b\\\\u001a\\\\u0004\\\\u0018\\\\u00010\\\\u0001H\xd6\\\\u0003J\\\\t\\\\u0010\\\\f\\\\u001a\\\\u00020\\\\rH\xd6\\\\u0001J\\\\t\\\\u0010\\\\u000e\\\\u001a\\\\u00020\\\\u0003H\xd6\\\\u0001R\\\\u0016\\\\u0010\\\\u0002\\\\u001a\\\\u00020\\\\u00038\\\\u0006X\\\\u0087\\\\u0004\xa2\\\\u0006\\\\b\\\\n\\\\u0000\\\\u001a\\\\u0004\\\\b\\\\u0005\\\\u0010\\\\u0006\xa8\\\\u0006\\\\u000f\\"},\\n\\t\\td2 = {\\"Lcom/fastonetech/lib/validation/clojure/PatchUser;\\", \\"\\", \\"username\\", \\"\\", \\"(Ljava/lang/String;)V\\", \\"getUsername\\", \\"()Ljava/lang/String;\\", \\"component1\\", \\"copy\\", \\"equals\\", \\"\\", \\"other\\", \\"hashCode\\", \\"\\", \\"toString\\", \\"fastone-web-spring-boot-starter\\"}\\n)\\npublic final class PatchUser {\\n\\n\\t@ClojureExpressionConstraint(\\n\\t\\t\\tmessage = \\"the username must be a string and the length must be greater than 5\\",\\n\\t\\t\\tvalue = \\"(and (string? it) (> (count it) 5))\\"\\n\\t)\\n\\t@NotNull\\n\\tprivate final String username;\\n\\n\\t@NotNull\\n\\tpublic final String getUsername() {\\n\\t\\treturn this.username;\\n\\t}\\n\\n\\tpublic PatchUser(@NotNull String username) {\\n\\t\\tIntrinsics.checkNotNullParameter(username, \\"username\\");\\n\\t\\tsuper();\\n\\t\\tthis.username = username;\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic final String component1() {\\n\\t\\treturn this.username;\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic final PatchUser copy(@NotNull String username) {\\n\\t\\tIntrinsics.checkNotNullParameter(username, \\"username\\");\\n\\t\\treturn new PatchUser(username);\\n\\t}\\n\\n\\t// $FF: synthetic method\\n\\tpublic static PatchUser copy$default(PatchUser var0, String var1, int var2, Object var3) {\\n\\t\\tif ((var2 & 1) != 0) {\\n\\t\\t\\tvar1 = var0.username;\\n\\t\\t}\\n\\n\\t\\treturn var0.copy(var1);\\n\\t}\\n\\n\\t@NotNull\\n\\tpublic String toString() {\\n\\t\\treturn \\"PatchUser(username=\\" + this.username + \\")\\";\\n\\t}\\n\\n\\tpublic int hashCode() {\\n\\t\\tString var10000 = this.username;\\n\\t\\treturn var10000 != null ? var10000.hashCode() : 0;\\n\\t}\\n\\n\\tpublic boolean equals(@Nullable Object var1) {\\n\\t\\tif (this != var1) {\\n\\t\\t\\tif (var1 instanceof PatchUser) {\\n\\t\\t\\t\\tPatchUser var2 = (PatchUser) var1;\\n\\t\\t\\t\\tif (Intrinsics.areEqual(this.username, var2.username)) {\\n\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn false;\\n\\t\\t} else {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\t}\\n\\n}\\n\\n```\\n\\n\u8fd9\u6b21\u6ce8\u89e3\u5728`username`\u5b57\u6bb5\u4e0a\u4e86.<br/>\\n\\n### `clojure`\u4e2d\u7684`eval`\u51fd\u6570\u6240\u9700\u7684`form`\u4e2d\u4e0d\u80fd\u4f9d\u8d56\u5916\u90e8\u7684\u53d8\u91cf\\n\\n\u5f53\u6267\u884c\u5982\u4e0b\u4ee3\u7801\u65f6\\n\\n```clojure\\n(defn eval-example []\\n  (let [x 10]\\n    (eval `(+ x 20))))\\n(eval-example)\\n```\\n\\n\u4f1a\u62a5\u9519\u4ee5\u4e0b\u4fe1\u606f\\n\\n```log\\nSyntax error compiling at (/tmp/form-init13157191612884728008.clj:1:1).\\nNo such var: user/x\\n```\\n\\n#### \u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f`eval`\u51fd\u6570\u6240\u9700\u7684`form`\u4e2d\u4e0d\u80fd\u4f9d\u8d56\u5916\u90e8\u7684\u53d8\u91cf, \u8981\u4e48\u88ab\u4f9d\u8d56\u7684\u53d8\u91cf\u662f\u5168\u5c40\\n\u4ece\u62a5\u9519\u53ef\u4ee5\u770b\u5230\u5b83\u5c1d\u8bd5\u4ece`user`\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u627e`x`\u8fd9\u4e2a\u53d8\u91cf, \u4f46\u662f\u5e76\u6ca1\u6709\u627e\u5230.<br/>\\n\u800c\u6211\u4eec\u7684\u547d\u540d\u7a7a\u95f4\u4e0d\u662f`user`\u6240\u4ee5\u4f1a\u62a5\u9519.<br/>\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u539f\u56e0\u662f\u56e0\u4e3a`eval`\u51fd\u6570\u5185\u90e8\u6267\u884c\u7684\u4ee3\u7801\u548c\u5916\u90e8\u7684\u4ee3\u7801\u662f\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4, \u6240\u4ee5\u4e0d\u80fd\u4f9d\u8d56\u8c03\u7528\u5916\u90e8\u8c03\u7528`eval`\\n\u51fd\u6570\u7684\u51fd\u6570\u7684\u5c40\u90e8\u53d8\u91cf.<br/>\\n\\n\u9700\u8981\u5728`form`\u4e2d\u91cd\u65b0`binding`\u6216\u8005\u53d8\u91cf\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u5728\u9700\u8981`eval`\u7684`form`\u4e2d\u91cd\u65b0`binding`\u53d8\u91cf\\n\\n### `clojure`\u4e2d\u7684`eval`\u51fd\u6570\u6240\u9700\u7684`form`\u4e2d`binding`\u4e86\u81ea\u5b9a\u4e49\u5bf9\u8c61\u5f53\u6267\u884c\u65f6\u4f1a\u62a5\u9519\\n\\n\u62a5\u9519\u5982\u4e0b\\n\\n```log\\nembed object in code, maybe print-dup not defined: Person(age=30)\\n```\\n\\n#### \u539f\u56e0\\n\\n\u7531\u4e8e`eval`\u9700\u8981\u5c06\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a`clojure`\u6570\u636e\u7ed3\u6784, \u7136\u540e\u5728\u8fd0\u884c\u65f6\u89e3\u91ca\u548c\u6267\u884c\u8fd9\u4e2a\u8868\u8fbe\u5f0f.<br/>\\n\u5728\u5c06\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a`clojure`\u6570\u636e\u7ed3\u6784\u7684\u8fc7\u7a0b\u4e2d, `clojure`\u9700\u8981\u4f7f\u7528`print-dup`\u51fd\u6570\u5c06\u8868\u8fbe\u5f0f\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32,\\n\u4ee5\u4fbf\u540e\u7eed\u53ef\u4ee5\u901a\u8fc7`read`\u51fd\u6570\u5c06\u8fd9\u4e9b\u5b57\u7b26\u4e32\u8fd8\u539f\u4e3aClojure\u6570\u636e\u7ed3\u6784.<br/>\\n\u56e0\u6b64, \u5f53\u4f7f\u7528`eval`\u51fd\u6570\u6267\u884c\u8868\u8fbe\u5f0f\u65f6\uff0c\u5982\u679c\u8868\u8fbe\u5f0f\u4e2d\u5305\u542b\u65e0\u6cd5\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32\u7684\u5bf9\u8c61\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u9519\u8bef.<br/>\\n\u800c\u5f53\u4e0d\u4f7f\u7528`eval`\u51fd\u6570\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u5bf9\u8c61\u65f6\uff0c\u7531\u4e8e`clojure`\u4e0d\u9700\u8981\u5c06\u5b83\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u9519\u8bef.<br/>\\n\u7efc\u4e0a\u6240\u8ff0, `eval`\u51fd\u6570\u6240\u9700\u7684`form`\u4e2d`binding`\u4e86\u81ea\u5b9a\u4e49\u5bf9\u8c61\u5f53\u6267\u884c\u65f6\u4f1a\u62a5\u9519.<br/>\\n\\n#### \u89e3\u51b3\u65b9\u6848\\n\\n\u5c06\u81ea\u5b9a\u4e49\u5bf9\u8c61\u8f6c\u6362\u4e3a`clojure`\u7684\u5185\u7f6e\u6570\u636e\u7ed3\u6784\u4ece\u800c\u907f\u514d\u8fd9\u4e2a\u95ee\u9898.<br/>\\n\u901a\u8fc7`clojure.java.data`\u4e2d\u7684\u51fd\u6570`from-java-deep`\u8fdb\u884c\u8f6c\u6362<br/>\\n\u8f6c\u6362\u540e\u7684\u6570\u636e\u7ed3\u6784\u5982\u679c\u662f`list`\u8fd8\u9700\u8981\u8f6c\u4e3a`vec`, \u8fd9\u662f\u56e0\u4e3a`clojure`\u4e2d\u7684`list`\u4ee3\u8868\u4e86\u51fd\u6570\u8c03\u7528, \u800c`vec`\u4ee3\u8868\u4e86\u6570\u636e\u7ed3\u6784,\\n\u6240\u4ee5\u9700\u8981\u8f6c\u6362\u4e3a`vec`.<br/>\\n\u53ef\u4ee5\u901a\u8fc7`clojure.walk/postwalk`\u51fd\u6570\u8fdb\u884c\u9012\u5f52\u8f6c\u6362.<br/>\\n\\n## \u5907\u6ce8\\n\\n### `clojure`\u4e2d\u7684`eval`\u51fd\u6570\\n\\n`eval`\u51fd\u6570\u662f\u5c06\u7ed9\u5b9a\u7684`form`\u7f16\u8bd1\u6267\u884c, \u8fd4\u56de\u6267\u884c\u7ed3\u679c.<br/>\\n\\n### `clojure`\u4e2d\u7684`form`\\n\\n`form`\u662f`clojure`\u4e2d\u7684\u8868\u8fbe\u5f0f, \u4e5f\u5c31\u662f`clojure`\u4e2d\u7684\u4ee3\u7801.<br/>\\n\u4f8b\u5982:\\n\\n```clojure\\n(+ 1 2)\\n```\\n\\n### `clojure`\u4e2d\u7684`binding`\\n\\n`binding`\u662f\u5c06\u53d8\u91cf\u7ed1\u5b9a\u5230\u4e00\u4e2a\u503c, \u4f7f\u5f97\u5728`binding`\u7684\u4f5c\u7528\u57df\u5185, \u53d8\u91cf\u7684\u503c\u4e3a\u7ed1\u5b9a\u7684\u503c.<br/>\\n\\n### `clojure`\u4e2d\u7684\u5168\u5c40\u53d8\u91cf\\n\\n`clojure`\u4e2d\u7684\u5168\u5c40\u53d8\u91cf\u662f\u6307\u5728`clojure`\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u53d8\u91cf.<br/>\\n\u4f8b\u5982:\\n\\n```clojure\\n(def x 10)\\n```\\n\\n\u8fd9\u4e2a`x`\u5c31\u662f\u5168\u5c40\u53d8\u91cf.<br/>\\n\\n\u5c40\u90e8\u53d8\u91cf\u662f\u6307\u5728\u51fd\u6570\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf.<br/>\\n\u4f8b\u5982:\\n\\n```clojure\\n(defn test []\\n  (let [x 10] x))\\n```\\n\\n## \u53c2\u8003\\n- [Annotation use-site targets](https://kotlinlang.org/docs/annotations.html#annotation-use-site-targets)\\n- [Spring MVC Custom Validation](https://www.baeldung.com/spring-mvc-custom-validator)\\n- [Evaluation](https://clojure.org/reference/evaluation)\\n- [Variable scope + eval in Clojure](https://stackoverflow.com/questions/6221716/variable-scope-eval-in-clojure)\\n- [Modifying expressions at runtime](https://stackoverflow.com/questions/23039818/modifying-expressions-at-runtime)\\n- [clojure and ^:dynamic](https://stackoverflow.com/questions/11730828/clojure-and-dynamic)\\n- [convert Java objects to Clojure types](https://stackoverflow.com/questions/64075760/convert-java-objects-to-clojure-types)\\n- [Access Java fields dynamically in Clojure?](https://stackoverflow.com/questions/6630432/access-java-fields-dynamically-in-clojure)\\n- [Clojure\u5165\u95e8\u6559\u7a0b](https://wizardforcel.gitbooks.io/clojure-fpftj/content/index.html)"},{"id":"/2023/02/26/apt-mirror","metadata":{"permalink":"/blog/2023/02/26/apt-mirror","source":"@site/blog/2023-02-26/apt-mirror.md","title":"ubuntu\u4e2d\u5e38\u7528\u7684apt\u6e90","description":"\u672c\u6587\u8bb0\u5f55\u4e86ubuntu\u4e2d\u5e38\u7528\u7684apt\u6e90, \u4ee5\u53ca\u5982\u4f55\u914d\u7f6eapt\u6e90.","date":"2023-02-26T00:00:00.000Z","formattedDate":"February 26, 2023","tags":[{"label":"apt","permalink":"/blog/tags/apt"},{"label":"ubuntu","permalink":"/blog/tags/ubuntu"},{"label":"linux","permalink":"/blog/tags/linux"}],"readingTime":3.98,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["apt","ubuntu","linux"]},"unlisted":false,"prevItem":{"title":"\u57fa\u4e8eclojure\u8868\u8fbe\u5f0f\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u6570\u636e\u9a8c\u8bc1","permalink":"/blog/2023/03/02/clojure-validation"},"nextItem":{"title":"\u4f7f\u7528nvm\u5b9e\u73b0nodejs\u591a\u7248\u672c\u7ba1\u7406","permalink":"/blog/2023/02/25/nvm"}},"content":"\u672c\u6587\u8bb0\u5f55\u4e86`ubuntu`\u4e2d\u5e38\u7528\u7684`apt`\u6e90, \u4ee5\u53ca\u5982\u4f55\u914d\u7f6e`apt`\u6e90.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u786e\u8ba4`codename`\\n\\n\u4e0d\u540c\u7684\u7248\u672c\u7684`ubuntu`, `codename`\u4f1a\u6709\u6240\u4e0d\u540c, \u6bd4\u5982`20.04`\u7684`codename`\u662f`focal`, `22.10`\u7684`codename`\u662f`kinetic`.\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u786e\u8ba4`codename`\\n\\n```bash\\nlsb_release -a\\n```\\n\\n\u8f93\u51fa\u7ed3\u679c\u53c2\u8003\\n\\n```log\\nNo LSB modules are available.\\nDistributor ID: Ubuntu\\nDescription:    Ubuntu 22.10\\nRelease:        22.10\\nCodename:       kinetic\\n```\\n\\n### \u7f16\u8f91`/etc/apt/sources.list`\\n\\n\u5c06\u4e0b\u9762\u7684\u5185\u5bb9\u4e2d\u7684`kinetic`\u66ff\u6362\u4e3a\u4e0a\u4e00\u6b65\u4e2d\u7684`codename`, \u7136\u540e\u4fdd\u5b58\u5230`/etc/apt/sources.list`\u4e2d.\\n\\n```text title=\\"/etc/apt/sources.list\\"\\n# Jiaotong University\\ndeb https://ftp.sjtu.edu.cn/sites/archive.ubuntu.com/ kinetic main restricted universe multiverse\\ndeb https://ftp.sjtu.edu.cn/sites/archive.ubuntu.com/ kinetic-updates main restricted universe multiverse\\ndeb https://ftp.sjtu.edu.cn/sites/archive.ubuntu.com/ kinetic-backports main restricted universe multiverse\\ndeb https://ftp.sjtu.edu.cn/sites/archive.ubuntu.com/ kinetic-security main restricted universe multiverse\\n\\n\\n# Tsinghua\\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic main restricted universe multiverse\\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic main restricted universe multiverse\\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-updates main restricted universe multiverse\\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-backports main restricted universe multiverse\\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-backports main restricted universe multiverse\\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-security main restricted universe multiverse\\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-security main restricted universe multiverse\\n\\n# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-proposed main restricted universe multiverse\\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ kinetic-proposed main restricted universe multiverse\\n\\n# Ali\\ndeb http://mirrors.aliyun.com/ubuntu/ kinetic main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ kinetic main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ kinetic-proposed main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ kinetic-proposed main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ kinetic-backports main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ kinetic-backports main restricted universe multiverse\\n\\n\\n# Netease\\ndeb http://mirrors.163.com/ubuntu/ kinetic main restricted universe multiverse\\ndeb http://mirrors.163.com/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb http://mirrors.163.com/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb http://mirrors.163.com/ubuntu/ kinetic-proposed main restricted universe multiverse\\ndeb http://mirrors.163.com/ubuntu/ kinetic-backports main restricted universe multiverse\\ndeb-src http://mirrors.163.com/ubuntu/ kinetic main restricted universe multiverse\\ndeb-src http://mirrors.163.com/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb-src http://mirrors.163.com/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb-src http://mirrors.163.com/ubuntu/ kinetic-proposed main restricted universe multiverse\\ndeb-src http://mirrors.163.com/ubuntu/ kinetic-backports main restricted universe multiverse\\n\\n\\n# \u4e2d\u79d1\u5927\u955c\u50cf\u6e90\\ndeb https://mirrors.ustc.edu.cn/ubuntu/ kinetic main restricted universe multiverse\\ndeb-src https://mirrors.ustc.edu.cn/ubuntu/ kinetic main restricted universe multiverse\\ndeb https://mirrors.ustc.edu.cn/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb-src https://mirrors.ustc.edu.cn/ubuntu/ kinetic-updates main restricted universe multiverse\\ndeb https://mirrors.ustc.edu.cn/ubuntu/ kinetic-backports main restricted universe multiverse\\ndeb-src https://mirrors.ustc.edu.cn/ubuntu/ kinetic-backports main restricted universe multiverse\\ndeb https://mirrors.ustc.edu.cn/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb-src https://mirrors.ustc.edu.cn/ubuntu/ kinetic-security main restricted universe multiverse\\ndeb https://mirrors.ustc.edu.cn/ubuntu/ kinetic-proposed main restricted universe multiverse\\ndeb-src https://mirrors.ustc.edu.cn/ubuntu/ kinetic-proposed main restricted universe multiverse\\n\\n#deb cdrom:[Ubuntu 22.04 LTS _kinetic Jellyfish_ - Release amd64 (20220419)]/ kinetic main restricted\\n\\n# See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to\\n# newer versions of the distribution.\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic main restricted\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic main restricted\\n\\n## Major bug fix updates produced after the final release of the\\n## distribution.\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates main restricted\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates main restricted\\n\\n## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu\\n## team. Also, please note that software in universe WILL NOT receive any\\n## review or updates from the Ubuntu security team.\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic universe\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic universe\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates universe\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates universe\\n\\n## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu \\n## team, and may not be under a free licence. Please satisfy yourself as to \\n## your rights to use the software. Also, please note that software in \\n## multiverse WILL NOT receive any review or updates from the Ubuntu\\n## security team.\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic multiverse\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic multiverse\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates multiverse\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic-updates multiverse\\n\\n## N.B. software from this repository may not have been tested as\\n## extensively as that contained in the main release, although it includes\\n## newer versions of some applications which may provide useful features.\\n## Also, please note that software in backports WILL NOT receive any review\\n## or updates from the Ubuntu security team.\\ndeb http://cn.archive.ubuntu.com/ubuntu/ kinetic-backports main restricted universe multiverse\\n# deb-src http://cn.archive.ubuntu.com/ubuntu/ kinetic-backports main restricted universe multiverse\\n\\ndeb http://security.ubuntu.com/ubuntu kinetic-security main restricted\\n# deb-src http://security.ubuntu.com/ubuntu kinetic-security main restricted\\ndeb http://security.ubuntu.com/ubuntu kinetic-security universe\\n# deb-src http://security.ubuntu.com/ubuntu kinetic-security universe\\ndeb http://security.ubuntu.com/ubuntu kinetic-security multiverse\\n# deb-src http://security.ubuntu.com/ubuntu kinetic-security multiverse\\n\\n# This system was installed using small removable media\\n# (e.g. netinst, live or single CD). The matching \\"deb cdrom\\"\\n# entries were disabled at the end of the installation process.\\n# For information about how to configure apt package sources,\\n# see the sources.list(5) manual.\\n```\\n\\n## \u53c2\u8003\\n\\n- [Official Archive Mirrors for Ubuntu](https://launchpad.net/ubuntu/+archivemirrors)\\n- [SourcesList](https://wiki.debian.org/SourcesList)"},{"id":"/2023/02/25/nvm","metadata":{"permalink":"/blog/2023/02/25/nvm","source":"@site/blog/2023-02-25/nvm.md","title":"\u4f7f\u7528nvm\u5b9e\u73b0nodejs\u591a\u7248\u672c\u7ba1\u7406","description":"\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d, \u6709\u65f6\u5019\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7248\u672c\u7684nodejs\u6765\u5f00\u53d1\u4e0d\u540c\u7684\u9879\u76ee.","date":"2023-02-25T00:00:00.000Z","formattedDate":"February 25, 2023","tags":[{"label":"nvm","permalink":"/blog/tags/nvm"},{"label":"nodejs","permalink":"/blog/tags/nodejs"}],"readingTime":1.44,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["nvm","nodejs"]},"unlisted":false,"prevItem":{"title":"ubuntu\u4e2d\u5e38\u7528\u7684apt\u6e90","permalink":"/blog/2023/02/26/apt-mirror"},"nextItem":{"title":"\u542f\u7528SSH\u5bc6\u7801\u9a8c\u8bc1","permalink":"/blog/2023/02/24/enable-sshd-password-authentication"}},"content":"\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d, \u6709\u65f6\u5019\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7248\u672c\u7684`nodejs`\u6765\u5f00\u53d1\u4e0d\u540c\u7684\u9879\u76ee.<br/>\\n\u4f8b\u5982, \u6709\u4e00\u4e2a`UI`\u9879\u76ee, \u9700\u8981\u4f7f\u7528`nodejs`\u7684`v12`\u7248\u672c, \u800c\u53e6\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u4f7f\u7528`nodejs`\u7684`v14`\u7248\u672c.<br/>\\n\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528`nvm`\u6765\u5b9e\u73b0`nodejs`\u7684\u591a\u7248\u672c\u7ba1\u7406.<br/>\\n\u672c\u6587\u5c06\u4ee5`nodejs-v18`\u4e3a\u4f8b\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`nvm`\u6765\u5b9e\u73b0`nodejs`\u7684\u591a\u7248\u672c\u7ba1\u7406\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u5b89\u88c5\\n\\n- \u5c06`github`\u4e0a\u7684`nvm`\u9879\u76ee\u514b\u9686\u5230\u672c\u5730\\n\\n```bash\\ngit clone git@github.com:nvm-sh/nvm.git\\n```\\n\\n- \u6267\u884c`nvm`\u7684\u5b89\u88c5\u811a\u672c\\n\\n\u8fdb\u5165`nvm`\u9879\u76ee\u7684\u6839\u76ee\u5f55, \u6267\u884c`install.sh`\u811a\u672c\\n\\n```bash\\n./install.sh\\n```\\n\\n### \u5c06`nvm`\u6dfb\u52a0\u5230`~/.bashrc`\u4e2d\\n\\n- \u914d\u7f6e`~/.bashrc`\\n\\n\u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9\u5230`~/.bashrc`\u6587\u4ef6\u4e2d\\n\\n```bash\\nexport NVM_DIR=$DEV_SOFTWARE_HOME/Nvm\\n[ -s \\"$NVM_DIR/nvm.sh\\" ] && \\\\. \\"$NVM_DIR/nvm.sh\\"  # This loads nvm\\n[ -s \\"$NVM_DIR/bash_completion\\" ] && \\\\. \\"$NVM_DIR/bash_completion\\"  # This loads nvm bash_completion\\n```\\n\\n- \u91cd\u65b0\u52a0\u8f7d`~/.bashrc`\\n\\n```bash\\nsource ~/.bashrc\\n```\\n\\n### `node`\u5b89\u88c5\\n\\n- \u5b89\u88c5`nodejs`\u7684`v18`\u7248\u672c\\n\\n```bash\\nnvm install 18\\n```\\n\\n- \u6267\u884c`node -v`\u547d\u4ee4, \u67e5\u770b`nodejs`\u7684\u7248\u672c\\n\\n```bash\\nnode -v\\n```\\n\\n### \u8bbe\u7f6e`nodejs`\u7684\u9ed8\u8ba4\u7248\u672c\\n\\n- \u7f16\u8f91`~/.bashrc`\u6587\u4ef6, \u8ffd\u52a0\u4ee5\u4e0b\u5185\u5bb9\\n\\n```bash\\nnvm alias default 18\\n```\\n\\n- \u91cd\u65b0\u52a0\u8f7d`~/.bashrc`\\n\\n```bash\\nsource ~/.bashrc\\n```\\n\\n## \u53c2\u8003\\n\\n- [nvm](https://github.com/nvm-sh/nvm)"},{"id":"/2023/02/24/enable-sshd-password-authentication","metadata":{"permalink":"/blog/2023/02/24/enable-sshd-password-authentication","source":"@site/blog/2023-02-24/enable-sshd-password-authentication.md","title":"\u542f\u7528SSH\u5bc6\u7801\u9a8c\u8bc1","description":"\u5728ssh\u4e2d, \u9ed8\u8ba4\u662f\u4e0d\u5141\u8bb8\u4f7f\u7528password\u8ba4\u8bc1\u7684, \u4f46\u662f\u6709\u65f6\u5019, \u6211\u4eec\u9700\u8981\u4f7f\u7528password\u8ba4\u8bc1.","date":"2023-02-24T00:00:00.000Z","formattedDate":"February 24, 2023","tags":[{"label":"ssh","permalink":"/blog/tags/ssh"}],"readingTime":0.635,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["ssh"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528nvm\u5b9e\u73b0nodejs\u591a\u7248\u672c\u7ba1\u7406","permalink":"/blog/2023/02/25/nvm"},"nextItem":{"title":"\u5e38\u89c1\u7684\u547d\u540d\u524d\u7f00","permalink":"/blog/2023/02/23/naming-pattern-prefix"}},"content":"\u5728`ssh`\u4e2d, \u9ed8\u8ba4\u662f\u4e0d\u5141\u8bb8\u4f7f\u7528`password`\u8ba4\u8bc1\u7684, \u4f46\u662f\u6709\u65f6\u5019, \u6211\u4eec\u9700\u8981\u4f7f\u7528`password`\u8ba4\u8bc1.<br/>\\n\u4e3a\u4e86\u80fd\u591f\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd, \u6211\u4eec\u9700\u8981\u5bf9`ssh`\u8fdb\u884c\u914d\u7f6e\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u4fee\u6539`sshd`\u914d\u7f6e\u6587\u4ef6\\n\\n\u4fee\u6539`/etc/ssh/sshd_config`\u6587\u4ef6, \u5c06`PasswordAuthentication`\u8bbe\u7f6e\u4e3a`yes`\\n\\n```\\nPasswordAuthentication no\\n```\\n\\n### \u91cd\u542f`ssh`\u670d\u52a1\\n\\n\u4ee5\u4e0b\u6709\u4e24\u79cd\u65b9\u5f0f, \u9009\u62e9\u4e00\u79cd\u5373\u53ef\\n\\n**\u65b9\u5f0f1: systemd**\\n\\n```bash\\nsudo systemctl restart sshd\\n```\\n\\n**\u65b9\u5f0f2: service**\\n\\n```bash\\nsudo service sshd restart\\n```\\n\\n## \u53c2\u8003\\n\\n- [How to Enable SSH Password Authentication](https://serverpilot.io/docs/how-to-enable-ssh-password-authentication/)"},{"id":"/2023/02/23/naming-pattern-prefix","metadata":{"permalink":"/blog/2023/02/23/naming-pattern-prefix","source":"@site/blog/2023-02-23/naming-pattern-prefix.md","title":"\u5e38\u89c1\u7684\u547d\u540d\u524d\u7f00","description":"\u5728\u7f16\u7a0b\u4e2d, \u547d\u540d\u662f\u4e00\u4ef6\u975e\u5e38\u91cd\u8981\u7684\u4e8b\u60c5, \u597d\u7684\u547d\u540d\u80fd\u591f\u8ba9\u4ee3\u7801\u66f4\u52a0\u6613\u8bfb, \u4e5f\u80fd\u591f\u8ba9\u4ee3\u7801\u66f4\u52a0\u6613\u4e8e\u7ef4\u62a4.","date":"2023-02-23T00:00:00.000Z","formattedDate":"February 23, 2023","tags":[{"label":"naming","permalink":"/blog/tags/naming"}],"readingTime":8.93,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["naming"]},"unlisted":false,"prevItem":{"title":"\u542f\u7528SSH\u5bc6\u7801\u9a8c\u8bc1","permalink":"/blog/2023/02/24/enable-sshd-password-authentication"},"nextItem":{"title":"springdoc-v2\u4e2d\u5728\u4e0d\u914d\u7f6e@ParameterObject\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0Pageable\u4ee5\u53caSort\u5bf9\u8c61\u5230API\u53c2\u6570\u7684\u8f6c\u6362","permalink":"/blog/2023/02/22/springdoc-v2-parameter-object"}},"content":"\u5728\u7f16\u7a0b\u4e2d, \u547d\u540d\u662f\u4e00\u4ef6\u975e\u5e38\u91cd\u8981\u7684\u4e8b\u60c5, \u597d\u7684\u547d\u540d\u80fd\u591f\u8ba9\u4ee3\u7801\u66f4\u52a0\u6613\u8bfb, \u4e5f\u80fd\u591f\u8ba9\u4ee3\u7801\u66f4\u52a0\u6613\u4e8e\u7ef4\u62a4.<br/>\\n\u901a\u5e38\u6211\u4eec\u5728\u9605\u8bfb\u7b2c\u4e09\u65b9\u5e93\u7684\u4ee3\u7801\u65f6, \u4f1a\u53d1\u73b0\u5f88\u591a\u65b9\u6cd5\u7684\u547d\u540d\u90fd\u662f\u4ee5\u4e00\u4e9b\u56fa\u5b9a\u7684\u547d\u540d\u524d\u7f00\u5f00\u5934\u7684.<br/>\\n\u672c\u6587\u4e3b\u8981\u603b\u7ed3\u76ee\u524d\u6211\u6240\u4e86\u89e3\u7684\u4e00\u4e9b\u5e38\u89c1\u7684\u547d\u540d\u524d\u7f00\u7684\u542b\u4e49. \u5e76\u5bf9\u5176\u8fdb\u884c\u5206\u7c7b, \u5927\u81f4\u7684\u5206\u7c7b\u4e3b\u8981\u5982\u4e0b.<br/>\\n\\n- \u5bf9\u8c61\u7684\u521b\u5efa\\n- \u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u72b6\u6001\\n- \u5bf9\u8c61\u7684\u5143\u7d20\u64cd\u4f5c\\n- \u5176\u4ed6\\n\\n\u5bf9\u4e8e\u6bcf\u79cd\u547d\u540d\u89c4\u5219, \u6211\u90fd\u4f1a\u7ed9\u51fa\u81ea\u5b9a\u4e49\u7684\u4f8b\u5b50, \u540c\u65f6\u4e5f\u4f1a\u9644\u5e26\u7b2c\u4e09\u65b9\u5e93\u4e2d\u7684\u73b0\u6709\u6848\u4f8b\u4ee5\u4fbf\u4e8e\u66f4\u597d\u7684\u7406\u89e3.<br/>\\n\u4ee3\u7801\u4ee5`kotlin`\u5b9e\u73b0, \u4f46\u662f\u5927\u90e8\u5206\u7684\u547d\u540d\u89c4\u5219\u90fd\u662f\u901a\u7528\u7684, \u4e5f\u9002\u7528\u4e8e\u5176\u4ed6\u7684\u8bed\u8a00.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bf9\u8c61\u521b\u5efa\\n\\n\u8fd9\u4e9b\u547d\u540d\u524d\u7f00\u7528\u4e8e\u8868\u793a\u5bf9\u8c61\u7684\u521b\u5efa\\n\\n### new\\n\\n\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u5b9e\u4f8b, \u8be5\u65b9\u6cd5\u901a\u5e38\u662f\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5, \u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u5b9e\u4f8b.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u58f0\u660e\u9759\u6001\u65b9\u6cd5`newAccount`\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684`Account`\u5bf9\u8c61\u5b9e\u4f8b\\n\\n```kotlin\\nclass Account(\\n\\tval name: String,\\n\\tval createdAt: ZonedDateTime,\\n) {\\n\\n\\tcompanion object {\\n\\n\\t\\tfun newAccount(name: String, createdAt: ZonedDateTime): Account =\\n\\t\\t\\tTODO(\\"DO SOMETHING\\")\\n\\n\\t}\\n\\n}\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `com.google.common.collect.Lists#newArrayList`\\n\\n### valueOf\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5c06\u57fa\u672c\u7c7b\u578b\u503c\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u5305\u88c5\u7c7b\u5bf9\u8c61, \u4e00\u822c\u9002\u7528\u4e8e\u5e95\u5c42\u5e93\u4e2d.<br/>\\n\u8be5\u65b9\u6cd5\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u7684\u4f7f\u7528\u573a\u666f\u5e76\u4e0d\u591a, \u4f46\u662f\u5728\u5e95\u5c42\u5e93\u4e2d, \u8be5\u65b9\u6cd5\u7684\u4f7f\u7528\u573a\u666f\u8fd8\u662f\u6bd4\u8f83\u591a\u7684.<br/>\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.lang.Integer#valueOf`\\n\\n### getInstance\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u83b7\u53d6\u5355\u4f8b\u5bf9\u8c61.<br/>\\n\u5728`kotlin`\u4e2d, \u901a\u5e38\u4f7f\u7528`companion object`\u6765\u58f0\u660e\u5355\u4f8b\u5bf9\u8c61\\n\\n#### \u6848\u4f8b\\n\\n- \u901a\u8fc7\u58f0\u660e`getInstance`\u65b9\u6cd5\u6765\u83b7\u53d6\u5355\u4f8b\u5bf9\u8c61\\n\\n```kotlin\\nclass AccountService {\\n\\n\\tcompanion object {\\n\\n\\t\\tfun getInstance(): AccountService =\\n\\t\\t\\tTODO(\\"DO SOMETHING\\")\\n\\n\\t}\\n\\n}\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.cloud.openfeign.FeignContext#getInstance`\\n\\n### create\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u5b9e\u4f8b, \u4f46\u662f\u5b83\u4e0e`new`\u65b9\u6cd5\u7684\u533a\u522b\u5728\u4e8e, \u5b83\u901a\u5e38\u7528\u4e8e\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u4e2d.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u901a\u8fc7`SessionRepositoryFactory`\u4e2d\u58f0\u660e\u7684\u5404\u79cd`create`\u65b9\u6cd5\u6765\u521b\u5efa\u4e0d\u540c\u7684`SessionRepository`\u5bf9\u8c61\\n\\n```kotlin\\ninterface SessionRepository {\\n\\n\\tfun getSession(requestId: String): Session\\n\\n}\\n\\ninterface SessionRepositoryFactory {\\n\\n\\tfun createInMemorySessionRepository(): SessionRepository\\n\\n\\tfun createDatabaseSessionRepository(): SessionRepository\\n\\n}\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean`\\n\\n### from\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5c06\u5bf9\u8c61\u4ece\u4e00\u79cd\u7c7b\u578b\u8f6c\u6362\u4e3a\u53e6\u4e00\u79cd\u7c7b\u578b.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u901a\u8fc7`Account`\u4e2d\u58f0\u660e\u7684`fromDto`\u548c`fromEntity`\u65b9\u6cd5\u6765\u5c06`AccountDto`\u548c`AccountEntity`\u8f6c\u6362\u4e3a`Account`\u5bf9\u8c61\\n\\n```kotlin\\nclass Account {\\n\\n\\tcompanion object {\\n\\n\\n\\t\\tfun fromDto(dto: AccountDto): Account =\\n\\t\\t\\tTODO(\\"DO SOMETHING\\")\\n\\n\\t\\tfun fromEntity(entity: AccountEntity): Account =\\n\\t\\t\\tTODO(\\"DO SOMETHING\\")\\n\\n\\t}\\n\\n}\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.time.ZonedDateTime#from`\\n- `io.vavr.control.Validation#fromEither`\\n\\n### copy\\n\\n\u8be5\u65b9\u6cd5\u7528\u4e8e\u590d\u5236\u5bf9\u8c61, \u8fd4\u56de\u65b0\u7684\u526f\u672c.<br/>\\n\u5728`kotlin`\u4e2d`copy`\u662f`data class`\u81ea\u5e26\u7684\u65b9\u6cd5, \u8be5\u65b9\u6cd5\u7528\u4e8e\u590d\u5236\u4e00\u4e2a\u4e0d\u53ef\u53d8\u5bf9\u8c61.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- `kotlin`\u4e2d\u7684`copy`\u65b9\u6cd5\\n\\n```kotlin\\ndata class Person(val name: String, val age: Int)\\n\\nval person = Person(\\"Tom\\", 18)\\nval copiedPerson = person.copy(age = 20)\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.lang.String#copyValueOf`\\n\\n### clone\\n\\n\u8be5\u65b9\u6cd5\u7528\u4e8e\u590d\u5236\u5bf9\u8c61, \u8fd4\u56de\u65b0\u7684\u526f\u672c.<br/>\\n\u5728`java`\u4e2d, `clone`\u662f`Object`\u7c7b\u4e2d\u7684\u65b9\u6cd5, \u8be5\u65b9\u6cd5\u7528\u4e8e\u590d\u5236\u4e00\u4e2a\u5bf9\u8c61.<br/>\\n`copy`\u548c`clone`\u4e4b\u95f4\u7684\u533a\u522b\u5728\u4e8e, `copy`\u65b9\u6cd5\u662f\u5bf9\u4e00\u4e2a\u4e0d\u53ef\u53d8\u5bf9\u8c61\u7684\u590d\u5236, \u800c`clone`\u65b9\u6cd5\u5219\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236.<br/>\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.lang.Object#clone`\\n\\n#### \u6848\u4f8b\\n\\n- `java`\u4e2d\u7684`clone`\u65b9\u6cd5\\n\\n```java\\npublic class Person implements Cloneable {\\n\\n\\tprivate String name;\\n\\n\\tprivate int age;\\n\\n\\t@Override\\n\\tpublic Person clone() {\\n\\t\\ttry {\\n\\t\\t\\treturn (Person) super.clone();\\n\\t\\t} catch (CloneNotSupportedException e) {\\n\\t\\t\\tthrow new AssertionError();\\n\\t\\t}\\n\\t}\\n\\n}\\n```\\n\\n### with\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u590d\u5236\u5bf9\u8c61\u5e76\u4fee\u6539\u5176\u7279\u5b9a\u5c5e\u6027.<br/>\\n\u4e00\u822c\u88ab\u590d\u5236\u7684\u5bf9\u8c61\u4e3a\u4e0d\u53ef\u53d8\u5bf9\u8c61.<br/>\\n\u548ccopy\u7684\u533a\u522b\u5728\u4e8e, \u8c03\u7528copy\u65f6, \u53ef\u4ee5\u9009\u62e9\u6027\u7684\u4fee\u6539\u5bf9\u8c61\u7684\u67d0\u4e9b\u5c5e\u6027,\\n\u800c\u8c03\u7528with\u65f6, \u901a\u5e38\u662f\u4fee\u6539\u5bf9\u8c61\u7684\u5355\u4e2a\u5c5e\u6027.<br/>\\n\\n\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u7c7b\u4f3c\u4e8e\u51fd\u6570\u5f0f\u7f16\u7a0b\u4e2d`curring`\u548c`partial apply`\u7684\u533a\u522b.<br/>\\n\u4e3b\u8981\u76f8\u4f3c\u70b9\u5728\u4e8e, \u53c2\u6570\u4f20\u5165\u7684\u6570\u91cf\u4e0d\u540c, \u53e6\u5916\u8fd4\u56de\u7684\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61/\u51fd\u6570.<br/>\\n\\n`curring`: \u6bcf\u6b21\u53ea\u80fd\u4f20\u5165\u4e00\u4e2a\u53c2\u6570, \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570, \u8be5\u51fd\u6570\u63a5\u6536\u5269\u4f59\u7684\u53c2\u6570.<br/>\\n`partial apply`: \u6bcf\u6b21\u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u53c2\u6570, \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570, \u8be5\u51fd\u6570\u63a5\u6536\u5269\u4f59\u7684\u53c2\u6570.<br/>\\n\\n\u5728`lombok`\u4e2d, \u901a\u8fc7`@With`\u6ce8\u89e3\u6765\u5b9e\u73b0`with`\u65b9\u6cd5.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u901a\u8fc7`with`\u65b9\u6cd5\u4fee\u6539\u7279\u5b9a\u5c5e\u6027\\n\\n```kotlin\\nval person = Person()\\nperson.withName(\\"John\\").withAge(30)\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `io.vavr.collection.BitSet#withBytes`\\n\\n### parse\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5c06\u5b57\u7b26\u4e32\u89e3\u6790\u4e3a\u5bf9\u8c61.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u5c06\u5b57\u7b26\u4e32\u89e3\u6790\u4e3a`Date`\u5bf9\u8c61\\n\\n```kotlin\\nval date = Date.parse(\\"2020-01-01\\")\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.time.ZonedDateTime#parse`\\n\\n### of\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5c06\u591a\u4e2a\u53c2\u6570\u7ec4\u5408\u4e3a\u4e00\u4e2a\u5bf9\u8c61.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u5c06\u591a\u4e2a\u53c2\u6570\u7ec4\u5408\u4e3a\u4e00\u4e2a\u5bf9\u8c61\\n\\n```kotlin\\nval list = List.of(1, 2, 3)\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.time.ZonedDateTime#of`\\n\\n## \u5c5e\u6027\u548c\u72b6\u6001\\n\\n\u8fd9\u4e9b\u547d\u540d\u524d\u7f00\u7528\u4e8e\u8868\u793a\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u72b6\u6001\\n\\n### get\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u83b7\u53d6\u5bf9\u8c61\u7684\u5c5e\u6027.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u83b7\u53d6\u7528\u6237\u7684\u59d3\u540d\\n\\n```kotlin\\nperson.getName()\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.boot.configurationprocessor.json.JSONObject#getString`\\n\\n### set or put\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u8bbe\u7f6e\u5bf9\u8c61\u7684\u5c5e\u6027.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u4fee\u6539\u7528\u6237\u7684\u59d3\u540d\\n\\n```kotlin\\nperson.setName(name = \\"Jack\\")\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.boot.configurationprocessor.json.JSONObject#put`\\n\\n### is\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5224\u65ad\u5bf9\u8c61\u7684\u72b6\u6001.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u5224\u65ad\u7528\u6237\u662f\u5426\u6210\u5e74\\n\\n```kotlin\\nperson.isAdult()\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.boot.configurationprocessor.json.JSONObject#isNull`\\n\\n## \u5bf9\u8c61\u7684\u5143\u7d20\u64cd\u4f5c\\n\\n\u8fd9\u4e9b\u547d\u540d\u524d\u7f00\u7528\u4e8e\u8868\u793a\u542b\u6709\u4e00\u4e9b\u5143\u7d20\u7684\u5bf9\u8c61\u7684\u64cd\u4f5c, \u901a\u5e38\u5728\u5177\u6709\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u7684\u5bf9\u8c61\u4e2d\u6bd4\u8f83\u5e38\u89c1<br/>\\n\\n### has\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5305\u542b\u67d0\u4e2a\u5143\u7d20.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u5224\u65ad\u7528\u6237\u662f\u5426\u5177\u6709`ADMIN`\u89d2\u8272\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.boot.configurationprocessor.json.JSONObject#has`\\n\\n```kotlin\\nuser.hasRole(role = \\"ADMIN\\")\\n```\\n\\n### add\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5411\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u5143\u7d20.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u4e3a\u7528\u6237\u6388\u4e88`ADMIN`\u89d2\u8272\\n\\n```kotlin\\nuser.addRole(role = \\"ADMIN\\")\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.util.List#add`\\n\\n### remove\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u4ece\u5bf9\u8c61\u4e2d\u79fb\u9664\u5143\u7d20.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u4e3a\u7528\u6237\u79fb\u9664`ADMIN`\u89d2\u8272\\n\\n```kotlin\\nuser.removeRole(role = \\"ADMIN\\")\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `java.util.List#remove`\\n\\n## \u5176\u4ed6\\n\\n\u8fd9\u4e9b\u547d\u540d\u524d\u7f00\u6ca1\u6709\u7279\u5b9a\u7684\u542b\u4e49, \u4f46\u662f\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u573a\u666f\u4e2d, \u4f1a\u6709\u7279\u5b9a\u7684\u542b\u4e49.<br/>\\n\\n### to\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u5c06\u5bf9\u8c61\u8f6c\u6362\u4e3a\u53e6\u4e00\u79cd\u7c7b\u578b.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- \u5c06`Account`\u8f6c\u6362\u4e3a`AccountDto`\\n\\n```kotlin\\naccount.toDto()\\n```\\n\\n- \u5c06`Account`\u8f6c\u6362\u4e3a`AccountEntity`\\n\\n```kotlin\\naccount.toEntity()\\n```\\n\\n#### \u73b0\u6709\u6848\u4f8b\\n\\n- `org.springframework.boot.configurationprocessor.json.JSONObject#toJSONArray`\\n- `java.time.ZonedDateTime#toLocalDateTime`\\n\\n### do\\n\\n\u8be5\u65b9\u6cd5\u901a\u5e38\u7528\u4e8e\u6267\u884c\u67d0\u4e2a\u64cd\u4f5c.<br/>\\n\u8be5\u65b9\u6cd5\u5728`spring`\u4e2d\u6bd4\u8f83\u5e38\u89c1, \u901a\u5e38\u8868\u793a\u5728\u6267\u884c\u5b8c\u67d0\u4e9b\u524d\u7f6e\u5de5\u4f5c, \u4f8b\u5982\u8f93\u5165\u9a8c\u8bc1, \u7136\u540e\u5f00\u59cb\u6267\u884c\u771f\u6b63\u7684\u64cd\u4f5c.<br/>\\n\\n#### \u6848\u4f8b\\n\\n- `org.springframework:spring-beans`\u4e2d`AbstractBeanFactory`\u7684`doGetBean`\u65b9\u6cd5\\n\\n```java\\npublic abstract class AbstractBeanFactory extends FactoryBeanRegistrySupport implements ConfigurableBeanFactory {\\n\\n\\tprotected <T> T doGetBean(\\n\\t\\tString name, @Nullable Class<T> requiredType, @Nullable Object[] args, boolean typeCheckOnly)\\n\\t\\tthrows BeansException {\\n\\n\\t}\\n\\n}\\n```\\n\\n- `org.springframework:spring-webmvc`\u4e2d`DispatcherServlet`\u7684`doDispatch`\u65b9\u6cd5\\n\\n```java\\npublic class DispatcherServlet extends FrameworkServlet {\\n\\n\\t@Override\\n\\tprotected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {\\n\\t\\t// DO SOMETHING\\n\\t}\\n\\n}\\n```\\n\\n- `org.springframework:spring-jdbc`\u4e2d`AbstractPlatformTransactionManager`\u7684`doBegin`\u65b9\u6cd5\\n\\n```java\\npublic abstract class AbstractPlatformTransactionManager implements PlatformTransactionManager {\\n\\n\\tprotected void doBegin(Object transaction, TransactionDefinition definition) {\\n\\t\\t// DO SOMETHING\\n\\t}\\n\\n}\\n```\\n\\n## \u53c2\u8003\\n\\n- [Effective Java\u7b2c\u4e00\u7ae0\u4e2d\u5173\u4e8e\u9759\u6001\u5de5\u5382\u7684\u547d\u540d\u4e60\u60ef](https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-2/Chapter-2-Item-1-Consider-static-factory-methods-instead-of-constructors.md)\\n- [ORACLE Naming Conventions](https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html)\\n- [Naming Conventions in Java](https://www.geeksforgeeks.org/java-naming-conventions/)"},{"id":"/2023/02/22/springdoc-v2-parameter-object","metadata":{"permalink":"/blog/2023/02/22/springdoc-v2-parameter-object","source":"@site/blog/2023-02-22/springdoc-v2-parameter-object.md","title":"springdoc-v2\u4e2d\u5728\u4e0d\u914d\u7f6e@ParameterObject\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0Pageable\u4ee5\u53caSort\u5bf9\u8c61\u5230API\u53c2\u6570\u7684\u8f6c\u6362","description":"springdoc\u662f\u4e00\u4e2a\u53ef\u4ee5\u5feb\u901f\u751f\u6210API\u6587\u6863\u7684\u7b2c\u4e09\u65b9\u516c\u5171\u5e93, \u5e76\u63d0\u4f9b\u4e86UI\u9875\u9762\u4ee5\u4f9b\u8bbf\u95ee.","date":"2023-02-22T00:00:00.000Z","formattedDate":"February 22, 2023","tags":[{"label":"springdoc","permalink":"/blog/tags/springdoc"},{"label":"spring","permalink":"/blog/tags/spring"}],"readingTime":4.98,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["springdoc","spring"]},"unlisted":false,"prevItem":{"title":"\u5e38\u89c1\u7684\u547d\u540d\u524d\u7f00","permalink":"/blog/2023/02/23/naming-pattern-prefix"},"nextItem":{"title":"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6ce8\u5165\u6570\u7ec4\u5230\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e","permalink":"/blog/2023/02/21/inject-environment-as-array-into-spring-application"}},"content":"`springdoc`\u662f\u4e00\u4e2a\u53ef\u4ee5\u5feb\u901f\u751f\u6210`API`\u6587\u6863\u7684\u7b2c\u4e09\u65b9\u516c\u5171\u5e93, \u5e76\u63d0\u4f9b\u4e86`UI`\u9875\u9762\u4ee5\u4f9b\u8bbf\u95ee.<br/>\\n\u540c\u65f6\u5b83\u4e5f\u63d0\u4f9b\u4e86`spring-webmvc`\u4e2d\u7684`handler`\u4e2d\u7684\u53c2\u6570\u5bf9\u8c61\u5230`API`\u53c2\u6570\u7684\u8f6c\u6362.<br/>\\n\u5bf9\u4e8e`spring-data-commons`\u4e2d\u7684`Pageable`\u548c`Sort`, `springdoc`\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd,\\n\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u542f\u7528\u4ee5\u53ca\u5728\u53c2\u6570\u4e2d\u58f0\u660e`@ParameterObject`<br/>\\n\\n```yaml title=\\"application.yml\\"\\nspringdoc:\\n  model-converters:\\n    pageable-converter:\\n      enabled: true\\n```\\n\\n\u5bf9\u4e8e\u5df2\u7ecf\u5b58\u5728\u7684\u9879\u76ee, \u5f53\u521a\u5f15\u5165`springdoc`\u65f6, \u9700\u8981\u914d\u7f6e\u5927\u91cf\u7684`@ParameterObject`\u6ce8\u89e3\u4ee5\u5b9e\u73b0\u53c2\u6570\u8f6c\u6362\u529f\u80fd.<br/>\\n\u8fd9\u4e2a\u8fc7\u7a0b\u901a\u5e38\u6bd4\u8f83\u7e41\u7410, \u56e0\u4e3a\u5bf9\u4e8e\u4e00\u4e2a\u5177\u6709\u4e00\u5b9a\u89c4\u6a21\u7684\u9879\u76ee\u800c\u8a00, \u5176\u5bf9\u5916\u63d0\u4f9b\u7684`API`\u5f80\u5f80\u4f1a\u975e\u5e38\u591a,\\n\u9700\u8981\u8fdb\u884c\u5927\u91cf\u7684\u4fee\u6539\u529f\u80fd\u624d\u80fd\u5b9e\u73b0\u8be5\u529f\u80fd<br/>\\n\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u9700\u8981\u4e00\u79cd\u89e3\u51b3\u65b9\u6848, \u5373\u5982\u4f55\u5728\u4e0d\u914d\u7f6e`@ParameterObject`\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0`Pageable`\u4ee5\u53ca`Sort`\u5bf9\u8c61\u5230API\u53c2\u6570\u7684\u8f6c\u6362\\n\\n\x3c!--truncate--\x3e\\n\\n## \u601d\u8def\\n\\n### @ParameterObject\\n\\n\u5728`springdoc`\u4e2d, `@ParameterObject`\u6ce8\u89e3\u7684\u83b7\u53d6\u662f\u6765\u81ea\u4e8e`spring-webmvc`\u4e2d\u7684`HandlerMethod`\u5bf9\u8c61\\n\\n### HandlerMethod\\n\\n\u8fd9\u4e2a\u5bf9\u8c61\u662f\u6211\u4eec\u5728`Controller`\u4e2d\u58f0\u660e\u7684`Handler`\u7684\u62bd\u8c61, \u5b83\u4e3b\u8981\u4fdd\u5b58\u4e86\u6211\u4eec\u58f0\u660e\u7684`Handler`\u7684\u4e00\u4e9b\u5143\u4fe1\u606f. <br/>\\n\u5b83\u7684`MethodParameter[] parameters`\u5c5e\u6027\u5305\u542b\u4e86\u8be5\u65b9\u6cd5\u7684\u6240\u6709\u53c2\u6570\u7684\u4fe1\u606f.<br/>\\n\\n### MethodParameter\\n\\n`MethodParameter`\u5bf9\u8c61\u7684`Annotation[] parameterAnnotations`\u5c5e\u6027\u5305\u542b\u4e86\u8be5\u53c2\u6570\u7684\u6240\u6709\u6ce8\u89e3.<br/>\\n\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4fee\u6539`Annotation[] parameterAnnotations`\u5c5e\u6027\u4ee5\u5b9e\u73b0\u52a8\u6001\u6dfb\u52a0`@ParameterObject`\u6ce8\u89e3\u7684\u529f\u80fd.<br/>\\n\\n### HandlerMapping\\n\\n\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u4ece`spring`\u5bb9\u5668\u4e2d\u83b7\u53d6\u5230`MethodHandler`, \u56e0\u4e3a\u5176\u662f\u4fdd\u5b58\u5728`HandlerMapping`\u4e2d\u7684, `HandlerMapping`\\n\u53ef\u4ee5\u4ece\u5bb9\u5668\u4e2d\u83b7\u53d6\u5230.<br/>\\n\\n### BeanPostProcessor\\n\\n`spring`\u4e2d\u63d0\u4f9b\u4e86`BeanPostProcess`\u673a\u5236, \u4e3b\u8981\u5b9e\u73b0\u4e86\u5bf9`Bean`\u7684\u521b\u5efa\u8fdb\u884c\u62e6\u622a\u5904\u7406.<br/>\\n\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0`BeanPostProcessor`\u6765\u5bf9`HandlerMapping`\u4e2d\u7684`MethodHandler`\u4e2d\u7684`MethodParameter`\u7684`parameterAnnotations`\\n\u8fdb\u884c\u4fee\u6539\u4ee5\u5b9e\u73b0\u8ffd\u52a0`@ParameterObject`\u6ce8\u89e3\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u65b0\u589e`AppendSpringdocAnnotationBeanPostProcessor`\u7528\u4e8e\u5b9e\u73b0\u589e\u52a0`@ParameterObject`\u6ce8\u89e3\u7684\u80fd\u529b\\n\\n```kotlin title=\\"AppendSpringdocAnnotationBeanPostProcessor.kt\\"\\n/**\\n * We must add @ParameterObject annotation to Pageable and Sort parameter to ensure that springdoc can generate correct.\\n * But declaring @ParameterObject in the controller method is not a good idea, because it will take some time to.\\n * So we can use this class to avoid declaring @ParameterObject on method parameter which type is Pageable or Sort.\\n *\\n * @author Xiangcheng.Kuo\\n * @see org.springdoc.core.annotations.ParameterObject\\n * @see <a href=\\"https://springdoc.org/v2/#how-can-i-map-pageable-spring-data-commons-object-to-correct-url-parameter-in-swagger-ui\\">13.22. How can I map Pageable (spring-data-commons) object to correct URL-Parameter in Swagger UI?</a>\\n */\\ninternal class AppendSpringdocAnnotationBeanPostProcessor : BeanPostProcessor {\\n\\n\\toverride fun postProcessAfterInitialization(bean: Any, beanName: String): Any {\\n\\t\\tif (bean !is AbstractHandlerMethodMapping<*>) {\\n\\t\\t\\treturn bean\\n\\t\\t}\\n\\t\\tbean.handlerMethods?.forEach { (_: Any, handlerMethod: HandlerMethod) ->\\n\\t\\t\\thandlerMethod\\n\\t\\t\\t\\t.methodParameters\\n\\t\\t\\t\\t.filter {\\n\\t\\t\\t\\t\\tPageable::class.java.isAssignableFrom(it.parameterType) || Sort::class.java.isAssignableFrom(it.parameterType)\\n\\t\\t\\t\\t}.forEach { methodParameter: MethodParameter ->\\n\\t\\t\\t\\t\\taddAnnotationForParameter(methodParameter)\\n\\t\\t\\t\\t}\\n\\t\\t}\\n\\t\\treturn bean\\n\\t}\\n\\n\\tprivate fun addAnnotationForParameter(methodParameter: MethodParameter) {\\n\\t\\tval parameterAnnotationsField =\\n\\t\\t\\tFieldUtils.getDeclaredField(MethodParameter::class.java, \\"parameterAnnotations\\", true)\\n\\t\\tval annotations: MutableList<Annotation> =\\n\\t\\t\\t((parameterAnnotationsField[methodParameter] as Array<Annotation>?)\\n\\t\\t\\t\\t?: emptyArray<Annotation>()).toMutableList()\\n\\n\\t\\tif (annotations.stream().anyMatch(ParameterObject::class::isInstance)) {\\n\\t\\t\\treturn\\n\\t\\t}\\n\\n\\t\\tannotations.add(FakeParameterObject.create())\\n\\t\\tparameterAnnotationsField[methodParameter] = annotations.toTypedArray()\\n\\t}\\n\\n}\\n```\\n\\n### \u65b0\u589e`@ParameterObject`\u7684\u5b9e\u73b0\u7c7b, \u7531\u4e8e`kotlin`\u4e0d\u652f\u6301\u7ee7\u627f`annotation`, \u9700\u8981\u65b0\u5efa`java`\u7c7b\u6765\u7ee7\u627f`annotation`\\n\\n```java title=\\"FakeParameterObject.java\\"\\n/**\\n * Avoid the following kotlin compile error\\n * This type has a constructor, and thus must be initialized here\\n * This type is final, so it cannot be inherited from\\n *\\n * @author Xiangcheng.Kuo\\n * @see <a href=\\"https://stackoverflow.com/questions/51608924/implement-inherit-extend-annotation-in-kotlin\\">Implement (/inherit/~extend) annotation in Kotlin</a>\\n */\\npublic class FakeParameterObject implements ParameterObject {\\n\\n\\t@Override\\n\\tpublic Class<? extends Annotation> annotationType() {\\n\\t\\treturn FakeParameterObject.class;\\n\\t}\\n\\n\\tpublic static ParameterObject create() {\\n\\t\\treturn new FakeParameterObject();\\n\\t}\\n\\n}\\n```\\n\\n### \u65b0\u589eConfiguration, \u5c06`AppendSpringdocAnnotationBeanPostProcessor`\u6dfb\u52a0\u5230\u5bb9\u5668\u4e2d\\n\\n```kotlin title=\\"ApidocAutoConfiguration.kt\\"\\n/**\\n * @author Xiangcheng.Kuo\\n */\\n@Configuration\\ninternal class ApidocAutoConfiguration {\\n\\n\\t@Bean\\n\\t@ConditionalOnProperty(Constants.SPRINGDOC_ENABLED, matchIfMissing = true)\\n\\tfun appendSpringdocAnnotationBeanPostProcessor(): BeanPostProcessor =\\n\\t\\tAppendSpringdocAnnotationBeanPostProcessor()\\n\\n}\\n```\\n\\n## \u5907\u6ce8\\n\\n### \u53cd\u5c04\\n\\n\u8be5\u89e3\u51b3\u65b9\u6cd5\u662f\u57fa\u4e8e\u53cd\u5c04\u7684, \u5e76\u4e14\u5728`spring`\u7684`BeanPostProcessor`\u4e2d\u4fee\u6539\u4e86`MethodParameter`\u7684`parameterAnnotations`\u5c5e\u6027.\\n\u8be5\u5c5e\u6027\u53ef\u80fd\u4f1a\u5728`spring`\u7684\u5176\u4ed6\u5730\u65b9\u88ab\u4f7f\u7528, \u56e0\u6b64\u53ef\u80fd\u4f1a\u5f15\u8d77\u4e00\u4e9b\u4e0d\u53ef\u9884\u77e5\u7684\u95ee\u9898.\\n\\n### `springdoc`\u5e94\u8be5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5173\u95ed\\n\\n\u5728\u751f\u4ea7\u73af\u5883\u4e2d, \u4e0d\u5e94\u8be5\u5f00\u542f`springdoc`, \u56e0\u4e3a\u8fd9\u4f1a\u66b4\u9732`swagger`\u7684`api`\u6587\u6863, \u4ece\u800c\u5bfc\u81f4`api`\u6587\u6863\u6cc4\u9732,\\n\\n\u4f7f\u7528`spring`\u4e2d\u63d0\u4f9b\u7684`profile`\u529f\u80fd\u4ee5\u5b9e\u73b0\u5728\u5f00\u53d1\u6a21\u5f0f\u4e0b\u5f00\u542f`springdoc`, \u751f\u4ea7\u6a21\u5f0f\u4e0b\u5173\u95ed`springdoc`\\n\\n```yaml title=\\"application.yml\\"\\nspringdoc:\\n  api-docs:\\n    enabled: false\\n  model-converters:\\n    pageable-converter:\\n      enabled: true\\n```\\n\\n```yaml title=\\"application-dev.yml\\"\\nspringdoc:\\n  api-docs:\\n    enabled: true\\n  model-converters:\\n    pageable-converter:\\n      enabled: true\\n```\\n\\n## \u53c2\u8003\\n\\n### springdoc-v2\\n\\n- [springdoc v2](https://springdoc.org/v2/)\\n- [13.22. How can I map Pageable (spring-data-commons) object to correct URL-Parameter in Swagger UI?](https://springdoc.org/v2/#how-can-i-map-pageable-spring-data-commons-object-to-correct-url-parameter-in-swagger-ui)\\n- [13.61. How can I extract fields from parameter object ?](https://springdoc.org/v2/#how-can-i-extract-fields-from-parameter-object)\\n\\n### spring\\n\\n- [Class HandlerMethod](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/method/HandlerMethod.html)\\n- [Class MethodParameter](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/MethodParameter.html)\\n- [Interface HandlerMapping](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/HandlerMapping.html)\\n- [Interface BeanPostProcessor](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html)\\n\\n### kotlin\\n\\n- [Implement (/inherit/~extend) annotation in Kotlin](https://stackoverflow.com/questions/51608924/implement-inherit-extend-annotation-in-kotlin)"},{"id":"/2023/02/21/inject-environment-as-array-into-spring-application","metadata":{"permalink":"/blog/2023/02/21/inject-environment-as-array-into-spring-application","source":"@site/blog/2023-02-21/inject-environment-as-array-into-spring-application.md","title":"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6ce8\u5165\u6570\u7ec4\u5230\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e","description":"\u5bb9\u5668\u542f\u52a8\u65f6, \u9700\u8981\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6ce8\u5165\u914d\u7f6e\u7ed9\u5e94\u7528\u7a0b\u5e8f.","date":"2023-02-21T00:00:00.000Z","formattedDate":"February 21, 2023","tags":[{"label":"spring","permalink":"/blog/tags/spring"}],"readingTime":0.65,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["spring"]},"unlisted":false,"prevItem":{"title":"springdoc-v2\u4e2d\u5728\u4e0d\u914d\u7f6e@ParameterObject\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0Pageable\u4ee5\u53caSort\u5bf9\u8c61\u5230API\u53c2\u6570\u7684\u8f6c\u6362","permalink":"/blog/2023/02/22/springdoc-v2-parameter-object"},"nextItem":{"title":"\u6e05\u7406\u65e7\u7248\u672c\u7684snap\u5e94\u7528\u4ee5\u91ca\u653e\u7a7a\u95f4","permalink":"/blog/2023/02/20/cleanup-old-version-of-snap-package"}},"content":"\u5bb9\u5668\u542f\u52a8\u65f6, \u9700\u8981\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6ce8\u5165\u914d\u7f6e\u7ed9\u5e94\u7528\u7a0b\u5e8f.<br/>\\n\u4ee5`spring.ldap.urls`\u6b64\u914d\u7f6e\u4e3a\u4f8b, \u5b83\u662f\u4e00\u4e2a\u6570\u7ec4.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u6709\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u6b64\u9700\u8981, \u9009\u5176\u4e2d\u4e00\u4e2a\u5373\u53ef.<br/>\\n\u63a8\u8350\u7b2c\u4e8c\u79cd, \u56e0\u4e3a\u4e0b\u6807\u7684\u914d\u7f6e\u65b9\u5f0f\u5bf9\u4e8e\u5217\u8868\u7684\u6570\u91cf\u662f\u975e\u56fa\u5b9a\u7684\u573a\u666f\u662f\u4e0d\u591f\u7075\u6d3b\u7684\\n\\n**\u65b9\u5f0f1: \u4e0b\u6807\u914d\u7f6e**\\n```bash\\nSPRING_LDAP_URLS[0]=ldap://host-1:389\\nSPRING_LDAP_URLS[1]=ldap://host-2:389\\n```\\n\\n**\u65b9\u5f0f2: \u65e0\u4e0b\u6807\u914d\u7f6e**\\n```bash\\nSPRING_LDAP_URLS=ldap://host-1:389,ldap://host-2:389\\n```\\n\\n## \u53c2\u8003\\n\\n- [Inject Arrays and Lists From Spring Properties Files](https://www.baeldung.com/spring-inject-arrays-lists#reading-properties-programmatically)"},{"id":"/2023/02/20/cleanup-old-version-of-snap-package","metadata":{"permalink":"/blog/2023/02/20/cleanup-old-version-of-snap-package","source":"@site/blog/2023-02-20/cleanup-old-version-of-snap-package.md","title":"\u6e05\u7406\u65e7\u7248\u672c\u7684snap\u5e94\u7528\u4ee5\u91ca\u653e\u7a7a\u95f4","description":"snap\u9ed8\u8ba4\u4f1a\u4fdd\u7559\u65e7\u7248\u672c\u7684\u5e94\u7528, \u4f46\u662f\u8fd9\u4e9b\u65e7\u7248\u672c\u7684\u5e94\u7528\u5360\u7528\u4e86\u5927\u91cf\u7684\u7a7a\u95f4, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u6e05\u7406\u65e7\u7248\u672c\u7684\u5e94\u7528, \u4ee5\u91ca\u653e\u7a7a\u95f4.","date":"2023-02-20T00:00:00.000Z","formattedDate":"February 20, 2023","tags":[{"label":"snap","permalink":"/blog/tags/snap"}],"readingTime":0.645,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["snap"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6ce8\u5165\u6570\u7ec4\u5230\u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e","permalink":"/blog/2023/02/21/inject-environment-as-array-into-spring-application"},"nextItem":{"title":"\u901a\u8fc7\u4e3aaws-eks\u6258\u7ba1\u7684k8s\u4e2d\u7684service\u542f\u7528nlb\u4ee5\u5b9e\u73b0\u5bf9\u5916\u66b4\u9732\u670d\u52a1","permalink":"/blog/2023/02/19/enable-nlb-for-eks-service"}},"content":"`snap`\u9ed8\u8ba4\u4f1a\u4fdd\u7559\u65e7\u7248\u672c\u7684\u5e94\u7528, \u4f46\u662f\u8fd9\u4e9b\u65e7\u7248\u672c\u7684\u5e94\u7528\u5360\u7528\u4e86\u5927\u91cf\u7684\u7a7a\u95f4, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u6e05\u7406\u65e7\u7248\u672c\u7684\u5e94\u7528, \u4ee5\u91ca\u653e\u7a7a\u95f4.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u65b0\u589e\u811a\u672c\u7528\u4e8e\u6e05\u7406\u65e7\u7248\u672c\u7684`snap`\u5e94\u7528.\\n\\n```bash title=\\"cleanup-old-snaps.sh\\"\\n#!/bin/bash\\n\\nset -eu\\n\\necho \\"Old versions of snaps will be removed.\\"\\n\\nsudo rm -rf /var/lib/snapd/cache/*\\nsnap list --all | awk \'/disabled/{print $1, $3}\' | while read -r package revision; do\\n  snap remove \\"$package\\" --revision=\\"$revision\\"\\ndone\\n\\necho \\"Old revisions of snaps are removed.\\"\\n\\n```\\n\\n## \u53c2\u8003\\n\\n- [How To Remove Old Snap Versions To Free Up Disk Space](https://www.linuxuprising.com/2019/04/how-to-remove-old-snap-versions-to-free.html)"},{"id":"/2023/02/19/enable-nlb-for-eks-service","metadata":{"permalink":"/blog/2023/02/19/enable-nlb-for-eks-service","source":"@site/blog/2023-02-19/enable-nlb-for-eks-service.md","title":"\u901a\u8fc7\u4e3aaws-eks\u6258\u7ba1\u7684k8s\u4e2d\u7684service\u542f\u7528nlb\u4ee5\u5b9e\u73b0\u5bf9\u5916\u66b4\u9732\u670d\u52a1","description":"\u9ed8\u8ba4\u60c5\u51b5\u4e0bk8s\u4e2d\u7684Service\u4e3aClusterIP\u7c7b\u578b, \u5373\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee, \u65e0\u6cd5\u901a\u8fc7\u5916\u90e8\u8bbf\u95ee(\u8fd9\u91cc\u7684\u5916\u90e8\u6307\u7684\u662fk8s\u96c6\u7fa4\u5916\u90e8,","date":"2023-02-19T00:00:00.000Z","formattedDate":"February 19, 2023","tags":[{"label":"k8s","permalink":"/blog/tags/k-8-s"},{"label":"aws","permalink":"/blog/tags/aws"}],"readingTime":1.135,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["k8s","aws"]},"unlisted":false,"prevItem":{"title":"\u6e05\u7406\u65e7\u7248\u672c\u7684snap\u5e94\u7528\u4ee5\u91ca\u653e\u7a7a\u95f4","permalink":"/blog/2023/02/20/cleanup-old-version-of-snap-package"},"nextItem":{"title":"\u4f7f\u7528aliyundrive-webdav\u548crclone\u5b9e\u73b0\u963f\u91cc\u4e91\u76d8\u6587\u4ef6\u6302\u8f7d\u5230\u672c\u5730","permalink":"/blog/2023/02/18/use-aliyundrive-webdav-with-rclone-to-mount-files"}},"content":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b`k8s`\u4e2d\u7684`Service`\u4e3a`ClusterIP`\u7c7b\u578b, \u5373\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee, \u65e0\u6cd5\u901a\u8fc7\u5916\u90e8\u8bbf\u95ee(\u8fd9\u91cc\u7684\u5916\u90e8\u6307\u7684\u662f`k8s`\u96c6\u7fa4\u5916\u90e8,\\n\u5373`k8s`\u96c6\u7fa4\u6240\u5728\u7684`VPC`\u5916\u90e8).<br/>\\n`NodeProt`\u4e5f\u5b58\u5728\u540c\u6837\u7684\u95ee\u9898, \u65e0\u6cd5\u901a\u8fc7\u5916\u90e8\u8bbf\u95ee.<br/>\\n\u4e3a\u4e86\u80fd\u591f\u901a\u8fc7\u5916\u90e8\u8bbf\u95ee`k8s`\u4e2d\u7684`service`, \u9700\u8981\u542f\u7528`nlb`\u4ee5\u5b9e\u73b0\u4e3a`aws-eks`\u6258\u7ba1\u7684`k8s`\u4e2d\u7684`service`\u542f\u7528\u5916\u90e8\u8bbf\u95ee\u80fd\u529b.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u524d\u63d0\\n\\n`kubernetes`\u4e0a\u5b58\u5728`aws-load-balancer-controller`, \u5426\u5219\u8be5\u529f\u80fd\u65e0\u6cd5\u4f7f\u7528\\n\\n### \u66f4\u65b0`Service`, \u8ffd\u52a0`annotations`\u4ee5\u53ca\u4fee\u6539`type`\u4e3a`LoadBalancer`\\n\\n```yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  annotations:\\n    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip\\n    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing\\n    service.beta.kubernetes.io/aws-load-balancer-type: external\\nspec:\\n  type: LoadBalancer\\n```\\n\\n\u7a0d\u7b49\u7247\u523b\u540e\u901a\u8fc7`kubectl get svc`\u67e5\u770b`service`\u7684`status`\u4fe1\u606f, \u53ef\u4ee5\u770b\u5230`status`\u4e2d\u7684`loadBalancer`\u4fe1\u606f\u4e2d\u5305\u542b\u4e86`hostname`\u4fe1\u606f.\\n\u901a\u8fc7`hostname`\u5373\u53ef\u8bbf\u95ee`service`.\\n\\n## \u53c2\u8003\\n\\n- [Installing the AWS Load Balancer Controller add-on](https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html)\\n- [Network load balancing on Amazon EKS](https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html)\\n- [Network Load Balancer](https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.4/guide/service/nlb/)"},{"id":"/2023/02/18/use-aliyundrive-webdav-with-rclone-to-mount-files","metadata":{"permalink":"/blog/2023/02/18/use-aliyundrive-webdav-with-rclone-to-mount-files","source":"@site/blog/2023-02-18/use-aliyundrive-webdav-with-rclone-to-mount-files.md","title":"\u4f7f\u7528aliyundrive-webdav\u548crclone\u5b9e\u73b0\u963f\u91cc\u4e91\u76d8\u6587\u4ef6\u6302\u8f7d\u5230\u672c\u5730","description":"aliyun-webdav\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5de5\u5177, \u53ef\u4ee5\u4e3a\u963f\u91cc\u4e91\u76d8\u63d0\u4f9bWebDAV\u670d\u52a1.","date":"2023-02-18T00:00:00.000Z","formattedDate":"February 18, 2023","tags":[{"label":"aliyundrive","permalink":"/blog/tags/aliyundrive"},{"label":"rclone","permalink":"/blog/tags/rclone"},{"label":"docker","permalink":"/blog/tags/docker"},{"label":"fuse","permalink":"/blog/tags/fuse"}],"readingTime":1.86,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["aliyundrive","rclone","docker","fuse"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u4e3aaws-eks\u6258\u7ba1\u7684k8s\u4e2d\u7684service\u542f\u7528nlb\u4ee5\u5b9e\u73b0\u5bf9\u5916\u66b4\u9732\u670d\u52a1","permalink":"/blog/2023/02/19/enable-nlb-for-eks-service"},"nextItem":{"title":"\u4f7f\u7528snap\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528","permalink":"/blog/2023/02/17/snap-install-specify-version"}},"content":"`aliyun-webdav`\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5de5\u5177, \u53ef\u4ee5\u4e3a\u963f\u91cc\u4e91\u76d8\u63d0\u4f9b`WebDAV`\u670d\u52a1.<br/>\\n`rclone`\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5de5\u5177, \u53ef\u4ee5\u5c06\u672c\u5730\u6587\u4ef6\u540c\u6b65\u5230\u5404\u79cd\u4e91\u5b58\u50a8\u670d\u52a1\u4e2d, \u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\\n\\n- S3\\n- WebDAV\\n- FTP\\n- SFTP\\n- ...\\n\\n\u4ee5\u4e0b\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`aliyun-webdav`\u642d\u914d`rclone`\u5b9e\u73b0\u5c06\u672c\u5730\u6587\u4ef6\u540c\u6b65\u5230\u963f\u91cc\u4e91\u76d8.<br/>\\n\u672c\u6848\u4f8b\u662f\u57fa\u4e8e`ubuntu`\u5b9e\u73b0\u7684, \u65b9\u6848\u4f7f\u7528\u5230\u4e86`docker`\u56e0\u6b64\u7406\u8bba\u4e0a\u53ef\u4ee5\u5728\u4efb\u4f55\u652f\u6301`docker`\u7684\u7cfb\u7edf\u4e2d\u5b9e\u73b0.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u8981\u6c42\\n\\n\u7cfb\u7edf\u4e2d\u5fc5\u987b\u5b58\u5728\u4ee5\u4e0b\u5de5\u5177\\n\\n- docker\\n- docker-compose\\n\\n\u53e6\u5916\u786e\u4fdd\u5f53\u524d\u7528\u6237\u6709`docker`\u6743\u9650, \u5982\u679c\u6ca1\u6709, \u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6dfb\u52a0\\n\\n```bash\\nsudo usermod -aG docker $USER\\nsudo newgrp docker\\n```\\n\\n### \u83b7\u53d6\u963f\u91cc\u4e91\u76d8\u7684`refresh_token`\\n\\n\u65b0\u7248\u672c\u7684\u963f\u91cc\u4e91\u76d8\u4e0d\u518d\u652f\u6301\u5728\u6d4f\u89c8\u5668\u4e2d\u76f4\u63a5\u83b7\u53d6`refresh_token`, \u6240\u4ee5\u9700\u8981\u8bbf\u95ee\u8be5\u9879\u76ee\u5bf9\u5e94\u7684\u5f00\u53d1\u8005\u63d0\u4f9b\u7684\u83b7\u53d6`refresh_token`\u7684\u9875\u9762,\\n\u5e76\u5728\u8be5\u9875\u9762\u4e2d\u83b7\u53d6`refresh_token`\\n\\n\u8fdb\u5165[aliyundrive-webdav refresh token \u83b7\u53d6](https://messense-aliyundrive-webdav-backendrefresh-token-ucs0wn.streamlit.app/)\\n\u5e76\u6839\u636e\u9875\u9762\u63d0\u793a\u83b7\u53d6`refresh_token`\\n\\n### \u914d\u7f6e`aliyundrive-webdav`\\n\\n\u4e0b\u8f7d\u5e76\u89e3\u538b[aliyundrive.zip](aliyundrive.zip)`aliyundrive-webdav`, \u8fd9\u4e2a\u538b\u7f29\u5305\u4e2d\u5305\u542b\u4e86\u76f8\u5173\u670d\u52a1\u7684\u914d\u7f6e\u4ee5\u53ca\u542f\u52a8\u811a\u672c.<br/>\\n\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\u4e2d\u5b58\u5728`docker-compose.yml`\u6587\u4ef6, \u7f16\u8f91\u8be5\u6587\u4ef6.<br/>\\n\u5c06`REFRESH_TOKEN: \\"<REFRESH_TOKEN>\\"`\u4e2d\u7684`<REFRESH_TOKEN>`\\n\u6539\u4e3a\u4e0a\u4e00\u6b65\u83b7\u53d6\u5230\u7684`refresh_token`.<br/>\\n\\n### \u542f\u52a8\\n\\n\u5728\u521a\u624d\u7684\u76ee\u5f55\u4e2d\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\\n\\n```bash\\n./start.sh\\n```\\n\\n## \u53c2\u8003\\n\\n- [aliyundrive-webdav](https://github.com/messense/aliyundrive-webdav)\\n- [rclone](https://rclone.org/)\\n- [docker](https://www.docker.com/)\\n- [docker-compose](https://docs.docker.com/compose/)\\n- [\u963f\u91cc\u4e91\u76d8](https://www.aliyundrive.com/drive)"},{"id":"/2023/02/17/snap-install-specify-version","metadata":{"permalink":"/blog/2023/02/17/snap-install-specify-version","source":"@site/blog/2023-02-17/snap-install-specify-version.md","title":"\u4f7f\u7528snap\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528","description":"\u5728\u4f7f\u7528snap\u5b89\u88c5\u5e94\u7528\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7248\u672c\uff0c\u4f1a\u9ed8\u8ba4\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\u5e94\u7528.","date":"2023-02-17T00:00:00.000Z","formattedDate":"February 17, 2023","tags":[{"label":"snap","permalink":"/blog/tags/snap"}],"readingTime":1.02,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["snap"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528aliyundrive-webdav\u548crclone\u5b9e\u73b0\u963f\u91cc\u4e91\u76d8\u6587\u4ef6\u6302\u8f7d\u5230\u672c\u5730","permalink":"/blog/2023/02/18/use-aliyundrive-webdav-with-rclone-to-mount-files"},"nextItem":{"title":"\u5728linux\u4e2d\u901a\u8fc7\u542f\u7528swapfile\u6765\u589e\u52a0\u865a\u62df\u5185\u5b58\u5e76\u63d0\u9ad8\u6027\u80fd","permalink":"/blog/2023/02/16/linux-swapfile"}},"content":"\u5728\u4f7f\u7528`snap`\u5b89\u88c5\u5e94\u7528\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7248\u672c\uff0c\u4f1a\u9ed8\u8ba4\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\u5e94\u7528.<br/>\\n\u6709\u4e9b\u573a\u666f\u4e0b\u9700\u8981\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528<br/>\\n\u4f8b\u5982`UI`\u9879\u76ee\u76ee\u524d\u4ec5\u652f\u6301`nodejs`\u7684`v12`\u7248\u672c, \u90a3\u4e48\u5c31\u4e0d\u80fd\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684`nodejs`<br/>\\n\u8fd9\u4e2a\u4f8b\u5b50\u4ec5\u4f5c\u4e3a\u53c2\u8003, \u56e0\u4e3a\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\u662f\u4f7f\u7528`nvm`\u6765\u7ba1\u7406`nodejs`\u7684\u7248\u672c<br/>\\n\u5728`python`\u4e2d,\u53ef\u4ee5\u4f7f\u7528`pyenv virtualenv`\u6765\u7ba1\u7406python\u7684\u7248\u672c<br/>\\n\u4e0b\u9762\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`snap`\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u901a\u8fc7`snap`\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528, \u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\\n\\n```bash\\nsnap install <app> --channel=<channel>\\n```\\n\\n\u4ee5nodejs\u4e3a\u4f8b, \u5b89\u88c5`v12`\u7248\u672c\u7684\u5e94\u7528, \u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\\n\\n```bash\\nsnap install node --channel=12/stable\\n```\\n\\n## \u53c2\u8003\\n\\n- [man snap](https://manpages.org/snap)"},{"id":"/2023/02/16/linux-swapfile","metadata":{"permalink":"/blog/2023/02/16/linux-swapfile","source":"@site/blog/2023-02-16/linux-swapfile.md","title":"\u5728linux\u4e2d\u901a\u8fc7\u542f\u7528swapfile\u6765\u589e\u52a0\u865a\u62df\u5185\u5b58\u5e76\u63d0\u9ad8\u6027\u80fd","description":"swapfile\u662flinux\u4e2d\u7684\u4e00\u79cd\u865a\u62df\u5185\u5b58, \u4e0ewindows\u4e2d\u7684pagefile\u7c7b\u4f3c.","date":"2023-02-16T00:00:00.000Z","formattedDate":"February 16, 2023","tags":[{"label":"linux","permalink":"/blog/tags/linux"}],"readingTime":0.91,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["linux"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528snap\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528","permalink":"/blog/2023/02/17/snap-install-specify-version"},"nextItem":{"title":"\u5728TestContainers\u4e2d\u5b9e\u73b0\u914d\u7f6e\u7684\u5bb9\u5668hostname\u4ee5\u89e3\u51b3\u5bb9\u5668\u4e4b\u95f4\u8bbf\u95ee\u95ee\u9898","permalink":"/blog/2023/02/15/testcontainers-hostname"}},"content":"`swapfile`\u662f`linux`\u4e2d\u7684\u4e00\u79cd\u865a\u62df\u5185\u5b58, \u4e0e`windows`\u4e2d\u7684`pagefile`\u7c7b\u4f3c.<br/>\\n`swapfile`\u7684\u4f5c\u7528\u662f\u5f53`RAM`\u4e0d\u8db3\u65f6, \u5c06\u4e00\u90e8\u5206`RAM`\u4e2d\u7684\u6570\u636e\u5199\u5165\u5230`swapfile`\u4e2d, \u4ece\u800c\u91ca\u653e\u51fa`RAM`\u7684\u7a7a\u95f4.<br/>\\n\u4f8b\u5982, \u5e73\u65f6\u4f7f\u7528\u6d4f\u89c8\u5668\u65f6\u4f1a\u5f00\u542f\u9875\u9762, \u8fd9\u4e9b\u9875\u9762\u901a\u5e38\u4f1a\u5360\u7528\u4e00\u5b9a\u7684`RAM`\u7a7a\u95f4.<br/>\\n\u5982\u679c\u5f00\u542f\u4e86\u592a\u591a\u7684\u9875\u9762, \u4f1a\u5bfc\u81f4`RAM`\u4e0d\u8db3, \u8fd9\u65f6\u5c31\u9700\u8981\u5c06\u4e00\u90e8\u5206\u9875\u9762\u7684\u6570\u636e\u5199\u5165\u5230`swapfile`\u4e2d, \u4ece\u800c\u91ca\u653e\u51fa`RAM`\u7684\u7a7a\u95f4<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u542f\u7528`swapfile`, \u5927\u5c0f\u4e3a`4G`\\n\\n```bash\\nsudo fallocate -l 4G /swapfile\\nsudo chmod 600 /swapfile\\nsudo mkswap /swapfile\\nsudo swapon /swapfile\\nsudo swapon --show\\nsudo free -h\\n```\\n\\n### \u7981\u7528`swapfile`\\n\\n```bash\\nsudo swapoff /swapfile\\n```\\n\\n## \u53c2\u8003\\n\\n- [Create a Linux Swap File](https://linuxize.com/post/create-a-linux-swap-file/)"},{"id":"/2023/02/15/testcontainers-hostname","metadata":{"permalink":"/blog/2023/02/15/testcontainers-hostname","source":"@site/blog/2023-02-15/testcontainers-hostname.md","title":"\u5728TestContainers\u4e2d\u5b9e\u73b0\u914d\u7f6e\u7684\u5bb9\u5668hostname\u4ee5\u89e3\u51b3\u5bb9\u5668\u4e4b\u95f4\u8bbf\u95ee\u95ee\u9898","description":"\u5728\u4f7f\u7528TestContainers\u542f\u52a8\u5bb9\u5668\u65f6, \u53ef\u80fd\u4f1a\u5b58\u5728\u5bb9\u5668\u4e4b\u95f4\u4f9d\u8d56\u7684\u60c5\u51b5.","date":"2023-02-15T00:00:00.000Z","formattedDate":"February 15, 2023","tags":[{"label":"testcontainers","permalink":"/blog/tags/testcontainers"},{"label":"docker","permalink":"/blog/tags/docker"}],"readingTime":1.265,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["testcontainers","docker"]},"unlisted":false,"prevItem":{"title":"\u5728linux\u4e2d\u901a\u8fc7\u542f\u7528swapfile\u6765\u589e\u52a0\u865a\u62df\u5185\u5b58\u5e76\u63d0\u9ad8\u6027\u80fd","permalink":"/blog/2023/02/16/linux-swapfile"},"nextItem":{"title":"\u8df3\u8fc7SSH\u8fde\u63a5\u65f6\u7684\u786e\u8ba4\u63d0\u793a","permalink":"/blog/2023/02/14/ssh-prompt"}},"content":"\u5728\u4f7f\u7528`TestContainers`\u542f\u52a8\u5bb9\u5668\u65f6, \u53ef\u80fd\u4f1a\u5b58\u5728\u5bb9\u5668\u4e4b\u95f4\u4f9d\u8d56\u7684\u60c5\u51b5.<br/>\\n\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u5bb9\u5668\u4f9d\u8d56\u4e8e\u53e6\u5916\u4e00\u4e2a\u5bb9\u5668, \u90a3\u4e48\u9700\u8981\u5728\u542f\u52a8\u88ab\u4f9d\u8d56\u7684\u5bb9\u5668\u65f6, \u6307\u5b9a`hostname`.<br/>\\n\u8fd9\u6837\u6709\u4f9d\u8d56\u9700\u6c42\u7684\u5bb9\u5668\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7`hostname`\u6765\u8bbf\u95ee\u88ab\u4f9d\u8d56\u7684\u5bb9\u5668.<br/>\\n\u4ee5\u4fbf\u4e8e\u88ab\u4f9d\u8d56\u7684\u5bb9\u5668\u80fd\u591f\u6b63\u786e\u7684\u89e3\u6790\u4f9d\u8d56\u5bb9\u5668\u7684`hostname`.\\n\u4e0b\u9762\u5c06\u4ecb\u7ecd\u5982\u4f55\u5728`TestContainers`\u4e2d\u5b9e\u73b0\u914d\u7f6e\u7684\u5bb9\u5668`hostname`\u4ee5\u89e3\u51b3\u5bb9\u5668\u4e4b\u95f4\u8bbf\u95ee\u95ee\u9898.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u5728\u542f\u52a8\u5bb9\u5668\u65f6, \u901a\u8fc7`withNetworkAliases`\u65b9\u6cd5\u6307\u5b9a\u5bb9\u5668\u7684`hostname`\\n\\n```kotlin\\nwithNetworkAliases(\\"ldap\\")\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f, \u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u91c7\u7528`docker`\u7684`--network-alias`\u53c2\u6570\u5b9e\u73b0\u7684, \u8be5\u53c2\u6570\u7684\u4f5c\u7528\u662f\u4e3a\u5bb9\u5668\u6307\u5b9a`hostname`<br/>\\n\u53e6\u5916\u9700\u8981\u786e\u4fdd\u9700\u8981\u4e92\u76f8\u8bbf\u95ee\u7684\u5bb9\u5668\u8981\u5728\u540c\u4e00\u4e2a`network`\u4e2d, \u5426\u5219\u65e0\u6cd5\u4e92\u76f8\u8bbf\u95ee.<br/>\\n\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u4ee3\u7801\u6765\u914d\u7f6e`network`\\n\\n```kotlin\\nval network = Network.newNetwork()\\ncontainer.withNetwork(network)\\n```\\n\\n## \u53c2\u8003\\n\\n- [Network settings](https://docs.docker.com/engine/reference/run/#network-settings)"},{"id":"/2023/02/14/ssh-prompt","metadata":{"permalink":"/blog/2023/02/14/ssh-prompt","source":"@site/blog/2023-02-14/ssh-prompt.md","title":"\u8df3\u8fc7SSH\u8fde\u63a5\u65f6\u7684\u786e\u8ba4\u63d0\u793a","description":"\u5e73\u65f6\u5728\u5199\u4e00\u4e9b\u811a\u672c\u7684\u65f6\u5019, \u9700\u8981\u9891\u7e41\u5730\u8fde\u63a5\u5728\u4e91\u4e0a\u65b0\u521b\u5efa\u7684\u673a\u5668.","date":"2023-02-14T00:00:00.000Z","formattedDate":"February 14, 2023","tags":[{"label":"ssh","permalink":"/blog/tags/ssh"}],"readingTime":1.13,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["ssh"]},"unlisted":false,"prevItem":{"title":"\u5728TestContainers\u4e2d\u5b9e\u73b0\u914d\u7f6e\u7684\u5bb9\u5668hostname\u4ee5\u89e3\u51b3\u5bb9\u5668\u4e4b\u95f4\u8bbf\u95ee\u95ee\u9898","permalink":"/blog/2023/02/15/testcontainers-hostname"},"nextItem":{"title":"\u4fee\u6539postgresql\u4e2d\u7684\u6700\u5927\u8fde\u63a5\u6570","permalink":"/blog/2023/02/13/postgres-max-connections"}},"content":"\u5e73\u65f6\u5728\u5199\u4e00\u4e9b\u811a\u672c\u7684\u65f6\u5019, \u9700\u8981\u9891\u7e41\u5730\u8fde\u63a5\u5728\u4e91\u4e0a\u65b0\u521b\u5efa\u7684\u673a\u5668.<br/>\\n\u5728ssh\u4e2d\u7b2c\u4e00\u6b21\u8fde\u63a5\u65f6, \u4f1a\u8f93\u51fa\u5982\u4e0b\u63d0\u793a.<br/>\\n\\n```log\\nRSA key fingerprint is 96:a9:23:5c:cc:d1:0a:d4:70:22:93:e9:9e:1e:74:2f.\\nAre you sure you want to continue connecting (yes/no)? yes\\n```\\n\\n\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6bcf\u6b21\u90fd\u9700\u8981\u8f93\u5165yes\u6765\u786e\u8ba4\u662f\u5426\u8fde\u63a5.<br/>\\n\u56e0\u4e3a\u811a\u672c\u4e0d\u53ef\u4ee5\u4ea4\u4e92, \u4f1a\u5bfc\u81f4\u811a\u672c\u5361\u5728\u8fd9\u4e00\u6b65\u65e0\u6cd5\u6267\u884c\u540e\u7eed\u7684\u64cd\u4f5c.<br/>\\n\u56e0\u6b64\u9700\u8981\u8df3\u8fc7\u8fd9\u4e00\u6b65\u7684\u786e\u8ba4.<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u5728ssh\u8fde\u63a5\u65f6, \u901a\u8fc7`-o StrictHostKeyChecking=no`\u53c2\u6570\u6765\u8df3\u8fc7\u786e\u8ba4.<br/>\\n\\n```bash\\nssh -o StrictHostKeyChecking=no -i <your-key> <username>@<hostname>\\n```\\n\\n## \u5907\u6ce8\\n\\n\u5728`man ssh`\u4e2d\u5bf9\u4e8e`StrictHostKeyChecking`\u53c2\u6570\u7684\u63cf\u8ff0\u5982\u4e0b:\\n\\n```text\\nThe StrictHostKeyChecking option can be used to control logins to machines whose host key is not known or has changed.\\n```\\n\\n## \u53c2\u8003\\n\\n- [how to avoid ssh asking permission?](https://unix.stackexchange.com/questions/33271/how-to-avoid-ssh-asking-permission)\\n- [How to accept \'yes\' from shell script \\"Are you sure you want to continue connecting (yes/no)?\\" using ssh. Without using StrictHostKeyChecking=no](https://stackoverflow.com/questions/64449495/how-to-accept-yes-from-shell-script-are-you-sure-you-want-to-continue-connect)"},{"id":"/2023/02/13/postgres-max-connections","metadata":{"permalink":"/blog/2023/02/13/postgres-max-connections","source":"@site/blog/2023-02-13/postgres-max-connections.md","title":"\u4fee\u6539postgresql\u4e2d\u7684\u6700\u5927\u8fde\u63a5\u6570","description":"postgresql\u9ed8\u8ba4\u8fde\u63a5\u6570\u91cf\u6709\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u591f\u7528\u7684\u60c5\u51b5, \u8fd9\u65f6\u5c31\u9700\u8981\u4fee\u6539postgresql\u7684\u6700\u5927\u8fde\u63a5\u6570","date":"2023-02-13T00:00:00.000Z","formattedDate":"February 13, 2023","tags":[{"label":"postgresql","permalink":"/blog/tags/postgresql"}],"readingTime":0.51,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["postgresql"]},"unlisted":false,"prevItem":{"title":"\u8df3\u8fc7SSH\u8fde\u63a5\u65f6\u7684\u786e\u8ba4\u63d0\u793a","permalink":"/blog/2023/02/14/ssh-prompt"},"nextItem":{"title":"\u5c06postgresql\u4e2d\u6307\u5b9a\u7684database\u5bfc\u51fa\u4e3asql\u6587\u4ef6","permalink":"/blog/2023/02/12/postgres-pgdump"}},"content":"`postgresql`\u9ed8\u8ba4\u8fde\u63a5\u6570\u91cf\u6709\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u591f\u7528\u7684\u60c5\u51b5, \u8fd9\u65f6\u5c31\u9700\u8981\u4fee\u6539`postgresql`\u7684\u6700\u5927\u8fde\u63a5\u6570\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u901a\u8fc7`ALTER SYSTEM`\u4fee\u6539\\n\\n```bash\\nALTER SYSTEM SET max_connections = 1000;\\n```\\n\\n## \u5907\u6ce8\\n\\n### \u91cd\u7f6e`max_connections`\\n\\n```bash\\nALTER SYSTEM RESET max_connections;\\n```\\n\\n### \u67e5\u770b`max_connections`\\n\\n```bash\\nSHOW max_connections;\\n```\\n\\n## \u53c2\u8003\\n\\n- [Query a parameter (postgresql.conf setting) like \\"max_connections\\"](https://stackoverflow.com/questions/8288823/query-a-parameter-postgresql-conf-setting-like-max-connections)\\n- [How to increase max_connection in the official PostgreSQL Docker image](https://stackoverflow.com/questions/47252026/how-to-increase-max-connection-in-the-official-postgresql-docker-image)\\n- [Tuning Postgres Max Connections](https://linuxhint.com/tuning-postgres-max-connections/)"},{"id":"/2023/02/12/postgres-pgdump","metadata":{"permalink":"/blog/2023/02/12/postgres-pgdump","source":"@site/blog/2023-02-12/postgres-pgdump.md","title":"\u5c06postgresql\u4e2d\u6307\u5b9a\u7684database\u5bfc\u51fa\u4e3asql\u6587\u4ef6","description":"\u5728\u4f7f\u7528postgresql\u65f6, \u6709\u65f6\u5019\u9700\u8981\u5c06database\u5bfc\u51fa\u4e3asql\u6587\u4ef6, \u4ee5\u4fbf\u4e8e\u5728\u5176\u4ed6\u73af\u5883\u4e2d\u4f7f\u7528.","date":"2023-02-12T00:00:00.000Z","formattedDate":"February 12, 2023","tags":[{"label":"postgresql","permalink":"/blog/tags/postgresql"}],"readingTime":0.38,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["postgresql"]},"unlisted":false,"prevItem":{"title":"\u4fee\u6539postgresql\u4e2d\u7684\u6700\u5927\u8fde\u63a5\u6570","permalink":"/blog/2023/02/13/postgres-max-connections"},"nextItem":{"title":"\u5728Docker\u4e2d\u4f7f\u7528Rclone\u5e76\u5c06\u5bf9\u5e94\u7684fuse\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a","permalink":"/blog/2023/02/11/rclone-fuse"}},"content":"\u5728\u4f7f\u7528`postgresql`\u65f6, \u6709\u65f6\u5019\u9700\u8981\u5c06`database`\u5bfc\u51fa\u4e3a`sql`\u6587\u4ef6, \u4ee5\u4fbf\u4e8e\u5728\u5176\u4ed6\u73af\u5883\u4e2d\u4f7f\u7528.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n```bash\\npg_dump --column-inserts --data-only --table=<table> <database>\\n```\\n\\n\u8be5\u547d\u4ee4\u4f1a\u5c06`<database>`\u4e2d\u7684`<table>`\u5bfc\u51fa\u4e3a`sql`\u6587\u4ef6\\n\\n### \u53c2\u8003\\n\\n- [Using pg_dump to only get insert statements from one table within database](https://stackoverflow.com/questions/2857989/using-pg-dump-to-only-get-insert-statements-from-one-table-within-database)\\n- [Dump Your PostgreSQL Database](https://www.netguru.com/blog/how-to-dump-and-restore-postgresql-database)"},{"id":"/2023/02/11/rclone-fuse","metadata":{"permalink":"/blog/2023/02/11/rclone-fuse","source":"@site/blog/2023-02-11/rclone-fuse.md","title":"\u5728Docker\u4e2d\u4f7f\u7528Rclone\u5e76\u5c06\u5bf9\u5e94\u7684fuse\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a","description":"\u5728Docker\u4e2d\u4f7f\u7528Rclone\u65f6\u9700\u8981\u5c06fuse\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a.","date":"2023-02-11T00:00:00.000Z","formattedDate":"February 11, 2023","tags":[{"label":"rclone","permalink":"/blog/tags/rclone"},{"label":"docker","permalink":"/blog/tags/docker"},{"label":"fuse","permalink":"/blog/tags/fuse"}],"readingTime":0.56,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["rclone","docker","fuse"]},"unlisted":false,"prevItem":{"title":"\u5c06postgresql\u4e2d\u6307\u5b9a\u7684database\u5bfc\u51fa\u4e3asql\u6587\u4ef6","permalink":"/blog/2023/02/12/postgres-pgdump"},"nextItem":{"title":"\u4f7f\u7528pyenv\u5b9e\u73b0python\u591a\u7248\u672c\u7ba1\u7406","permalink":"/blog/2023/02/10/pyenv"}},"content":"\u5728`Docker`\u4e2d\u4f7f\u7528`Rclone`\u65f6\u9700\u8981\u5c06`fuse`\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a.<br/>\\n\u8fd9\u6837\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u4e0a\u4f7f\u7528`Rclone`\u6302\u8f7d\u7684\u6587\u4ef6\u5939\u4ee5\u53ca\u53ef\u4ee5\u5bf9`fuse`\u8fdb\u884c\u64cd\u4f5c<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n```bash\\n# perform mount inside Docker container, expose result to host\\nmkdir -p ~/data/mount\\ndocker run --rm \\\\\\n    --volume ~/.config/rclone:/config/rclone \\\\\\n    --volume ~/data:/data:shared \\\\\\n    --user $(id -u):$(id -g) \\\\\\n    --volume /etc/passwd:/etc/passwd:ro --volume /etc/group:/etc/group:ro \\\\\\n    --device /dev/fuse --cap-add SYS_ADMIN --security-opt apparmor:unconfined \\\\\\n    rclone/rclone \\\\\\n    mount dropbox:Photos /data/mount &\\nls ~/data/mount\\nkill %1\\n```\\n\\n## \u53c2\u8003\\n\\n- [Rclone docker | Explained](https://bobcares.com/blog/rclone-docker/)"},{"id":"/2023/02/10/pyenv","metadata":{"permalink":"/blog/2023/02/10/pyenv","source":"@site/blog/2023-02-10/pyenv.md","title":"\u4f7f\u7528pyenv\u5b9e\u73b0python\u591a\u7248\u672c\u7ba1\u7406","description":"pyenv\u662f\u4e00\u4e2apython\u7248\u672c\u7ba1\u7406\u5de5\u5177, \u53ef\u4ee5\u65b9\u4fbf\u7684\u7ba1\u7406\u591a\u4e2apython\u7248\u672c.","date":"2023-02-10T00:00:00.000Z","formattedDate":"February 10, 2023","tags":[{"label":"pyenv","permalink":"/blog/tags/pyenv"},{"label":"python","permalink":"/blog/tags/python"}],"readingTime":3.145,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["pyenv","python"]},"unlisted":false,"prevItem":{"title":"\u5728Docker\u4e2d\u4f7f\u7528Rclone\u5e76\u5c06\u5bf9\u5e94\u7684fuse\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a","permalink":"/blog/2023/02/11/rclone-fuse"},"nextItem":{"title":"JDK\u6539\u8fdb\u9879\u76ee\u7684\u4ecb\u7ecd","permalink":"/blog/2023/02/09/openjdk-project"}},"content":"`pyenv`\u662f\u4e00\u4e2a`python`\u7248\u672c\u7ba1\u7406\u5de5\u5177, \u53ef\u4ee5\u65b9\u4fbf\u7684\u7ba1\u7406\u591a\u4e2a`python`\u7248\u672c.<br/>\\n\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\u6709\u7684\u65f6\u5019\u4f1a\u6709\u591a\u4e2a`python`\u7248\u672c\u7684\u9700\u6c42.<br/>\\n\u4f8b\u5982, \u6709\u7684\u9879\u76ee\u9700\u8981`python3.6`, \u6709\u7684\u9879\u76ee\u9700\u8981`python3.7`. \u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528`pyenv`\u6765\u7ba1\u7406\u591a\u4e2a`python`\u7248\u672c.<br/>\\n\u76ee\u524d\u5e02\u9762\u4e0a\u6709\u5f88\u591a`python`\u7248\u672c\u7ba1\u7406\u5de5\u5177, \u4f8b\u5982`pyenv`, `conda`\u7b49.<br/>\\n`pyenv`\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u5de5\u5177, \u4f46\u662f\u529f\u80fd\u4e5f\u5f88\u5f3a\u5927, \u9002\u5408\u4e8e\u5f00\u53d1\u8005\u4f7f\u7528.<br/>\\n\u4e0b\u9762\u5c06\u4ee5`python3.11.0`\u4e3a\u4f8b\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528`pyenv`\u6765\u7ba1\u7406\u591a\u4e2a`python`\u7248\u672c<br/>\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n### \u5c06`github`\u4e0a\u7684`pyenv`\u4ed3\u5e93`clone`\u5230\u672c\u5730\\n\\n```bash\\ngit clone git@github.com:pyenv/pyenv.git\\n```\\n\\n### \u914d\u7f6e`~/.bashrc`\\n\\n\u5c06\u4ee5\u4e0b\u914d\u7f6e\u6dfb\u52a0\u5230`~/.bashrc`, \u6ce8\u610f\u5c06`<pyenv-path>`\u66ff\u6362\u4e3a`pyenv`\u7684\u5b9e\u9645\u8def\u5f84\\n\\n```bash\\n# pyenv\\nexport PATH=<pyenv-path>/bin:$PATH\\nexport PYENV_VIRTUALENV_DISABLE_PROMPT=1\\neval \\"$(pyenv init -)\\"\\neval \\"$(pyenv virtualenv-init -)\\"\\npyenv deactivate\\n```\\n\\n### \u4f7f`~/.bashrc`\u4e2d\u7684\u914d\u7f6e\u751f\u6548\\n\\n\u91cd\u65b0\u52a0\u8f7d`~/.bashrc`, \u8fd9\u4e48\u505a\u662f\u4e3a\u4e86\u8ba9`pyenv`\u7684\u914d\u7f6e\u751f\u6548\\n\\n```bash\\nsource ~/.bashrc\\n```\\n\\n### \u4e0b\u8f7d`python`\u5b89\u88c5\u5305\u5230`cache`\u76ee\u5f55\u4ee5\u52a0\u5feb\u5b89\u88c5\u901f\u5ea6\\n\\n\u4f7f\u7528`pyenv`\u5b89\u88c5`python`\u65f6\u4f1a\u6bd4\u8f83\u6162, \u8fd9\u662f\u56e0\u4e3a\u8bbf\u95ee\u56fd\u5916\u7f51\u7ad9\u4f1a\u6bd4\u8f83\u6162. <br/>\\n\u53ef\u4ee5\u5148\u5c06`python`\u7684\u5b89\u88c5\u5305\u4e0b\u8f7d\u5230\u521a\u624d`clone`\u7684\u9879\u76ee\u7684`cache`\u76ee\u5f55\u4e0b. <br/>\\n\u901a\u8fc7\u4e0b\u8f7d\u5668\u4f8b\u5982`\u8fc5\u96f7`\u53ef\u4ee5\u66f4\u5feb\u7684\u4e0b\u8f7d.<br/>\\n\u540e\u7eed\u4f7f\u7528`pyenv`\u8fdb\u884c`install`\u65f6\u4f1a\u4ece`cache`\u76ee\u5f55\u4e0b\u8bfb\u53d6\u5b89\u88c5\u5305, \u901f\u5ea6\u4f1a\u5feb\u5f88\u591a<br/>\\n\u4ee5`3.11.0`\u4e3a\u4f8b, \u4e0b\u8f7d\u5730\u5740\u4e3a: `https://www.python.org/ftp/python/3.11.0/Python-3.11.0.tar.xz` <br/>\\n\u53ef\u4ee5\u8fdb\u5165`https://www.python.org/ftp/python/` \u67e5\u770b\u6240\u6709`python`\u7248\u672c\u7684\u5b89\u88c5\u5305\u4e0b\u8f7d\u5730\u5740.<br/>\\n\\n### \u5b89\u88c5\u5fc5\u8981\u7684\u4f9d\u8d56\\n\\n\u4f7f\u7528`pyenv`\u5b89\u88c5`python`\u65f6, \u9700\u8981\u5b89\u88c5\u4e00\u4e9b\u4f9d\u8d56, \u5426\u5219\u5b89\u88c5\u65f6\u4f1a\u62a5\u9519.<br/>\\n\u901a\u5e38\u8fd9\u4e9b\u4f9d\u8d56\u7684\u524d\u7f00\u4e3a`lib***-dev`.<br/>\\n\\n\u4ee5\u4e0b\u662f\u6211\u4ee5\u524d\u5b89\u88c5`python`\u65f6\u9047\u5230\u7684\u4f9d\u8d56, \u5404\u4e2a\u7248\u672c\u53ef\u80fd\u4e0d\u4e00\u6837, \u8bf7\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5b89\u88c5.<br/>\\n\\n```bash\\nfor package in libncurses-dev build-essential zlib1g-dev libffi-dev libssl-dev libbz2-dev libreadline-dev libsqlite3-dev liblzma-dev; do\\n  apt-get install -y $package\\ndone\\n```\\n\\n```bash\\npyenv install 3.11.0\\n```\\n\\n### \u521b\u5efa`virtualenv`, \u540d\u79f0\u4e3a`python3.11.0`\\n\\n```bash\\npyenv virtualenv 3.11.0 python3.11.0\\npyenv activate 3.11.0/envs/python3.11.0\\n```\\n\\n### \u8ffd\u52a0`pyenv activate`\u5230`~/.bashrc`\\n\\n\u5c06\u4ee5\u4e0b\u914d\u7f6e\u6dfb\u52a0\u5230`~/.bashrc`, \u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u6bcf\u6b21\u6253\u5f00`terminal`\u65f6\u81ea\u52a8\u6fc0\u6d3b`virtualenv`.\\n\\n```bash\\npyenv activate python3.11.0\\n```\\n\\n## \u5907\u6ce8\\n\\n### \u5e38\u7528\u547d\u4ee4\\n\\n- \u5b89\u88c5\u7279\u5b9a\u7248\u672c\u7684python\\n\\n```bash\\npyenv install <python-version>\\n```\\n\\n- \u521b\u5efa\u865a\u62df\u73af\u5883\\n\\n```bash\\npyenv virtualenv <python-version> <virtualenv-name>\\n```\\n\\n- \u5217\u51fa\u6240\u6709\u865a\u62df\u73af\u5883\\n\\n```bash\\npyenv virtualenvs\\n```\\n\\n- \u4f7f\u7528\u865a\u62df\u73af\u5883\\n\\n```bash\\npyenv activate <python-version>/envs/<virtualenv-name>\\n```\\n\\n- \u89e3\u9664\u865a\u62df\u73af\u5883\\n\\n```bash\\npyenv deactivate\\n```\\n\\n## \u53c2\u8003\\n\\n- [pyenv](https://github.com/pyenv/pyenv)\\n- [python repo](https://www.python.org/ftp/python/)"},{"id":"/2023/02/09/openjdk-project","metadata":{"permalink":"/blog/2023/02/09/openjdk-project","source":"@site/blog/2023-02-09/openjdk-project.md","title":"JDK\u6539\u8fdb\u9879\u76ee\u7684\u4ecb\u7ecd","description":"\u4ee5\u4e0b\u5217\u8868\u662f\u622a\u81f3\u5230\u76ee\u524dOpen JDK\u4e2d\u90e8\u5206\u8fdb\u884c\u7684\u5bf9JDK\u7684\u6539\u8fdb\u9879\u76ee","date":"2023-02-09T00:00:00.000Z","formattedDate":"February 9, 2023","tags":[{"label":"java","permalink":"/blog/tags/java"},{"label":"openjdk","permalink":"/blog/tags/openjdk"}],"readingTime":1.79,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["java","openjdk"]},"unlisted":false,"prevItem":{"title":"\u4f7f\u7528pyenv\u5b9e\u73b0python\u591a\u7248\u672c\u7ba1\u7406","permalink":"/blog/2023/02/10/pyenv"},"nextItem":{"title":"\u5728TestContainers\u4e2d\u5b9e\u73b0Docker registry\u8ba4\u8bc1","permalink":"/blog/2023/02/08/testcontainers-docker-registry"}},"content":"\u4ee5\u4e0b\u5217\u8868\u662f\u622a\u81f3\u5230\u76ee\u524d`Open JDK`\u4e2d\u90e8\u5206\u8fdb\u884c\u7684\u5bf9`JDK`\u7684\u6539\u8fdb\u9879\u76ee\\n\\n- Amber\\n- Galahad\\n- Leyden\\n- Lilliput\\n- Loom\\n- Panama\\n- Valhalla\\n\\n\u8fd9\u4e9b\u6539\u8fdb\u9879\u76ee\u7684\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u6539\u8fdb`Java`\u7684\u6027\u80fd\u548c\u5f00\u53d1\u4f53\u9a8c. \\n\u4ece\u800c\u4f7f`Java`\u80fd\u591f\u66f4\u597d\u5730\u9002\u5e94\u76ee\u524d\u7684\u8f6f\u4ef6\u5f00\u53d1\u9700\u6c42.<br/>\\n\u4ee5\u4e0b\u662f\u8fd9\u4e9b\u9879\u76ee\u7684\u7b80\u5355\u4ecb\u7ecd.\\n\\n\x3c!--truncate--\x3e\\n\\n## Amber\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u5728`Java`\u4e2d\u5f15\u5165\u65b0\u7684\u8bed\u6cd5\u6765\u6539\u8fdb`Java`\u7684\u5f00\u53d1\u4f53\u9a8c\\n\\n- [Project Amber](https://openjdk.org/projects/amber/)\\n\\n## Galahad\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u5c06`GraalVM`\u4e2d\u4f7f\u7528`Java`\u7f16\u7684`JIT`\u7f16\u8bd1\u5668\u66ff\u6362\u6389`OpenJDK`\u4e2d\u73b0\u6709\u7684`HotSpot`\u4e2d\u4f7f\u7528`C++`\u5b9e\u73b0\u7684`JIT`\u7f16\u8bd1\u5668.\\n\\n- [GraalVM, Galahad, and a New Release Schedule](https://medium.com/graalvm/graalvm-galahad-and-a-new-release-schedule-d081d1031bba)\\n\\n## Leyden\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u6539\u8fdb`Java`\u7a0b\u5e8f\u7684\u542f\u52a8\u65f6\u95f4\\n\\n- [Project Leyden](https://openjdk.org/projects/leyden/)\\n\\n## Lilliput\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u5c06`Java`\u4e2d\u5bf9\u8c61\u7684\u5934\u90e8\u4fe1\u606f\u4ece`128`\u4f4d\u538b\u7f29\u5230`64`\u4f4d\u6216\u66f4\u4f4e, \u4ece\u800c\u6539\u5584`Java`\u7a0b\u5e8f\u7684\u5185\u5b58\u5360\u7528\\n\\n- [Lilliput](https://openjdk.org/projects/lilliput/)\\n\\n## Loom\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u5728Java\u4e2d\u5f15\u5165\u534f\u7a0b(`coroutine`)\u4ee5\u6539\u8fdbJava\u7684\u5e76\u53d1\u6027\u80fd\\n\\n- [Loom - Fibers, Continuations and Tail-Calls for the JVM](https://openjdk.org/projects/loom/)\\n\\n## Panama\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u63d0\u4f9b\u66f4\u597d\u7684`Java`\u4e0e\u7b2c\u4e09\u65b9\u4ee3\u7801\u7684\u4e92\u64cd\u4f5c\u6027, \u4f7f`Java`\u4e0e\u975e`Java`\u7f16\u5199\u7684\u4ee3\u7801\u80fd\u591f\u66f4\u597d\u5730\u4ea4\u4e92\\n\\n- [Project Panama: Interconnecting JVM and native code](https://openjdk.org/projects/panama/)\\n\\n## Valhalla\\n\\n\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f\u5728`Java`\u4e2d\u589e\u52a0`Value Type`\u7684\u529f\u80fd\u4ee5\u63d0\u9ad8`Java`\u7a0b\u5e8f\u7684\u6027\u80fd\u548c\u5185\u5b58\u6548\u7387\\n\\n- [Project Valhalla](https://openjdk.org/projects/valhalla/)"},{"id":"/2023/02/08/testcontainers-docker-registry","metadata":{"permalink":"/blog/2023/02/08/testcontainers-docker-registry","source":"@site/blog/2023-02-08/testcontainers-docker-registry.md","title":"\u5728TestContainers\u4e2d\u5b9e\u73b0Docker registry\u8ba4\u8bc1","description":"\u5728docker registry\u914d\u7f6e\u4e86\u8ba4\u8bc1\u540e, \u9879\u76ee\u4e2dCICD\u4e2d\u8fd0\u884c\u7684test case\u5931\u8d25, \u9519\u8bef\u65e5\u5fd7\u5982\u4e0b","date":"2023-02-08T00:00:00.000Z","formattedDate":"February 8, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"testcontainers","permalink":"/blog/tags/testcontainers"},{"label":"docker","permalink":"/blog/tags/docker"}],"readingTime":0.99,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","testcontainers","docker"]},"unlisted":false,"prevItem":{"title":"JDK\u6539\u8fdb\u9879\u76ee\u7684\u4ecb\u7ecd","permalink":"/blog/2023/02/09/openjdk-project"},"nextItem":{"title":"\u901a\u8fc7\u8c03\u7528shell\u6a21\u5757\u6765\u89e3\u51b3\u65e7\u7248\u672cansible\u65e0\u6cd5\u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\u7684\u95ee\u9898","permalink":"/blog/2023/02/07/use-chage-command-to-set-password-never-expire"}},"content":"\u5728`docker registry`\u914d\u7f6e\u4e86\u8ba4\u8bc1\u540e, \u9879\u76ee\u4e2d`CICD`\u4e2d\u8fd0\u884c\u7684`test case`\u5931\u8d25, \u9519\u8bef\u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\nCaused by: org.testcontainers.containers.ContainerFetchException: Can\'t get Docker image: RemoteDockerImage(imageName=hub.fastonetech.com/cce/fastone-auditing:latest, imagePullPolicy=AlwaysPullPolicy(), imageNameSubstitutor=org.testcontainers.utility.ImageNameSubstitutor$LogWrappedImageNameSubstitutor@3b68a50c)\\n\\tat app//org.testcontainers.containers.GenericContainer.getDockerImageName(GenericContainer.java:1371)\\n\\tat app//org.testcontainers.containers.GenericContainer.logger(GenericContainer.java:651)\\n\\tat app//org.testcontainers.containers.GenericContainer.doStart(GenericContainer.java:331)\\n\\t... 153 more\\nCaused by: org.testcontainers.containers.ContainerFetchException: Failed to pull image: hub.fastonetech.com/cce/fastone-auditing:latest\\n\\tat app//org.testcontainers.images.RemoteDockerImage.resolve(RemoteDockerImage.java:119)\\n\\tat app//org.testcontainers.images.RemoteDockerImage.resolve(RemoteDockerImage.java:28)\\n\\tat app//org.testcontainers.utility.LazyFuture.getResolvedValue(LazyFuture.java:17)\\n\\tat app//org.testcontainers.utility.LazyFuture.get(LazyFuture.java:39)\\n\\tat app//org.testcontainers.containers.GenericContainer.getDockerImageName(GenericContainer.java:1369)\\n\\t... 155 more\\nCaused by: com.github.dockerjava.api.exception.InternalServerErrorException: Status 500: {\\"message\\":\\"unauthorized: unauthorized to access repository: cce/fastone-auditing, action: pull: unauthorized to access repository: cce/fastone-auditing, action: pull\\"}\\n\\n\\tat app//org.testcontainers.shaded.com.github.dockerjava.core.DefaultInvocationBuilder.execute(DefaultInvocationBuilder.java:247)\\n\\tat app//org.testcontainers.shaded.com.github.dockerjava.core.DefaultInvocationBuilder.lambda$executeAndStream$1(DefaultInvocationBuilder.java:269)\\n\\tat java.base@17.0.1/java.lang.Thread.run(Thread.java:833)\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u6839\u636e\u4e0a\u8ff0\u65e5\u5fd7\u4e2d\u7684\u5173\u952e\u4fe1\u606f\u5f97\u51fa\u7531\u4e8e`docker registry`\u672a\u8ba4\u8bc1\u5bfc\u81f4\u8be5\u95ee\u9898\u7684\u51fa\u73b0\\n\\n```log\\nCaused by: com.github.dockerjava.api.exception.InternalServerErrorException: Status 500: {\\"message\\":\\"unauthorized: unauthorized to access repository: cce/fastone-auditing, action: pull: unauthorized to access repository: cce/fastone-auditing, action: pull\\"}\\n```\\n\\n\u6267\u884c`docker login`\u547d\u4ee4\uff0c\u7136\u540e\u4ece`~/.docker/config.json`\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u4f5c\u4e3a`DOCKER_AUTH_CONFIG`\u73af\u5883\u53d8\u91cf\u7684\u503c\\n\\n```bash\\ndocker login -u <username> -p <password> <registry>\\nDOCKER_AUTH_CONFIG=\\"\\"\\nDOCKER_AUTH_CONFIG=$(cat ~/.docker/config.json)\\nexport DOCKER_AUTH_CONFIG\\n```\\n\\n## \u53c2\u8003\\n\\n- [Docker registry authentication](https://www.testcontainers.org/supported_docker_environment/#docker-registry-authentication)"},{"id":"/2023/02/07/use-chage-command-to-set-password-never-expire","metadata":{"permalink":"/blog/2023/02/07/use-chage-command-to-set-password-never-expire","source":"@site/blog/2023-02-07/use-chage-command-to-set-password-never-expire.md","title":"\u901a\u8fc7\u8c03\u7528shell\u6a21\u5757\u6765\u89e3\u51b3\u65e7\u7248\u672cansible\u65e0\u6cd5\u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\u7684\u95ee\u9898","description":"\u6700\u8fd1\u7ebf\u4e0a\u53d1\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898, \u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u7531\u4e8e\u7cfb\u7edf\u7528\u6237\u8fc7\u671f\u5bfc\u81f4\u7528\u6237\u65e0\u6cd5\u5728web\u901a\u8fc7SSH/VNC\u8fde\u63a5\u96c6\u7fa4, \u4e0b\u9762\u5c06\u4ecb\u7ecd\u8fd9\u4e2a\u95ee\u9898\u7684\u5177\u4f53\u7ec6\u8282\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848.","date":"2023-02-07T00:00:00.000Z","formattedDate":"February 7, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"ansible","permalink":"/blog/tags/ansible"},{"label":"ssh","permalink":"/blog/tags/ssh"}],"readingTime":3.105,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","ansible","ssh"]},"unlisted":false,"prevItem":{"title":"\u5728TestContainers\u4e2d\u5b9e\u73b0Docker registry\u8ba4\u8bc1","permalink":"/blog/2023/02/08/testcontainers-docker-registry"},"nextItem":{"title":"\u5f53\u8c03\u5ea6\u670d\u52a1\u63a5\u53e3\u65f6\u62a5\u9519\u63d0\u793acannot execute UPDATE in a read-only transaction\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/01/30/fix-cannot-execute-update-in-a-readonly-transaction"}},"content":"\u6700\u8fd1\u7ebf\u4e0a\u53d1\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898, \u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u7531\u4e8e\u7cfb\u7edf\u7528\u6237\u8fc7\u671f\u5bfc\u81f4\u7528\u6237\u65e0\u6cd5\u5728`web`\u901a\u8fc7`SSH/VNC`\u8fde\u63a5\u96c6\u7fa4, \u4e0b\u9762\u5c06\u4ecb\u7ecd\u8fd9\u4e2a\u95ee\u9898\u7684\u5177\u4f53\u7ec6\u8282\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848.\\n\\n\x3c!--truncate--\x3e\\n\\n## \u539f\u56e0\\n\\n\u67e5\u770b\u8d1f\u8d23\u521b\u5efa`SSH/VNC`\u7684\u670d\u52a1\u7684\u65e5\u5fd7\u53d1\u73b0\u8be5\u670d\u52a1\u5728\u4f7f\u7528\u5bf9\u5e94\u8282\u70b9\u4e0a\u7684\u7cfb\u7edf\u7528\u6237\u8fdb\u884c`ssh`\u8fde\u63a5\u65f6\u62a5\u9519, \u9519\u8bef\u63d0\u793a`Auth fail`.<br/>\\n\u767b\u5f55\u5230\u5bf9\u5e94\u8282\u70b9\u67e5\u770b\u7cfb\u7edf\u7528\u6237\u7684\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4, \u53d1\u73b0\u5bc6\u7801\u5df2\u7ecf\u8fc7\u671f, \u5bfc\u81f4\u65e0\u6cd5\u4f7f\u7528\u8be5\u7528\u6237\u8fdb\u884c`ssh`\u8fde\u63a5.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u4fee\u6539`ansible`\u4e2d\u7684`fs-base.yml`\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\\n\\n```yaml\\n- name: unlock and set xxx user never expire\\n  hosts: all\\n  become: yes\\n  gather_facts: no\\n  any_errors_fatal: no\\n  tasks:\\n    - name: unlock and set xxx user never expire\\n      user:\\n        name: xxx\\n        password: \'xxx\'\\n        update_password: always\\n        expires: -1\\n    - name: set max expire to 100 years\\n      shell: chage -M 36500 xxx\\n```\\n\\n## \u6392\u67e5\u6b65\u9aa4\\n\\n\u4f7f\u7528\u4e91\u5382\u5546\u63d0\u4f9b\u7684`login user`\u767b\u5f55\u5230\u5bf9\u5e94\u5934\u8282\u70b9\u5c1d\u8bd5\u4f7f\u7528\u7cfb\u7edf\u7528\u6237\u8fdb\u884cssh\u8fde\u63a5, \u53d1\u73b0\u65e0\u6cd5\u8fde\u63a5, \u62a5\u9519\u63d0\u793a\u5bc6\u7801\u8fc7\u671f<br/>\\n\\n```bash\\nsudo ssh -i /home/xxx/.ssh/id_rsa xxx@localhost\\n```\\n\\n\u6392\u67e5`deploy`\u5bf9\u5e94\u5173\u4e8e\u8d26\u6237\u7684\u914d\u7f6e\u4ee3\u7801, \u5176\u662f\u5b9e\u73b0\u662f\u57fa\u4e8e`ansible`\u7684`user`\u6a21\u5757\u5b8c\u6210\u7684, \u76f8\u5e94\u4ee3\u7801\u5982\u4e0b<br/>\\n\\n```yml\\n- name: unlock and set xxx user never expire\\n  hosts: all\\n  become: yes\\n  gather_facts: no\\n  any_errors_fatal: no\\n  tasks:\\n    - name: unlock and set xxx user never expire\\n      user:\\n        name: xxx\\n        password: \'\'\\n        update_password: always\\n        expires: -1\\n```\\n\\n\u5176\u4e2d`expires`\u8bbe\u7f6e\u4e3a\u4e86-1, \u8fd9\u4e2a\u53ea\u80fd\u6539\u53d8\u8d26\u6237\u7684\u8fc7\u671f\u65f6\u95f4\u800c\u4e0d\u4f1a\u6539\u53d8\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4, \u9700\u8981\u67e5\u770buser\u6a21\u5757\u7684\u6587\u6863\u6765\u67e5\u770b\u5bf9\u5e94\u7684\u53c2\u6570<br/>\\n\\n\u5728ansible\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u4e86\u5bf9\u5e94\u53c2\u6570, \u53c2\u6570\u5982\u4e0b<br/>\\n\\n```text\\npassword_expire_max | added in ansible-core 2.11 | Maximum number of days between password change. Supported on Linux only.\\npassword_expire_min | added in ansible-core 2.11 | Minimum number of days between password change. Supported on Linux only.\\n```\\n\\n\u7531\u4e8e\u6211\u4eec\u7684`ansible`\u7248\u672c\u4e3a`2.10`, \u65e0\u6cd5\u4f7f\u7528\u8fd9\u4e24\u4e2a\u53c2\u6570, \u6240\u4ee5\u9700\u8981\u53e6\u4e00\u79cd\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898<br/>\\n\u76ee\u524d\u6700\u5feb\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u65b0\u5efa\u4e00\u4e2atask, \u901a\u8fc7`shell`\u6a21\u5757\u6765\u6267\u884c`chage`\u547d\u4ee4\u6765\u4fee\u6539\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4, \u4ee3\u7801\u5982\u4e0b<br/>\\n\\n```yaml\\n- name: unlock and set xxx user never expire\\n  hosts: all\\n  become: yes\\n  gather_facts: no\\n  any_errors_fatal: no\\n  tasks:\\n    - name: unlock and set xxx user never expire\\n      user:\\n        name: xxx\\n        password: \'xxx\'\\n        update_password: always\\n        expires: -1\\n    - name: set max expire to 100 years\\n      shell: chage -M 36500 xxx\\n```\\n\\n## \u53c2\u8003\\n\\n- [ansible.builtin.user module \u2013 Manage user accounts](https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html)\\n- [User password expiration - Ansible module user](https://www.ansiblepilot.com/articles/user-password-expiration-ansible-module-user/)\\n- [Linux: Set Password to NEVER Expire](https://www.shellhacks.com/linux-set-password-to-never-expire/)\\n- [Ansible User Module Tutorial](https://linuxhint.com/ansible-user-module-tutorial/)\\n- [Strong Password Generator](https://delinea.com/resources/password-generator-it-tool)"},{"id":"/2023/01/30/fix-cannot-execute-update-in-a-readonly-transaction","metadata":{"permalink":"/blog/2023/01/30/fix-cannot-execute-update-in-a-readonly-transaction","source":"@site/blog/2023-01-30/fix-cannot-execute-update-in-a-readonly-transaction.md","title":"\u5f53\u8c03\u5ea6\u670d\u52a1\u63a5\u53e3\u65f6\u62a5\u9519\u63d0\u793acannot execute UPDATE in a read-only transaction\u95ee\u9898\u89e3\u51b3","description":"\u524d\u7aef\u8bf7\u6c42\u670d\u52a1\u76f8\u5e94\u63a5\u53e3\u62a5\u9519, \u65e5\u5fd7\u5982\u4e0b","date":"2023-01-30T00:00:00.000Z","formattedDate":"January 30, 2023","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"kotlin","permalink":"/blog/tags/kotlin"},{"label":"java","permalink":"/blog/tags/java"},{"label":"postgresql","permalink":"/blog/tags/postgresql"}],"readingTime":2.55,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","kotlin","java","postgresql"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u8c03\u7528shell\u6a21\u5757\u6765\u89e3\u51b3\u65e7\u7248\u672cansible\u65e0\u6cd5\u8bbe\u7f6e\u5bc6\u7801\u8fc7\u671f\u65f6\u95f4\u7684\u95ee\u9898","permalink":"/blog/2023/02/07/use-chage-command-to-set-password-never-expire"},"nextItem":{"title":"TestContainers\u542f\u52a8\u5b8cfastone-auditing\u5bb9\u5668\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u62a5\u9519","permalink":"/blog/2022/12/29/testcontainers-connection-reset"}},"content":"\u524d\u7aef\u8bf7\u6c42\u670d\u52a1\u76f8\u5e94\u63a5\u53e3\u62a5\u9519, \u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\n2023-01-30 12:10:14.822  WARN 1 --- [nio-4396-exec-6] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 0, SQLState: 25006\\n2023-01-30 12:10:14.822 ERROR 1 --- [nio-4396-exec-6] o.h.engine.jdbc.spi.SqlExceptionHelper   : ERROR: cannot execute UPDATE in a read-only transaction\\n\\tat org.springframework.security.web.authentication.AnonymousAuthen\\n\\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:336)\\n\\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:81)\\n\\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:126)\\n\\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:336)\\n\\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:115)\\n\\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:121)\\n\\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:336)\\n\\tat org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:81)\\n\\tat org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:115)\\n\\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:327)\\n\\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)\\n\\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)\\n\\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\\n\\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)\\n\\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227)\\n\\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:764)\\n\\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)\\n\\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:684)\\n\\tat org.springframework.web.servlet.FrameworkServlet.doPut(FrameworkServlet.java:920)\\n\\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)\\n\\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:963)\\n\\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1067)\\n\\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\\n\\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808)\\n\\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)\\n\\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:117)\\n\\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150)\\n\\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)\\n\\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\\n\\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\\n\\tat jdk.internal.reflect.GeneratedMethodAccessor355.invoke(Unknown Source)\\n\\tat com.fastonetech.computecloud.api.regional.software.controller.LaunchableAppController.lastAccessAt(LaunchableAppController.kt:56)\\n\\tat com.fastonetech.computecloud.api.regional.software.service.UserSoftwareUsageServiceImpl$$EnhancerBySpringCGLIB$$1caff315.lastAccessAt(<generated>)\\n\\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:698)\\n\\tat org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:753)\\n\\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\\n\\tat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)\\n\\tat org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:407)\\n\\tat org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:654)\\n\\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:711)\\n\\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:743)\\n\\tat org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:562)\\n\\tat org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101)\\n\\tat org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:281)\\n\\tat org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.access$300(JdbcResourceLocalTransactionCoordinatorImpl.java:40)\\n\\tat org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.beforeCompletionCallback(JdbcResourceLocalTransactionCoordinatorImpl.java:183)\\n\\tat org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.beforeTransactionCompletion(JdbcCoordinatorImpl.java:448)\\n\\tat org.hibernate.internal.SessionImpl.beforeTransactionCompletion(SessionImpl.java:2380)\\n\\tat org.hibernate.internal.SessionImpl.flushBeforeTransactionCompletion(SessionImpl.java:3212)\\n\\tat org.hibernate.internal.SessionImpl.managedFlush(SessionImpl.java:453)\\n\\tat org.hibernate.internal.SessionImpl.doFlush(SessionImpl.java:1362)\\n\\tat org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:99)\\n\\tat org.hibernate.event.internal.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:40)\\n\\tat org.hibernate.event.internal.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:344)\\n\\tat org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:475)\\n\\tat java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:721)\\n\\tat org.hibernate.engine.spi.ActionQueue.lambda$executeActions$1(ActionQueue.java:478)\\n\\tat org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:604)\\n\\tat org.hibernate.action.internal.EntityUpdateAction.execute(EntityUpdateAction.java:201)\\n\\tat org.hibernate.persister.entity.AbstractEntityPersister.update(AbstractEntityPersister.java:3769)\\n\\tat org.hibernate.persister.entity.AbstractEntityPersister.updateOrInsert(AbstractEntityPersister.java:3355)\\n\\tat org.hibernate.persister.entity.AbstractEntityPersister.update(AbstractEntityPersister.java:3493)\\n\\tat org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:197)\\n\\tat com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)\\n\\tat com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)\\n\\tat org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:130)\\n\\tat org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:164)\\n\\tat org.postgresql.jdbc.PgStatement.execute(PgStatement.java:401)\\n\\tat org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:481)\\n\\tat org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:322)\\n\\tat org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2297)\\n\\tat org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2565)\\norg.postgresql.util.PSQLException: ERROR: cannot execute UPDATE in a read-only transaction\\n```\\n\\n## \u539f\u56e0\\n\\n> \u6570\u636e\u5e93\u91c7\u7528\u4e3b\u4ece\u67b6\u6784, \u7531\u4e8e\u4e3b\u5e93\u5b95\u673a, `Load balancer`\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e86\u4ece\u5e93, \u4ece\u5e93\u7684\u4e8b\u52a1\u4e3a`read only`\u5bfc\u81f4\u66f4\u65b0\u5931\u8d25\u3002\\n\\n\u540e\u7aef\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\\n\\n```kotlin\\n@javax.transaction.Transactional\\nfun lastAccessAt(id: Long, type: LaunchableAppType): UserSoftwareUsageDTO {\\n    val userId = authService.currentAsPortal().bind().userId\\n    val userSoftwareUsage =\\n        getOrElseCreate(userId, id, type).copy(lastAccessAt = ZonedDateTime.now()).let(repository::save)\\n    return UserSoftwareUsageDTO(\\n        userSoftwareUsage.appId,\\n        userSoftwareUsage.appType,\\n        userSoftwareUsage.lastAccessAt,\\n        userSoftwareUsage.collected\\n    )\\n}\\n```\\n\\n\u5176\u91c7\u7528\u7684`javax`\u7684`@Transactional`\u8fdb\u884c\u4e8b\u52a1\u63a7\u5236.<br/>\\n\u8be5\u6ce8\u89e3\u6ca1\u6709\u63d0\u4f9b\u663e\u5f0f\u6307\u5b9a\u6570\u636e\u5e93\u4e8b\u52a1\u7684\u8bfb\u5199\u884c\u4e3a\u76f8\u5173\u5c5e\u6027, \u662f\u5426\u662f\u53ea\u8bfb\u6216\u8005\u5199\u5165\u53ea\u80fd\u7531\u7531\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u884c\u4e3a\u51b3\u5b9a.<br/>\\n\\n\u5728`PostgreSQL`\u4e2d, \u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6765\u67e5\u770b\u9ed8\u8ba4\u7684\u8bfb\u5199\u884c\u4e3a\\n\\n```postgresql\\nshow default_transaction_read_only;\\n-- return true if default transaction is read only, false otherwise\\n```\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n1. \u6570\u636e\u5e93\u4e3b\u673a\u5b95\u673a\u65f6, \u4ece\u5e93\u5347\u7ea7\u4e3a\u4e3b\u5e93. \u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u6570\u636e\u5e93\u8bfb\u5199\u4e0d\u53d7\u5f71\u54cd\u3002\\n2. java\u4fa7\u9700\u8981\u91c7\u7528\u53ef\u4ee5\u663e\u5f0f\u63a7\u5236\u4e8b\u52a1\u662f\u5426\u4e3a`readonly`\u7684\u6846\u67b6, \u5982spring\u7684`@Transactional`\u6ce8\u89e3, \u8be5\u6ce8\u89e3\u63d0\u4f9b\u4e86`readOnly`\u5c5e\u6027,\\n   \u53ef\u4ee5\u663e\u5f0f\u63a7\u5236\u4e8b\u52a1\u7684\u8bfb\u5199\u884c\u4e3a\u3002\u8fd9\u6837\u53ef\u4ee5\u4e0d\u9690\u5f0f\u4f9d\u8d56\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u884c\u4e3a, \u4ece\u800c\u5728\u521b\u5efa\u4e8b\u52a1\u65f6\u63d0\u524d\u53d1\u73b0\u95ee\u9898\u3002\\n\\n## \u5907\u6ce8\\n\\n- [Client Connection Defaults](https://www.postgresql.org/docs/current/runtime-config-client.html)\\n- [\\"READ-ONLY\\" MODE FOR POSTGRESQL](https://jkatz05.com/post/postgres/postgres-read-only/)"},{"id":"/2022/12/29/testcontainers-connection-reset","metadata":{"permalink":"/blog/2022/12/29/testcontainers-connection-reset","source":"@site/blog/2022-12-29/testcontainers-connection-reset.md","title":"TestContainers\u542f\u52a8\u5b8cfastone-auditing\u5bb9\u5668\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u62a5\u9519","description":"TestContainers\u542f\u52a8\u5b8c\u5bb9\u5668\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u62a5\u9519","date":"2022-12-29T00:00:00.000Z","formattedDate":"December 29, 2022","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"testcontainers","permalink":"/blog/tags/testcontainers"},{"label":"docker","permalink":"/blog/tags/docker"}],"readingTime":5.605,"hasTruncateMarker":true,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","testcontainers","docker"]},"unlisted":false,"prevItem":{"title":"\u5f53\u8c03\u5ea6\u670d\u52a1\u63a5\u53e3\u65f6\u62a5\u9519\u63d0\u793acannot execute UPDATE in a read-only transaction\u95ee\u9898\u89e3\u51b3","permalink":"/blog/2023/01/30/fix-cannot-execute-update-in-a-readonly-transaction"},"nextItem":{"title":"\u901a\u8fc7\u5f15\u5165\u9632\u5fa1\u6027\u590d\u5236\u4ee5\u907f\u514dConcurrentModificationException","permalink":"/blog/2022/11/24/avoiding-the-concurrent-modification-exception"}},"content":"`TestContainers`\u542f\u52a8\u5b8c\u5bb9\u5668\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u62a5\u9519\\n\\n```log\\nfeign.RetryableException: Connection reset executing GET http://localhost:32772/javers/api/v1/snapshots?page=0&size=1&sort=commitMetadata.id%2CDESC\\n```\\n\\n\u5173\u952e`cause`\u5982\u4e0b\\n\\n```log\\nCaused by: java.net.SocketException: Connection reset\\n\\tat java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:323)\\n\\tat java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:350)\\n\\tat java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:803)\\n\\tat java.base/java.net.Socket$SocketInputStream.read(Socket.java:966)\\n\\tat org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137)\\n\\tat org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153)\\n\\tat org.apache.http.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:280)\\n\\tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:138)\\n\\tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:56)\\n\\tat org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:259)\\n\\tat org.apache.http.impl.DefaultBHttpClientConnection.receiveResponseHeader(DefaultBHttpClientConnection.java:163)\\n\\tat org.apache.http.impl.conn.CPoolProxy.receiveResponseHeader(CPoolProxy.java:157)\\n\\tat org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:273)\\n\\tat org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:125)\\n\\tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)\\n\\tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186)\\n\\tat org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)\\n\\tat org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)\\n\\tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)\\n\\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)\\n\\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:108)\\n\\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)\\n\\tat feign.httpclient.ApacheHttpClient.execute(ApacheHttpClient.java:81)\\n\\tat feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:121)\\n\\t... 101 more\\n```\\n\\n\x3c!--truncate--\x3e\\n\\n### \u539f\u56e0\\n\\n\u901a\u8fc7\u65e5\u5fd7\u53d1\u73b0\u62a5\u9519\u7684\u65f6\u95f4\u6bd4\u670d\u52a1\u542f\u52a8\u6210\u529f\u7684\u65f6\u95f4\u8981\u65e9, \u8bf4\u660e\u670d\u52a1\u8fd8\u6ca1\u6709\u8fbe\u5230\u53ef\u4ee5\u63a5\u53d7\u8bf7\u6c42\u7684\u72b6\u6001<br/>\\n`TestContainers`\u5224\u65ad\u5bb9\u5668\u662f\u5426\u542f\u52a8\u6210\u529f\u662f\u6839\u636e`WaitStrategy`\u6765\u5224\u65ad\u7684, \u4ee3\u7801\u5982\u4e0b<br/>\\n\\n```java\\npublic class GenericContainer<SELF extends GenericContainer<SELF>>\\n\\t\\textends FailureDetectingExternalResource\\n\\t\\timplements Container<SELF>, AutoCloseable, WaitStrategyTarget, Startable {\\n\\n\\t@NonNull\\n\\tprotected org.testcontainers.containers.wait.strategy.WaitStrategy waitStrategy = Wait.defaultWaitStrategy();\\n\\n}\\n\\npublic class Wait {\\n\\n\\t/**\\n\\t * Convenience method to return the default WaitStrategy.\\n\\t *\\n\\t * @return a WaitStrategy\\n\\t */\\n\\tpublic static WaitStrategy defaultWaitStrategy() {\\n\\t\\treturn forListeningPort();\\n\\t}\\n\\n\\t/**\\n\\t * Convenience method to return a WaitStrategy for an exposed or mapped port.\\n\\t *\\n\\t * @return the WaitStrategy\\n\\t * @see HostPortWaitStrategy\\n\\t */\\n\\tpublic static HostPortWaitStrategy forListeningPort() {\\n\\t\\treturn new HostPortWaitStrategy();\\n\\t}\\n\\n}\\n\\n```\\n\\n\u9ed8\u8ba4\u7684`WaitStrategy`\u662f`HostPortWaitStrategy`, \u8fd9\u79cd\u65b9\u5f0f\u6709\u4ee5\u4e0b\u95ee\u9898\\n\\n- \u7aef\u53e3\u88ab\u76d1\u542c\u5e76\u4e0d\u4e00\u5b9a\u8bf4\u660e\u670d\u52a1\u8fdb\u5165\u4e86\u53ef\u4ee5\u53ef\u4ee5\u63a5\u53d7\u8bf7\u6c42\u7684\u72b6\u6001\\n- \u5728`springboot`\u4e2d`tomcat`\u5f00\u59cb\u76d1\u542c\u7aef\u53e3\u4e4b\u540e\u8fd8\u6709\u522b\u7684\u4e8b\u60c5\u8981\u505a\\n- \u53ea\u6709\u670d\u52a1\u771f\u6b63\u53ef\u4ee5\u63a5\u53e3\u8bf7\u6c42\u624d\u8bf4\u660e\u5bb9\u5668\u542f\u52a8\u6210\u529f\\n\\n\u5bb9\u5668\u65e5\u5fd7\u5982\u4e0b\\n\\n```log\\nSetting Active Processor Count to 16\\nCalculating JVM memory based on 2844780K available memory\\nFor more information on this calculation, see https://paketo.io/docs/reference/java-reference/#memory-calculator\\nCalculated JVM Memory Configuration: -XX:MaxDirectMemorySize=10M -Xmx2427024K -XX:MaxMetaspaceSize=110555K -XX:ReservedCodeCacheSize=240M -Xss1M (Total Memory: 2844780K, Thread Count: 50, Loaded Class Count: 17105, Headroom: 0%)\\nEnabling Java Native Memory Tracking\\nAdding 124 container CA certificates to JVM truststore\\nSpring Cloud Bindings Enabled\\nPicked up JAVA_TOOL_OPTIONS: -Djava.security.properties=/layers/paketo-buildpacks_bellsoft-liberica/java-security-properties/java-security.properties -XX:+ExitOnOutOfMemoryError -XX:ActiveProcessorCount=16 -XX:MaxDirectMemorySize=10M -Xmx2427024K -XX:MaxMetaspaceSize=110555K -XX:ReservedCodeCacheSize=240M -Xss1M -XX:+UnlockDiagnosticVMOptions -XX:NativeMemoryTracking=summary -XX:+PrintNMTStatistics -Dorg.springframework.cloud.bindings.boot.enable=true\\n\\n  .   ____          _            __ _ _\\n /\\\\\\\\ / ___\'_ __ _ _(_)_ __  __ _ \\\\ \\\\ \\\\ \\\\\\n( ( )\\\\___ | \'_ | \'_| | \'_ \\\\/ _` | \\\\ \\\\ \\\\ \\\\\\n \\\\\\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\\n  \'  |____| .__|_| |_|_| |_\\\\__, | / / / /\\n =========|_|==============|___/=/_/_/_/\\n :: Spring Boot ::                (v3.0.0)\\n\\n2022-12-29T12:55:59.290Z  INFO 1 --- [           main] c.f.a.FastoneAuditingApplicationKt       : Starting FastoneAuditingApplicationKt using Java 17.0.5 with PID 1 (/workspace/BOOT-INF/classes started by cnb in /workspace)\\n2022-12-29T12:55:59.295Z  INFO 1 --- [           main] c.f.a.FastoneAuditingApplicationKt       : No active profile set, falling back to 1 default profile: \\"default\\"\\n2022-12-29T12:56:00.102Z  INFO 1 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.\\n2022-12-29T12:56:00.158Z  INFO 1 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 47 ms. Found 4 JPA repository interfaces.\\n2022-12-29T12:56:00.479Z  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 6666 (http)\\n2022-12-29T12:56:00.490Z  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]\\n2022-12-29T12:56:00.491Z  INFO 1 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.1]\\n2022-12-29T12:56:00.547Z  INFO 1 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\\n2022-12-29T12:56:00.548Z  INFO 1 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1160 ms\\n2022-12-29T12:56:00.654Z  INFO 1 --- [           main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.5.1 by Redgate\\n2022-12-29T12:56:00.654Z  INFO 1 --- [           main] o.f.c.internal.license.VersionPrinter    : See what\'s new here: https://flywaydb.org/documentation/learnmore/releaseNotes#9.5.1\\n2022-12-29T12:56:00.655Z  INFO 1 --- [           main] o.f.c.internal.license.VersionPrinter    : \\n2022-12-29T12:56:00.664Z  INFO 1 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...\\n2022-12-29T12:56:00.760Z  INFO 1 --- [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4cffcc61\\n2022-12-29T12:56:00.762Z  INFO 1 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.\\n2022-12-29T12:56:00.776Z  INFO 1 --- [           main] o.f.c.i.database.base.BaseDatabaseType   : Database: jdbc:postgresql://tc-mGu8Gk79/auditing (PostgreSQL 12.10)\\n2022-12-29T12:56:00.795Z  INFO 1 --- [           main] o.f.core.internal.command.DbValidate     : Successfully validated 1 migration (execution time 00:00.008s)\\n2022-12-29T12:56:00.803Z  INFO 1 --- [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table \\"public\\".\\"flyway_schema_history\\" ...\\n2022-12-29T12:56:00.825Z  INFO 1 --- [           main] o.f.core.internal.command.DbMigrate      : Current version of schema \\"public\\": << Empty Schema >>\\n2022-12-29T12:56:00.832Z  INFO 1 --- [           main] o.f.core.internal.command.DbMigrate      : Migrating schema \\"public\\" to version \\"1 - Init\\"\\n2022-12-29T12:56:00.849Z  INFO 1 --- [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema \\"public\\", now at version v1 (execution time 00:00.027s)\\n2022-12-29T12:56:00.903Z  INFO 1 --- [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]\\n2022-12-29T12:56:00.926Z  INFO 1 --- [           main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.1.5.Final\\n2022-12-29T12:56:01.010Z  WARN 1 --- [           main] org.hibernate.orm.deprecation            : HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead\\n2022-12-29T12:56:01.085Z  INFO 1 --- [           main] SQL dialect                              : HHH000400: Using dialect: org.hibernate.dialect.PostgreSQLDialect\\n2022-12-29T12:56:01.428Z  INFO 1 --- [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]\\n2022-12-29T12:56:01.432Z  INFO 1 --- [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit \'default\'\\n2022-12-29T12:56:02.256Z  WARN 1 --- [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning\\n2022-12-29T12:56:02.533Z  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 6666 (http) with context path \'\'\\n2022-12-29T12:56:02.547Z  INFO 1 --- [           main] c.f.a.FastoneAuditingApplicationKt       : Started FastoneAuditingApplicationKt in 3.642 seconds (process running for 3.961)\\n2022-12-29T12:56:03.536Z  INFO 1 --- [nio-6666-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet \'dispatcherServlet\'\\n2022-12-29T12:56:03.537Z  INFO 1 --- [nio-6666-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet \'dispatcherServlet\'\\n2022-12-29T12:56:03.538Z  INFO 1 --- [nio-6666-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms\\n```\\n\\n> 2022-12-29T12:56:00.479Z INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized\\n> with port(s): 6666 (http)<br/>\\n> 2022-12-29T12:56:02.547Z INFO 1 --- [           main] c.f.a.FastoneAuditingApplicationKt       : Started\\n> FastoneAuditingApplicationKt in 3.642 seconds (process running for 3.961)<br/>\\n> \u901a\u5e38\u5728\u8fd9\u4e24\u4e2a\u9636\u6bb5\u4e2d\u95f4\u8fd8\u6709\u522b\u7684\u4e8b\u60c5\u4f1a\u505a, \u5982\u679c\u51fa\u73b0\u6bd4\u8f83\u6781\u7aef\u7684\u60c5\u51b5\u4f8b\u5982\u670d\u52a1\u7ec4\u4ef6\u8fc7\u591a,\u6216\u8005\u673a\u5668\u8d44\u6e90\u4e0d\u8db3,\\n> \u90a3\u4e48\u8fd9\u4e24\u4e2a\u9636\u6bb5\u4e2d\u95f4\u4f1a\u6709\u6bd4\u8f83\u5927\u7684\u65f6\u95f4\u5dee\u8ddd<br/>\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u914d\u7f6e`WaitStrategy`\u4e3a`HttpWaitStrategy`, \u4ee3\u7801\u5982\u4e0b\\n\\n```kotlin\\nval server = GenericContainer(\\"hub.fastonetech.com/infra/fastone-auditing:20221223-032350\\").apply {\\n\\twithImagePullPolicy(PullPolicy.alwaysPull())\\n\\twithNetwork(network)\\n\\twithEnv(\\n\\t\\tmapOf(\\n\\t\\t\\t\\"SERVER_TOMCAT_CONNECTIONTIMEOUT\\" to \\"60s\\",\\n\\t\\t\\t\\"SERVER_PORT\\" to \\"6666\\",\\n\\t\\t\\t\\"SPRING_DATASOURCE_URL\\" to \\"jdbc:postgresql://${postgres.networkAliases.first()}/auditing\\"\\n\\t\\t)\\n\\t)\\n\\twithExposedPorts(6666)\\n\\tdependsOn(postgres)\\n\\twaitingFor(Wait.forHttp(\\"/javers/api/v1/snapshots\\")) // We need to wait for the container to be able to respond to the request\\n\\tstart()\\n}\\n```\\n\\n### \u53c2\u8003\\n\\n- [HttpWaitStrategy](https://www.tabnine.com/code/java/classes/org.testcontainers.containers.wait.HttpWaitStrategy)"},{"id":"/2022/11/24/avoiding-the-concurrent-modification-exception","metadata":{"permalink":"/blog/2022/11/24/avoiding-the-concurrent-modification-exception","source":"@site/blog/2022-11-24/avoiding-the-concurrent-modification-exception.md","title":"\u901a\u8fc7\u5f15\u5165\u9632\u5fa1\u6027\u590d\u5236\u4ee5\u907f\u514dConcurrentModificationException","description":"\u5728consul\u4e2d\u4fee\u6539\u76f8\u5173\u670d\u52a1\u7684\u914d\u7f6e\u65f6\u5f15\u53d1ConcurrentModificationException\u5e76\u5bfc\u81f4\u534f\u7a0b\u4efb\u52a1\u5f02\u5e38\u9000\u51fa.","date":"2022-11-24T00:00:00.000Z","formattedDate":"November 24, 2022","tags":[{"label":"problem-solving","permalink":"/blog/tags/problem-solving"},{"label":"kotlin","permalink":"/blog/tags/kotlin"},{"label":"java","permalink":"/blog/tags/java"},{"label":"consul","permalink":"/blog/tags/consul"}],"readingTime":1.315,"hasTruncateMarker":false,"authors":[{"name":"Xiangcheng Kuo","title":"programmer on jvm platform","url":"https://github.com/orange-guo","imageURL":"https://github.com/orange-guo.png","key":"xiangcheng.kuo"}],"frontMatter":{"authors":["xiangcheng.kuo"],"tags":["problem-solving","kotlin","java","consul"]},"unlisted":false,"prevItem":{"title":"TestContainers\u542f\u52a8\u5b8cfastone-auditing\u5bb9\u5668\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u62a5\u9519","permalink":"/blog/2022/12/29/testcontainers-connection-reset"}},"content":"\u5728`consul`\u4e2d\u4fee\u6539\u76f8\u5173\u670d\u52a1\u7684\u914d\u7f6e\u65f6\u5f15\u53d1`ConcurrentModificationException`\u5e76\u5bfc\u81f4\u534f\u7a0b\u4efb\u52a1\u5f02\u5e38\u9000\u51fa.<br/>\\n\u76f8\u5173\u62a5\u9519\u5982\u4e0b:\\n\\n```log\\n2022-11-24 10:08:27.954  INFO 1 --- [TaskScheduler-1] b.c.PropertySourceBootstrapConfiguration : Located property source: [BootstrapPropertySource {name=\'bootstrapProperties-config/mgmt-scheduler/\'}, BootstrapPropertySource {name=\'bootstrapProperties-config/application/\'}]\\n2022-11-24 10:08:27.968  INFO 1 --- [TaskScheduler-1] o.s.boot.SpringApplication               : No active profile set, falling back to 1 default profile: \\"default\\"\\n2022-11-24 10:08:27.979  INFO 1 --- [TaskScheduler-1] o.s.boot.SpringApplication               : Started application in 0.244 seconds (JVM running for 7930.38)\\nException in thread \\"DefaultDispatcher-worker-6\\" java.util.ConcurrentModificationException\\nat java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:1013)\\nat java.base/java.util.ArrayList$Itr.next(ArrayList.java:967)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$1$1.invokeSuspend(ResourceDispatcher.kt:40)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$1$1.invoke(ResourceDispatcher.kt)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$1$1.invoke(ResourceDispatcher.kt)\\nat kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:89)\\nat kotlinx.coroutines.CoroutineScopeKt.coroutineScope(CoroutineScope.kt:264)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$1.dispatch(ResourceDispatcher.kt:16)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$3.schedule(ResourceDispatcher.kt:32)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$3.schedule(ResourceDispatcher.kt:27)\\nat com.fastonetech.scheduling.core.ResourceDispatcher$Companion$of$1$1$2$1.invokeSuspend(ResourceDispatcher.kt:19)\\nat kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\\nat kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)\\nat kotlinx.coroutines.internal.LimitedDispatcher.run(LimitedDispatcher.kt:42)\\nat kotlinx.coroutines.scheduling.TaskImpl.run(Tasks.kt:95)\\nat kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:570)\\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:749)\\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:677)\\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:664)\\nSuppressed: kotlinx.coroutines.DiagnosticCoroutineContextException: [StandaloneCoroutine{Cancelling}@19b8b4b6, Dispatchers.IO]\\n```\\n\\n## \u539f\u56e0\\n\\n\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u88ab\u4fee\u6539\u7684\u914d\u7f6e\u6620\u5c04\u5230\u4e86\u4ee3\u7801\u4e2d\u88ab`@ConfigurationProperties`\u6ce8\u89e3\u7684\u7c7b\u4e2d\u7684\u4e00\u4e2a`List`\u7c7b\u578b\u7684\u5c5e\u6027.<br/>\\n\u8be5\u5c5e\u6027\u88ab\u4fee\u6539\u65f6\u6070\u597d\u534f\u7a0b\u4efb\u52a1\u6b63\u5728\u904d\u5386\u8be5\u5c5e\u6027, \u4ece\u800c\u5bfc\u81f4`ConcurrentModificationException`\u5f02\u5e38.<br/>\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u6bcf\u6b21\u83b7\u53d6\u8be5\u5c5e\u6027\u65f6\u90fd\u8fdb\u884c\u4e00\u6b21\u9632\u5fa1\u6027\u590d\u5236, \u4ece\u800c\u907f\u514d`ConcurrentModificationException`\u5f02\u5e38\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Avoiding the ConcurrentModificationException in Java](https://www.baeldung.com/java-concurrentmodificationexception)\\n- [\u300aEffective Java\u300b\u5b66\u4e60\u65e5\u5fd7\uff08\u4e03\uff0950\uff1a\u5f53\u9700\u8981\u65f6\u8fdb\u884c\u9632\u5fa1\u6027\u590d\u5236](https://waltyou.github.io/Effective-Java-50-Make-Defensive-Copies-When-Needed/)"}]}')}}]);